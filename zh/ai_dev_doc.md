# AIå¼€å‘æ–‡æ¡£

## KPUç¡¬ä»¶åŸºæœ¬åŸç†ä»‹ç»

åœ¨è¾¹ç¼˜è®¡ç®—åœºæ™¯ä¸­ï¼ˆå¦‚ç‰©è”ç½‘è®¾å¤‡ã€æ™ºèƒ½æ‘„åƒå¤´ã€å·¥ä¸šæ£€æµ‹ç»ˆç«¯ã€å¯ç©¿æˆ´è®¾å¤‡ç­‰ï¼‰ï¼Œè®¾å¤‡é€šå¸¸éƒ¨ç½²åœ¨è¿œç¦»äº‘ç«¯æ•°æ®ä¸­å¿ƒçš„ç°åœºï¼Œé¢ä¸´ç€**å®æ—¶æ€§è¦æ±‚é«˜ã€ç½‘ç»œå¸¦å®½å—é™ã€æ•°æ®éšç§æ•æ„Ÿä»¥åŠåŠŸè€—çº¦æŸä¸¥æ ¼**çš„æŒ‘æˆ˜ã€‚åœ¨è¿™äº›åœºæ™¯ä¸‹è¿è¡Œå¤æ‚çš„AIæ¨¡å‹ï¼ˆå¦‚å›¾åƒè¯†åˆ«ã€ç›®æ ‡æ£€æµ‹ã€è¯­éŸ³å”¤é†’ï¼‰ï¼Œå¦‚æœä»…ä¾èµ–ä¼ ç»Ÿçš„é€šç”¨CPUè¿›è¡Œè®¡ç®—ï¼Œå¾€å¾€ä¼šé‡åˆ°**è®¡ç®—é‡è¿‡å¤§ã€å¤„ç†é€Ÿåº¦æ…¢ã€åŠŸè€—è¿‡é«˜**çš„é—®é¢˜ï¼Œéš¾ä»¥æ»¡è¶³å®æ—¶å“åº”å’Œèƒ½æ•ˆæ¯”çš„è¦æ±‚ã€‚

**KPUï¼ˆKnowledge Processing Unitï¼‰** æ˜¯å˜‰æ¥ ç§‘æŠ€ä¸“ä¸ºåº”å¯¹è¾¹ç¼˜AIè®¡ç®—æŒ‘æˆ˜è€Œè®¾è®¡çš„ç¡¬ä»¶åŠ é€Ÿå¼•æ“ã€‚å®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªé«˜åº¦ä¼˜åŒ–çš„**æ·±åº¦å­¦ä¹ åå¤„ç†å™¨/åŠ é€Ÿå™¨**ï¼Œå…¶æ ¸å¿ƒåŠŸèƒ½æ˜¯**é«˜æ•ˆæ‰§è¡Œç¥ç»ç½‘ç»œæ¨¡å‹ä¸­çš„å¯†é›†è®¡ç®—ä»»åŠ¡**ï¼ˆç‰¹åˆ«æ˜¯å·ç§¯ã€çŸ©é˜µä¹˜æ³•ã€æ¿€æ´»å‡½æ•°ç­‰æ“ä½œï¼‰ã€‚

**KPUçš„æ ¸å¿ƒä¼˜åŠ¿**ï¼šä¸“ç²¾ä¸é«˜æ•ˆ, ä¸é€šç”¨CPUç›¸æ¯”ï¼ŒKPUçš„ä¼˜åŠ¿åœ¨äºå…¶**ä¸“ç”¨åŒ–æ¶æ„**ï¼š

- **å¹¶è¡Œè®¡ç®—èƒ½åŠ›ï¼š** KPUå†…éƒ¨åŒ…å«å¤§é‡ä¸“ä¸ºç¥ç»ç½‘ç»œè®¡ç®—è®¾è®¡çš„å¤„ç†å•å…ƒï¼ˆPEï¼‰ï¼Œèƒ½å¤ŸåŒæ—¶å¤„ç†æµ·é‡æ•°æ®ï¼ˆå¦‚ç‰¹å¾å›¾ã€æƒé‡ï¼‰ï¼Œæ˜¾è‘—åŠ é€Ÿæ¨¡å‹æ¨ç†è¿‡ç¨‹ã€‚
- **ä¼˜åŒ–çš„æ•°æ®æµä¸å†…å­˜è®¿é—®ï¼š** é’ˆå¯¹ç¥ç»ç½‘ç»œè®¡ç®—æ¨¡å¼ï¼ˆå¦‚æ•°æ®å¤ç”¨ï¼‰è¿›è¡Œæ·±åº¦ä¼˜åŒ–ï¼Œå‡å°‘ä¸å¿…è¦çš„æ•°æ®æ¬è¿ï¼Œæœ€å¤§åŒ–åˆ©ç”¨å†…å­˜å¸¦å®½ï¼Œé™ä½å»¶è¿Ÿã€‚
- **é«˜èƒ½æ•ˆæ¯”ï¼š** ä¸“ç”¨ç”µè·¯è®¾è®¡é¿å…äº†CPUæ‰§è¡Œé€šç”¨æŒ‡ä»¤çš„å¼€é”€ï¼Œåœ¨æ‰§è¡Œç›¸åŒçš„AIè®¡ç®—ä»»åŠ¡æ—¶ï¼ŒKPUé€šå¸¸èƒ½æä¾›**æ•°åå€ç”šè‡³ä¸Šç™¾å€äºCPUçš„è®¡ç®—æ•ˆç‡ï¼ˆTOPS/Wï¼‰**ï¼Œåœ¨æœ‰é™çš„è¾¹ç¼˜è®¾å¤‡åŠŸè€—é¢„ç®—å†…å®ç°é«˜æ€§èƒ½AIå¤„ç†ã€‚
- **é™ä½CPUè´Ÿè½½ï¼š** å°†ç¹é‡çš„AIè®¡ç®—ä»»åŠ¡å¸è½½ï¼ˆOffloadï¼‰åˆ°KPUæ‰§è¡Œï¼Œé‡Šæ”¾å®è´µçš„CPUèµ„æºå»å¤„ç†è®¾å¤‡æ§åˆ¶ã€é€šä¿¡ã€ç”¨æˆ·äº¤äº’ç­‰å…¶ä»–å…³é”®ä»»åŠ¡ï¼Œæå‡ç³»ç»Ÿæ•´ä½“å“åº”èƒ½åŠ›å’Œç¨³å®šæ€§ã€‚

KPUæ”¯æŒå„ç§ä¸»æµçš„ç¥ç»ç½‘ç»œæ¨¡å‹ç»“æ„ï¼Œé€‚ç”¨äºå¹¿æ³›çš„è¾¹ç¼˜è§†è§‰AIåº”ç”¨åœºæ™¯ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š

- **å›¾åƒåˆ†ç±»ï¼š** è¯†åˆ«å›¾åƒä¸­çš„ç‰©ä½“ç±»åˆ«ï¼ˆå¦‚è¯†åˆ«æ°´æœç§ç±»ã€å·¥ä¸šé›¶ä»¶ï¼‰ã€‚
- **ç›®æ ‡æ£€æµ‹ï¼š** å®šä½å¹¶è¯†åˆ«å›¾åƒä¸­çš„å¤šä¸ªç›®æ ‡åŠå…¶ä½ç½®ï¼ˆå¦‚æ£€æµ‹è¡Œäººã€è½¦è¾†ã€ç¼ºé™·ï¼‰ã€‚
- **è¯­ä¹‰åˆ†å‰²ï¼š** å¯¹å›¾åƒä¸­çš„æ¯ä¸ªåƒç´ è¿›è¡Œåˆ†ç±»ï¼ˆå¦‚åŒºåˆ†é“è·¯ã€å¤©ç©ºã€å»ºç­‘ç‰©ï¼›åŒ»ç–—å›¾åƒåˆ†æï¼‰ã€‚
- **äººè„¸æ£€æµ‹ä¸è¯†åˆ«ï¼š** è®¾å¤‡ç«¯çš„äººè„¸éªŒè¯ã€é—¨ç¦è€ƒå‹¤ã€‚
- **å§¿æ€ä¼°è®¡ï¼š** åˆ†æäººä½“å…³èŠ‚ä½ç½®ï¼ˆå¦‚å¥èº«åŠ¨ä½œæŒ‡å¯¼ï¼‰ã€‚

**KPUåœ¨ç³»ç»Ÿä¸­çš„å®šä½ï¼š**

å®ƒé€šå¸¸ä½œä¸ºSoCï¼ˆSystem on Chipï¼‰ä¸­çš„ä¸€ä¸ªç‹¬ç«‹IPæ ¸å­˜åœ¨ï¼Œä¸CPUã€å†…å­˜ã€å¤–è®¾ç­‰ååŒå·¥ä½œã€‚CPUè´Ÿè´£ç³»ç»Ÿç®¡ç†ã€ä»»åŠ¡è°ƒåº¦å’Œåº”ç”¨é€»è¾‘ï¼Œè€Œå°†è®¡ç®—å¯†é›†å‹çš„AIæ¨¡å‹æ¨ç†ä»»åŠ¡é«˜æ•ˆåœ°äº¤ç»™KPUæ‰§è¡Œã€‚ä¸‹å›¾å±•ç¤ºäº†KPUåœ¨å…¸å‹è¾¹ç¼˜AI SoCä¸­çš„ä½ç½®ã€‚

![kpu_in_system](https://www.kendryte.com/api/post/attachment?id=610)

## K230 AI åº”ç”¨ç¤ºä¾‹å±•ç¤º

### åº”ç”¨ç¤ºä¾‹ç®€ä»‹

RT-Smart SDK çš„åº”ç”¨ç¤ºä¾‹ä½äº `src/rtsmart/examples` ç›®å½•ä¸‹ï¼Œè¿™é‡Œä¸ºä½ é€ä¸€ä»‹ç»å„ç±»ç¤ºä¾‹ï¼Œæ–¹ä¾¿å¿«é€Ÿä¸Šæ‰‹ã€‚

| åº”ç”¨ç›®å½•                        | è¯´æ˜                                                                                           | é€‚ç”¨åœºæ™¯                     |
| :-------------------------- | :------------------------------------------------------------------------------------------- | :----------------------- |
| **ai_poc**               | æ”¶å½•äº† **50+ AI åº”ç”¨ç¤ºä¾‹**ï¼Œå…¨é¢å±•ç¤º K230 èŠ¯ç‰‡çš„å¼ºå¤§æ€§èƒ½ä¸å¤šæ ·åŒ–åœºæ™¯æ”¯æŒã€‚ç¤ºä¾‹ä¸­å¯¹æ‘„åƒå¤´ã€æ˜¾ç¤ºã€å¤šåª’ä½“ç­‰åšäº†ç»Ÿä¸€å°è£…ï¼Œè®©ä½ ä¸“æ³¨äºæ¨¡å‹æ¨ç†ã€‚               | æƒ³ä¸€æ¬¡ä½“éªŒå„ç§ AI åº”ç”¨çš„åŒå­¦é‡ç‚¹å…³æ³¨       |
| **face_detection**       | äººè„¸æ£€æµ‹ç¤ºä¾‹ï¼Œæä¾› **å•æ¨¡å‹ä»»åŠ¡** çš„å®Œæ•´å‚è€ƒä»£ç ã€‚                                                                 | é€‚åˆå¼€å‘è‡ªå·±çš„ **å•æ¨¡å‹ AI åº”ç”¨**    |
| **face_recognition**     | äººè„¸è¯†åˆ«ç¤ºä¾‹ï¼Œæ¼”ç¤º **åŒæ¨¡å‹ä»»åŠ¡** çš„å®ç°æ–¹å¼ï¼Œå¯ç›´æ¥ç”¨äºå®é™…åœºæ™¯ã€‚                                                         | æƒ³åš **å¤šæ¨¡å‹ AI åº”ç”¨** çš„å¥½å‚è€ƒ    |
| **kpu_run_yolov8**      | ä»¥ YOLOv8 ä¸ºä¾‹ï¼Œå±•ç¤ºä»è¾“å…¥è®¾ç½®ã€é¢„å¤„ç†ã€æ¨ç†ã€åˆ°è¾“å‡ºåå¤„ç†çš„å…¨æµç¨‹ä»£ç ã€‚æ”¯æŒå›¾ç‰‡å’Œè§†é¢‘æ¨ç†ï¼ŒåŸºäºåº•å±‚ API å¼€å‘ï¼Œæ— åœºæ™¯å°è£…ã€‚                         | å­¦ä¹  **KPU æ¨ç†å…¨æµç¨‹** çš„å¿…å¤‡ç¤ºä¾‹   |
| **usage_ai2d**           | æ¼”ç¤º AI2D ç¡¬ä»¶æ”¯æŒçš„ **5 ç§é¢„å¤„ç†æ–¹æ³•**ï¼šè¯»å–å›¾ç‰‡ â†’ åˆ›å»º Tensor â†’ AI2D é¢„å¤„ç† â†’ ä¿å­˜ç»“æœã€‚                               | å­¦ä¼š **ç”¨ AI2D åšé¢„å¤„ç†**       |
| **YOLO**                  | å°è£…å¥½çš„ YOLO éƒ¨ç½²å·¥å…·ï¼Œæ”¯æŒ **YOLOv5 / YOLOv8 / YOLO11**ï¼Œè¦†ç›–åˆ†ç±»ã€æ£€æµ‹ã€åˆ†å‰²ã€æ—‹è½¬æ£€æµ‹å››ç±»ä»»åŠ¡ï¼Œæ”¯æŒå›¾ç‰‡/è§†é¢‘ä¸¤ç§éƒ¨ç½²æ¨¡å¼ï¼Œä¸€æ¬¡ç¼–è¯‘å¤šç§è¿è¡Œæ–¹å¼ã€‚ | **å¿«é€Ÿæµ‹è¯• YOLO ç³»åˆ—æ¨¡å‹**       |
| **uvc_face_detection**  | åŸºäº UVC æ‘„åƒå¤´çš„äººè„¸æ£€æµ‹ç¤ºä¾‹ï¼Œå·²å°è£…æ‘„åƒå¤´ã€æ˜¾ç¤ºã€æ ¼å¼è½¬æ¢ç­‰æ¨¡å—ï¼Œè®©ä½ ç›´æ¥å…³æ³¨æ¨ç†é€»è¾‘ã€‚                                              | å¼€å‘ **UVC æ‘„åƒå¤´ AI åº”ç”¨** çš„å‚è€ƒ |
| **opencv_examples**      | OpenCV åº”ç”¨ç¤ºä¾‹ï¼Œæ¼”ç¤ºåœ¨ RT-Smart ä¸Šä½¿ç”¨ OpenCV å¤„ç†å›¾åƒçš„æ–¹æ³•ã€‚                                                 | å±•ç¤º **OpenCV åœ¨K230 RTSmartä¸Šçš„ç”¨æ³•**   |
| **openblas_examples**     | OpenBLAS åº”ç”¨ç¤ºä¾‹ï¼Œæä¾›çŸ©é˜µè®¡ç®—çš„å‡ ä¸ªæ¡ˆä¾‹ï¼Œå±•ç¤ºåœ¨ RT-Smart ä¸Šçš„ä½¿ç”¨æ–¹æ³•ã€‚                                               | å±•ç¤º **Openblas åœ¨K230 RTSmartä¸Šçš„ç”¨æ³•**           |

### AI Demoä»‹ç»

ä¸ºäº†å¸®åŠ©å¼€å‘è€…å¿«é€Ÿä¸Šæ‰‹å¹¶ç›´è§‚ä½“éªŒ K230 å¼ºå¤§çš„è¾¹ç¼˜ AI èƒ½åŠ›ï¼ŒCanMV K230 é•œåƒå†…ç½®äº†ä¸°å¯Œå¤šæ ·çš„ AI ç¤ºä¾‹ç¨‹åº (AI Demo)ã€‚

è¿™äº›å¼€ç®±å³ç”¨çš„ Demo æ¶µç›–äº†å•æ¨¡å‹åº”ç”¨ï¼ˆå¦‚äººè„¸æ£€æµ‹ï¼‰å’Œå¤šæ¨¡å‹åº”ç”¨ï¼ˆå¦‚æ‰‹æŒå…³é”®ç‚¹ï¼‰ä¸¤å¤§ç±»åˆ«ï¼Œç”¨æˆ·æ— éœ€ä»é›¶æ­å»ºç¯å¢ƒï¼Œå³å¯é€šè¿‡é›¶é…ç½®ã€ä¸€é”®è¿è¡Œçš„æ–¹å¼ï¼Œä½“éªŒä¸»æµ AI åŠŸèƒ½ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š

- è§†è§‰åº”ç”¨ï¼š ç‰©ä½“è¯†åˆ«ã€äººè„¸æ£€æµ‹ã€æ‰‹åŠ¿è¯†åˆ«ã€äººä½“è¯†åˆ«ã€è½¦ç‰Œè¯†åˆ«ã€OCR æ–‡å­—è¯†åˆ«ã€‚
- éŸ³é¢‘åº”ç”¨ï¼š å…³é”®è¯è¯†åˆ« (KWS)ã€ä¸­æ–‡è¯­éŸ³åˆæˆ (TTS) ç­‰ã€‚

é€šè¿‡è¿™äº› Demoï¼Œå¼€å‘è€…å¯ä»¥å¿«é€ŸéªŒè¯æ¨¡å‹æ€§èƒ½ï¼Œç†Ÿæ‚‰ K230 çš„ AI æ¨ç†èƒ½åŠ›ï¼Œä¸ºåç»­çš„å®šåˆ¶åŒ–å¼€å‘æ‰“ä¸‹åšå®åŸºç¡€ã€‚

**è¿è¡Œæ–¹å¼ï¼š**

æ‰€æœ‰ Demo çš„æºä»£ç å‡å¼€æ”¾ã€ç»“æ„æ¸…æ™°ï¼Œç»Ÿä¸€å­˜æ”¾åœ¨ `src/rtsmart/examples/ai_poc` ç›®å½•ä¸‹ã€‚ç”¨æˆ·å¯ä»¥è‡ªè¡Œæ­å»ºç¼–è¯‘ç¯å¢ƒï¼Œå¹¶å®Œæˆaidemoçš„ç¼–è¯‘ã€è¿è¡Œã€è°ƒè¯•å’Œæ·±å…¥ç ”ç©¶è¿™äº›ä»£ç ï¼Œç†è§£ API è°ƒç”¨ã€æ•°æ®å¤„ç†æµç¨‹å’Œæ¨¡å‹é›†æˆæ–¹å¼ï¼Œæå¤§åœ°åŠ é€Ÿè‡ªèº«åº”ç”¨çš„å¼€å‘è¿›ç¨‹ã€‚å…·ä½“å†…å®¹è¯·å‚è€ƒæ–‡æ¡£ï¼š![AI Demoåº”ç”¨æŒ‡å—](./app_develop_guide/ai/aidemo.md)ã€‚

**æ³¨æ„äº‹é¡¹ï¼š**

- éƒ¨åˆ† Demo å› å†…å­˜å ç”¨è¾ƒé«˜ï¼Œåœ¨ K230D èŠ¯ç‰‡ä¸Šå¯èƒ½æ— æ³•æ­£å¸¸è¿è¡Œã€‚

- å…³äºK230å’ŒK230Dçš„åŒºåˆ«ï¼Œè¯·å‚è€ƒï¼š**[äº§å“ä¸­å¿ƒ](https://www.kendryte.com/zh/products)**

| Demo å­ç›®å½•           | åœºæ™¯                     |      è¯´æ˜                  |
| :-------------------- | ------------------------ |--------------------------- |
| anomaly_det           | å¼‚å¸¸æ£€æµ‹                 | å¼‚å¸¸æ£€æµ‹ç¤ºä¾‹æä¾›çš„æ¨¡å‹ä½¿ç”¨patchcoreå¼‚å¸¸æ£€æµ‹æ–¹æ³•è®­ç»ƒå¾—åˆ°ï¼Œèƒ½å¤Ÿä»è¾“å…¥å›¾ç‰‡ä¸­è¾¨åˆ«å‡ºç»ç’ƒç“¶å£æ˜¯å¦å­˜åœ¨å¼‚å¸¸ã€‚å¼‚å¸¸æ£€æµ‹é€šå¸¸ä¼šè¢«åº”ç”¨åœ¨å·¥ä¸šå›¾åƒæ£€æµ‹ã€åŒ»ç–—å›¾åƒåˆ†æã€å®‰é˜²ç›‘æ§ç­‰é¢†åŸŸã€‚                            |
| bytetrack             | å¤šç›®æ ‡è·Ÿè¸ª               | ByteTrackå¤šç›®æ ‡è¿½è¸ªç¤ºä¾‹ä½¿ç”¨YOLOv5ä½œä¸ºç›®æ ‡æ£€æµ‹ç®—æ³•ï¼Œåº”ç”¨å¡å°”æ›¼æ»¤æ³¢ç®—æ³•è¿›è¡Œè¾¹ç•Œæ¡†é¢„æµ‹ï¼Œåº”ç”¨åŒˆç‰™åˆ©ç®—æ³•è¿›è¡Œç›®æ ‡å’Œè½¨è¿¹é—´çš„åŒ¹é…ã€‚  |
| crosswalk_detect      | äººè¡Œæ¨ªé“æ£€æµ‹              | äººè¡Œæ¨ªé“æ£€æµ‹ä½¿ç”¨YOLOV5ç½‘ç»œï¼Œè¯¥åº”ç”¨å¯¹å›¾ç‰‡æˆ–è§†é¢‘ä¸­çš„äººè¡Œæ¨ªé“è¿›è¡Œæ£€æµ‹ï¼Œå¯ç”¨äºè¾…åŠ©é©¾é©¶ç­‰åœºæ™¯ã€‚                        |
| distraction_reminder  | éæ­£è§†æ£€æµ‹                  | éæ­£è§†æ£€æµ‹ç¤ºä¾‹ä¸»è¦é‡‡ç”¨äº†äººè„¸å§¿æ€ä¼°è®¡ä½œä¸ºåŸºç¡€ï¼Œé€šè¿‡é€»è¾‘åˆ¤æ–­å®ç°å¯¹å¸æœºæ³¨æ„åŠ›ä¸é›†ä¸­äºå‰æ–¹çš„æé†’ã€‚äººè„¸æ£€æµ‹é‡‡ç”¨äº†retina-faceæ¨¡å‹ï¼Œäººè„¸æœå‘ä¼°è®¡98ä¸ª2Då…³é”®ç‚¹æ‹Ÿåˆ                        |
| dms_system            | é©¾é©¶å‘˜ç›‘æ§ç³»ç»Ÿ             | dmsç¤ºä¾‹ä»¥æ‰‹æŒæ£€æµ‹å’Œäººè„¸æ£€æµ‹ä¸ºåŸºç¡€ï¼Œé€šè¿‡é€»è¾‘åˆ¤æ–­å®ç°å¯¹è¡Œé©¶è½¦è¾†å¸æœºçš„è¿è§„è¡Œä¸ºï¼ˆæŠ½çƒŸã€æ‰“ç”µè¯ã€å–æ°´ï¼‰è¿›è¡Œæé†’ã€‚äººè„¸æ£€æµ‹é‡‡ç”¨äº†retina-faceç½‘ç»œç»“æ„ï¼Œbackboneé€‰å–0.25-mobilenetã€‚æ‰‹æŒæ£€æµ‹é‡‡ç”¨äº†yolov5ç½‘ç»œç»“æ„ï¼Œbackboneé€‰å–äº†1.0-mobilenetV2ã€‚ |
| dynamic_gesture       | è§†è§‰åŠ¨æ€æ‰‹åŠ¿è¯†åˆ«            | è§†è§‰åŠ¨æ€æ‰‹åŠ¿è¯†åˆ«å¯ä»¥å¯¹ä¸Šä¸‹å·¦å³æ‘†æ‰‹å’Œäº”æŒ‡æåˆäº”ä¸ªåŠ¨ä½œè¿›è¡Œè¯†åˆ«ï¼Œç”¨äºéš”ç©ºæ“ä½œæ§åˆ¶åœºæ™¯ã€‚ æ‰‹æŒæ£€æµ‹é‡‡ç”¨äº†yolov5ç½‘ç»œç»“æ„ï¼Œbackboneé€‰å–äº†1.0-mobilenetV2ï¼Œæ‰‹æŒå…³é”®ç‚¹æ£€æµ‹é‡‡ç”¨äº†resnet50ç½‘ç»œç»“æ„,åŠ¨æ€æ‰‹åŠ¿è¯†åˆ«é‡‡ç”¨äº†tsmç»“æ„ï¼Œbackboneé€‰å–äº†mobilenetV2ã€‚                            |
| eye_gaze              | æ³¨è§†ä¼°è®¡                 |   æ³¨è§†ä¼°è®¡ç¤ºä¾‹æ ¹æ®äººè„¸é¢„æµ‹äººæ­£åœ¨çœ‹å“ªé‡Œï¼Œå¯¹è§†é¢‘å¸§æˆ–å›¾ç‰‡ï¼Œå…ˆè¿›è¡Œäººè„¸æ£€æµ‹ï¼Œç„¶åå¯¹æ¯ä¸ªäººè„¸è¿›è¡Œæ³¨è§†ä¼°è®¡ï¼Œé¢„æµ‹å‡ºæ³¨è§†å‘é‡ï¼Œå¹¶ä»¥ç®­å¤´çš„æ–¹å¼æ˜¾ç¤ºåˆ°å±å¹•ä¸Šã€‚è¯¥åº”ç”¨é‡‡ç”¨retina-faceç½‘ç»œå®ç°äººè„¸æ£€æµ‹ï¼Œä½¿ç”¨L2CS-Netå®ç°æ³¨è§†ä¼°è®¡ã€‚æ³¨è§†ä¼°è®¡å¯ä»¥åº”ç”¨åˆ°æ±½è½¦å®‰å…¨é¢†åŸŸã€‚                          |
| face_alignment        | äººè„¸å¯¹é½                 | äººè„¸å¯¹é½ç¤ºä¾‹å¯å¾—åˆ°å›¾åƒæˆ–è§†é¢‘ä¸­çš„æ¯ä¸ªäººè„¸çš„æ·±åº¦å›¾ï¼ˆdepthï¼‰æˆ–å½’ä¸€åŒ–æŠ•å½±åæ ‡ç¼–ç å›¾ã€‚äººè„¸æ£€æµ‹é‡‡ç”¨äº†retina-faceç½‘ç»œç»“æ„ï¼Œbackboneé€‰å–0.25-mobilenetï¼Œäººè„¸å¯¹é½ç½‘ç»œåŸºäº3DDFA(3D Dense Face Alignment)å®ç°ã€‚            |
| face_detection        | äººè„¸æ£€æµ‹                 |  äººè„¸æ£€æµ‹å®ä¾‹å¯å¾—åˆ°å›¾åƒæˆ–è§†é¢‘ä¸­çš„æ¯ä¸ªäººè„¸æ£€æµ‹æ¡†ä»¥åŠæ¯ä¸ªäººè„¸çš„å·¦çœ¼çƒ/å³çœ¼çƒ/é¼»å°–/å·¦å˜´è§’/å³å˜´è§’äº”ä¸ªå…³é”®ç‚¹ä½ç½®ã€‚äººè„¸æ£€æµ‹é‡‡ç”¨äº†retina-faceç½‘ç»œç»“æ„ï¼Œbackboneé€‰å–0.25-mobilenetã€‚                           |
| face_emotion          | é¢éƒ¨è¡¨æƒ…è¯†åˆ«              | é¢éƒ¨è¡¨æƒ…è¯†åˆ«ä½¿ç”¨ä¸¤ä¸ªæ¨¡å‹å®ç°å›¾åƒ/è§†é¢‘ä¸­æ¯ä¸ªäººçš„è¡¨æƒ…è¯†åˆ«çš„åŠŸèƒ½ï¼Œå¯è¯†åˆ«çš„è¡¨æƒ…ç±»åˆ«åŒ…æ‹¬Neutralã€Happinessã€Sadnessã€Angerã€Disgustã€Fearã€Surpriseã€‚äººè„¸æ£€æµ‹ä½¿ç”¨retina-faceç½‘ç»œç»“æ„ï¼›è¡¨æƒ…åˆ†ç±»é€‰ç”¨mobilenetä¸ºbackboneè¿›è¡Œåˆ†ç±»ï¼Œå¾—åˆ°äººç‰©è¡¨æƒ…ã€‚                            |
| face_gender           | æ€§åˆ«åˆ†ç±»                 | äººè„¸æ€§åˆ«åˆ†ç±»ç¤ºä¾‹ä½¿ç”¨ä¸¤ä¸ªæ¨¡å‹å®ç°åˆ¤æ–­å›¾åƒ/è§†é¢‘ä¸­æ¯ä¸ªäººçš„æ€§åˆ«çš„åŠŸèƒ½ï¼Œæ¯ä¸ªäººç‰©æ€§åˆ«ç”¨Mæˆ–Fè¡¨ç¤ºï¼Œå…¶ä¸­Mè¡¨ç¤ºç”·æ€§ï¼ˆMaleï¼‰ï¼ŒFè¡¨ç¤ºå¥³æ€§ï¼ˆFemaleï¼‰ã€‚ äººè„¸æ£€æµ‹ä½¿ç”¨retina-faceç½‘ç»œç»“æ„ï¼›æ€§åˆ«åˆ†ç±»é€‰ç”¨EfficientNetB3ä¸ºbackboneè¿›è¡Œåˆ†ç±»ï¼Œå¾—åˆ°äººç‰©æ€§åˆ«ã€‚                           |
| face_glasses          | æ˜¯å¦ä½©æˆ´çœ¼é•œåˆ†ç±»         | æ˜¯å¦ä½©æˆ´çœ¼é•œåˆ†ç±»ç¤ºä¾‹ä½¿ç”¨ä¸¤ä¸ªæ¨¡å‹å®ç°åˆ¤æ–­å›¾åƒ/è§†é¢‘æ¯ä¸ªäººæ˜¯å¦ä½©æˆ´çœ¼é•œã€‚ äººè„¸æ£€æµ‹æ£€æµ‹æ¨¡å‹ä½¿ç”¨retina-faceç½‘ç»œç»“æ„ï¼›äººè„¸çœ¼é•œåˆ†ç±»æ¨¡å‹é€‰ç”¨SqueezeNet-1.1ä¸ºbackboneï¼Œç”¨äºå¯¹æ¯ä¸ªäººè„¸æ¡†åˆ¤æ–­çœ¼é•œä½©æˆ´æƒ…å†µã€‚                           |
| face_landmark         | äººè„¸å¯†é›†å…³é”®ç‚¹            | äººè„¸å¯†é›†å…³é”®ç‚¹æ£€æµ‹åº”ç”¨ä½¿ç”¨ä¸¤ä¸ªæ¨¡å‹å®ç°æ£€æµ‹å›¾åƒ/è§†é¢‘ä¸­æ¯å¼ äººè„¸çš„106å…³é”®ç‚¹ï¼Œå¹¶æ ¹æ®106å…³é”®ç‚¹ç»˜åˆ¶äººè„¸ã€äº”å®˜ç­‰è½®å»“ï¼Œä¸åŒè½®å»“ä½¿ç”¨ä¸ç”¨çš„é¢œè‰²è¡¨ç¤ºã€‚äººè„¸æ£€æµ‹ä½¿ç”¨retina-faceç½‘ç»œç»“æ„ï¼›å¯†é›†å…³é”®ç‚¹æ£€æµ‹é€‰ç”¨0.5-mobilenetä¸ºbackboneï¼Œç”¨äºå¯¹æ¯å¼ äººè„¸æ£€æµ‹106ä¸ªå…³é”®ç‚¹ï¼Œ106å…³é”®ç‚¹åŒ…æ‹¬äººè„¸çš„è„¸é¢Šã€å˜´å·´ã€çœ¼ç›ã€é¼»å­å’Œçœ‰æ¯›åŒºåŸŸã€‚                            |
| face_mask             | æ˜¯å¦ä½©æˆ´å£ç½©åˆ†ç±»          | æ˜¯å¦ä½©æˆ´å£ç½©åˆ†ç±»åº”ç”¨ä½¿ç”¨ä¸¤ä¸ªæ¨¡å‹å®ç°åˆ¤æ–­å›¾åƒ/è§†é¢‘æ¯ä¸ªäººæ˜¯å¦ä½©æˆ´å£ç½©ã€‚åœ¨éœ€è¦ä½©æˆ´å£ç½©çš„åº”ç”¨åœºæ™¯ä¸­ï¼Œè‹¥å‘ç°æœ‰äººæ²¡æœ‰ä½©æˆ´å£ç½©ï¼Œå¯è¿›è¡Œç›¸å…³æé†’ã€‚äººè„¸æ£€æµ‹æ£€æµ‹æ¨¡å‹ä½¿ç”¨retina-faceç½‘ç»œç»“æ„ï¼›äººè„¸å£ç½©åˆ†ç±»æ¨¡å‹ä½¿ç”¨mobilenet-v2ä¸ºbackboneï¼Œç”¨äºå¯¹æ¯ä¸ªäººè„¸æ¡†åˆ¤æ–­å£ç½©ä½©æˆ´æƒ…å†µã€‚                            |
| face_mesh             | 3Däººè„¸ç½‘æ ¼              |  3Däººè„¸ç½‘æ ¼å¯å¾—åˆ°å›¾åƒæˆ–è§†é¢‘ä¸­çš„æ¯ä¸ªäººè„¸çš„ä¸‰ç»´ç½‘æ ¼ç»“æ„ã€‚äººè„¸æ£€æµ‹é‡‡ç”¨äº†retina-faceç½‘ç»œç»“æ„ï¼Œbackboneé€‰å–0.25-mobilenetï¼Œäººè„¸å¯¹é½ç½‘ç»œåŸºäº3DDFA(3D Dense Face Alignment)å®ç°ã€‚|
| face_parse            | äººè„¸åˆ†å‰²                  | äººè„¸åˆ†å‰²ç¤ºä¾‹ä½¿ç”¨ä¸¤ä¸ªæ¨¡å‹å®ç°å¯¹å›¾åƒ/è§†é¢‘ä¸­æ¯ä¸ªäººè„¸çš„åˆ†å‰²åŠŸèƒ½ï¼Œäººè„¸åˆ†å‰²åŒ…å«å¯¹äººè„¸çœ¼ç›ã€é¼»å­ã€å˜´å·´ç­‰éƒ¨ä½æŒ‰ç…§åƒç´ è¿›è¡ŒåŒºåˆ†ï¼Œä¸åŒçš„åŒºåŸŸç”¨ä¸åŒçš„é¢œè‰²è¡¨ç¤ºã€‚ äººè„¸æ£€æµ‹é‡‡ç”¨äº†retina-faceç½‘ç»œç»“æ„ï¼Œäººè„¸éƒ¨ä½åˆ†å‰²ä½¿ç”¨DeepNetV3ç½‘ç»œç»“æ„ï¼Œbackboneä½¿ç”¨mobilenet-1.0ã€‚                           |
| face_pose             | äººè„¸å§¿æ€ä¼°è®¡             | äººè„¸å§¿æ€ä¼°è®¡ä½¿ç”¨ä¸¤ä¸ªæ¨¡å‹å®ç°å¯¹å›¾åƒ/è§†é¢‘ä¸­æ¯ä¸ªäººçš„è„¸éƒ¨æœå‘çš„è§’åº¦è¿›è¡Œä¼°è®¡çš„åŠŸèƒ½ã€‚äººè„¸æœå‘ç”¨ä¸€èˆ¬ç”¨æ¬§æ‹‰è§’ï¼ˆroll/yaw/pitchï¼‰è¡¨ç¤ºï¼Œå…¶ä¸­rollä»£è¡¨äº†äººè„¸å·¦å³æ‘‡å¤´çš„ç¨‹åº¦ï¼›yawä»£è¡¨äº†äººè„¸å·¦å³æ—‹è½¬çš„ç¨‹åº¦ï¼›pitchä»£è¡¨äº†äººè„¸ä½å¤´æŠ¬å¤´çš„ç¨‹åº¦ã€‚äººè„¸æ£€æµ‹é‡‡ç”¨äº†retina-faceæ¨¡å‹ï¼Œäººè„¸æœå‘ä¼°è®¡98ä¸ª2Då…³é”®ç‚¹æ‹Ÿåˆã€‚                            |
| face_verification     | äººè„¸èº«ä»½éªŒè¯             | äººè„¸èº«ä»½éªŒè¯æ˜¯ä¸€ç§åŸºäºäººè„¸ç”Ÿç‰©ç‰¹å¾çš„èº«ä»½éªŒè¯æŠ€æœ¯ï¼Œæ—¨åœ¨ç¡®è®¤ä¸ªä½“æ˜¯å¦æ˜¯å…¶æ‰€å£°ç§°çš„èº«ä»½ã€‚è¯¥æŠ€æœ¯é€šè¿‡åˆ†æå’Œæ¯”å¯¹ç”¨æˆ·çš„è„¸éƒ¨ç‰¹å¾æ¥éªŒè¯å…¶èº«ä»½ï¼Œé€šå¸¸æ˜¯åœ¨äººè„¸éªŒè¯ç³»ç»Ÿé€šè¿‡å¯¹æ¯”ä¸¤å¼ å›¾ç‰‡ï¼Œç¡®å®šä¸¤å¼ å›¾åƒä¸­çš„äººè„¸æ˜¯å¦å±äºåŒä¸€ä¸ªäººã€‚ äººè„¸æ£€æµ‹é‡‡ç”¨äº†retina-faceæ¨¡å‹ï¼Œäººè„¸æœç‰¹å¾åŒ–ä½¿ç”¨ResNet50,è¾“å‡º512ç»´ç‰¹å¾ã€‚                           |
| falldown_detect       | è·Œå€’æ£€æµ‹                 |  è·Œå€’æ£€æµ‹å¯ä»¥å¯¹å›¾ç‰‡æˆ–è§†é¢‘ä¸­çš„äººçš„è·Œå€’çŠ¶æ€è¿›è¡Œæ£€æµ‹ã€‚è¯¥ç¤ºä¾‹ä½¿ç”¨yolov5næ¨¡å‹å®ç°ã€‚                           |
| finger_guessing       | çŒœæ‹³æ¸¸æˆ                 |  çŒœæ‹³æ¸¸æˆç¤ºä¾‹é€šè¿‡æ‰‹éƒ¨æ‰‹åŠ¿è¯†åˆ«åŒºåˆ†çŸ³å¤´é¸¡å‰ªåˆ€å¸ƒï¼ŒåŒ…æ‹¬æ‰‹æŒæ£€æµ‹å’Œæ‰‹éƒ¨21å…³é”®ç‚¹è¯†åˆ«ä¸¤ä¸ªæ¨¡å‹ï¼Œé€šè¿‡21ä¸ªå…³é”®ç‚¹çš„ä½ç½®çº¦æŸç¡®å®šæ‰‹åŠ¿ç±»åˆ«ã€‚æ‰‹æŒæ£€æµ‹éƒ¨åˆ†é‡‡ç”¨äº†yolov5ç½‘ç»œç»“æ„ï¼Œbackboneé€‰å–äº†1.0-mobilenetV2ï¼Œæ‰‹æŒå…³é”®ç‚¹æ£€æµ‹éƒ¨åˆ†é‡‡ç”¨äº†resnet50ç½‘ç»œç»“æ„ã€‚                          |
| fitness               | è¹²èµ·åŠ¨ä½œè®¡æ•°             |  è¹²èµ·åŠ¨ä½œè®¡æ•°ç¤ºä¾‹å®ç°è§†é¢‘ä¸­äººçš„è¹²èµ·åŠ¨ä½œè®¡æ•°åŠŸèƒ½ï¼Œé€‚ç”¨äºå¥èº«çŠ¶æ€æ£€æµ‹ç­‰åœºæ™¯ã€‚ä½¿ç”¨yolov8n-poseæ¨¡å‹å®ç°ã€‚                           |
| head_detection        | äººå¤´æ£€æµ‹è®¡æ•°             |  äººå¤´æ£€æµ‹è®¡æ•°ç¤ºä¾‹å®ç°äº†è·å–å›¾ç‰‡æˆ–è§†é¢‘ä¸­å‡ºç°çš„äººå¤´çš„åæ ‡å’Œæ•°é‡çš„åŠŸèƒ½ã€‚ä½¿ç”¨yolov8æ¨¡å‹å®ç°ã€‚                           |
| helmet_detect         | å®‰å…¨å¸½æ£€æµ‹               | å®‰å…¨å¸½æ£€æµ‹å®ä¾‹å®ç°äº†å¯¹å›¾ç‰‡æˆ–è§†é¢‘ä¸­å‡ºç°çš„äººæ˜¯å¦ä½©æˆ´å®‰å…¨å¸½è¿›è¡Œæ£€æµ‹ï¼Œé€‚ç”¨äºå»ºç­‘åˆ¶é€ ä¸šçš„å®‰å…¨é¢„é˜²åœºæ™¯ã€‚ä½¿ç”¨yolov5æ¨¡å‹å®ç°ã€‚                            |
| kws                   | å…³é”®è¯å”¤é†’               |å…³é”®è¯å”¤é†’é€šè¿‡éŸ³é¢‘è¯†åˆ«æ¨¡å‹æ£€æµ‹éŸ³é¢‘æµä¸­æ˜¯å¦åŒ…å«è®­ç»ƒæ—¶è®¾å®šçš„å…³é”®è¯ï¼Œå¦‚æœæ£€æµ‹åˆ°å¯¹åº”çš„å…³é”®è¯ï¼Œç»™å‡ºè¯­éŸ³å“åº”ã€‚æœ¬ç¤ºä¾‹æä¾›çš„æ¨¡å‹ä¸ºWeNetè®­ç»ƒå¾—åˆ°ï¼Œæ­£è´Ÿæ ·æœ¬åˆ†åˆ«é‡‡ç”¨åœ¨k230å¼€å‘æ¿ä¸Šé‡‡é›†çš„â€œxiaonanâ€éŸ³é¢‘å’Œå¼€æºæ•°æ®é›†speech_commandsã€‚                             |
| licence_det           | è½¦ç‰Œæ£€æµ‹                 | è½¦ç‰Œæ£€æµ‹å¯ä»¥æ£€æµ‹å›¾åƒæˆ–è§†é¢‘ä¸­çš„å‡ºç°çš„è½¦ç‰Œã€‚ è½¦ç‰Œæ£€æµ‹é‡‡ç”¨äº†retinanetç½‘ç»œç»“æ„ã€‚                          |
| licence_det_rec       | è½¦ç‰Œè¯†åˆ«                 | è½¦ç‰Œè¯†åˆ«å¯ä»¥è¯†åˆ«å›¾å›¾åƒæˆ–è§†é¢‘ä¸­å‡ºç°çš„è½¦ç‰Œçš„ä½ç½®ä»¥åŠç‰Œç…§ä¿¡æ¯ã€‚è½¦ç‰Œæ£€æµ‹é‡‡ç”¨äº†retinanetç½‘ç»œç»“æ„ï¼Œè½¦ç‰Œè¯†åˆ«é‡‡ç”¨äº†ä»¥MobileNetV3ä¸ºbackboneçš„RLNetç½‘ç»œç»“æ„ã€‚                            |
| nanotracker           | å•ç›®æ ‡è·Ÿè¸ª               | å•ç›®æ ‡è·Ÿè¸ªåœ¨å‰å‡ ç§’åœ¨æ³¨å†Œæ¡†ä¸­é˜²æ­¢ç‰¹å¾æ˜æ˜¾çš„å¾…è·Ÿè¸ªç‰©å“å®ç°è¿½è¸ªæ³¨å†Œï¼Œç„¶åå®æ—¶å¯¹è¯¥ç‰©å“è¿›è¡Œè§†è§‰è¿½è¸ªã€‚ è·Ÿè¸ªç®—æ³•ä½¿ç”¨NanoTrackã€‚                           |
| object_detect_yolov8n | YOLOV8å¤šç›®æ ‡æ£€æµ‹         | YOLOv8å¤šç›®æ ‡æ£€æµ‹æ£€æµ‹ç¤ºä¾‹å®ç°COCOæ•°æ®é›†80ç±»åˆ«æ£€æµ‹ã€‚ä½¿ç”¨yolov8næ¨¡å‹ã€‚                            |
| ocr                   | ocræ£€æµ‹+è¯†åˆ«             | OCRè¯†åˆ«ç¤ºä¾‹å¯æ£€æµ‹åˆ°å›¾åƒæˆ–è§†é¢‘ä¸­çš„æ–‡æœ¬ä½ç½®ä»¥åŠç›¸åº”çš„æ–‡å­—å†…å®¹ã€‚OCRè¯†åˆ«ä»»åŠ¡é‡‡ç”¨äº†CRNNç½‘ç»œç»“æ„ï¼ŒOCRæ£€æµ‹ä»»åŠ¡é‡‡ç”¨äº†DBnetçš„ç½‘ç»œç»“æ„ã€‚                           |
| person_attr           | äººä½“å±æ€§                 | äººä½“å±æ€§æ£€æµ‹å¯ä»¥è¯†åˆ«å›¾ç‰‡æˆ–è§†é¢‘ä¸­çš„äººä½“ä½ç½®åæ ‡ï¼Œæ€§åˆ«ã€å¹´é¾„ã€æ˜¯å¦ä½©æˆ´çœ¼é•œã€æ˜¯å¦æŒç‰©ã€‚äººä½“æ£€æµ‹ä½¿ç”¨YOLOv5æ¨¡å‹å®ç°ï¼Œäººä½“å±æ€§ä½¿ç”¨PULCäººæ¨¡å‹å®ç°ã€‚                            |
| person_detect         | äººä½“æ£€æµ‹                 |  äººä½“æ£€æµ‹å¯ä»¥æ£€æµ‹å›¾ç‰‡æˆ–è§†é¢‘ä¸­çš„äººä½“ä½ç½®åæ ‡ä¿¡æ¯ï¼Œå¹¶ç”¨æ£€æµ‹æ¡†æ ‡è®°å‡ºæ¥ã€‚æœ¬ç¤ºä¾‹ä½¿ç”¨yolov5æ¨¡å‹å®ç°ã€‚                           |
| person_distance       | è¡Œäººæµ‹è·                 |  è¡Œäººæµ‹è·æ˜¯å…ˆé€šè¿‡è¡Œäººæ£€æµ‹æ£€æµ‹è¡Œäººï¼Œå†é€šè¿‡æ£€æµ‹æ¡†åœ¨å›¾åƒä¸­çš„å¤§å°å»ä¼°ç®—ç›®æ ‡è·ç¦»ã€‚å…¶ä¸­è¡Œäººæ£€æµ‹é‡‡ç”¨äº†yolov5nçš„ç½‘ç»œç»“æ„ã€‚ä½¿ç”¨è¯¥åº”ç”¨ï¼Œå¯å¾—åˆ°å›¾åƒæˆ–è§†é¢‘ä¸­çš„æ¯ä¸ªè¡Œäººçš„æ£€æµ‹æ¡†ä»¥åŠä¼°ç®—çš„è·ç¦»ã€‚è¯¥æŠ€æœ¯å¯åº”ç”¨åœ¨è½¦è¾†è¾…åŠ©é©¾é©¶ç³»ç»Ÿã€æ™ºèƒ½äº¤é€šç­‰é¢†åŸŸã€‚è¯¥åº”ç”¨éœ€è¦æ ¹æ®æ‘„åƒå¤´è°ƒæ•´è®¡ç®—æ•°æ®ï¼Œç°æœ‰ç¤ºä¾‹å¯èƒ½è¯†åˆ«ä¸å‡†ã€‚                   |
| pose_detect           | äººä½“å…³é”®ç‚¹æ£€æµ‹           |  äººä½“å…³é”®ç‚¹æ£€æµ‹æ¨¡å‹çš„è¾“å‡ºæ˜¯ä¸€ç»„ä»£è¡¨å›¾åƒæˆ–è§†é¢‘ä¸­äººä½“å¯¹è±¡ä¸Šçš„å…³é”®ç‚¹ï¼ˆ17ä¸ªï¼‰ï¼Œä»¥åŠæ¯ä¸ªç‚¹çš„ç½®ä¿¡åº¦å¾—åˆ†ï¼Œå¹¶ä½¿ç”¨ä¸åŒé¢œè‰²çš„çº¿å°†å…³é”®ç‚¹è¿æ¥æˆäººä½“çš„å½¢çŠ¶ã€‚æœ¬ç¤ºä¾‹ä½¿ç”¨yolov8n-poseæ¨¡å‹å®ç°ã€‚                           |
| pphumanseg            | äººåƒåˆ†å‰²                 | äººåƒåˆ†å‰²æŒ‡å¯¹å›¾ç‰‡æˆ–è§†é¢‘ä¸­çš„äººä½“è½®å»“èŒƒå›´è¿›è¡Œè¯†åˆ«ï¼Œå°†å…¶ä¸èƒŒæ™¯è¿›è¡Œåˆ†ç¦»ï¼Œè¿”å›åˆ†å‰²åçš„äºŒå€¼å›¾ã€ç°åº¦å›¾ã€å‰æ™¯äººåƒå›¾ç­‰ï¼Œå®ç°èƒŒæ™¯å›¾åƒçš„æ›¿æ¢ä¸åˆæˆã€‚ å¯åº”ç”¨äºäººåƒæŠ å›¾ã€ç…§ç‰‡åˆæˆã€äººåƒç‰¹æ•ˆã€èƒŒæ™¯ç‰¹æ•ˆç­‰åœºæ™¯ï¼Œå¤§å¤§æå‡å›¾ç‰‡å’Œè§†é¢‘å·¥å…·æ•ˆç‡ã€‚æœ¬ç¤ºä¾‹ä½¿ç”¨pphumansegæ¨¡å‹å®ç°ã€‚                            |
| puzzle_game           | æ‹¼å›¾æ¸¸æˆ                 | æ‹¼å›¾æ¸¸æˆå¯å¾—åˆ°å›¾åƒæˆ–è§†é¢‘ä¸­çš„æ¯ä¸ªæ‰‹æŒçš„21ä¸ªéª¨éª¼å…³é”®ç‚¹ä½ç½®ã€‚å¹¶ä¸”å¯ä»¥å®ç°æ‹¼å›¾æ¸¸æˆçš„åŠŸèƒ½ï¼Œå¼ å¼€æ‹‡æŒ‡å’Œä¸­æŒ‡ï¼Œå°†å…¶ä¸­ç‚¹æ”¾åˆ°ç©ºæ ¼æ—è¾¹çš„éç©ºæ ¼ï¼Œæ‹Ÿåˆä¸¤æŒ‡ï¼Œå½“å‰éç©ºæ ¼ä¼šç§»åŠ¨åˆ°ç©ºæ ¼å†…ã€‚ ç¤ºä¾‹ä¸­æ‰‹æŒæ£€æµ‹é‡‡ç”¨äº†yolov5ç½‘ç»œç»“æ„ï¼Œbackboneé€‰å–äº†1.0-mobilenetV2ï¼Œæ‰‹æŒå…³é”®ç‚¹æ£€æµ‹é‡‡ç”¨äº†resnet50ç½‘ç»œç»“æ„ã€‚                           |
| segment_yolov8n       | YOLOV8å¤šç›®æ ‡åˆ†å‰²         | YOLOv8å¤šç›®æ ‡åˆ†å‰²æ£€æµ‹ç¤ºä¾‹å®ç°COCOæ•°æ®é›†80ç±»åˆ«åˆ†å‰²æ©ç ã€‚ä½¿ç”¨yolov8n-segæ¨¡å‹ã€‚                            |
| self_learning         | è‡ªå­¦ä¹ ï¼ˆåº¦é‡å­¦ä¹ åˆ†ç±»ï¼‰    | è‡ªå­¦ä¹ é€šè¿‡åœ¨æ³¨å†Œæ¡†å†…æ³¨å†Œç‰©å“ç‰¹å¾ï¼Œç„¶åå†ä¸é‡æ–°è®­ç»ƒçš„å‰æä¸‹è¯†åˆ«æ¡†å†…çš„ç‰©å“ã€‚ç¨‹åºå¯åŠ¨åè¾“å…¥iæ‰“æ–­è¿è¡Œï¼Œè¾“å…¥nä¸ºæ–°å»ºç‰¹å¾ï¼Œè¾“å…¥dæ˜¯åˆ é™¤ç‰¹å¾ï¼Œç‰¹å¾æ³¨å†Œå®Œæ¯•åä¼šç»§ç»­å¼€å§‹è¯†åˆ«æ£€æµ‹æ¡†å†…çš„ç‰©å“å’Œæ³¨å†Œçš„ç‰©å“çš„ç›¸ä¼¼ç¨‹åº¦ï¼Œå¹¶å®Œæˆåˆ†ç±»ï¼ŒæŒ‰escé”®é€€å‡ºç¨‹åºã€‚ç‰¹å¾åŒ–æ¨¡å‹ä½¿ç”¨ppshitu_liteæ¨¡å‹ã€‚                           |
| smoke_detect          | å¸çƒŸæ£€æµ‹                 |  å¸çƒŸæ£€æµ‹å¯¹å›¾ç‰‡æˆ–è§†é¢‘ä¸­å­˜åœ¨çš„å¸çƒŸè¡Œä¸ºè¿›è¡Œå®æ—¶ç›‘æµ‹è¯†åˆ«ã€‚è¯¥ç¤ºä¾‹ä½¿ç”¨yolov5æ¨¡å‹å®ç°ã€‚                           |
| space_resize          | æ‰‹åŠ¿éš”ç©ºç¼©æ”¾             | æ‰‹åŠ¿éš”ç©ºç¼©æ”¾å¯å¾—åˆ°å›¾åƒæˆ–è§†é¢‘ä¸­çš„æ¯ä¸ªæ‰‹æŒçš„21ä¸ªéª¨éª¼å…³é”®ç‚¹ä½ç½®ï¼Œå¹¶ä¸”æˆ‘ä»¬é€šè¿‡æ‹‡æŒ‡ä¸­æŒ‡æ¥å®ç°éš”ç©ºç¼©æ”¾å›¾åƒã€‚æ‰‹æŒæ£€æµ‹é‡‡ç”¨äº†yolov5ç½‘ç»œç»“æ„ï¼Œbackboneé€‰å–äº†1.0-mobilenetV2ï¼Œæ‰‹æŒå…³é”®ç‚¹æ£€æµ‹é‡‡ç”¨äº†resnet50ç½‘ç»œç»“æ„ã€‚                            |
| sq_hand_det           | æ‰‹æŒæ£€æµ‹                 |  æ‰‹æŒæ£€æµ‹å¯è·å–å›¾åƒæˆ–è§†é¢‘ä¸­çš„æ¯ä¸ªæ‰‹æŒçš„æ£€æµ‹æ¡†ã€‚æ‰‹æŒæ£€æµ‹é‡‡ç”¨äº†yolov5ç½‘ç»œç»“æ„ï¼Œbackboneé€‰å–äº†1.0-mobilenetV2ã€‚                           |
| sq_handkp_class       | æ‰‹æŒå…³é”®ç‚¹æ‰‹åŠ¿åˆ†ç±»       |   æ‰‹æŒå…³é”®ç‚¹æ‰‹åŠ¿åˆ†ç±»å¯å¾—åˆ°å›¾åƒæˆ–è§†é¢‘ä¸­çš„æ¯ä¸ªæ‰‹æŒçš„21ä¸ªéª¨éª¼å…³é”®ç‚¹ä½ç½®,å¹¶æ ¹æ®å…³é”®ç‚¹çš„ä½ç½®äºŒç»´çº¦æŸè·å¾—é™æ€æ‰‹åŠ¿ã€‚å…±æ”¯æŒæ¡æ‹³ï¼Œäº”æŒ‡å¼ å¼€ï¼Œä¸€æ‰‹åŠ¿ï¼Œyeahæ‰‹åŠ¿ï¼Œä¸‰æ‰‹åŠ¿ï¼Œå…«æ‰‹åŠ¿ï¼Œå…­æ‰‹åŠ¿ï¼Œç‚¹èµï¼Œæ‹‡æŒ‡é£ŸæŒ‡å°æ‹‡æŒ‡å¼ å¼€å…±9ç§æ‰‹åŠ¿ã€‚æœ¬ç¤ºä¾‹ä¸­æ‰‹æŒæ£€æµ‹é‡‡ç”¨äº†yolov5ç½‘ç»œç»“æ„ï¼Œbackboneé€‰å–äº†1.0-mobilenetV2ï¼Œæ‰‹æŒå…³é”®ç‚¹æ£€æµ‹é‡‡ç”¨äº†resnet50ç½‘ç»œç»“æ„ã€‚                          |
| sq_handkp_det         | æ‰‹æŒå…³é”®ç‚¹æ£€æµ‹           | æ‰‹æŒå…³é”®ç‚¹æ£€æµ‹ç¤ºä¾‹å¯å¾—åˆ°å›¾åƒæˆ–è§†é¢‘ä¸­çš„æ¯ä¸ªæ‰‹æŒçš„21ä¸ªéª¨éª¼å…³é”®ç‚¹ä½ç½®ã€‚æ‰‹æŒæ£€æµ‹é‡‡ç”¨äº†yolov5ç½‘ç»œç»“æ„ï¼Œbackboneé€‰å–äº†1.0-mobilenetV2ï¼Œæ‰‹æŒå…³é”®ç‚¹æ£€æµ‹é‡‡ç”¨äº†resnet50ç½‘ç»œç»“æ„ã€‚                           |
| sq_handkp_flower      | æŒ‡å°–åŒºåŸŸèŠ±å‰åˆ†ç±»         | æŒ‡å°–åŒºåŸŸèŠ±å‰è¯†åˆ«å¯å¾—åˆ°å›¾åƒæˆ–è§†é¢‘ä¸­çš„ä¸¤ä¸ªæ‰‹æŒçš„é£ŸæŒ‡æŒ‡å°–åŒ…å›´åŒºåŸŸå†…çš„èŠ±å‰ç±»åˆ«ã€‚å¯æ”¯æŒ102ç§èŠ±å‰çš„ç§ç±»è¯†åˆ«ã€‚æœ¬ç¤ºä¾‹æ‰‹æŒæ£€æµ‹é‡‡ç”¨äº†yolov5ç½‘ç»œç»“æ„ï¼Œbackboneé€‰å–äº†1.0-mobilenetV2ï¼Œæ‰‹æŒå…³é”®ç‚¹æ£€æµ‹é‡‡ç”¨äº†resnet50ç½‘ç»œç»“æ„ã€‚èŠ±æœµåˆ†ç±»backboneé€‰å–äº†1.0-mobilenetV2ã€‚                            |
| sq_handkp_ocr         | æ‰‹æŒ‡åŒºåŸŸOCRè¯†åˆ«          | æ‰‹æŒ‡åŒºåŸŸOCRè¯†åˆ«å¯å¾—åˆ°å›¾åƒæˆ–è§†é¢‘ä¸­çš„æ¯ä¸ªæ‰‹æŒçš„é£ŸæŒ‡å·¦ä¸ŠåŒºåŸŸèŒƒå›´å†…è¯†åˆ«åˆ°çš„æ–‡å­—ã€‚æ‰‹æŒæ£€æµ‹é‡‡ç”¨äº†yolov5ç½‘ç»œç»“æ„ï¼Œbackboneé€‰å–äº†1.0-mobilenetV2ï¼Œæ‰‹æŒå…³é”®ç‚¹æ£€æµ‹é‡‡ç”¨äº†resnet50ç½‘ç»œç»“æ„ã€‚æ–‡å­—æ£€æµ‹é‡‡ç”¨äº†retinanetç½‘ç»œç»“æ„ï¼Œæ–‡å­—è¯†åˆ«é‡‡ç”¨äº†ä»¥MobileNetV3ä¸ºbackboneçš„RLnetç½‘ç»œç»“æ„ã€‚                            |
| sq_handreco           | æ‰‹åŠ¿è¯†åˆ«                 | æ‰‹åŠ¿è¯†åˆ«å¯å¾—åˆ°å›¾åƒæˆ–è§†é¢‘ä¸­çš„æ¯ä¸ªæ‰‹åŠ¿çš„ç±»åˆ«ã€‚ä»…æ”¯æŒäº”æŒ‡å¼ å¼€ã€å…«æ‰‹åŠ¿ã€  yeahæ‰‹åŠ¿ä¸‰ç§ã€‚ æœ¬ç¤ºä¾‹ä¸­æ‰‹æŒæ£€æµ‹é‡‡ç”¨äº†yolov5ç½‘ç»œç»“æ„ï¼Œbackboneé€‰å–äº†1.0-mobilenetV2ï¼Œæ‰‹åŠ¿è¯†åˆ«backboneé€‰å–äº†1.0-mobilenetV2ã€‚                        |
| traffic_light_detect  | äº¤é€šä¿¡å·ç¯æ£€æµ‹           | å¯æ£€æµ‹åˆ°å›¾åƒæˆ–è§†é¢‘ä¸­çš„äº¤çº¢ç»¿é»„ä¿¡å·ç¯ã€‚æœ¬ç¤ºä¾‹ä½¿ç”¨yolov5æ¨¡å‹å®ç°ã€‚                            |
| translate_en_ch       | è‹±ç¿»ä¸­ç¿»è¯‘               | è‹±ç¿»ä¸­ç¿»è¯‘å¯ä»¥å®ç°ç®€å•çš„è‹±ç¿»ä¸­ç¿»è¯‘ä»»åŠ¡ï¼Œæ•ˆæœä¸€èˆ¬ã€‚æœºå™¨ç¿»è¯‘æ¨¡å‹åº”ç”¨äº†transformerç»“æ„ã€‚                       |
| tts_zh                | ä¸­æ–‡è½¬è¯­éŸ³               | ä¸­æ–‡æ–‡å­—è½¬è¯­éŸ³ï¼ˆtext to chinese speech, tts_zhï¼‰ä½¿ç”¨ä¸‰ä¸ªæ¨¡å‹å®ç°ã€‚ç”¨æˆ·é»˜è®¤è¾“å…¥ä¸‰æ¬¡æ–‡å­—ï¼Œç”Ÿæˆæ–‡å­—å¯¹åº”çš„wavæ–‡ä»¶ã€‚ æœ¬ç¤ºä¾‹å°†FastSpeech2æ¨¡å‹æ‹†åˆ†æˆä¸¤ä¸ªæ¨¡å‹ï¼ŒEncoder+Variance Adaptorä¸ºfastspeech1ï¼ŒDecoderä¸ºfastspeech2ï¼Œå£°ç å™¨é€‰æ‹©hifiganã€‚æŒç»­æ—¶é—´ç‰¹å¾åœ¨fastspeech1ä¹‹åæ·»åŠ ã€‚                       |
| vehicle_attr          | è½¦è¾†å±æ€§è¯†åˆ«             | è½¦è¾†å±æ€§è¯†åˆ«å¯ä»¥è¯†åˆ«å›¾åƒæˆ–è§†é¢‘ä¸­æ¯ä¸ªè½¦è¾†ï¼Œå¹¶è¿”å›è¯¥è½¦è¾†çš„ä½ç½®åæ ‡ã€è½¦å‹ã€è½¦èº«é¢œè‰²ã€‚æœ¬ç¤ºä¾‹é‡‡ç”¨äº†yolov5ç½‘ç»œç»“æ„å®ç°äº†è½¦è¾†æ£€æµ‹ï¼Œè½¦è¾†å±æ€§æ£€æµ‹ä½¿ç”¨PULCæ¨¡å‹ã€‚                         |
| virtual_keyboard      | éš”ç©ºè™šæ‹Ÿé”®ç›˜             | éš”ç©ºè™šæ‹Ÿé”®ç›˜å¯ä»¥ä½¿ç”¨å±å¹•ä¸Šçš„è™šæ‹Ÿé”®ç›˜è¾“å‡ºå­—ç¬¦ã€‚æ‹‡æŒ‡å’Œé£ŸæŒ‡æåˆæ˜¯è¾“å…¥åŠ¨ä½œã€‚æœ¬ç¤ºä¾‹ä¸­æ‰‹æŒæ£€æµ‹é‡‡ç”¨äº†yolov5ç½‘ç»œç»“æ„ï¼Œbackboneé€‰å–äº†1.0-mobilenetV2ï¼Œæ‰‹æŒå…³é”®ç‚¹æ£€æµ‹é‡‡ç”¨äº†resnet50ç½‘ç»œç»“æ„ã€‚                          |
| yolop_lane_seg        | è·¯é¢è½¦é“çº¿åˆ†å‰²           | è·¯é¢è½¦é“çº¿åˆ†å‰²å¯åœ¨å›¾åƒæˆ–è§†é¢‘ä¸­å®ç°è·¯é¢åˆ†å‰²ï¼Œå³æ£€æµ‹åˆ°è½¦é“çº¿å’Œå¯è¡Œé©¶åŒºåŸŸï¼Œå¹¶åŠ ä»¥é¢œè‰²åŒºåˆ†ã€‚æœ¬ç¤ºä¾‹ä½¿ç”¨yolopæ¨¡å‹å®ç°ã€‚         |

## AIæ¨¡å‹æ¨ç†çš„åŸºæœ¬æµç¨‹

æŠŠè®­ç»ƒçš„AIæ¨¡å‹éƒ¨ç½²åœ¨K230ä¸Šçš„åŸºæœ¬æµç¨‹è§ä¸‹é¢çš„æµç¨‹å›¾ï¼š

![pipeline_model_deploy](https://www.kendryte.com/api/post/attachment?id=611)

ğŸ·ï¸ **æ•°æ®é‡‡é›†**:

æ•°æ®é‡‡é›†æ˜¯æŒ‡é€šè¿‡æ‘„åƒå¤´ã€éº¦å…‹é£ç­‰ä¼ æ„Ÿè®¾å¤‡æ”¶é›†åŸå§‹è¾“å…¥æ•°æ®çš„è¿‡ç¨‹ã€‚é‡‡é›†æ•°æ®çš„è´¨é‡ä¸æ•°é‡ç›´æ¥å†³å®šäº†æ¨¡å‹è®­ç»ƒä¸æ¨ç†çš„æ•ˆæœã€‚å› æ­¤ï¼Œé€‰æ‹©åˆé€‚çš„é‡‡é›†è®¾å¤‡å’Œç­–ç•¥è‡³å…³é‡è¦ã€‚

ä¸ºè·å¾—æ›´å¥½çš„éƒ¨ç½²æ•ˆæœï¼Œæ¨èä½¿ç”¨ K230 æœ¬èº«é‡‡é›†å›¾åƒæ•°æ®ï¼Œä»¥ç¡®ä¿æ•°æ®åˆ†å¸ƒæ›´è´´è¿‘å®é™…éƒ¨ç½²ç¯å¢ƒã€‚

ğŸ·ï¸ **æ•°æ®æ ‡æ³¨**:

æ•°æ®æ ‡æ³¨æ˜¯ä¸ºé‡‡é›†åˆ°çš„æ•°æ®æ·»åŠ è¯­ä¹‰æ ‡ç­¾çš„è¿‡ç¨‹ï¼Œç”¨äºç›‘ç£å­¦ä¹ æ¨¡å‹çš„è®­ç»ƒã€‚è¿™ä¸€è¿‡ç¨‹å¯ä»¥é€šè¿‡äººå·¥æ–¹å¼å®Œæˆï¼Œä¹Ÿå¯ä»¥å€ŸåŠ©æ ‡æ³¨å·¥å…·è¿›è¡ŒåŠè‡ªåŠ¨åŒ–å¤„ç†ã€‚

æ¯”å¦‚å›¾åƒåˆ†ç±»ä»»åŠ¡éœ€è¦ä¸ºæ¯å¼ å›¾åƒåˆ†é…æ­£ç¡®çš„ç±»åˆ«æ ‡ç­¾ï¼›ç›®æ ‡æ£€æµ‹ä»»åŠ¡è¦ä¸ºå›¾åƒä¸­æ¯ä¸ªç›®æ ‡æ·»åŠ è¾¹ç•Œæ¡†åŠå…¶ç±»åˆ«æ ‡ç­¾ã€‚å‡†ç¡®çš„æ ‡æ³¨å¯¹äºè®­ç»ƒå‡ºé«˜æ€§èƒ½ã€æ³›åŒ–èƒ½åŠ›å¼ºçš„æ¨¡å‹è‡³å…³é‡è¦ã€‚

ğŸ·ï¸ **æ¨¡å‹è®­ç»ƒ**:

æ¨¡å‹è®­ç»ƒé˜¶æ®µæ˜¯æ•´ä¸ª AI åº”ç”¨å¼€å‘æµç¨‹çš„é‡è¦æ­¥éª¤ä¹‹ä¸€ï¼Œå…¶ä¸»è¦ç›®æ ‡æ˜¯åˆ©ç”¨å·²æ ‡æ³¨çš„æ•°æ®é›†ï¼Œé€šè¿‡æ·±åº¦å­¦ä¹ æ–¹æ³•è®­ç»ƒå‡ºå…·æœ‰æ³›åŒ–èƒ½åŠ›çš„ç¥ç»ç½‘ç»œæ¨¡å‹ã€‚åœ¨è¿™ä¸€è¿‡ç¨‹ä¸­ï¼Œæ¨¡å‹é€šè¿‡ä¸æ–­åœ°è°ƒæ•´å†…éƒ¨å‚æ•°ï¼Œé€æ­¥æ‹Ÿåˆæ•°æ®çš„åˆ†å¸ƒç‰¹å¾ï¼Œä»¥ä¾¿åœ¨é¢å¯¹æœªè§è¿‡çš„è¾“å…¥æ•°æ®æ—¶ï¼Œä»èƒ½åšå‡ºå‡†ç¡®ä¸”ç¨³å®šçš„é¢„æµ‹ç»“æœã€‚

æ¨¡å‹è®­ç»ƒé€šå¸¸éœ€è¦ä¾æ‰˜å¤§é‡é«˜è´¨é‡çš„æ ·æœ¬æ•°æ®ï¼Œæ¶µç›–ä»»åŠ¡ç›¸å…³çš„å¤šæ ·æ€§åœºæ™¯ä¸ç±»åˆ«ã€‚æ•°æ®çš„å……åˆ†æ€§å’Œæ ‡æ³¨çš„å‡†ç¡®æ€§ç›´æ¥å½±å“æ¨¡å‹çš„å­¦ä¹ æ•ˆæœå’Œåº”ç”¨è¡¨ç°ã€‚åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œç¥ç»ç½‘ç»œæ¨¡å‹ä¼šä»è¾“å…¥æ•°æ®ä¸­æå–ç‰¹å¾ï¼Œè®¡ç®—é¢„æµ‹è¾“å‡ºï¼Œå¹¶é€šè¿‡ä¸çœŸå®æ ‡ç­¾å¯¹æ¯”äº§ç”ŸæŸå¤±ï¼ˆLossï¼‰ï¼Œå†å€ŸåŠ©åå‘ä¼ æ’­æœºåˆ¶è°ƒæ•´ç½‘ç»œä¸­çš„æƒé‡å‚æ•°ï¼Œä¸æ–­ä¼˜åŒ–æ¨¡å‹çš„æ€§èƒ½ã€‚

ä¸ºäº†å®ç°é«˜æ•ˆçš„è®­ç»ƒï¼Œå¼€å‘è€…éœ€è¦é€‰æ‹©ä¸€ä¸ªé€‚åˆå½“å‰ä»»åŠ¡çš„æ¨¡å‹ç»“æ„ï¼Œå¦‚å›¾åƒåˆ†ç±»ä¸­çš„ MobileNetã€ResNetï¼Œç›®æ ‡æ£€æµ‹ä¸­çš„ YOLO ç³»åˆ—ç­‰ã€‚æ¨¡å‹çš„é€‰æ‹©ä¸ä»…å–å†³äºç²¾åº¦è¦æ±‚ï¼Œè¿˜éœ€è€ƒè™‘æ¨ç†é€Ÿåº¦ã€æ¨¡å‹ä½“ç§¯å’Œéƒ¨ç½²å¹³å°çš„èµ„æºçº¦æŸç­‰å› ç´ ï¼Œç‰¹åˆ«æ˜¯åœ¨é¢å‘ K230 è¿™æ ·çš„è¾¹ç¼˜ AI èŠ¯ç‰‡æ—¶ï¼Œè½»é‡åŒ–æ¨¡å‹æ›´å…·å®é™…ä»·å€¼ã€‚

æ­¤å¤–ï¼Œè®­ç»ƒè¿‡ç¨‹å¾€å¾€éœ€è¦åœ¨å…·å¤‡ä¸€å®šç®—åŠ›æ”¯æŒçš„è®¡ç®—å¹³å°ï¼ˆå¦‚ GPU æœåŠ¡å™¨æˆ–æœ¬åœ°é«˜æ€§èƒ½å·¥ä½œç«™ï¼‰ä¸Šè¿›è¡Œï¼Œä»¥ä¿è¯æ¨¡å‹åœ¨åˆç†æ—¶é—´å†…å®Œæˆä¼˜åŒ–ã€‚ç°ä»£æ·±åº¦å­¦ä¹ è®­ç»ƒé€šå¸¸ä½¿ç”¨æˆç†Ÿçš„è®­ç»ƒæ¡†æ¶ï¼Œå¦‚ **PyTorch** å’Œ **TensorFlow**ï¼Œå®ƒä»¬æä¾›äº†ä¸°å¯Œçš„ç¥ç»ç½‘ç»œæ„å»ºæ¨¡å—ã€ä¼˜åŒ–å™¨ã€æŸå¤±å‡½æ•°åŠæ•°æ®å¤„ç†å·¥å…·ï¼Œæå¤§åœ°ç®€åŒ–äº†æ¨¡å‹å¼€å‘æµç¨‹ã€‚æ‚¨å¯ä»¥æ ¹æ®è‡ªèº«çš„æŠ€æœ¯èƒŒæ™¯å’Œæ¨¡å‹éœ€æ±‚ï¼Œé€‰æ‹©åˆé€‚çš„æ¡†æ¶å¼€å±•è®­ç»ƒå·¥ä½œã€‚

ğŸ·ï¸ **æ¨¡å‹è½¬æ¢å’ŒéªŒè¯**:

ç”±äºè¾¹ç¼˜è®¾å¤‡è®¡ç®—èµ„æºæœ‰é™ï¼Œä¸èƒ½ç›´æ¥éƒ¨ç½²åœ¨é«˜ç®—åŠ›å¹³å°è®­ç»ƒå¾—åˆ°çš„æ¨¡å‹ã€‚å¿…é¡»é€šè¿‡æ¨¡å‹è½¬æ¢å·¥å…·å¯¹æ¨¡å‹è¿›è¡Œä¼˜åŒ–ä¸é‡åŒ–ï¼Œç”Ÿæˆé€‚ç”¨äºç›®æ ‡ç¡¬ä»¶çš„æ¨ç†æ ¼å¼ã€‚

å¯¹äº K230 èŠ¯ç‰‡ï¼š

- ä½¿ç”¨ KPUï¼ˆKnowledge Processing Unitï¼‰ ä½œä¸ºç¥ç»ç½‘ç»œåŠ é€Ÿå•å…ƒï¼›
- æ”¯æŒçš„æ¨¡å‹æ ¼å¼ä¸º KModelï¼›
- ä½¿ç”¨ nncase ç¼–è¯‘å™¨ å°†è®­ç»ƒå¥½çš„ ONNX æˆ– TFLite æ¨¡å‹ è½¬æ¢ä¸º KModelï¼›
- è½¬æ¢è¿‡ç¨‹ä¸­ä¼šè¿›è¡Œç»“æ„ä¼˜åŒ–ä¸é‡åŒ–ï¼Œä»¥å‡å°‘æ¨¡å‹ä½“ç§¯å’Œè®¡ç®—å¤æ‚åº¦ã€‚

è½¬æ¢å®Œæˆåï¼Œè¿˜éœ€è¿›è¡ŒåŠŸèƒ½éªŒè¯ï¼Œç¡®ä¿æ¨¡å‹åœ¨ç²¾åº¦ã€å»¶è¿Ÿå’Œèµ„æºä½¿ç”¨æ–¹é¢æ»¡è¶³åº”ç”¨éœ€æ±‚ã€‚

ğŸ·ï¸ **æ¨¡å‹éƒ¨ç½²**:

éªŒè¯é€šè¿‡çš„ KModel å¯ä»¥é€šè¿‡ K230 RT-Smart SDK æä¾›çš„ API åŠ è½½åˆ°è®¾å¤‡ä¸Šè¿è¡Œã€‚

éƒ¨ç½²æµç¨‹é€šå¸¸åŒ…å«ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š

- åŠ è½½kmodelï¼›
- è¯»å–å›¾åƒ/éŸ³é¢‘ç­‰è¾“å…¥æ•°æ®ï¼›
- æ‰§è¡Œæ•°æ®é¢„å¤„ç†ï¼ˆå¦‚ç¼©æ”¾ã€å½’ä¸€åŒ–ã€é€šé“æ’åˆ—ç­‰ï¼‰ï¼›
- è¿è¡Œæ¨¡å‹æ¨ç†ï¼›
- æ‰§è¡Œç»“æœåå¤„ç†ï¼ˆå¦‚åˆ†ç±»è§£ç ã€è¾¹ç•Œæ¡†è¿‡æ»¤ç­‰ï¼‰ï¼›
- ç»˜åˆ¶/è¾“å‡ºæ¨ç†ç»“æœã€‚

ä¸åŒæ¨¡å‹çš„é¢„å¤„ç†å’Œåå¤„ç†æµç¨‹å¯èƒ½ä¸åŒï¼Œéœ€æ ¹æ®å…·ä½“æ¨¡å‹æ‰‹åŠ¨é€‚é…ç›¸åº”ä»£ç é€»è¾‘ã€‚

ğŸ·ï¸ **æ¨¡å‹è°ƒä¼˜**:

éƒ¨ç½²å®Œæˆåï¼Œä»éœ€å¯¹æ¨¡å‹è¿›è¡Œæ€§èƒ½ä¸æ•ˆæœä¸Šçš„è°ƒä¼˜ï¼Œä»¥é€‚é…è¾¹ç¼˜åœºæ™¯çš„å®é™…éœ€æ±‚ã€‚ä¼˜åŒ–æªæ–½åŒ…æ‹¬ä½†ä¸é™äºï¼š

- è®¾ç½®æ›´åˆç†çš„æ¨ç†é˜ˆå€¼æˆ–è¾“å‡ºç­–ç•¥ï¼›
- è°ƒæ•´æ¨¡å‹è½¬æ¢å‚æ•°ï¼ˆå¦‚é‡åŒ–ç­–ç•¥ã€è¾“å…¥åˆ†è¾¨ç‡ï¼‰ï¼›
- æ”¹è¿›æ¨¡å‹ç»“æ„æˆ–è®­ç»ƒè¶…å‚æ•°ï¼›
- ä¸°å¯Œå¹¶ä¼˜åŒ–æ•°æ®é›†ï¼›
- ä¼˜åŒ–æ¨ç†æµç¨‹ï¼ˆå¦‚çº¿ç¨‹è°ƒåº¦ã€å†…å­˜å¤ç”¨ï¼‰ã€‚

æ¨¡å‹è°ƒä¼˜æ˜¯ä¸€ä¸ªæŒç»­è¿­ä»£çš„è¿‡ç¨‹ï¼Œæœ‰åŠ©äºæå‡ç³»ç»Ÿçš„ç¨³å®šæ€§ã€å®æ—¶æ€§ä¸èƒ½æ•ˆæ¯”ã€‚

ä»¥ä¸Šå…­ä¸ªæ­¥éª¤æ„æˆäº†åœ¨ K230 èŠ¯ç‰‡ ä¸Šå®Œæˆ AI æ¨¡å‹éƒ¨ç½²ä¸æ¨ç†çš„å®Œæ•´æµç¨‹ã€‚æ¯ä¸€æ­¥å‡éœ€ç²¾å¿ƒè®¾è®¡ä¸æ‰§è¡Œï¼Œä»¥ç¡®ä¿æœ€ç»ˆåº”ç”¨å…·å¤‡è‰¯å¥½çš„æ€§èƒ½ã€ç¨³å®šæ€§ä¸ç”¨æˆ·ä½“éªŒã€‚

## è®­ç»ƒæ¨¡å‹

```{note}
ğŸ¤– **ã€åœºæ™¯å®šä¹‰ã€‘**ï¼šåœ¨ K230 å¼€å‘æ¿ä¸Šå®ç°â€œæ‰“å°æ•°å­—çš„è¯†åˆ«ä¸å®šä½â€ã€‚

ğŸ“Œ **ä»»åŠ¡èƒŒæ™¯**ï¼š
åœ¨å¾ˆå¤š AI åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°â€œè¯†åˆ«å›¾ç‰‡é‡Œçš„æŸäº›ä¸œè¥¿â€çš„éœ€æ±‚ï¼Œæ¯”å¦‚è¯†åˆ«å›¾ç‰‡ä¸­çš„äººè„¸ã€ç‰©ä½“ï¼Œæˆ–è€…åƒæœ¬ä¾‹ä¸­è¯†åˆ«æ•°å­—ã€‚ä¸ºäº†æ›´å¥½åœ°ç†è§£ç›®æ ‡æ£€æµ‹çš„åŸºæœ¬æµç¨‹ï¼Œæˆ‘ä»¬è®¾è®¡äº†ä¸€ä¸ªç®€å•çš„å°ä»»åŠ¡â€”â€”â€”â€”**è¯†åˆ«æ‰“å°çº¸ä¸Š â€œ0â€ã€â€œ1â€ã€â€œ2â€ã€â€œ3â€ è¿™å››ç§æ•°å­—ï¼Œå¹¶æ ‡å‡ºå®ƒä»¬åœ¨å›¾åƒä¸­çš„ä½ç½®**ã€‚

è¿™ä¸ªä»»åŠ¡ä¸å¤æ‚ï¼Œä½†èƒ½å®Œæ•´åœ°ç»ƒä¹ ä¸€éä»æ¨¡å‹éƒ¨ç½²åˆ°å›¾åƒå¤„ç†ã€ç»“æœæ˜¾ç¤ºçš„æ•´ä¸ªè¿‡ç¨‹ã€‚å®ƒä½œä¸ºä¸€ä¸ªå…¥é—¨æ•™ç¨‹ï¼Œå¸®åŠ©å¤§å®¶å¿«é€ŸæŒæ¡å¦‚ä½•åœ¨ K230 å¹³å°ä¸Šéƒ¨ç½² AI æ¨¡å‹ï¼Œè¿›è¡Œç›®æ ‡æ£€æµ‹ï¼Œå¹¶å°†æ£€æµ‹ç»“æœæ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚

ğŸ¯ **é¡¹ç›®ç›®æ ‡**ï¼š
åŸºäº Kendryte K230 AI SoC å¹³å°ï¼Œå¼€å‘ä¸€ä¸ªè½»é‡çº§ã€é«˜æ€§èƒ½çš„è§†è§‰è¯†åˆ«ç¤ºä¾‹ï¼Œå®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š

* âœ… **è¯†åˆ«ç±»åˆ«**ï¼šä»…è¯†åˆ«â€œ0â€ã€â€œ1â€ã€â€œ2â€ã€â€œ3â€å››ç±»æ•°å­—å­—ç¬¦ï¼›
* âœ… **è¯†åˆ«å¯¹è±¡**ï¼šæ‰“å°åœ¨çº¸å¼ ä¸Šçš„æ ‡å‡†å­—ä½“æ•°å­—ï¼›
* âœ… **å®šä½åŠŸèƒ½**ï¼šä¸ä»…è¯†åˆ«æ•°å­—ç±»åˆ«ï¼Œè¿˜èƒ½**å‡†ç¡®è·å–æ¯ä¸ªæ•°å­—åœ¨å›¾åƒä¸­çš„ä½ç½®åæ ‡**ï¼ˆæ¡†å‡ºæ£€æµ‹æ¡†ï¼‰ï¼Œä¸ºåç»­å¤„ç†æˆ–æ“ä½œæä¾›åŸºç¡€ï¼›
* âœ… **è¿è¡Œå¹³å°**ï¼šåº”ç”¨éƒ¨ç½²åœ¨ K230 å¼€å‘æ¿ï¼Œåˆ©ç”¨å…¶**AI ç¡¬ä»¶åŠ é€Ÿã€æ‘„åƒå¤´è¾“å…¥ã€å±å¹•æ˜¾ç¤ºèƒ½åŠ›**ï¼Œå®ç°ç«¯ä¾§æ¨ç†ã€å®æ—¶æ˜¾ç¤ºã€‚

ğŸ–¼ **é¢„æœŸæ•ˆæœå›¾**ï¼š

![4_number_det](https://www.kendryte.com/api/post/attachment?id=645)
```

### æ•°æ®é‡‡é›†

```{note}
ğŸ‘‰ é‡‡é›†è®­ç»ƒæ•°æ®å…¶å®å¾ˆç®€å•ï¼ä½ åªéœ€è¦å…ˆæŠŠ MicroPython å›ºä»¶çƒ§è¿›å¼€å‘æ¿ï¼Œç„¶åæ‰¾åˆ°é‚£ä¸ªè„šæœ¬â€”â€”/sdcard/examples/16-AI-Cube/DataCollectionCamera.pyï¼ŒæŠŠå®ƒæ”¹åä¸º main.pyï¼Œæ”¾åˆ° /sdcard ç›®å½•ä¸‹ã€‚æ¥ç€é‡æ–°ä¸Šç”µï¼ˆä¹Ÿå°±æ˜¯é‡å¯ä¸€ä¸‹æ¿å­ï¼‰ï¼Œè¿è¡Œèµ·æ¥åï¼ŒæŒ‰ä¸‹æ¿å­ä¸Šçš„keyæŒ‰é”®å°±å¯ä»¥å¼€å§‹é‡‡é›†å•¦ï¼æ¯æŒ‰ä¸€ä¸‹å°±æ‹ä¸€å¼ ç…§ç‰‡ï¼Œå›¾åƒä¼šè‡ªåŠ¨ä¿å­˜åˆ° /sdcard/examples/data/ æ–‡ä»¶å¤¹é‡Œï¼Œå®Œå…¨ä¸ç”¨ä½ ç®¡ï¼Œè¶…çœå¿ƒï¼
```

åœ¨è®­ç»ƒæ¨¡å‹ä¹‹å‰ï¼Œæ•°æ®é‡‡é›†æ˜¯æ•´ä¸ªæµç¨‹ä¸­çš„ç¬¬ä¸€æ­¥ï¼Œä¹Ÿæ˜¯è‡³å…³é‡è¦çš„ä¸€æ­¥ã€‚é«˜è´¨é‡çš„æ•°æ®ä¸ä»…èƒ½æå‡æ¨¡å‹çš„æ€§èƒ½ï¼Œè¿˜èƒ½å¢å¼ºæ¨¡å‹åœ¨å®é™…åº”ç”¨åœºæ™¯ä¸­çš„æ³›åŒ–èƒ½åŠ›ã€‚æ ¹æ®ä¸åŒçš„åº”ç”¨éœ€æ±‚ï¼Œæ•°æ®é‡‡é›†å¯ä»¥åˆ†ä¸º**é€šç”¨åœºæ™¯**å’Œ**ä¸“ç”¨åœºæ™¯**ä¸¤ç§æƒ…å†µï¼Œä¸‹é¢å°†åˆ†åˆ«è¿›è¡Œè¯¦ç»†è¯´æ˜ã€‚

ğŸ“Œ **é€šç”¨åœºæ™¯ä¸‹çš„æ•°æ®é‡‡é›†**

åœ¨é€šç”¨äººå·¥æ™ºèƒ½ä»»åŠ¡ä¸­ï¼Œå¦‚å›¾åƒåˆ†ç±»ã€ç›®æ ‡æ£€æµ‹ã€è¯­ä¹‰åˆ†å‰²ç­‰ï¼Œé€šå¸¸å¯ä»¥å€ŸåŠ©å·²æœ‰çš„å…¬å¼€æ•°æ®é›†æ¥æ„å»ºè®­ç»ƒæ ·æœ¬ã€‚è¿™äº›æ•°æ®é›†ç”±å­¦æœ¯æœºæ„ã€ç ”ç©¶ç»„ç»‡æˆ–å¤§å‹ä¼ä¸šæ•´ç†å‘å¸ƒï¼Œå…·æœ‰è‰¯å¥½çš„æ ‡æ³¨è´¨é‡å’Œå¹¿æ³›çš„åº”ç”¨åŸºç¡€ã€‚

æ¯”å¦‚ï¼Œå¸¸è§å›¾åƒç±»å…¬å¼€æ•°æ®é›†åŒ…æ‹¬ï¼šImageNetã€COCOã€MNISTã€Fashion-MNISTã€CIFARç³»åˆ—ç­‰ï¼Œæˆ–è€…å¯»æ‰¾ç½‘ç»œä¸Šå¯¹åº”åœºæ™¯çš„å¼€æºæ•°æ®é›†ã€‚

è™½ç„¶å…¬å¼€æ•°æ®é›†è´¨é‡è¾ƒé«˜ï¼Œä½†åœ¨å®é™…ä½¿ç”¨å‰ä»éœ€è¿›è¡Œé€‚å½“çš„ç­›é€‰ä¸å¤„ç†ï¼Œä»¥ç¡®ä¿å…¶ç¬¦åˆé¡¹ç›®éœ€æ±‚ï¼š

- **è´¨é‡ä¿è¯å¤„ç†**ï¼šå»é™¤æ¨¡ç³Šã€é”™è¯¯æ ‡æ³¨æˆ–ä½è´¨é‡æ ·æœ¬ã€‚
- **ç±»åˆ«å¹³è¡¡**ï¼šç¡®ä¿å„ç±»åˆ«æ ·æœ¬æ•°é‡å‡è¡¡ï¼Œé¿å…æ¨¡å‹åå‘ã€‚
- **æ ¼å¼ç»Ÿä¸€**ï¼šå°†æ•°æ®è½¬æ¢ä¸ºç»Ÿä¸€æ ¼å¼ï¼ˆå¦‚JPEGã€PNGç­‰ï¼‰ã€‚
- **æ•°æ®æ‰©å¢**ï¼šé€šè¿‡æ—‹è½¬ã€è£å‰ªã€ç¿»è½¬ã€æ·»åŠ å™ªå£°ç­‰æ–¹å¼æ‰©å……æ•°æ®é‡ï¼Œæé«˜æ¨¡å‹é²æ£’æ€§ã€‚
- **æ„å»ºå®šåˆ¶åŒ–æ•°æ®é›†**ï¼šæœ‰æ—¶å•ä¸€æ•°æ®é›†å¯èƒ½æ— æ³•æ»¡è¶³ç‰¹å®šéœ€æ±‚ï¼Œå¯ä»¥é€šè¿‡ç»„åˆå¤šä¸ªæ•°æ®é›†å¹¶è¿›è¡Œé‡æ–°æ ‡æ³¨å’Œæ¸…æ´—ï¼Œæ„å»ºæ›´ç¬¦åˆä¸šåŠ¡åœºæ™¯çš„å®šåˆ¶åŒ–æ•°æ®é›†ã€‚

ğŸ“Œ **ä¸“ç”¨åœºæ™¯ä¸‹çš„æ•°æ®é‡‡é›†**

å¯¹äºä¸€äº›ç‰¹æ®Šè¡Œä¸šæˆ–å…·ä½“åº”ç”¨åœºæ™¯ï¼ˆå¦‚å·¥ä¸šè´¨æ£€ã€å†œä¸šç›‘æµ‹ã€å®‰é˜²ç›‘æ§ã€åŒ»ç–—è¯Šæ–­ç­‰ï¼‰ï¼Œå¾€å¾€éœ€è¦é‡‡é›†ä¸“ç”¨äºè¯¥åœºæ™¯çš„æ•°æ®ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå…¬å¼€æ•°æ®é›†å¯èƒ½æ— æ³•å‡†ç¡®åæ˜ çœŸå®ç¯å¢ƒçš„æ•°æ®åˆ†å¸ƒï¼Œå› æ­¤éœ€è¦è¿›è¡Œ**å®šåˆ¶åŒ–æ•°æ®é‡‡é›†**ã€‚

åœ¨æŸäº›ç‰¹å®šçš„AIéƒ¨ç½²åœºæ™¯ä¸­ï¼Œæœ‰æ¡ä»¶çš„æƒ…å†µä¸‹å¯ä»¥ç›´æ¥**ä½¿ç”¨K230è®¾å¤‡**è¿›è¡Œæ•°æ®é‡‡é›†ã€‚è¿™æ ·**é‡‡é›†çš„æ•°æ®æ›´è´´è¿‘å®é™…éƒ¨ç½²ç¯å¢ƒï¼Œæœ‰åŠ©äºæå‡æ¨¡å‹åœ¨è®¾å¤‡ä¸Šçš„è¡¨ç°**ã€‚

âš ï¸ è¿™é‡Œç»™å‡ºä¸€äº›æ•°æ®é‡‡é›†æµç¨‹å»ºè®®ï¼š

- **æ˜ç¡®é‡‡é›†ç›®æ ‡**ï¼šå®šä¹‰é‡‡é›†å¯¹è±¡ï¼ˆå¦‚ç‰©ä½“ç±»å‹ã€åœºæ™¯ï¼‰ã€å…‰ç…§æ¡ä»¶ã€è§’åº¦ã€åˆ†è¾¨ç‡ç­‰ã€‚
- **æ˜ç¡®æ•°æ®ä»»åŠ¡**ï¼šä¸åŒçš„ä»»åŠ¡å¯¹æ•°æ®é›†çš„è¦æ±‚ä¸åŒï¼Œä¸€æ–¹é¢è¦è€ƒè™‘å®é™…éƒ¨ç½²åœºæ™¯ï¼Œå¦ä¸€æ–¹é¢è¦è€ƒè™‘ä»»åŠ¡éœ€æ±‚ï¼Œæ¯”å¦‚åˆ†ç±»ä»»åŠ¡å¯èƒ½éœ€è¦ç‰©ä½“å æ®è¾ƒå¤§çš„åŒºåŸŸï¼Œå¤§ç‰‡çš„èƒŒæ™¯å¯èƒ½ä¼šå½±å“åˆ†ç±»æ•ˆæœï¼›è€Œç›®æ ‡æ£€æµ‹å¯ä»¥æœ‰å¤§å°ä¸åŒçš„å¤šä¸ªç‰©ä½“ã€‚
- **ä½¿ç”¨åˆé€‚å·¥å…·**ï¼šä½¿ç”¨K230å¼€å‘æ¿é…åˆæ‘„åƒå¤´æ¨¡å—ï¼Œå¯ç¼–å†™è„šæœ¬è‡ªåŠ¨é‡‡é›†ã€‚
- **åŒæ­¥æ ‡æ³¨ä¿¡æ¯**ï¼šåœ¨é‡‡é›†è¿‡ç¨‹ä¸­å°½é‡åŒæ­¥è®°å½•æ ‡ç­¾ä¿¡æ¯ï¼Œä¾¿äºåæœŸæ ‡æ³¨ã€‚
- **åˆæ­¥è´¨é‡æ£€æŸ¥**ï¼šå‰”é™¤æ¨¡ç³Šã€æ›å…‰è¿‡åº¦ã€é®æŒ¡ä¸¥é‡ç­‰æ— æ•ˆæ ·æœ¬ã€‚
  
### æ•°æ®æ ‡æ³¨

```{note}
ğŸ‘‰ æ‹¿åˆ°é‡‡é›†å¥½çš„å›¾ç‰‡ä¹‹åï¼Œå°±å¯ä»¥å¼€å§‹ç»™å®ƒä»¬æ‰“æ ‡ç­¾å•¦ï¼æ ¹æ®è¿™ä¸ªä»»åŠ¡çš„è¦æ±‚ï¼Œä½ å¯ä»¥ç”¨ä¸€äº›å¸¸è§çš„æ ‡æ³¨å·¥å…·ï¼Œæ¯”å¦‚ LabelImgã€Labelme æˆ– X-AnyLabelingï¼Œç»™å›¾ç‰‡é‡Œçš„æ•°å­—åŠ ä¸Šå¯¹åº”çš„ç±»åˆ«ã€ç”»å‡ºç›®æ ‡æ¡†ã€‚ä½ å¯ä»¥äº²è‡ªé‡‡é›†å›¾åƒã€è‡ªå·±åŠ¨æ‰‹æ ‡æ³¨ï¼Œæ•´ä¸ªè¿‡ç¨‹ä¹ŸæŒºæœ‰è¶£çš„ã€‚å½“ç„¶å•¦ï¼Œå¦‚æœä½ ä¸æƒ³ä»å¤´åšï¼Œæˆ‘ä»¬ä¹Ÿè´´å¿ƒå‡†å¤‡äº†ä¸€ä»½ç°æˆçš„â€œ0/1/2/3å››ç±»æ‰“å°æ•°å­—è¯†åˆ«â€æ•°æ®é›†ï¼Œç›´æ¥ç‚¹è¿™é‡Œå°±èƒ½ä¸‹è½½ï¼š[0/1/2/3å››ç±»æ‰“å°æ•°å­—è¯†åˆ«æ•°æ®é›†](https://kendryte-download.canaan-creative.com/developer/k230/yolo_dataset/number_det.zip)ã€‚çœæ—¶åˆçœåŠ›ï¼Œç›´æ¥ä¸Šæ‰‹è®­ç»ƒä¹Ÿæ²¡é—®é¢˜ï¼
```

æ•°æ®æ ‡æ³¨æ˜¯è®­ç»ƒæ¨¡å‹çš„å…³é”®æ­¥éª¤ä¹‹ä¸€ï¼Œå®ƒæ¶‰åŠåˆ°å¯¹åŸå§‹æ•°æ®è¿›è¡Œæ ‡æ³¨ï¼Œä»¥ä¾¿æ¨¡å‹èƒ½å¤Ÿå­¦ä¹ åˆ°æ•°æ®çš„ç‰¹å¾å’Œæ¨¡å¼ã€‚åœ¨è¿›è¡Œæ•°æ®æ ‡æ³¨æ—¶ï¼Œéœ€è¦è€ƒè™‘ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

- **æ ‡æ³¨æ ¼å¼**ï¼šé€‰æ‹©é€‚åˆæ¨¡å‹çš„æ ‡æ³¨æ ¼å¼ï¼Œå¦‚XMLã€JSONã€TXTç­‰ã€‚
- **æ ‡æ³¨å·¥å…·**ï¼šé€‰æ‹©é€‚åˆçš„æ ‡æ³¨å·¥å…·ï¼Œå¦‚LabelImgã€Labelmeã€X-AnyLabelingã€VIAç­‰ã€‚
- **æ ‡æ³¨è´¨é‡**ï¼šç¡®ä¿æ ‡æ³¨çš„å‡†ç¡®æ€§å’Œä¸€è‡´æ€§ï¼Œé¿å…æ ‡æ³¨é”™è¯¯ã€‚
- **æ ‡æ³¨ç­–ç•¥**ï¼šæ ¹æ®ä»»åŠ¡éœ€æ±‚å’Œæ•°æ®ç‰¹ç‚¹ï¼Œé€‰æ‹©åˆé€‚çš„æ ‡æ³¨ç­–ç•¥ï¼Œå¦‚è¾¹ç•Œæ¡†æ ‡æ³¨ã€å…³é”®ç‚¹æ ‡æ³¨ç­‰ã€‚

å…³äºå¸¸è§çš„è§†è§‰ä»»åŠ¡ï¼Œè¿™é‡Œæ¨èä½¿ç”¨X-AnyLabelingè¿›è¡Œæ ‡æ³¨ã€‚ä¸‹è½½é“¾æ¥: [X-AnyLabeling-release](https://github.com/CVHub520/X-AnyLabeling/releases)ã€‚
  
### æ¨¡å‹è®­ç»ƒ

```{note}
ğŸ‘‰ æ¨¡å‹è®­ç»ƒçš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œå…¶ä¸­ YOLO ç³»åˆ—æ˜¯ç°åœ¨ç‰¹åˆ«å¸¸ç”¨çš„é€‰æ‹©ï¼Œæ¯”å¦‚ YOLOv5ã€YOLOv8 æˆ– YOLO11ã€‚æˆ‘ä»¬æ¨èä½ ç”¨ YOLO æ¥è¿›è¡Œè®­ç»ƒï¼Œå› ä¸ºå®ƒæ•ˆæœå¥½ã€é€Ÿåº¦å¿«ã€ç¤¾åŒºä¹Ÿå¾ˆæ´»è·ƒã€‚æ›´æ£’çš„æ˜¯ï¼Œæˆ‘ä»¬æä¾›çš„æ•°æ®é›†å·²ç»æ•´ç†å¥½äº†ï¼Œå¯ä»¥ç›´æ¥ç”¨æ¥è®­ç»ƒ YOLO æ¨¡å‹ï¼ä½ åªéœ€è¦è·³è½¬åˆ°è¿™ä¸ªç¤ºä¾‹ï¼š[YOLOæ£€æµ‹ç¤ºä¾‹](#yolov8è·Œå€’æ£€æµ‹)ï¼ŒæŒ‰ç…§é‡Œé¢çš„æµç¨‹æ¥åšï¼ŒæŠŠç¤ºä¾‹ä¸­çš„æ•°æ®é›†éƒ¨åˆ†æ¢æˆæˆ‘ä»¬å‡†å¤‡çš„â€œ0/1/2/3 å››ç±»æ‰“å°æ•°å­—è¯†åˆ«æ•°æ®é›†â€å°±è¡Œå•¦ã€‚æœ¬èŠ‚çš„ç›®æ ‡æ˜¯å…ˆæŠŠæ¨¡å‹è®­ç»ƒå¥½ï¼Œå¹¶å¯¼å‡ºä¸º ONNX æ ¼å¼ï¼Œåé¢è¿˜æœ‰æ›´å¤šæœ‰è¶£çš„å†…å®¹ç­‰ç€ä½ ç»§ç»­è§£é”ï¼
```

æ¨¡å‹è®­ç»ƒæ˜¯æ•´ä¸ªAIæµç¨‹ä¸­æœ€é‡è¦çš„ä¸€æ­¥ï¼Œå®ƒæ¶‰åŠåˆ°æ¨¡å‹çš„æ„å»ºã€è®­ç»ƒå’Œä¼˜åŒ–ã€‚åœ¨è¿›è¡Œæ¨¡å‹è®­ç»ƒæ—¶ï¼Œéœ€è¦è€ƒè™‘ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

- **æ¨¡å‹é€‰æ‹©**ï¼šæ ¹æ®ä»»åŠ¡éœ€æ±‚å’Œæ•°æ®ç‰¹ç‚¹ï¼Œé€‰æ‹©é€‚åˆçš„æ¨¡å‹ã€‚
- **æ¨¡å‹æ„å»º**ï¼šæ„å»ºæ¨¡å‹çš„ç½‘ç»œç»“æ„ï¼ŒåŒ…æ‹¬è¾“å…¥å±‚ã€éšè—å±‚å’Œè¾“å‡ºå±‚ã€‚
- **æ¨¡å‹è®­ç»ƒ**ï¼šä½¿ç”¨æ ‡æ³¨å¥½çš„æ•°æ®è¿›è¡Œæ¨¡å‹è®­ç»ƒï¼ŒåŒ…æ‹¬é€‰æ‹©åˆé€‚çš„æŸå¤±å‡½æ•°å’Œä¼˜åŒ–å™¨ã€‚
- **æ¨¡å‹è¯„ä¼°**ï¼šä½¿ç”¨æµ‹è¯•é›†å¯¹æ¨¡å‹è¿›è¡Œè¯„ä¼°ï¼Œè¯„ä¼°æ¨¡å‹çš„æ€§èƒ½å’Œæ³›åŒ–èƒ½åŠ›ã€‚
- **æ¨¡å‹ä¼˜åŒ–**ï¼šæ ¹æ®æ¨¡å‹è¯„ä¼°ç»“æœï¼Œå¯¹æ¨¡å‹è¿›è¡Œä¼˜åŒ–ï¼Œæé«˜æ¨¡å‹çš„æ€§èƒ½å’Œæ³›åŒ–èƒ½åŠ›ã€‚

è®­ç»ƒå¥½çš„æ¨¡å‹éœ€è¦è½¬æ¢æˆonnxæ¨¡å‹æˆ–è€…tfliteæ¨¡å‹ï¼Œå‡†å¤‡åç»­ä½¿ç”¨nncaseè¿›è¡Œæ¨¡å‹è½¬æ¢ï¼Œå¾—åˆ°å¯ä»¥åœ¨K230ä¸Šæ¨ç†çš„kmodelã€‚

## æ¨¡å‹è½¬æ¢

å½“æˆ‘ä»¬è®­ç»ƒç»“æŸåï¼Œä¼šå¾—åˆ°ä¸€ä¸ª ONNX æ¨¡å‹æ–‡ä»¶ã€‚ä½†è¿™ä¸ªæ¨¡å‹è¿˜ä¸èƒ½ç›´æ¥åœ¨ K230 ä¸Šç”¨ KPU æ¥è·‘ï¼Œå› ä¸º KPU åªæ”¯æŒ Kmodel æ ¼å¼ã€‚

æ‰€ä»¥æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦ç”¨ä¸€ä¸ªå« nncase çš„ç¼–è¯‘å™¨ï¼ŒæŠŠ ONNX æ¨¡å‹â€œç¿»è¯‘â€æˆ Kmodelï¼Œè¿™æ · KPU æ‰èƒ½ç†è§£å¹¶è¿è¡Œå®ƒã€‚

ä¸‹é¢æˆ‘ä»¬å°±æ¥ç®€å•è®¤è¯†ä¸€ä¸‹è¿™ä¸ªå…³é”®å·¥å…· â€”â€” nncaseï¼

### ä»€ä¹ˆæ˜¯ nncase

#### nncase ç®€ä»‹

`nncase` æ˜¯ä¸€æ¬¾ä¸“ä¸º AI åŠ é€Ÿå™¨è®¾è®¡çš„**ç¥ç»ç½‘ç»œç¼–è¯‘å™¨**ï¼Œç›®å‰å·²æ”¯æŒçš„åç«¯ï¼ˆtargetï¼‰åŒ…æ‹¬ï¼š**CPUã€K210ã€K510ã€K230** ç­‰å¹³å°ã€‚

**nncase æä¾›çš„æ ¸å¿ƒåŠŸèƒ½**ï¼š

- æ”¯æŒ **å¤šè¾“å…¥å¤šè¾“å‡º** çš„ç½‘ç»œç»“æ„ï¼Œå…¼å®¹å¸¸è§çš„ **å¤šåˆ†æ”¯æ¨¡å‹æ‹“æ‰‘**ï¼›
- é‡‡ç”¨ **é™æ€å†…å­˜åˆ†é…** ç­–ç•¥ï¼Œæ— éœ€ä¾èµ–è¿è¡Œæ—¶å †å†…å­˜ï¼Œèµ„æºå ç”¨å¯æ§ï¼›
- å®ç° **ç®—å­èåˆä¸å›¾ä¼˜åŒ–**ï¼Œæœ‰æ•ˆå‡å°‘å†—ä½™è®¡ç®—ï¼Œæå‡æ¨ç†æ•ˆç‡ï¼›
- æ”¯æŒ **æµ®ç‚¹ï¼ˆfloatï¼‰æ¨ç†** å’Œ **å®šç‚¹é‡åŒ–æ¨ç†ï¼ˆuint8/int8ï¼‰**ï¼›
- æ”¯æŒ **è®­ç»ƒåé‡åŒ–ï¼ˆPost-Training Quantization, PTQï¼‰**ï¼Œå¯åŸºäºæµ®ç‚¹æ¨¡å‹å’Œæ ¡å‡†æ•°æ®é›†ç”Ÿæˆé«˜æ•ˆçš„é‡åŒ–æ¨¡å‹ï¼›
- ç¼–è¯‘ç”Ÿæˆçš„æ¨¡å‹ä¸º**å¹³å¦ç»“æ„ï¼ˆFlat Modelï¼‰**ï¼Œå…·å¤‡ **é›¶æ‹·è´åŠ è½½ï¼ˆZero-Copy Loadingï¼‰** èƒ½åŠ›ï¼Œé€‚åˆèµ„æºå—é™çš„åµŒå…¥å¼åœºæ™¯ã€‚

**æ”¯æŒçš„æ¨¡å‹æ ¼å¼**ï¼š

nncase æ”¯æŒä»ä¸»æµæ·±åº¦å­¦ä¹ æ¡†æ¶å¯¼å‡ºçš„ä»¥ä¸‹æ¨¡å‹æ ¼å¼ï¼š

- **TFLiteï¼ˆTensorFlow Liteï¼‰**
- **ONNXï¼ˆOpen Neural Network Exchangeï¼‰**

æ‚¨å¯ä»¥ä½¿ç”¨ PyTorchã€TensorFlow ç­‰è®­ç»ƒæ¡†æ¶å¯¼å‡ºæ¨¡å‹è‡³ä¸Šè¿°æ ¼å¼ï¼Œå†é€šè¿‡ nncase è½¬æ¢ä¸º KModelï¼Œä»¥éƒ¨ç½²è‡³ K230 ç­‰è®¾å¤‡ã€‚

**æ¶æ„æ¦‚è§ˆ**ï¼š

![nncaseæ¶æ„](https://www.kendryte.com/api/post/attachment?id=509)

nncase çš„è½¯ä»¶æ ˆä¸»è¦åŒ…æ‹¬ä»¥ä¸‹ä¸¤å¤§ç»„æˆéƒ¨åˆ†ï¼š

- **Compilerï¼ˆç¼–è¯‘å™¨ï¼‰**ï¼šå°†é«˜å±‚æ¡†æ¶å¯¼å‡ºçš„ TFLite æˆ– ONNX æ¨¡å‹ï¼Œè½¬æ¢ä¸ºé€‚ç”¨äºç›®æ ‡ç¡¬ä»¶å¹³å°çš„ KModel æ ¼å¼ï¼Œå¹¶æ‰§è¡Œç»“æ„ä¼˜åŒ–ã€ç®—å­è°ƒåº¦ä¸é‡åŒ–å¤„ç†ï¼›
- **Runtimeï¼ˆè¿è¡Œæ—¶ï¼‰**ï¼šåœ¨ç›®æ ‡è®¾å¤‡ï¼ˆå¦‚ K230ï¼‰ä¸ŠåŠ è½½å¹¶è¿è¡Œ KModelï¼Œç»“åˆç¡¬ä»¶åŠ é€Ÿå•å…ƒï¼ˆå¦‚ KPUï¼‰å®ç°é«˜æ€§èƒ½æ¨¡å‹æ¨ç†ã€‚

ğŸ·ï¸ **Compiler**: ç”¨äºåœ¨PCä¸Šç¼–è¯‘ç¥ç»ç½‘ç»œæ¨¡å‹ï¼Œæœ€ç»ˆç”Ÿæˆkmodelæ–‡ä»¶ã€‚ä¸»è¦åŒ…æ‹¬importer, IR, Evaluator, Quantize, Transformä¼˜åŒ–, Tiling, Partition, Schedule, Codegenç­‰æ¨¡å—ã€‚

- Importer: å°†å…¶å®ƒç¥ç»ç½‘ç»œæ¡†æ¶çš„æ¨¡å‹å¯¼å…¥åˆ°nncaseä¸­ï¼›
- IR: ä¸­é—´è¡¨ç¤º, åˆ†ä¸ºimporterå¯¼å…¥çš„Neutral IR(è®¾å¤‡æ— å…³)å’ŒNeutral IRç»loweringè½¬æ¢ç”Ÿæˆçš„Target IR(è®¾å¤‡ç›¸å…³)ï¼›
- Evaluator: Evaluatoræä¾›IRçš„è§£é‡Šæ‰§è¡Œèƒ½åŠ›ï¼Œå¸¸è¢«ç”¨äºConstant Folding/PTQ Calibrationç­‰åœºæ™¯ï¼›
- Transform: ç”¨äºIRè½¬æ¢å’Œå›¾çš„éå†ä¼˜åŒ–ç­‰ï¼›
- Quantize: è®­ç»ƒåé‡åŒ–, å¯¹è¦é‡åŒ–çš„tensoråŠ å…¥é‡åŒ–æ ‡è®°, æ ¹æ®è¾“å…¥çš„æ ¡æ­£é›†, è°ƒç”¨ Evaluatorè¿›è¡Œè§£é‡Šæ‰§è¡Œ, æ”¶é›†tensorçš„æ•°æ®èŒƒå›´, æ’å…¥é‡åŒ–/åé‡åŒ–ç»“ç‚¹, æœ€åä¼˜åŒ–æ¶ˆé™¤ä¸å¿…è¦çš„é‡åŒ–/åé‡åŒ–ç»“ç‚¹ç­‰ï¼›
- Tiling: å—é™äºNPUè¾ƒä½çš„å­˜å‚¨å™¨å®¹é‡ï¼Œéœ€è¦å°†å¤§å—è®¡ç®—è¿›è¡Œæ‹†åˆ†ã€‚å¦å¤–ï¼Œè®¡ç®—å­˜åœ¨å¤§é‡æ•°æ®å¤ç”¨æ—¶é€‰æ‹©Tilingå‚æ•°ä¼šå¯¹æ—¶å»¶å’Œå¸¦å®½äº§ç”Ÿå½±å“ï¼›
- Partition: å°†å›¾æŒ‰ModuleTypeè¿›è¡Œåˆ‡åˆ†, åˆ‡åˆ†åçš„æ¯ä¸ªå­å›¾ä¼šå¯¹åº”RuntimeModule, ä¸åŒç±»å‹çš„RuntimeModuleå¯¹åº”ä¸åŒçš„Device(CPU/K230)ï¼›
- Schedule: æ ¹æ®ä¼˜åŒ–åå›¾ä¸­çš„æ•°æ®ä¾èµ–å…³ç³»ç”Ÿæˆè®¡ç®—é¡ºåºå¹¶åˆ†é…Bufferï¼›
- Codegen: å¯¹æ¯ä¸ªå­å›¾åˆ†åˆ«è°ƒç”¨ModuleTypeå¯¹åº”çš„codegenï¼Œç”ŸæˆRuntimeModuleï¼›

ğŸ·ï¸ **Runtime**: é›†æˆäºç”¨æˆ·åº”ç”¨ç¨‹åºï¼ˆAppï¼‰ä¸­ï¼Œæä¾›æ¨¡å‹åŠ è½½ã€è¾“å…¥è®¾ç½®ã€æ¨ç†æ‰§è¡Œå’Œè¾“å‡ºè¯»å–ç­‰åŠŸèƒ½ã€‚Runtime æ¥å£å±è”½äº†åº•å±‚ç¡¬ä»¶å·®å¼‚ï¼Œä½¿å¼€å‘è€…èƒ½æ›´ä¸“æ³¨äºæ¨¡å‹æ¨ç†é€»è¾‘çš„é›†æˆä¸åº”ç”¨å¼€å‘ã€‚

æ¨¡å‹è½¬æ¢ç« èŠ‚ä¸»è¦ä»‹ç»nncase compilerå’Œsimulatorçš„ä½¿ç”¨æ–¹æ³•ã€‚

#### å®‰è£… nncase ç¯å¢ƒ

- **Linux ç¯å¢ƒæ­å»º nncase**

é¦–å…ˆï¼Œè¯·å®‰è£… `.NET SDK 7.0` å¹¶é…ç½® `DOTNET_ROOT` ç¯å¢ƒå˜é‡ã€‚**è¯·æ³¨æ„ï¼Œä¸å»ºè®®åœ¨ Anaconda è™šæ‹Ÿç¯å¢ƒä¸­å®‰è£… `dotnet`ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´å…¼å®¹æ€§é—®é¢˜ã€‚**

```bash
sudo apt-get update
sudo apt-get install dotnet-sdk-7.0
export DOTNET_ROOT=/usr/share/dotnet
```

æ¥ä¸‹æ¥ï¼Œé€šè¿‡ pip å®‰è£… `nncase` å’Œ `nncase-kpu`ï¼š

```bash
pip install nncase nncase-kpu
```

- **Windows ç¯å¢ƒæ­å»º nncase**

é¦–å…ˆå®‰è£… [.NET SDK 7.0](https://learn.microsoft.com/zh-cn/dotnet/core/install/windows)ï¼Œè¯·æ ¹æ® Microsoft å®˜æ–¹æ–‡æ¡£å®Œæˆå®‰è£…æµç¨‹ã€‚
å®‰è£… `nncase` åº“ã€‚å¯é€šè¿‡ pip åœ¨çº¿å®‰è£…ä¸»ç¨‹åº `nncase`ï¼Œå¹¶ä» [GitHub Releases é¡µé¢](https://github.com/kendryte/nncase/releases) ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„ `nncase_kpu`ï¼Œå†ä½¿ç”¨ pip ç¦»çº¿å®‰è£…ã€‚

```bash
pip install nncase
# è¯·å°† `2.x.x` æ›¿æ¢ä¸ºå®é™…ä¸‹è½½ç‰ˆæœ¬å·ã€‚
pip install nncase_kpu-2.x.x-py2.py3-none-win_amd64.whl
```

- **ä½¿ç”¨ Docker æ­å»ºç¯å¢ƒ**

å¦‚æœæ‚¨æœªé…ç½® Ubuntu æœ¬åœ°ç¯å¢ƒï¼Œå¯ç›´æ¥ä½¿ç”¨å®˜æ–¹æä¾›çš„ `nncase` Docker é•œåƒã€‚è¯¥é•œåƒåŸºäº Ubuntu 20.04ï¼Œé¢„è£…äº† Python 3.8 å’Œ dotnet-sdk-7.0ï¼Œæ–¹ä¾¿å¿«é€Ÿå¯åŠ¨ã€‚

```bash
cd /path/to/nncase_sdk
docker pull ghcr.io/kendryte/k230_sdk
docker run -it --rm -v `pwd`:/mnt -w /mnt ghcr.io/kendryte/k230_sdk /bin/bash
```

- **æŸ¥çœ‹ nncase ç‰ˆæœ¬ä¿¡æ¯**

è¿›å…¥ Python äº¤äº’ç¯å¢ƒåå¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤ç¡®è®¤å½“å‰å®‰è£…çš„ `nncase` ç‰ˆæœ¬ï¼š

```python
>>> import _nncase
>>> print(_nncase.__version__)
2.9.0
```

> ç¤ºä¾‹è¾“å‡ºä¸º `2.9.0`ï¼Œè¯·ä»¥å®é™…å®‰è£…ç‰ˆæœ¬ä¸ºå‡†ã€‚

### ä½¿ç”¨ nncase ç¼–è¯‘å™¨è½¬æ¢kmodel

![compile_kmodel](https://www.kendryte.com/api/post/attachment?id=636)

ç¼–è¯‘kmodelçš„æµç¨‹ä¸»è¦åŒ…å«ä»¥ä¸‹å…³é”®æ­¥éª¤ï¼Œæ¯ä¸ªæ­¥éª¤éƒ½æœ‰å…¶ç‰¹å®šçš„ç›®çš„å’ŒæŠ€æœ¯è€ƒé‡ï¼š

**è®¾ç½®ç¼–è¯‘é€‰é¡¹**ï¼šè¿™ä¸€æ­¥çš„æ ¸å¿ƒç›®çš„æ˜¯ä¸ºæ¨¡å‹éƒ¨ç½²é€‚é…ç›®æ ‡ç¡¬ä»¶å¹³å°ã€‚ç”±äºè¾¹ç¼˜è®¡ç®—è®¾å¤‡éœ€è¦æ˜ç¡®æŒ‡å®šè¿è¡Œå¹³å°ä»¥ç¡®ä¿ç”Ÿæˆçš„kmodelæ˜¯å¦éœ€è¦åˆ©ç”¨ç¡¬ä»¶ï¼ˆkpuï¼‰åŠ é€Ÿã€‚åŒæ—¶ï¼Œé…ç½®é¢„å¤„ç†å‚æ•°ï¼ˆå¦‚è¾“å…¥æ ‡å‡†åŒ–å‚æ•°ï¼‰åˆ°kmodelå†…éƒ¨å¯å‡å°‘æ¨ç†æ—¶çš„è®¡ç®—å¼€é”€ï¼Œæå‡æ•´ä½“æ•ˆç‡ã€‚

**åˆå§‹åŒ–ç¼–è¯‘å™¨**ï¼šnncaseç¼–è¯‘å™¨çš„åˆå§‹åŒ–æ˜¯ä¸ºåç»­è½¬æ¢å·¥ä½œæ„å»ºæ ‡å‡†åŒ–ç¯å¢ƒã€‚ç¼–è¯‘å™¨æ ¹æ®å‰è¿°é…ç½®çš„ç¼–è¯‘é€‰é¡¹å®Œæˆåˆå§‹åŒ–è¿‡ç¨‹ã€‚

**å¯¼å…¥åŸå§‹æ¨¡å‹**ï¼šå½“å‰ä¸»æµè®­ç»ƒæ¡†æ¶ï¼ˆå¦‚TensorFlow/PyTorchï¼‰ç”Ÿæˆçš„ONNX/TFLiteæ¨¡å‹åŒ…å«é€šç”¨è¿ç®—ç¬¦ï¼Œä½†KPUä½œä¸ºä¸“ç”¨åŠ é€Ÿå™¨éœ€è¦ç‰¹å®šç®—å­æ ¼å¼ã€‚æ­¤æ­¥éª¤é€šè¿‡æ¨¡å‹è§£æå’Œç®—å­è½¬æ¢ï¼Œå°†åŸå§‹æ¨¡å‹è½¬åŒ–ä¸ºç¼–è¯‘å™¨å¯ä¼˜åŒ–çš„ä¸­é—´è¡¨ç¤ºï¼Œä¸ºåç»­ç¡¬ä»¶ç›¸å…³ä¼˜åŒ–å¥ å®šåŸºç¡€ã€‚

**é‡åŒ–å¤„ç†**ï¼šè¿™æ˜¯æå‡è¾¹ç¼˜ä¾§æ¨ç†æ€§èƒ½çš„å…³é”®ç¯èŠ‚ã€‚æˆ‘ä»¬è®­ç»ƒå¾—åˆ°çš„FP32æ¨¡å‹è™½ç²¾åº¦é«˜ä½†å­˜åœ¨è®¡ç®—å»¶è¿Ÿå¤§ã€å†…å­˜å ç”¨é«˜ç­‰é—®é¢˜ã€‚é€šè¿‡é‡åŒ–åˆ°INT8/INT16ï¼šæ˜¾è‘—å‡å°‘æ¨¡å‹ä½“ç§¯ï¼Œæå‡è®¡ç®—é€Ÿåº¦ï¼ˆåˆ©ç”¨ç¡¬ä»¶å®šç‚¹åŠ é€ŸæŒ‡ä»¤ï¼‰ï¼Œé™ä½åŠŸè€—ï¼ˆå‡å°‘å†…å­˜å¸¦å®½éœ€æ±‚ï¼‰ã€‚éœ€æ³¨æ„çš„æ˜¯ï¼Œé‡åŒ–ä¼šå¼•å…¥ç²¾åº¦æŸå¤±ï¼Œå› æ­¤éœ€è¦é€šè¿‡æ ¡å‡†æ•°æ®é›†å¸®åŠ©æ¨¡å‹ç¡®å®šåœ¨é‡åŒ–è¿‡ç¨‹ä¸­æ¯ä¸€å±‚æƒé‡å’Œæ¿€æ´»å€¼åº”è¯¥è¢«æ˜ å°„åˆ°çš„èŒƒå›´ï¼Œä»¥ä¾¿ä¿ç•™æ›´å¤šçš„ä¿¡æ¯ï¼Œå‡å°‘é‡åŒ–è¯¯å·®ã€‚é‡åŒ–è¿‡ç¨‹éœ€è¦é…ç½®é‡åŒ–å‚æ•°å’Œæ ¡å‡†æ•°æ®ï¼Œé‡åŒ–å‚æ•°è§[ç¼–è¯‘å‚æ•°è¯´æ˜](#ç¼–è¯‘å‚æ•°è¯´æ˜)ã€‚

**ç¼–è¯‘ç”Ÿæˆkmodel**ï¼šåœ¨å‰è¿°ä¼˜åŒ–åŸºç¡€ä¸Šï¼Œæœ€ç»ˆç”Ÿæˆçš„kmodelæ˜¯ç»è¿‡æ·±åº¦ä¼˜åŒ–çš„å¯ç›´æ¥éƒ¨ç½²åˆ°K230è®¾å¤‡æ‰§è¡Œé«˜æ•ˆæ¨ç†ã€‚

#### è½¬æ¢ç¤ºä¾‹

æˆ‘ä»¬å°±ä»¥**å››ç±»æ‰“å°æ•°å­—è¯†åˆ«**åœºæ™¯ä¸ºä¾‹ï¼Œå°†ä¸Šé¢å¾—åˆ°çš„ONNXæ¨¡å‹è½¬æ¢æˆKmodelã€‚è¿™é‡Œç»™å‡ºç¼–è¯‘ç¤ºä¾‹è„šæœ¬ï¼š

```python
# å¯¼å…¥æ‰€éœ€åº“
import os
import argparse
import numpy as np
from PIL import Image  # ç”¨äºå›¾åƒè¯»å–å’Œå¤„ç†
import onnxsim         # ONNX æ¨¡å‹ç®€åŒ–å·¥å…·
import onnx            # ONNX æ¨¡å‹å¤„ç†å·¥å…·
import nncase          # nncase ç¼–è¯‘å™¨ SDK
import shutil
import math

def parse_model_input_output(model_file, input_shape):
    # åŠ è½½ONNXæ¨¡å‹
    onnx_model = onnx.load(model_file)
    
    # è·å–æ¨¡å‹ä¸­æ‰€æœ‰è¾“å…¥èŠ‚ç‚¹åç§°
    input_all = [node.name for node in onnx_model.graph.input]
    
    # è·å–æ¨¡å‹ä¸­å·²ç»è¢«åˆå§‹åŒ–çš„å‚æ•°ï¼ˆå¦‚æƒé‡ç­‰ï¼‰ï¼Œè¿™äº›ä¸å±äºè¾“å…¥æ•°æ®
    input_initializer = [node.name for node in onnx_model.graph.initializer]
    
    # çœŸå®è¾“å…¥ = æ‰€æœ‰è¾“å…¥ - åˆå§‹åŒ–å™¨
    input_names = list(set(input_all) - set(input_initializer))
    
    # ä»å›¾ä¸­æå–çœŸå®è¾“å…¥å¼ é‡
    input_tensors = [node for node in onnx_model.graph.input if node.name in input_names]

    # æå–è¾“å…¥å¼ é‡çš„åç§°ã€æ•°æ®ç±»å‹ã€å½¢çŠ¶ç­‰ä¿¡æ¯
    inputs = []
    for _, e in enumerate(input_tensors):
        onnx_type = e.type.tensor_type
        input_dict = {}
        input_dict['name'] = e.name
        # è½¬æ¢ä¸ºNumPyæ•°æ®ç±»å‹
        input_dict['dtype'] = onnx.mapping.TENSOR_TYPE_TO_NP_TYPE[onnx_type.elem_type]
        # å¦‚æœæŸç»´ä¸º0ï¼Œè¯´æ˜ONNXæ¨¡å‹æœªå›ºå®šshapeï¼Œä½¿ç”¨ä¼ å…¥çš„input_shapeä»£æ›¿
        input_dict['shape'] = [(i.dim_value if i.dim_value != 0 else d) for i, d in zip(onnx_type.shape.dim, input_shape)]
        inputs.append(input_dict)

    return onnx_model, inputs

def onnx_simplify(model_file, dump_dir, input_shape):
    # è·å–æ¨¡å‹å’Œè¾“å…¥å½¢çŠ¶ä¿¡æ¯
    onnx_model, inputs = parse_model_input_output(model_file, input_shape)

    # è‡ªåŠ¨æ¨æ–­ç¼ºå¤±çš„shapeä¿¡æ¯
    onnx_model = onnx.shape_inference.infer_shapes(onnx_model)

    # æ„é€ ç”¨äºonnxsimçš„è¾“å…¥shapeæ˜ å°„
    input_shapes = {input['name']: input['shape'] for input in inputs}

    # ç®€åŒ–æ¨¡å‹
    onnx_model, check = onnxsim.simplify(onnx_model, input_shapes=input_shapes)
    assert check, "æ¨¡å‹ç®€åŒ–æ ¡éªŒå¤±è´¥"

    # ä¿å­˜ç®€åŒ–åçš„æ¨¡å‹
    model_file = os.path.join(dump_dir, 'simplified.onnx')
    onnx.save_model(onnx_model, model_file)
    return model_file

def read_model_file(model_file):
    with open(model_file, 'rb') as f:
        model_content = f.read()
    return model_content

def generate_data(shape, batch, calib_dir):
    # è·å–æ•°æ®é›†ä¸­çš„æ‰€æœ‰å›¾ç‰‡è·¯å¾„
    img_paths = [os.path.join(calib_dir, p) for p in os.listdir(calib_dir)]
    data = []

    for i in range(batch):
        assert i < len(img_paths), "æ ¡å‡†å›¾ç‰‡æ•°é‡ä¸è¶³"

        # åŠ è½½å›¾ç‰‡ï¼Œè½¬æ¢ä¸ºRGBæ ¼å¼
        img_data = Image.open(img_paths[i]).convert('RGB')

        # æŒ‰æ¨¡å‹è¾“å…¥å°ºå¯¸è¿›è¡Œç¼©æ”¾
        img_data = img_data.resize((shape[3], shape[2]), Image.BILINEAR)

        # è½¬æ¢ä¸ºNumPyæ•°ç»„
        img_data = np.asarray(img_data, dtype=np.uint8)

        # è½¬æ¢ä¸º NCHW æ ¼å¼
        img_data = np.transpose(img_data, (2, 0, 1))

        # å¢åŠ batchç»´åº¦
        data.append([img_data[np.newaxis, ...]])

    return np.array(data)

def main():
    # å‘½ä»¤è¡Œå‚æ•°å®šä¹‰
    parser = argparse.ArgumentParser(prog="nncase")
    parser.add_argument("--target", default="k230", type=str, help='ç¼–è¯‘ç›®æ ‡ï¼Œä¾‹å¦‚k230æˆ–cpu')
    parser.add_argument("--model", type=str, help='è¾“å…¥ONNXæ¨¡å‹è·¯å¾„')
    parser.add_argument("--dataset_path", type=str, help='PTQæ ¡å‡†æ•°æ®é›†è·¯å¾„')
    parser.add_argument("--input_width", type=int, default=320, help='æ¨¡å‹è¾“å…¥å®½åº¦')
    parser.add_argument("--input_height", type=int, default=320, help='æ¨¡å‹è¾“å…¥é«˜åº¦')
    parser.add_argument("--ptq_option", type=int, default=0, help='PTQé€‰é¡¹ï¼š0-5')

    args = parser.parse_args()

    # è¾“å…¥å°ºå¯¸å‘ä¸Šå¯¹é½åˆ°32çš„æ•´æ•°å€ï¼Œç¬¦åˆç¡¬ä»¶è¦æ±‚
    input_width = int(math.ceil(args.input_width / 32.0)) * 32
    input_height = int(math.ceil(args.input_height / 32.0)) * 32
    input_shape = [1, 3, input_height, input_width]  # NCHWæ ¼å¼

    # åˆ›å»ºä¸´æ—¶ç›®å½•ä¿å­˜ä¸­é—´æ¨¡å‹
    dump_dir = 'tmp'
    if not os.path.exists(dump_dir):
        os.makedirs(dump_dir)

    # ç®€åŒ–æ¨¡å‹
    model_file = onnx_simplify(args.model, dump_dir, input_shape)

    # ç¼–è¯‘é€‰é¡¹è®¾ç½®
    compile_options = nncase.CompileOptions()
    compile_options.target = args.target                  # æŒ‡å®šç›®æ ‡å¹³å°
    compile_options.preprocess = True                     # å¯ç”¨é¢„å¤„ç†
    compile_options.swapRB = False                        # ä¸äº¤æ¢RBé€šé“
    compile_options.input_shape = input_shape             # è®¾ç½®è¾“å…¥å½¢çŠ¶
    compile_options.input_type = 'uint8'                  # è¾“å…¥å›¾åƒæ•°æ®ç±»å‹
    compile_options.input_range = [0, 1]                  # è¾“å…¥å›¾åƒåé‡åŒ–èŒƒå›´
    compile_options.mean = [0, 0, 0]                      # é¢„å¤„ç†å‡å€¼
    compile_options.std = [1, 1, 1]                       # æ ‡å‡†å·®è®¾ä¸º1ï¼Œä¸è¿›è¡Œå½’ä¸€åŒ–
    compile_options.input_layout = "NCHW"                 # è¾“å…¥æ•°æ®æ ¼å¼

    # åˆå§‹åŒ–ç¼–è¯‘å™¨
    compiler = nncase.Compiler(compile_options)

    # å¯¼å…¥ONNXæ¨¡å‹ä¸ºIR
    model_content = read_model_file(model_file)
    import_options = nncase.ImportOptions()
    compiler.import_onnx(model_content, import_options)

    # PTQé€‰é¡¹è®¾ç½®ï¼ˆåè®­ç»ƒé‡åŒ–ï¼‰
    ptq_options = nncase.PTQTensorOptions()
    ptq_options.samples_count = 10  # æ ¡å‡†æ ·æœ¬æ•°é‡

    # æ”¯æŒ6ç§é‡åŒ–æ–¹æ¡ˆï¼ˆæ ¹æ®ç²¾åº¦ä¸æ€§èƒ½æƒè¡¡é€‰æ‹©ï¼‰
    if args.ptq_option == 0:
        ptq_options.calibrate_method = 'NoClip'
        ptq_options.quant_type = 'uint8'
        ptq_options.w_quant_type = 'uint8'
    elif args.ptq_option == 1:
        ptq_options.calibrate_method = 'NoClip'
        ptq_options.quant_type = 'uint8'
        ptq_options.w_quant_type = 'int16'
    elif args.ptq_option == 2:
        ptq_options.calibrate_method = 'NoClip'
        ptq_options.quant_type = 'int16'
        ptq_options.w_quant_type = 'uint8'
    elif args.ptq_option == 3:
        ptq_options.calibrate_method = 'Kld'
        ptq_options.quant_type = 'uint8'
        ptq_options.w_quant_type = 'uint8'
    elif args.ptq_option == 4:
        ptq_options.calibrate_method = 'Kld'
        ptq_options.quant_type = 'uint8'
        ptq_options.w_quant_type = 'int16'
    elif args.ptq_option == 5:
        ptq_options.calibrate_method = 'Kld'
        ptq_options.quant_type = 'int16'
        ptq_options.w_quant_type = 'uint8'

    # è®¾ç½®PTQæ ¡å‡†æ•°æ®
    ptq_options.set_tensor_data(generate_data(input_shape, ptq_options.samples_count, args.dataset_path))

    # åº”ç”¨PTQ
    compiler.use_ptq(ptq_options)

    # ç¼–è¯‘æ¨¡å‹
    compiler.compile()

    # å¯¼å‡ºKModelæ–‡ä»¶
    base, ext = os.path.splitext(args.model)
    kmodel_name = base + ".kmodel"
    with open(kmodel_name, 'wb') as f:
        f.write(compiler.gencode_tobytes())

# Pythonç¨‹åºä¸»å…¥å£
if __name__ == '__main__':
    main()
```

å°†ä¸Šè¿°ä»£ç ä¿å­˜ä¸º`to_kmodel.py`è„šæœ¬ï¼Œä½¿ç”¨å¦‚ä¸‹è½¬æ¢å‘½ä»¤å®Œæˆç¼–è¯‘ï¼š

```shell
# ä½ éœ€è¦å°†onnxæ¨¡å‹æ¢æˆä½ è®­ç»ƒå¥½çš„æ¨¡å‹
python to_kmodel.py --target k230 --model best.onnx --dataset_path test --input_width 320 --input_height 320 --ptq_option 0
```

é€šè¿‡ä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸæ‹¿åˆ°äº†ç”¨äºè¯†åˆ«å››ç±»æ•°å­—çš„ Kmodel æ¨¡å‹ã€‚é‚£ä¹ˆä½ å¯èƒ½ä¼šå¥½å¥‡ï¼šåœ¨æŠŠæ¨¡å‹è½¬æ¢æˆ Kmodel çš„è¿‡ç¨‹ä¸­ï¼Œé‡Œé¢ç”¨åˆ°çš„é‚£äº›å‚æ•°åˆ°åº•æ˜¯å•¥æ„æ€ï¼Ÿå¦‚æœä»¥åæˆ‘æƒ³æ¢ä¸ªæ¨¡å‹æ¥è½¬ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿè¦æ”¹å‚æ•°å‘¢ï¼Ÿåˆ«ç€æ€¥ï¼Œæ¥ä¸‹æ¥çš„ç« èŠ‚æˆ‘ä»¬å°±ä¼šå¸¦ä½ ææ‡‚è¿™äº›è½¬æ¢å‚æ•°çš„å…·ä½“å«ä¹‰ï¼Œè¿˜ä¼šæ•™ä½ åœ¨è½¬æ¢å…¶ä»–æ¨¡å‹æ—¶è¯¥æ€ä¹ˆæ­£ç¡®é…ç½®ï¼Œä¸€æ­¥æ­¥å¸¦ä½ ä¸Šæ‰‹ï¼Œä¸è¿·è·¯ï¼

#### ç¼–è¯‘å‚æ•°è¯´æ˜

ä½¿ç”¨ `nncase compiler` å°† `tflite/onnx` æ¨¡å‹è½¬æ¢æˆ `kmodel` ï¼Œæ¨¡å‹è½¬æ¢ä»£ç çš„å…³é”®åœ¨äºæ ¹æ®è‡ªèº«éœ€æ±‚è¿›è¡Œé€‰é¡¹é…ç½®ï¼Œä¸»è¦æ˜¯ `CompileOptions` ã€ `PTQTensorOptions` å’Œ `ImportOptions`ã€‚

`nncase` ç”¨æˆ·æŒ‡å—æ–‡æ¡£è§ï¼š[github: user_guide](https://github.com/kendryte/nncase/tree/master/examples/user_guide) æˆ– [gitee: user_guide](https://gitee.com/kendryte/nncase/tree/master/examples/user_guide) ã€‚

- **ç¼–è¯‘é€‰é¡¹ CompileOptions**

`CompileOptions` ç±», ç”¨äºé…ç½® `nncase` ç¼–è¯‘é€‰é¡¹ï¼Œå„å±æ€§è¯´æ˜å¦‚ä¸‹ï¼š

| å±æ€§åç§°                    |         ç±»å‹          | æ˜¯å¦å¿…é¡» | æè¿°                                                                                                                   |
| :-------------------------- | :-------------------: | :------: | ---------------------------------------------------------------------------------------------------------------------- |
| target                      |        string         |    æ˜¯    | æŒ‡å®šç¼–è¯‘ç›®æ ‡, å¦‚'cpu', 'k230'                                                                                          |
| dump_ir                     |         bool          |    å¦    | æŒ‡å®šæ˜¯å¦dump IR, é»˜è®¤ä¸ºFalse                                                                                           |
| dump_asm                    |         bool          |    å¦    | æŒ‡å®šæ˜¯å¦dump asmæ±‡ç¼–æ–‡ä»¶, é»˜è®¤ä¸ºFalse                                                                                  |
| dump_dir                    |        string         |    å¦    | å‰é¢æŒ‡å®šdump_irç­‰å¼€å…³å, è¿™é‡ŒæŒ‡å®šdumpçš„ç›®å½•, é»˜è®¤ä¸º""                                                                  |
| input_file                  |        string         |    å¦    | ONNXæ¨¡å‹è¶…è¿‡2GBæ—¶ï¼Œç”¨äºæŒ‡å®šå‚æ•°æ–‡ä»¶è·¯å¾„ï¼Œé»˜è®¤ä¸º""                                                                      |
| preprocess                  |         bool          |    å¦    | æ˜¯å¦å¼€å¯å‰å¤„ç†ï¼Œé»˜è®¤ä¸ºFalseã€‚ä»¥ä¸‹å‚æ•°ä»…åœ¨ `preprocess=True`æ—¶ç”Ÿæ•ˆ                                                      |
| input_type                  |        string         |    å¦    | å¼€å¯å‰å¤„ç†æ—¶æŒ‡å®šè¾“å…¥æ•°æ®ç±»å‹ï¼Œé»˜è®¤ä¸º"float"ã€‚å½“ `preprocess`ä¸º `True`æ—¶ï¼Œå¿…é¡»æŒ‡å®šä¸º"uint8"æˆ–è€…"float32"                |
| input_shape                 |       list[int]       |    å¦    | å¼€å¯å‰å¤„ç†æ—¶æŒ‡å®šè¾“å…¥æ•°æ®çš„shapeï¼Œé»˜è®¤ä¸º[]ã€‚å½“ `preprocess`ä¸º `True`æ—¶ï¼Œå¿…é¡»æŒ‡å®š                                        |
| input_range                 |      list[float]      |    å¦    | å¼€å¯å‰å¤„ç†æ—¶æŒ‡å®šè¾“å…¥æ•°æ®åé‡åŒ–åçš„æµ®ç‚¹æ•°èŒƒå›´ï¼Œé»˜è®¤ä¸º[ ]ã€‚å½“ `preprocess`ä¸º `True`ä¸” `input_type`ä¸º `uint8`æ—¶ï¼Œå¿…é¡»æŒ‡å®š |
| input_layout                |        string         |    å¦    | æŒ‡å®šè¾“å…¥æ•°æ®çš„layoutï¼Œé»˜è®¤ä¸º""                                                                                         |
| swapRB                      |         bool          |    å¦    | æ˜¯å¦åœ¨ `channel`ç»´åº¦åè½¬æ•°æ®ï¼Œé»˜è®¤ä¸ºFalse                                                                              |
| mean                        |      list[float]      |    å¦    | å‰å¤„ç†æ ‡å‡†åŒ–å‚æ•°å‡å€¼ï¼Œé»˜è®¤ä¸º[0,0,0]                                                                                    |
| std                         |      list[float]      |    å¦    | å‰å¤„ç†æ ‡å‡†åŒ–å‚æ•°æ–¹å·®ï¼Œé»˜è®¤ä¸º[1,1,1]                                                                                    |
| letterbox_value             |         float         |    å¦    | æŒ‡å®šå‰å¤„ç†letterboxçš„å¡«å……å€¼ï¼Œé»˜è®¤ä¸º0                                                                                   |
| output_layout               |        string         |    å¦    | æŒ‡å®šè¾“å‡ºæ•°æ®çš„layout, é»˜è®¤ä¸º""                                                                                         |
| shape_bucket_enable         |         bool          |    æ˜¯    | æ˜¯å¦å¼€å¯ShapeBucketåŠŸèƒ½ï¼Œé»˜è®¤ä¸ºFalseã€‚åœ¨ `dump_ir=True`æ—¶ç”Ÿæ•ˆ                                                          |
| shape_bucket_range_info     | Dict[str, [int, int]] |    æ˜¯    | æ¯ä¸ªè¾“å…¥shapeç»´åº¦ä¿¡æ¯ä¸­çš„å˜é‡çš„èŒƒå›´ï¼Œæœ€å°å€¼å¿…é¡»å¤§äºç­‰äº1                                                               |
| shape_bucket_segments_count |          int          |    æ˜¯    | è¾“å…¥å˜é‡çš„èŒƒå›´åˆ’åˆ†ä¸ºå‡ æ®µ                                                                                               |
| shape_bucket_fix_var_map    |    Dict[str, int]     |    å¦    | å›ºå®šshapeç»´åº¦ä¿¡æ¯ä¸­çš„å˜é‡ä¸ºç‰¹å®šçš„å€¼|

å…³äºå‰å¤„ç†çš„é…ç½®è¯´æ˜ï¼Œè¯·å‚è€ƒ API æ–‡æ¡£ï¼š[nncase æ¨¡å‹ç¼–è¯‘APIæ‰‹å†Œå‰å¤„ç†æµç¨‹](./api_reference/nncase/nncase_compile.md#å‰å¤„ç†æµç¨‹è¯´æ˜)ã€‚å°†éƒ¨åˆ†å‰å¤„ç†æ“ä½œå°è£…åœ¨æ¨¡å‹å†…å¯ä»¥æé«˜å¼€å‘æ¿æ¨ç†æ—¶çš„å‰å¤„ç†æ•ˆç‡ï¼Œæ”¯æŒçš„å‰å¤„ç†åŒ…æ‹¬ï¼š`swapRB`(RGB->BGR or BGR->RGB)ã€`Transpose`(NHWC->NCHW or NCHW->NHWC)ã€`Normalization`ï¼ˆå‡å‡å€¼é™¤æ–¹å·®ï¼‰ã€`Dequantize`ç­‰ã€‚æ¯”å¦‚ï¼šonnxæ¨¡å‹éœ€è¦çš„è¾“å…¥æ˜¯`RGB`çš„ï¼Œæˆ‘ä»¬ä½¿ç”¨`opencv`è¯»å–çš„å›¾ç‰‡æ˜¯`BGR`ï¼Œæ­£å¸¸onnxæ¨¡å‹æ¨ç†çš„é¢„å¤„ç†æˆ‘ä»¬éœ€è¦å…ˆå°†`BGR`è½¬æˆ`RGB`ç»™onnxæ¨¡å‹ä½¿ç”¨ã€‚è½¬kmodelçš„æ—¶å€™æˆ‘ä»¬å°±å¯ä»¥è®¾ç½® `swapRB` ä¸º `True` ï¼Œè¿™æ ·kmodelä¸­è‡ªå¸¦äº¤æ¢`RB`é€šé“çš„é¢„å¤„ç†æ­¥éª¤ï¼Œåœ¨è¿›è¡Œkmodelæ¨ç†çš„é¢„å¤„ç†æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¿½ç•¥äº¤æ¢`RB`é€šé“çš„æ­¥éª¤ï¼Œå°†æ­¤æ­¥éª¤æ”¾åˆ°kmodelå†…éƒ¨ã€‚

- **å¯¼å…¥é€‰é¡¹ ImportOptions**

ImportOptionsç±», ç”¨äºé…ç½®nncaseå¯¼å…¥é€‰é¡¹ï¼Œé…ç½®ç¼–è¯‘å™¨çš„å¾…è½¬æ¢æ¨¡å‹ã€‚å¯ä»¥é…ç½® `tflite/onnx`ã€‚ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š

```python
# è¯»å–å¹¶å¯¼å…¥tfliteæ¨¡å‹
model_content = read_model_file(model)
compiler.import_tflite(model_content, import_options)

# è¯»å–å¹¶å¯¼å…¥onnxæ¨¡å‹
model_content = read_model_file(model)
compiler.import_onnx(model_content, import_options)
```

- **è®­ç»ƒåé‡åŒ–é€‰é¡¹ PTQTensorOptions**

`PTQTensorOptions` ç±», ç”¨äºé…ç½® `nncase PTQ` é€‰é¡¹ï¼š

| åç§°                           | ç±»å‹   | æ˜¯å¦å¿…é¡» | æè¿° |
| ------------------------------ | ------ | -------- | ---- |
| samples_count                  | int    |    å¦    |  æŒ‡å®šç”¨äºé‡åŒ–çš„æ ¡æ­£é›†æ•°é‡    |
| calibrate_method               | string |    å¦    |  æŒ‡å®šé‡åŒ–æ–¹æ³•ï¼Œå¯é€‰'NoClip'ã€'Kld'ï¼Œé»˜è®¤ä¸º'Kld'   |
| finetune_weights_method        | string |    å¦    |  æŒ‡å®šæ˜¯å¦å¯¹æƒé‡è¿›è¡Œå¾®è°ƒï¼Œå¯é€‰'NoFineTuneWeights'ã€'UseSquant'ï¼Œé»˜è®¤ä¸º'NoFineTuneWeights'  |
| quant_type                     | string |    å¦    |  æŒ‡å®šæ•°æ®é‡åŒ–ç±»å‹ï¼Œå¯é€‰'uint8'ï¼Œ'int8'ï¼Œ'int16'ï¼Œ`quant_type`å’Œ`w_quant_type`ä¸¤ç§ç±»å‹ä¸å¯åŒæ—¶ä¸º'int16'  |
| w_quant_type                   | string |    å¦    |  æŒ‡å®šæƒé‡é‡åŒ–ç±»å‹ï¼Œå¯é€‰'uint8'ï¼Œ'int8'ï¼Œ'int16'ï¼Œ`quant_type`å’Œ`w_quant_type`ä¸¤ç§ç±»å‹ä¸å¯åŒæ—¶ä¸º'int16' |
| quant_scheme                   | string |    å¦    |  å¯¼å…¥é‡åŒ–å‚æ•°é…ç½®æ–‡ä»¶çš„è·¯å¾„ |
| quant_scheme_strict_mode       | bool   |    å¦    |  æ˜¯å¦ä¸¥æ ¼æŒ‰ç…§quant_schemeæ‰§è¡Œé‡åŒ–  |
| export_quant_scheme            | bool   |    å¦    |  æ˜¯å¦å¯¼å‡ºé‡åŒ–å‚æ•°é…ç½®æ–‡ä»¶  |
| export_weight_range_by_channel | bool   |    å¦    |  æ˜¯å¦å¯¼å‡º `bychannel`å½¢å¼çš„weightsé‡åŒ–å‚æ•°ï¼Œè¯¥å‚æ•°å»ºè®®è®¾ç½®ä¸º `True`  |

æ··åˆé‡åŒ–å…·ä½“ä½¿ç”¨æµç¨‹è§ [MixQuantè¯´æ˜](https://github.com/kendryte/nncase/blob/release/2.0/docs/MixQuant.md)ã€‚

å…³äºé‡åŒ–çš„é…ç½®è¯´æ˜ï¼Œè¯·å‚è€ƒä¸Šè¡¨ã€‚å¦‚æœè½¬æ¢çš„kmodelè¾¾ä¸åˆ°æ•ˆæœï¼Œå¯ä»¥ä¿®æ”¹ `quant_type` å’Œ `w_quant_type` å‚æ•°ï¼Œä¿®æ”¹æ¨¡å‹æ•°æ®å’Œæƒé‡çš„é‡åŒ–ç±»å‹ï¼Œä½†æ˜¯è¿™ä¸¤ä¸ªå‚æ•°ä¸èƒ½åŒæ—¶è®¾ç½®ä¸º `int16`ã€‚

- **é‡åŒ–æ ¡æ­£é›†è®¾ç½®**

| åç§° | ç±»å‹                  | æè¿°           |
| ---- | --------------------- | -------------- |
| data | List[List[np.ndarray]] | è¯»å–çš„æ ¡å‡†æ•°æ® |

é‡åŒ–è¿‡ç¨‹ä¸­ä½¿ç”¨çš„æ ¡æ­£æ•°æ®é€šè¿‡ `set_tensor_data` æ–¹æ³•è¿›è¡Œè®¾ç½®ï¼Œæ¥å£å‚æ•°ç±»å‹ä¸º `List[List[np.ndarray]]`ï¼Œæ¯”å¦‚ï¼šæ¨¡å‹æœ‰ä¸€ä¸ªè¾“å…¥ï¼Œæ ¡æ­£æ•°æ®é‡è®¾ç½®ä¸º10ï¼Œä¼ å…¥çš„æ ¡æ­£æ•°æ®ç»´åº¦ä¸º `[10,1,3,320,320]`ï¼›å¦‚æœæ¨¡å‹æœ‰ä¸¤ä¸ªè¾“å…¥ï¼Œæ ¡æ­£æ•°æ®é‡è®¾ç½®ä¸º10ï¼Œä¼ å…¥çš„æ ¡æ­£æ•°æ®ç»´åº¦ä¸º `[[10,1,3,224,224],[10,1,3,320,320]]`ã€‚

### ä½¿ç”¨ nncase æ¨¡æ‹Ÿå™¨éªŒè¯è½¬æ¢æ•ˆæœ

å‰é¢æˆ‘ä»¬è¯´äº†æ€ä¹ˆæŠŠæ¨¡å‹è½¬æ¢æˆ Kmodelï¼Œç°åœ¨æˆ‘ä»¬è¦æ¥â€œä½“æ£€â€ä¸€ä¸‹è¿™ä¸ªæ¨¡å‹ï¼Œçœ‹å®ƒè½¬å¾—å¥½ä¸å¥½ï¼

å› ä¸º ONNX å’Œ Kmodel åœ¨é¢„å¤„ç†çš„æ—¶å€™å¯èƒ½ä¸å¤ªä¸€æ ·ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—åˆ†åˆ«æŒ‰å®ƒä»¬å„è‡ªçš„è¦æ±‚æ¥å‡†å¤‡è¾“å…¥æ•°æ®ã€‚ç„¶åï¼Œç”¨ ONNX æ¨¡å‹å’Œ Kmodel æ¨¡å‹å„è·‘ä¸€éæ¨ç†ï¼ŒæŠŠç»“æœéƒ½ä¿å­˜ä¸‹æ¥ï¼Œæ¥ç€ç®—ä¸€ä¸‹å®ƒä»¬ä¹‹é—´çš„ **Cosine ç›¸ä¼¼åº¦**â€”â€”è¿™å°±åƒæ˜¯åœ¨å¯¹æ¯”å®ƒä¿©è¾“å‡ºçš„â€œç›¸ä¼¼åº¦â€ã€‚

ä¸€å¥è¯æ€»ç»“å°±æ˜¯ï¼šæˆ‘ä»¬è¦çœ‹çœ‹è½¬æ¢åçš„ Kmodel å’ŒåŸæ¥çš„ ONNX æ¨¡å‹ï¼Œè¾“å‡ºå·®ä¸å¤šä¸ï¼Ÿå¦‚æœç›¸å·®å¤ªå¤§ï¼Œè¯´æ˜è½¬æ¢è¿‡ç¨‹ä¸­å¯èƒ½æœ‰é—®é¢˜ï¼Œé‚£å°±è¦å›å¤´æ£€æŸ¥å‚æ•°è®¾ç½®ï½

æ¨¡å‹è½¬æ¢æˆåŠŸåï¼Œå¯ä»¥ä½¿ç”¨`nncase.Simulator` åœ¨æœ¬åœ°PCä¸ŠåŠ è½½Kmodelè¿›è¡Œæ¨ç†ï¼Œé€šè¿‡è®¡ç®—onnxæ¨¡å‹å’Œkmodelæ¨¡å‹çš„ä½™å¼¦ç›¸ä¼¼åº¦åˆ¤æ–­kmodelè¾“å‡ºæ˜¯å¦æ­£ç¡®ã€‚**è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¯¥è¿‡ç¨‹æ˜¯åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šè¿è¡Œçš„ï¼Œè€Œä¸æ˜¯åœ¨k230å¼€å‘æ¿ä¸Šè¿è¡Œçš„ã€‚**

é¦–å…ˆéœ€è¦åœ¨pythonç¯å¢ƒä¸‹å®‰è£…onnxç›¸å…³çš„åŒ…ï¼š

```shell
pip install onnx
pip install onnxruntime
pip install onnxsim
```

æ‰§è¡Œæ¨¡æ‹Ÿå™¨æ¨ç†è„šæœ¬éœ€è¦æ·»åŠ nncaseæ’ä»¶ç¯å¢ƒå˜é‡ï¼š

- **linux**ï¼š

```shell
# ä¸‹è¿°å‘½ä»¤ä¸­çš„è·¯å¾„ä¸ºå®‰è£… nncase çš„ Python ç¯å¢ƒçš„è·¯å¾„ï¼Œè¯·æŒ‰ç…§æ‚¨çš„ç¯å¢ƒé€‚é…ä¿®æ”¹
export NNCASE_PLUGIN_PATH=$NNCASE_PLUGIN_PATH:/usr/local/lib/python3.9/site-packages/
export PATH=$PATH:/usr/local/lib/python3.9/site-packages/
source /etc/profile
```

- **windows**ï¼š

å°†å®‰è£… `nncase` çš„ `Python` ç¯å¢ƒä¸‹çš„ `Lib/site-packages` è·¯å¾„æ·»åŠ åˆ°ç¯å¢ƒå˜é‡çš„ç³»ç»Ÿå˜é‡ `Path` ä¸­ã€‚

é’ˆå¯¹**4ç±»æ‰“å°æ•°å­—è¯†åˆ«**åœºæ™¯ï¼ŒéªŒè¯è¾“å‡ºç›¸ä¼¼åº¦çš„ç¤ºä¾‹ä»£ç ï¼š

```python
import os
import cv2
import numpy as np
import onnxruntime as ort
import nncase
import math

def get_onnx_input(img_path,mean,std,model_input_size):
    # è¯»å–å›¾ç‰‡ï¼Œå›¾ç‰‡æ•°æ®ä¸€èˆ¬æ˜¯RGBä¸‰é€šé“ï¼Œé¢œè‰²èŒƒå›´ä¸º[0, 255.0]
    image_fp32=cv2.imread(img_path)
    # å¦‚æœæ¨¡å‹è¾“å…¥è¦æ±‚æ˜¯RGBçš„ï¼Œåˆ™è½¬æ¢ä¸ºRGBæ ¼å¼ï¼Œå¦‚æœè¦æ±‚æ˜¯BGRçš„ï¼Œåˆ™ä¸éœ€è¦è½¬æ¢
    image_fp32=cv2.cvtColor(image_fp32, cv2.COLOR_BGR2RGB)
    # ç¼©æ”¾æˆæ¨¡å‹è¾“å…¥å¤§å°
    image_fp32 = cv2.resize(image_fp32, (model_input_size[0], model_input_size[1]))
    # æ•°æ®ç±»å‹ä¸ºfloat32,
    image_fp32 = np.asarray(image_fp32, dtype=np.float32)
    # æ•°æ®æ ‡å‡†åŒ–,å…ˆå½’ä¸€åŒ–åˆ°[0,1]èŒƒå›´å†…ï¼Œç„¶åå‡å‡å€¼é™¤æ–¹å·®
    image_fp32/=255.0
    for i in range(3):
        image_fp32[:, :, i] -= mean[i]
        image_fp32[:, :, i] /= std[i]
    # æŒ‰ç…§æ¨¡å‹è¾“å…¥è¦æ±‚å¤„ç†æˆNCHWæ’å¸ƒæˆ–è€…NHWCæ’å¸ƒ
    image_fp32 = np.transpose(image_fp32, (2, 0, 1))
    return image_fp32.copy()

def get_kmodel_input(img_path,mean,std,model_input_size):
    # è¯»å–å›¾ç‰‡ï¼Œå›¾ç‰‡æ•°æ®ä¸€èˆ¬æ˜¯RGBä¸‰é€šé“ï¼Œé¢œè‰²èŒƒå›´ä¸º[0, 255.0]
    image_uint8=cv2.imread(img_path)
    # å¦‚æœæ¨¡å‹è¾“å…¥è¦æ±‚æ˜¯RGBçš„ï¼Œåˆ™è½¬æ¢ä¸ºRGBæ ¼å¼ï¼Œå¦‚æœè¦æ±‚æ˜¯BGRçš„ï¼Œåˆ™ä¸éœ€è¦è½¬æ¢
    image_uint8=cv2.cvtColor(image_uint8, cv2.COLOR_BGR2RGB)
    # ç¼©æ”¾æˆæ¨¡å‹è¾“å…¥å¤§å°
    image_uint8 = cv2.resize(image_uint8, (model_input_size[0], model_input_size[1]))
    # æ•°æ®ç±»å‹ä¸ºuint8,å› ä¸ºè½¬æ¢kmodelçš„æ—¶å€™å¼€å¯äº†é¢„å¤„ç†ï¼Œå¹¶ä¸”è®¾å®šäº†æ ‡å‡†åŒ–å‚æ•°ï¼Œå› æ­¤è¿™é‡Œçš„è¾“å…¥å°±ä¸éœ€è¦å®ç°æ ‡å‡†åŒ–äº†
    image_uint8 = np.asarray(image_uint8, dtype=np.uint8)
    # æŒ‰ç…§æ¨¡å‹è¾“å…¥è¦æ±‚å¤„ç†æˆNCHWæ’å¸ƒæˆ–è€…NHWCæ’å¸ƒ
    image_uint8 = np.transpose(image_uint8, (2, 0, 1))
    return image_uint8.copy()

def onnx_inference(onnx_path,onnx_input_data):
    # åˆ›å»º ONNX æ¨ç†ä¼šè¯ï¼ˆåŠ è½½æ¨¡å‹ï¼‰
    ort_session = ort.InferenceSession(onnx_path)
    # è·å–æ¨¡å‹è¾“å‡ºåç§°åˆ—è¡¨ï¼Œç”¨äºåç»­è°ƒç”¨æ¨ç†
    output_names = []
    model_outputs = ort_session.get_outputs()
    for i in range(len(model_outputs)):
        output_names.append(model_outputs[i].name)

    # è·å–æ¨¡å‹çš„è¾“å…¥ä¿¡æ¯
    model_input = ort_session.get_inputs()[0]             # ç¬¬ä¸€ä¸ªè¾“å…¥ï¼ˆé€šå¸¸åªæœ‰ä¸€ä¸ªï¼‰
    model_input_name = model_input.name                   # è¾“å…¥çš„åç§°ï¼ˆé”®ï¼‰
    model_input_type = np.float32                         # è¾“å…¥æ•°æ®ç±»å‹ï¼Œè¿™é‡Œå‡è®¾æ˜¯ float32
    model_input_shape = model_input.shape                 # è¾“å…¥å¼ é‡çš„å½¢çŠ¶ï¼ˆç»´åº¦ï¼‰

    # å¤„ç†è¾“å…¥æ•°æ®,éœ€ç¡®ä¿å’Œæ¨¡å‹è¾“å…¥å½¢çŠ¶ä¸€è‡´
    model_input_data = onnx_input_data.astype(model_input_type).reshape(model_input_shape)

    # æ‰§è¡Œæ¨ç†ï¼Œä¼ å…¥è¾“å…¥åç§°å’Œæ•°æ®ï¼Œè¿”å›æ‰€æœ‰è¾“å‡ºç»“æœ
    onnx_results = ort_session.run(output_names, { model_input_name : model_input_data })
    return onnx_results

def kmodel_inference(kmodel_path,kmodel_input_data,model_input_size):
    # åˆå§‹åŒ–nncase æ¨¡æ‹Ÿå™¨
    sim = nncase.Simulator()
    # è¯»å–kmodel
    with open(kmodel_path, 'rb') as f:
        kmodel = f.read()
    # åŠ è½½kmodel
    sim.load_model(kmodel)
    # è¯»å–è¾“å…¥æ•°æ®
    input_shape = [1, 3, model_input_size[1], model_input_size[0]]
    dtype = sim.get_input_desc(0).dtype
    # å¤„ç†è¾“å…¥æ•°æ®,éœ€ç¡®ä¿å’Œæ¨¡å‹è¾“å…¥å½¢çŠ¶ä¸€è‡´
    kmodel_input = kmodel_input_data.astype(dtype).reshape(input_shape)
    # è®¾ç½®æ¨¡æ‹Ÿå™¨è¾“å…¥tensor,æ­¤å¤„ä¸ºå•è¾“å…¥
    sim.set_input_tensor(0, nncase.RuntimeTensor.from_numpy(kmodel_input))
    # æ¨¡æ‹Ÿå™¨æ¨ç†kmodelæ¨¡å‹
    sim.run()
    # è·å–æ¨ç†è¾“å‡º
    kmodel_results = []
    for i in range(sim.outputs_size):
        kmodel_result = sim.get_output_tensor(i).to_numpy()  # è½¬æ¢ä¸ºnumpyæ•°ç»„
        kmodel_results.append(kmodel_result)  # ä¿å­˜åˆ°åˆ—è¡¨ä¸­
    return kmodel_results

def cosine_similarity(onnx_results,kmodel_results):
    output_size=len(kmodel_results)
    # å°†æ¯ä¸ªè¾“å‡ºå±•æˆä¸€ç»´ï¼Œç„¶åè®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦
    for i in range(output_size):
        onnx_i=np.reshape(onnx_results[i], (-1))
        kmodel_i=np.reshape(kmodel_results[i], (-1))
        cos = (onnx_i @ kmodel_i) / (np.linalg.norm(onnx_i, 2) * np.linalg.norm(kmodel_i, 2))
        print('output {0} cosine similarity : {1}'.format(i, cos))
    return

if __name__ == '__main__':
    img_path="test.jpg"
    mean=[0,0,0]
    std=[1,1,1]
    model_input_size=[320,320]
    # ONNX æ¨¡å‹æ–‡ä»¶
    onnx_model = "best.onnx"
    # kmodel æ¨¡å‹æ–‡ä»¶
    kmodel_path="best.kmodel"
    # ç”Ÿæˆonnxæ¨¡å‹è¾“å…¥æ•°æ®
    onnx_input_data = get_onnx_input(img_path,mean,std,model_input_size)
    # ç”Ÿæˆkmodelæ¨¡å‹è¾“å…¥æ•°æ®
    kmodel_input_data = get_kmodel_input(img_path,mean,std,model_input_size)
    # onnxæ¨¡å‹æ¨ç†
    onnx_results = onnx_inference(onnx_model,onnx_input_data)
    # kmodelæ¨¡å‹æ¨ç†
    nncase_results = kmodel_inference(kmodel_path,kmodel_input_data,model_input_size)
    # è®¡ç®—è¾“å‡ºç›¸ä¼¼åº¦
    cosine_similarity(onnx_results,nncase_results)
```

å°†ä¸Šè¿°ä»£ç ä¿å­˜æˆæ–‡ä»¶ï¼Œå¹¶å°†ä»£ç å†…çš„æ¨¡å‹æ¢æˆæ‚¨è‡ªå·±è½¬æ¢çš„æ¨¡å‹åï¼Œè¿è¡Œè„šæœ¬å¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š

```shell
output 0 cosine similarity : 0.9995334148406982
```

ä¸€èˆ¬æˆ‘ä»¬è®¤ä¸ºå½“ç›¸ä¼¼åº¦å¤§äº0.99æ—¶ï¼Œè¡¨ç¤ºè¯¥æ¨¡å‹è½¬æ¢æˆåŠŸï¼Œåœ¨å®é™…éƒ¨ç½²åœºæ™¯ä¸‹æ˜¯å¯ç”¨çš„ã€‚

#### ç”Ÿæˆè¾“å…¥æ•°æ®

âš ï¸ **æ³¨æ„**ï¼šåœ¨ä½¿ç”¨ ONNX æ¨¡å‹å’Œ KModel è¿›è¡Œæ¨ç†æ—¶ï¼Œ**å¿…é¡»è°¨æ…å¤„ç†è¾“å…¥æ•°æ®çš„é¢„å¤„ç†æ­¥éª¤**ã€‚è‹¥ KModel ä¸­å·²å°è£…äº†ç‰¹å®šçš„é¢„å¤„ç†æ“ä½œï¼Œåˆ™åœ¨æ¨ç†å‰æ— éœ€å¯¹å…¶è¾“å…¥æ•°æ®æ‰‹åŠ¨æ‰§è¡Œè¿™äº›é¢„å¤„ç†ï¼›ä½†åœ¨ä½¿ç”¨ ONNX æ¨¡å‹æ¨ç†æ—¶ï¼Œåˆ™éœ€æ˜¾å¼åœ°åœ¨æ¨¡å‹å¤–éƒ¨å®Œæˆæ‰€æœ‰å¿…è¦çš„é¢„å¤„ç†æµç¨‹ã€‚

KModel æ‰€æ”¯æŒå¹¶å¯å°è£…çš„é¢„å¤„ç†æ“ä½œåŒ…æ‹¬ï¼š

- é€šé“é¡ºåºå˜æ¢ï¼ˆå¦‚ RGB â†” BGRï¼‰ï¼Œå¯¹åº” `SwapRB` å‚æ•°ï¼›
- å¸ƒå±€è½¬æ¢ï¼ˆNCHW â†” NHWCï¼‰ï¼Œå¯¹åº” `input_shape` ä¸ `input_layout` å‚æ•°ï¼›
- æ•°æ®æ ‡å‡†åŒ–å¤„ç†ï¼Œä¾èµ– `mean` å’Œ `std` å‚æ•°ï¼›
- è¾“å…¥åé‡åŒ–å¤„ç†ï¼Œä¾èµ– `input_type` å’Œ `input_range` å‚æ•°ï¼›

å…³äº ONNX ä¸ KModel æ¨ç†æµç¨‹çš„å·®å¼‚ï¼Œå¯å‚è€ƒä»¥ä¸‹æµç¨‹å›¾ï¼š

![inference_diff_onnx_kmodel](https://www.kendryte.com/api/post/attachment?id=612)

åœ¨ä½¿ç”¨ ONNX æ¨¡å‹æ¨ç†æ—¶ï¼Œç”±äºå…¶æœ¬ä½“ä¸åŒ…å«ä»»ä½•é¢„å¤„ç†é€»è¾‘ï¼Œç”¨æˆ·å¿…é¡»åœ¨è¾“å…¥å‰å®Œæˆæ‰€éœ€çš„å…¨éƒ¨é¢„å¤„ç†æ­¥éª¤ã€‚
è€Œå¯¹äº KModelï¼Œå¦‚æœåœ¨æ¨¡å‹ç¼–è¯‘æ—¶å¯ç”¨äº† `preprocess` é€‰é¡¹ï¼Œåˆ™ç›¸å…³é¢„å¤„ç†æ“ä½œå°†è¢«è‡ªåŠ¨å°è£…è¿›æ¨¡å‹å†…éƒ¨ï¼Œæ¨ç†æ—¶ä¸å†éœ€è¦ç”¨æˆ·æ‰‹åŠ¨å¤„ç†ã€‚
å¦‚æœæœªå¯ç”¨ `preprocess`ï¼Œå…¶ä½¿ç”¨æ–¹å¼ä¸ ONNX æ¨¡å‹ç›¸åŒï¼Œä»éœ€åœ¨æ¨¡å‹å¤–éƒ¨å®Œæˆæ‰€æœ‰é¢„å¤„ç†è¿‡ç¨‹ã€‚

æ ¹æ®ä¸Šè¿°æµç¨‹ï¼Œå¼€å‘è€…å¯æŒ‰ç…§æ¨¡å‹è¦æ±‚æ„é€ ç¬¦åˆè¾“å…¥è§„èŒƒçš„æ¨ç†æ•°æ®ï¼Œä»¥ä¾¿åœ¨æ¨ç†è¿‡ç¨‹ä¸­ä½¿ç”¨ã€‚
**è¯·æ³¨æ„ï¼šæ•°æ®ç”Ÿæˆè¿‡ç¨‹å¿…é¡»ä¸¥æ ¼ç¬¦åˆæ¨¡å‹è¦æ±‚ï¼Œä¸åŒæ¨¡å‹ä¹‹é—´çš„è¾“å…¥å¤„ç†æµç¨‹å¯èƒ½å­˜åœ¨æ˜¾è‘—å·®å¼‚ï¼Œä¸èƒ½æ··ç”¨ã€‚**

ä»¥ä¸‹ä¸ºæ•°æ®é¢„å¤„ç†çš„ç¤ºä¾‹ä»£ç ï¼š

```python
def get_onnx_input(img_path,mean,std,model_input_size):
    # è¯»å–å›¾ç‰‡ï¼Œå›¾ç‰‡æ•°æ®ä¸€èˆ¬æ˜¯RGBä¸‰é€šé“ï¼Œé¢œè‰²èŒƒå›´ä¸º[0, 255.0]
    image_fp32=cv2.imread(img_path)
    # å¦‚æœæ¨¡å‹è¾“å…¥è¦æ±‚æ˜¯RGBçš„ï¼Œåˆ™è½¬æ¢ä¸ºRGBæ ¼å¼ï¼Œå¦‚æœè¦æ±‚æ˜¯BGRçš„ï¼Œåˆ™ä¸éœ€è¦è½¬æ¢
    image_fp32=cv2.cvtColor(image_fp32, cv2.COLOR_BGR2RGB)
    # ç¼©æ”¾æˆæ¨¡å‹è¾“å…¥å¤§å°
    image_fp32 = cv2.resize(image_fp32, (model_input_size[0], model_input_size[1]))
    # æ•°æ®ç±»å‹ä¸ºfloat32,
    image_fp32 = np.asarray(image_fp32, dtype=np.float32)
    # æ•°æ®æ ‡å‡†åŒ–,å…ˆå½’ä¸€åŒ–åˆ°[0,1]èŒƒå›´å†…ï¼Œç„¶åå‡å‡å€¼é™¤æ–¹å·®
    image_fp32/=255.0
    for i in range(3):
        image_fp32[:, :, i] -= mean[i]
        image_fp32[:, :, i] /= std[i]
    # æŒ‰ç…§æ¨¡å‹è¾“å…¥è¦æ±‚å¤„ç†æˆNCHWæ’å¸ƒæˆ–è€…NHWCæ’å¸ƒ
    image_fp32 = np.transpose(image_fp32, (2, 0, 1))
    return image_fp32.copy()

def get_kmodel_input(img_path,mean,std,model_input_size):
    # è¯»å–å›¾ç‰‡ï¼Œå›¾ç‰‡æ•°æ®ä¸€èˆ¬æ˜¯RGBä¸‰é€šé“ï¼Œé¢œè‰²èŒƒå›´ä¸º[0, 255.0]
    image_uint8=cv2.imread(img_path)
    # å¦‚æœæ¨¡å‹è¾“å…¥è¦æ±‚æ˜¯RGBçš„ï¼Œåˆ™è½¬æ¢ä¸ºRGBæ ¼å¼ï¼Œå¦‚æœè¦æ±‚æ˜¯BGRçš„ï¼Œåˆ™ä¸éœ€è¦è½¬æ¢
    image_uint8=cv2.cvtColor(image_uint8, cv2.COLOR_BGR2RGB)
    # ç¼©æ”¾æˆæ¨¡å‹è¾“å…¥å¤§å°
    image_uint8 = cv2.resize(image_uint8, (model_input_size[0], model_input_size[1]))
    # æ•°æ®ç±»å‹ä¸ºuint8,å› ä¸ºè½¬æ¢kmodelçš„æ—¶å€™å¼€å¯äº†é¢„å¤„ç†ï¼Œå¹¶ä¸”è®¾å®šäº†æ ‡å‡†åŒ–å‚æ•°ï¼Œå› æ­¤è¿™é‡Œçš„è¾“å…¥å°±ä¸éœ€è¦å®ç°æ ‡å‡†åŒ–äº†
    image_uint8 = np.asarray(image_uint8, dtype=np.uint8)
    # æŒ‰ç…§æ¨¡å‹è¾“å…¥è¦æ±‚å¤„ç†æˆNCHWæ’å¸ƒæˆ–è€…NHWCæ’å¸ƒ
    image_uint8 = np.transpose(image_uint8, (2, 0, 1))
    return image_uint8.copy()
```

åœ¨ä½¿ç”¨ ONNX æ¨¡å‹å’Œ KModel è¿›è¡Œæ¨ç†æ—¶ï¼Œè¾“å…¥æ•°æ®çš„é¢„å¤„ç†å­˜åœ¨è‹¥å¹²å…³é”®å·®å¼‚ï¼Œä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

- **æ ‡å‡†åŒ–å¤„ç†**ï¼šONNX æ¨¡å‹æœ¬èº«ä¸åŒ…å«ä»»ä½•é¢„å¤„ç†é€»è¾‘ï¼Œå› æ­¤å…¶è¾“å…¥æ•°æ®å¿…é¡»åœ¨å¤–éƒ¨å®Œæˆæ ‡å‡†åŒ–ï¼ˆä¾‹å¦‚å‡å‡å€¼é™¤æ ‡å‡†å·®ï¼‰ã€‚è€Œå¯¹äº KModelï¼Œå¦‚æœåœ¨æ¨¡å‹è½¬æ¢é˜¶æ®µå·²é…ç½®äº†å½’ä¸€åŒ–å‚æ•°ï¼ˆå¦‚ `mean` å’Œ `std`ï¼‰ï¼Œåˆ™è¿™éƒ¨åˆ†æ ‡å‡†åŒ–æ“ä½œä¼šè¢«å°è£…è¿›æ¨¡å‹å†…éƒ¨ï¼Œ**æ¨ç†å‰æ— éœ€é‡å¤å¤„ç†**ã€‚

- **æ•°æ®ç±»å‹å·®å¼‚**ï¼šONNX æ¨¡å‹çš„è¾“å…¥é€šå¸¸ä¸º `float32` ç±»å‹ï¼Œè€Œ KModel çš„è¾“å…¥ç±»å‹åˆ™ä¾èµ–æ¨¡å‹è½¬æ¢æ—¶æŒ‡å®šçš„ `input_type`ï¼ˆä¾‹å¦‚ `uint8`ï¼‰åŠ `input_range`ã€‚KModel ä¼šåœ¨æ¨ç†å†…éƒ¨è¿›è¡Œåé‡åŒ–å¤„ç†ï¼Œå°†æ•´æ•°ç±»å‹è¿˜åŸä¸ºè¿‘ä¼¼çš„æµ®ç‚¹è¡¨è¾¾ã€‚

- **é€šé“é¡ºåºå¤„ç†**ï¼šè‹¥åœ¨æ¨¡å‹è½¬æ¢è¿‡ç¨‹ä¸­æœªå¯ç”¨ `SwapRB`ï¼ˆå³å‚æ•°ä¸º `False`ï¼‰ï¼Œåˆ™éœ€è¦åœ¨å¤–éƒ¨é¢„å¤„ç†é˜¶æ®µå°†è¾“å…¥å›¾åƒçš„é€šé“é¡ºåºä» BGR è½¬æ¢ä¸º RGBã€‚è‹¥ `SwapRB=True`ï¼Œè¯¥é€šé“å˜æ¢æ“ä½œå°†è‡ªåŠ¨ç”± KModel å†…éƒ¨å¤„ç†ï¼Œ**æ— éœ€åœ¨å¤–éƒ¨æ‰§è¡Œ**ã€‚

ç»¼åˆæ¥çœ‹ï¼ŒONNX æ¨¡å‹æ‰€éœ€çš„å¤–éƒ¨é¢„å¤„ç†æ“ä½œç­‰äº KModel çš„å¤–éƒ¨é¢„å¤„ç† **åŠ ä¸Š** å†…éƒ¨é¢„å¤„ç†ï¼Œä¸¤è€…çš„å…³ç³»å¯è¡¨ç¤ºå¦‚ä¸‹ï¼š

```shell
ONNX æ¨¡å‹å¤–éƒ¨é¢„å¤„ç† = KModel å¤–éƒ¨é¢„å¤„ç† + KModel å†…éƒ¨é¢„å¤„ç†
```

#### åŠ è½½onnxæ¨¡å‹å¹¶æ¨ç†

é¦–å…ˆéœ€è¦ä½¿ç”¨onnxæ¨¡å‹å®Œæˆæ¨ç†ï¼Œè·å–onnxæ¨¡å‹çš„æ¨ç†ç»“æœã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```python
def onnx_inference(onnx_path,onnx_input_data):
    # åˆ›å»º ONNX æ¨ç†ä¼šè¯ï¼ˆåŠ è½½æ¨¡å‹ï¼‰
    ort_session = ort.InferenceSession(onnx_path)
    # è·å–æ¨¡å‹è¾“å‡ºåç§°åˆ—è¡¨ï¼Œç”¨äºåç»­è°ƒç”¨æ¨ç†
    output_names = []
    model_outputs = ort_session.get_outputs()
    for i in range(len(model_outputs)):
        output_names.append(model_outputs[i].name)

    # è·å–æ¨¡å‹çš„è¾“å…¥ä¿¡æ¯
    model_input = ort_session.get_inputs()[0]             # ç¬¬ä¸€ä¸ªè¾“å…¥ï¼ˆé€šå¸¸åªæœ‰ä¸€ä¸ªï¼‰
    model_input_name = model_input.name                   # è¾“å…¥çš„åç§°ï¼ˆé”®ï¼‰
    model_input_type = np.float32                         # è¾“å…¥æ•°æ®ç±»å‹ï¼Œè¿™é‡Œå‡è®¾æ˜¯ float32
    model_input_shape = model_input.shape                 # è¾“å…¥å¼ é‡çš„å½¢çŠ¶ï¼ˆç»´åº¦ï¼‰

    # å¤„ç†è¾“å…¥æ•°æ®,éœ€ç¡®ä¿å’Œæ¨¡å‹è¾“å…¥å½¢çŠ¶ä¸€è‡´
    model_input_data = onnx_input_data.astype(model_input_type).reshape(model_input_shape)

    # æ‰§è¡Œæ¨ç†ï¼Œä¼ å…¥è¾“å…¥åç§°å’Œæ•°æ®ï¼Œè¿”å›æ‰€æœ‰è¾“å‡ºç»“æœ
    onnx_results = ort_session.run(output_names, { model_input_name : model_input_data })
    return onnx_results
```

#### åŠ è½½kmodelæ¨¡å‹å¹¶æ¨ç†

ç„¶åä½¿ç”¨è½¬æ¢æˆåŠŸçš„kmodelè¿›è¡Œæ¨ç†ï¼Œè·å¾—kmodelçš„æ¨ç†ç»“æœã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```python
def kmodel_inference(kmodel_path,kmodel_input_data,model_input_size):
    # åˆå§‹åŒ–nncase æ¨¡æ‹Ÿå™¨
    sim = nncase.Simulator()
    # è¯»å–kmodel
    with open(kmodel_path, 'rb') as f:
        kmodel = f.read()
    # åŠ è½½kmodel
    sim.load_model(kmodel)
    # è¯»å–è¾“å…¥æ•°æ®
    input_shape = [1, 3, model_input_size[1], model_input_size[0]]
    dtype = sim.get_input_desc(0).dtype
    # å¤„ç†è¾“å…¥æ•°æ®,éœ€ç¡®ä¿å’Œæ¨¡å‹è¾“å…¥å½¢çŠ¶ä¸€è‡´
    kmodel_input = kmodel_input_data.astype(dtype).reshape(input_shape)
    # è®¾ç½®æ¨¡æ‹Ÿå™¨è¾“å…¥tensor,æ­¤å¤„ä¸ºå•è¾“å…¥
    sim.set_input_tensor(0, nncase.RuntimeTensor.from_numpy(kmodel_input))
    # æ¨¡æ‹Ÿå™¨æ¨ç†kmodelæ¨¡å‹
    sim.run()
    # è·å–æ¨ç†è¾“å‡º
    kmodel_results = []
    for i in range(sim.outputs_size):
        kmodel_result = sim.get_output_tensor(i).to_numpy()  # è½¬æ¢ä¸ºnumpyæ•°ç»„
        kmodel_results.append(kmodel_result)  # ä¿å­˜åˆ°åˆ—è¡¨ä¸­
    return kmodel_results
```

#### è®¡ç®—è¾“å‡ºçš„ä½™å¼¦ç›¸ä¼¼åº¦

å¾—åˆ°onnxæ¨¡å‹å’Œkmodelæ¨¡å‹çš„æ¨ç†ç»“æœåï¼Œé€ä¸ªè®¡ç®—æ¯ä¸ªè¾“å‡ºçš„ä½™å¼¦ç›¸ä¼¼åº¦ã€‚ä¸€èˆ¬ç›¸ä¼¼åº¦åœ¨0.99ä»¥ä¸Šå¯ä»¥è®¤ä¸ºè¯¥æ¨¡å‹è½¬æ¢æˆåŠŸï¼Œå¯éƒ¨ç½²ä½¿ç”¨ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```python
def cosine_similarity(onnx_results,kmodel_results):
    output_size=len(kmodel_results)
    # å°†æ¯ä¸ªè¾“å‡ºå±•æˆä¸€ç»´ï¼Œç„¶åè®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦
    for i in range(output_size):
        onnx_i=np.reshape(onnx_results[i], (-1))
        kmodel_i=np.reshape(kmodel_results[i], (-1))
        cos = (onnx_i @ kmodel_i) / (np.linalg.norm(onnx_i, 2) * np.linalg.norm(kmodel_i, 2))
        print('output {0} cosine similarity : {1}'.format(i, cos))
    return
```

## æ¨¡å‹éƒ¨ç½²

```{note}
ğŸ‘‰ å‰é¢æˆ‘ä»¬æŠŠkmodelæ¨¡å‹è½¬å¥½äº†ã€ä¹ŸéªŒè¯è¿‡äº†ï¼Œæ¥ä¸‹æ¥å½“ç„¶å°±æ˜¯â€”â€”â€”**ä¸Šæ¿å­è·‘èµ·æ¥å•¦ï¼** è¿™ä¸€ç« æˆ‘ä»¬å°±æ¥èŠèŠæ€ä¹ˆåœ¨ K230 çš„ RT-Smart ç¯å¢ƒä¸‹ï¼Œç”¨æä¾›çš„ nncase runtime API æŠŠæ¨¡å‹åŠ è½½è¿›æ¥å¹¶å®ç°æ¨ç†ã€‚

é‚£é—®é¢˜æ¥äº†ï¼šæ¨¡å‹æ˜¯æœ‰äº†ï¼Œé‚£è¾“å…¥æ•°æ®è¦æ€ä¹ˆå‡†å¤‡ï¼Ÿæˆ‘ä»¬è¦æ ¹æ®æ¨¡å‹çš„â€œå£å‘³â€å¯¹è¾“å…¥å›¾åƒåšä¸€äº›å¤„ç†ï¼Œæ¯”å¦‚å°ºå¯¸ã€æ ¼å¼ã€å½’ä¸€åŒ–ç­‰ç­‰ï¼Œç¡®ä¿å®ƒèƒ½â€œåƒå¾—å¯¹â€ã€‚ç„¶åæŠŠå¤„ç†å¥½çš„æ•°æ®å–‚è¿›å»ï¼Œè®©æ¨¡å‹å¼€å§‹æ¨ç†ã€‚æ¨ç†å®Œä¹‹åï¼Œæ¨¡å‹ä¼šç»™æˆ‘ä»¬ä¸€å †â€œè¾“å‡ºç»“æœâ€ï¼Œè¿™äº›ç»“æœæ˜¯å•¥æ„æ€ï¼Ÿæˆ‘ä»¬è¿˜å¾—åšä¸€ç•ªè§£æï¼Œæ¯”å¦‚æ‹¿å‡ºç±»åˆ«ã€åæ ‡è¿™äº›æœ‰ç”¨çš„ä¿¡æ¯ã€‚

æœ€åå˜›ï¼Œå½“ç„¶ä¸èƒ½è—ç€æ–ç€ï¼æˆ‘ä»¬ä¼šæŠŠè¿™äº›è¯†åˆ«å‡ºæ¥çš„å†…å®¹æ˜¾ç¤ºåœ¨å±å¹•ä¸Šï¼Œæ¯”å¦‚ç”»æ¡†ã€æ ‡æ•°å­—ï¼Œè®©æ•´ä¸ªæµç¨‹ä»å›¾åƒé‡‡é›†ã€æ¨¡å‹æ¨ç†ï¼Œåˆ°ç»“æœå±•ç¤º**ä¸€æ°”å‘µæˆã€å…¨æµç¨‹è·‘é€š**ï¼

è¿™ä¸€ç« å°±ä¼šå¸¦ä½ æŠŠè¿™ä¸ªå®Œæ•´è¿‡ç¨‹ææ˜ç™½ï¼Œè®©æ¨¡å‹çœŸçš„å¼€å§‹â€œåŠ¨èµ·æ¥â€ï½

å…³äºæœ¬ç« æåˆ°çš„æ¯”è¾ƒå¤æ‚çš„æµç¨‹ï¼Œåœ¨sdkçš„`src/rtsmart/examples/ai_poc/common_files/video_pipeline.cc`ä¸­åšäº†å°è£…ï¼Œç”¨æˆ·ä»…éœ€è°ƒç”¨`pl.GetFrame(dump_res)`å³å¯å¾—åˆ°ä¸€å¸§MIPIå›¾åƒã€‚UVCçš„æµç¨‹ä¹Ÿå°è£…åœ¨äº†`src/rtsmart/examples/uvc_ai/src/uvc_pipeline.cc`ä¸­åšäº†å°è£…ï¼Œå…·ä½“ä½¿ç”¨ä»£ç å‚è€ƒç¤ºä¾‹ä¸­çš„`main.cc`æ–‡ä»¶ã€‚ç”¨æˆ·å¯ä»¥ä¸“å¿ƒå¤„ç†æ¨¡å‹æ¨ç†éƒ¨åˆ†çš„ä»£ç ã€‚å¼€å‘æ–‡æ¡£å‚è€ƒï¼š![å¦‚ä½•å¼€å‘ä¸€ä¸ªai_demo](./app_develop_guide/ai/develop_ai_demo.md)ã€‚
```

å¯¹äºä¸€ä¸ªå®ç”¨çš„ AI ç¨‹åºï¼Œä¸ä»…åŒ…æ‹¬æ¨¡å‹æ¨ç†ï¼Œè¿˜åŒ…æ‹¬æœ‰å›¾åƒè¾“å…¥ã€å‰åå¤„ç†ç¨‹åºã€ç»“æœæ˜¾ç¤ºç­‰ä¸åŒæ¨¡å—ã€‚ä¸‹å›¾å±•ç¤ºäº†ä¸€ä¸ªå…¸å‹çš„AIåº”ç”¨ç¨‹åºçš„å®Œæ•´æ¡†å›¾ï¼š

![deploy_pipeline](https://www.kendryte.com/api/post/attachment?id=650)

ğŸš€ éƒ¨ç½²æµç¨‹è®²è§£ï¼šéƒ¨ç½²å…¶å®å¯ä»¥ç†è§£ä¸ºâ€œè®©æ¨¡å‹çœŸæ­£å·¥ä½œèµ·æ¥â€çš„è¿‡ç¨‹ï¼Œä¸‹é¢æˆ‘ä»¬æŒ‰ç…§æµç¨‹ï¼Œåˆ†æ­¥ä»‹ç»ã€‚

**1ï¸âƒ£ è·å–å›¾åƒæ•°æ®ï¼ˆè¾“å…¥æ•°æ®æºï¼‰**
æˆ‘ä»¬å…ˆå¾—æ‹¿åˆ°ä¸€å¼ å›¾åƒï¼Œé€šå¸¸æ˜¯ä»æ‘„åƒå¤´ä¸­å®æ—¶é‡‡é›†ï¼Œä¹Ÿå¯ä»¥ä»æœ¬åœ°åŠ è½½ä¸€å¼ æµ‹è¯•å›¾ç‰‡ã€‚æ‹¿åˆ°å›¾åƒåï¼Œå¯ä»¥ä½¿ç”¨å›¾åƒçš„æ•°æ®æŒ‡é’ˆåˆ›å»ºä¸€ä¸ª`runtime_tensor`ã€‚åœ¨ K230 å¼€å‘æ¿ä¸Šï¼Œé€šå¸¸ä½ ä¼šé€šè¿‡ `kd_mpi_vicap_dump_frame` æ¥å£æ¥è·å–ä¸€å¸§æ•°æ®ï¼Œå¹¶ä»è™šæ‹Ÿåœ°å€æ‹¿åˆ°æ•°æ®åˆ›å»º`runtime_tensor`ã€‚

**2ï¸âƒ£ æ„é€ è¾“å…¥ Tensorï¼ˆå‡†å¤‡æŠ•å–‚æ¨¡å‹çš„æ•°æ®ï¼‰**
æœ‰äº†å›¾åƒä¹‹åï¼Œæˆ‘ä»¬è¦æŠŠå®ƒâ€œæ‰“åŒ…â€æˆæ¨¡å‹èƒ½å¤„ç†çš„æ ¼å¼`runtime_tensor`ã€‚è¿™ä¸€æ­¥ï¼Œæ˜¯ä¸ºäº†å–‚ç»™æ¨¡å‹ä¸€ä¸ªæ ‡å‡†ç»“æ„çš„æ•°æ®ã€‚

**3ï¸âƒ£ é¢„å¤„ç†ï¼ˆai2d æ¨¡å—ï¼‰**
æ¨¡å‹å¯¹è¾“å…¥å›¾åƒæœ‰ç‰¹å®šè¦æ±‚ï¼Œæ¯”å¦‚å¤§å°ã€æ ¼å¼ã€é€šé“é¡ºåºç­‰ç­‰ã€‚è¿™ä¸€æ­¥æˆ‘ä»¬å°±ç”¨ ai2d æ¨¡å—æŠŠå›¾åƒtensorå¤„ç†æˆæ¨¡å‹éœ€è¦çš„â€œæ ·å­â€ã€‚

**4ï¸âƒ£ æ¨¡å‹æ¨ç†ï¼ˆä½¿ç”¨ KPU æ¨ç†æ¨¡å—ï¼‰**
å›¾åƒå¤„ç†å¥½åï¼Œå–‚è¿› KPUï¼ˆK230 çš„ç¥ç»ç½‘ç»œåŠ é€Ÿæ¨¡å—ï¼‰è¿›è¡Œæ¨ç†ã€‚KPU ä¼šè¿”å›ä¸€ä¸ªç»“æœ tensorï¼Œè¿™é‡Œé¢åŒ…å«äº†æ¨¡å‹çš„è¾“å‡ºï¼Œæ¯”å¦‚æ£€æµ‹æ¡†ã€åˆ†ç±»æ¦‚ç‡ç­‰ç­‰ã€‚

**5ï¸âƒ£ åå¤„ç†ï¼ˆæå–æœ‰ç”¨ä¿¡æ¯ï¼‰**
KPU è¾“å‡ºçš„æ˜¯ä¸€å †æ•°å­—ï¼Œæˆ‘ä»¬å¾—æŠŠè¿™äº›â€œå¹²è´§â€è§£æå‡ºæ¥ã€‚æ¯”å¦‚è¯†åˆ«åˆ°çš„æ•°å­—æ˜¯å‡ ï¼Ÿæ¡†åœ¨å›¾åƒä¸Šçš„ä½ç½®åœ¨å“ªï¼Ÿè¿™äº›éƒ½éœ€è¦ç”¨åå¤„ç†ç®—æ³•æ¥æå®šã€‚å¯¹ YOLO æ¨¡å‹æ¥è¯´ï¼Œåå¤„ç†åŒ…æ‹¬ç½®ä¿¡åº¦è¿‡æ»¤ã€NMS éæå¤§å€¼æŠ‘åˆ¶ç­‰ã€‚

**6ï¸âƒ£ æ˜¾ç¤ºè¯†åˆ«ç»“æœï¼ˆå¯è§†åŒ–ï¼‰**
æœ€åä¸€æ­¥ï¼ŒæŠŠè¯†åˆ«åˆ°çš„å†…å®¹â€œç”»â€å‡ºæ¥ï¼æˆ‘ä»¬å¯ä»¥åœ¨å±å¹•ä¸Šç”»å‡ºæ£€æµ‹æ¡†ã€æ•°å­—æ ‡ç­¾ç­‰ï¼Œè®©ç»“æœä¸€ç›®äº†ç„¶ã€‚ä¸€èˆ¬ä¼šç”¨ä¸¤ä¸ªå›¾å±‚æ¥æ˜¾ç¤ºï¼Œä¸€å±‚æ˜¯åŸå§‹å›¾åƒï¼Œå¦ä¸€å±‚æ˜¯è¯†åˆ«ç»“æœï¼ˆå¦‚æ¡†å’Œæ•°å­—ï¼‰ï¼Œå åŠ æ˜¾ç¤ºå¯ä»¥ä¿è¯æ•ˆæœæ›´æ¸…æ™°ä¹Ÿæ›´çµæ´»ã€‚

æ€»ç»“ï¼šéƒ¨ç½²çš„æ ¸å¿ƒæµç¨‹å°±æ˜¯ï¼šæ‹¿å›¾åƒ â†’ å¤„ç†æˆè¾“å…¥ â†’ æ‰”ç»™æ¨¡å‹ â†’ æ‹¿ç»“æœ â†’ è§£è¯»ç»“æœ â†’ æ˜¾ç¤ºå‡ºæ¥ï¼è¿™å¥—æµç¨‹è·‘é€šäº†ï¼Œä½ çš„æ¨¡å‹å°±ç­‰äºçœŸæ­£â€œä¸Šçº¿å·¥ä½œâ€äº†ï¼ğŸ‰

ğŸ’¡ **å›ºä»¶ä»‹ç»**ï¼šè¯·å‚è€ƒä¸‹é¢æ–‡æ¡£ä¸­çš„æ­¥éª¤æ­å»ºç¼–è¯‘ç¯å¢ƒï¼Œå¹¶ç¼–è¯‘å›ºä»¶ï¼Œä»¥ä¿è¯**æœ€æ–°çš„ç‰¹æ€§**è¢«æ”¯æŒï¼æ–‡æ¡£æ•™ç¨‹è§ï¼š[å›ºä»¶ç¼–è¯‘](./userguide/how_to_build.md)ã€‚

### è·å–è¾“å…¥å¹¶åˆ›å»ºtensor

å‰é¢æˆ‘ä»¬è¯´äº†ï¼Œæ¨¡å‹è·‘èµ·æ¥ä¹‹åï¼Œéœ€è¦è¾“å…¥æ•°æ®æ‰èƒ½å¼€å§‹æ¨ç†å¯¹å§ï¼Ÿé‚£è¿™äº›å›¾åƒæ•°æ®ä»å“ªå„¿æ¥å‘¢ï¼Ÿè¿™èŠ‚æˆ‘ä»¬å°±æ¥èŠèŠâ€”â€”**å›¾åƒæ˜¯æ€ä¹ˆæ¥çš„ï¼Œåˆæ˜¯æ€ä¹ˆä¸€æ­¥æ­¥å˜æˆæ¨¡å‹èƒ½â€œåƒâ€çš„æ ¼å¼çš„ï¼**

å›¾åƒæ¥æºå…¶å®æœ‰ä¸‰ç§æ–¹å¼ï¼šå¯ä»¥ç”¨æ¿å­ä¸Šæå‰æ”¾å¥½çš„æœ¬åœ°å›¾ç‰‡ï¼ˆæ¯”å¦‚ä½ äº‹å…ˆæ‹·è¿›å»çš„æµ‹è¯•å›¾ï¼‰ï¼Œä¹Ÿå¯ä»¥ç”¨æ¿è½½çš„ MIPI æ‘„åƒå¤´æ‹æ‘„å®æ—¶ç”»é¢ï¼Œæˆ–è€…æ¥ä¸ª UVC æ‘„åƒå¤´æ¥å–å›¾ã€‚ä¸ç®¡ä½ é€‰å“ªç§æ–¹å¼ï¼Œæœ€ç»ˆæˆ‘ä»¬éƒ½è¦æ‹¿åˆ°ä¸€ä¸ª **RGB888Pæ ¼å¼çš„æ•°æ®æŒ‡é’ˆ**â€”â€”è¿™ä¸ªå°±åƒæ˜¯â€œåŸææ–™â€ã€‚å¦‚æœå¾—åˆ°çš„æ•°æ®æ ¼å¼ä¸ç¬¦åˆï¼Œè¿˜éœ€è¦ä½¿ç”¨ä¸€äº›æ¨¡å—è¿›è¡Œè½¬æ¢ã€‚

```{note}
ğŸ‘‰ **`RGB888` å’Œ `RGB888P`** çš„åŒºåˆ«ä¸»è¦åœ¨äº **åƒç´ æ•°æ®åœ¨å†…å­˜ä¸­çš„æ’åˆ—æ–¹å¼**ã€‚

**RGB888æ ¼å¼**ï¼šæ¯ä¸ªåƒç´ çš„ Rã€Gã€B ä¸‰ä¸ªåˆ†é‡ç›´æ¥è¿ç»­å­˜æ”¾åœ¨ä¸€èµ·ï¼Œæ•°æ®æ’å¸ƒä¸º`HWC`ã€‚
**å†…å­˜å¸ƒå±€**ï¼š

[R0][G0][B0]  [R1][G1][B1]  [R2][G2][B2]  ...
[Rw][Gw][Bw]  ...

æ¯ä¸ªåƒç´ å  **3 å­—èŠ‚**ï¼ˆ8 ä½ R + 8 ä½ G + 8 ä½ B = 24 ä½ï¼‰ã€‚

**RGB888Pæ ¼å¼**ï¼šå°†æ‰€æœ‰ R åˆ†é‡æ”¾åœ¨ä¸€èµ·ã€æ‰€æœ‰ G åˆ†é‡æ”¾åœ¨ä¸€èµ·ã€æ‰€æœ‰ B åˆ†é‡æ”¾åœ¨ä¸€èµ·ï¼Œæ•°æ®æ’å¸ƒä¸º`CHW`ã€‚
**å†…å­˜å¸ƒå±€**ï¼š
[R0][R1][R2]...[Rn]    â† å…¨éƒ¨çº¢è‰²åˆ†é‡
[G0][G1][G2]...[Gn]    â† å…¨éƒ¨ç»¿è‰²åˆ†é‡
[B0][B1][B2]...[Bn]    â† å…¨éƒ¨è“è‰²åˆ†é‡

æ¯ä¸ªåˆ†é‡çš„å†…å­˜å—å¤§å°éƒ½æ˜¯ `width Ã— height` å­—èŠ‚ã€‚

å› æ­¤å¦‚ä½•åˆ›å»ºè¾“å…¥`tensor`ï¼Œéœ€è¦æ ¹æ®è½¬æ¢æ¨¡å‹æ—¶`nncase.CompileOptions`çš„`input_layout`ç¡®å®šï¼Œæˆ–è€…ä½¿ç”¨`netron`æŸ¥çœ‹`onnx`æ¨¡å‹çš„è¾“å…¥æ’å¸ƒé¡ºåºã€‚
```

æ‹¿åˆ°å›¾åƒä¹‹åï¼Œæˆ‘ä»¬è¿˜ä¸èƒ½ç›´æ¥é€ç»™æ¨¡å‹ã€‚æˆ‘ä»¬ç”¨ `nncase::runtime` æ¨¡å—æä¾›çš„ APIï¼ŒæŠŠè¿™ä¸ªæ•°ç»„è½¬æˆ **runtime_tensorï¼ˆå¼ é‡ï¼‰**ã€‚è¿™æ—¶å€™æ•°æ®å°±â€œæ‰“åŒ…â€å¥½äº†ï¼Œå¯ä»¥å®‰å¿ƒé€è¿›æ¨¡å‹åšæ¨ç†äº†ï¼

é‚£ä»€ä¹ˆæ˜¯ tensor å‘¢ï¼Ÿä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆæ˜¯æ¨¡å‹èƒ½å¬æ‡‚çš„â€œè¯­è¨€â€â€”â€”å®ƒå°±åƒä¸€ä¸ªè£…æ•°æ®çš„ç›’å­ï¼Œæ¨¡å‹åƒè¿›å»çš„æ˜¯ tensorï¼Œæ¨ç†ä¹‹ååå‡ºæ¥çš„ç»“æœä¹Ÿæ˜¯ tensorã€‚åœ¨ `nncase::runtime` æ¨¡å—é‡Œï¼Œè¿™ä¸ªä¸œè¥¿è¢«å°è£…æˆäº† `runtime_tensor`ï¼Œä½ åªè¦æŒ‰ç…§è¦æ±‚æ„é€ å¥½ï¼Œå°±èƒ½ç›´æ¥ç”¨äº†ã€‚

![create_tensor](https://www.kendryte.com/api/post/attachment?id=651)

ä¸Šå›¾è¯´æ˜äº†åœ¨è·å–è¾“å…¥å›¾åƒå¹¶åˆ›å»ºtensorçš„è¿‡ç¨‹ã€‚æ¨¡å‹æ¨ç†è¾“å…¥ä¸º`runtime_tensor`ç±»å‹ï¼Œå¯ä»¥ä»æŸä¸€ä¸ªæ•°æ®æŒ‡é’ˆåˆ›å»ºã€‚

å¸¸ç”¨çš„è¾“å…¥æ•°æ®æºåŒ…æ‹¬ï¼š

- å›¾ç‰‡æ–‡ä»¶
- MIPIæ‘„åƒå¤´
- UVCæ‘„åƒå¤´

æœ¬èŠ‚å°±è¿™ä¸‰ç§è¾“å…¥æ•°æ®æ¥æºè¿›è¡Œè¯¦ç»†ä»‹ç»ã€‚
  
#### å›¾ç‰‡æ–‡ä»¶è¾“å…¥

ä»å¼€å‘æ¿è¯»å…¥ä¸€å¼ å›¾ç‰‡æ•°æ®ï¼Œåˆ›å»º`cv::Mat`å®ä¾‹ï¼Œå¹¶ä»`cv::Matå®ä¾‹çš„dataæŒ‡é’ˆ`åˆ›å»º`runtime tensor`å®ä¾‹ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼Œ`opencv`è¯»å…¥ä¸€å¼ å›¾ï¼Œ`cv::Mat`é»˜è®¤å®ä¾‹æ˜¯`BGR HWCæ ¼å¼`ï¼Œé¦–å…ˆå°†å…¶è½¬æ¢æˆ`RGB CHW`æ ¼å¼ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªç©ºçš„tensorï¼Œå¹¶æ˜ å°„å‡ºHostç«¯çš„å¯å†™å†…å­˜åŒºåŸŸï¼Œæ‹·è´æ•°æ®åˆ°å¼ é‡å†…ï¼Œç„¶ååŒæ­¥åˆ°è®¾å¤‡ä¸­ï¼š

```cpp
#include <opencv2/core.hpp>
#include <opencv2/highgui.hpp>
#include <opencv2/imgcodecs.hpp>
#include <opencv2/imgproc.hpp>
#include <nncase/runtime/interpreter.h>
#include <nncase/runtime/runtime_op_utility.h>
#include "scoped_timing.h"

using namespace std;
using namespace nncase::runtime;

/**
 * @brief å•å¼ /å¸§å›¾ç‰‡å¤§å°
 */
typedef struct FrameCHWSize
{
    int channel;
    int height; // é«˜
    int width;  // å®½
} FrameCHWSize;

std::string image_path = "/sdcard/test.jpg";
// è¯»å–å›¾ç‰‡
cv::Mat ori_img = cv::imread(image_path);
FrameCHWSize image_size={ori_img.channels(),ori_img.rows,ori_img.cols};
// åˆ›å»ºä¸€ä¸ªç©ºçš„å‘é‡ï¼Œç”¨äºå­˜å‚¨chwå›¾åƒæ•°æ®,å°†è¯»å…¥çš„hwcæ•°æ®è½¬æ¢æˆchwæ•°æ®
std::vector<uint8_t> chw_vec;
std::vector<cv::Mat> bgrChannels(3);
cv::split(ori_img, bgrChannels);
for (auto i = 2; i > -1; i--)
{
    std::vector<uint8_t> data = std::vector<uint8_t>(bgrChannels[i].reshape(1, 1));
    chw_vec.insert(chw_vec.end(), data.begin(), data.end());
}
// åˆ›å»ºtensor
dims_t in_shape { 1, 3, ori_img.rows, ori_img.cols };
runtime_tensor input_tensor = host_runtime_tensor::create(typecode_t::dt_uint8, in_shape, hrt::pool_shared).expect("cannot create input tensor");
auto input_buf = input_tensor.impl()->to_host().unwrap()->buffer().as_host().unwrap().map(map_access_::map_write).unwrap().buffer();
memcpy(reinterpret_cast<char *>(input_buf.data()), chw_vec.data(), chw_vec.size());
hrt::sync(input_tensor, sync_op_t::sync_write_back, true).expect("write back input failed");
```
  
#### MIPIè§†é¢‘æµè¾“å…¥

k230 vicapæ¨¡å—è´Ÿè´£å›¾åƒé‡‡é›†å’Œæ•°æ®å¤„ç†ï¼Œæ”¯æŒMIPIæ¥å£æ‘„åƒå¤´ã€‚MIPIæ‘„åƒå¤´å¯ä»¥é€šè¿‡vicapæ¨¡å—é‡‡é›†å›¾åƒæ•°æ®ï¼Œvicapæ¨¡å—æ”¯æŒå¤šé€šé“é‡‡å›¾ï¼Œå¯ä»¥å°†é‡‡é›†åˆ°çš„å›¾åƒæ•°æ®è½¬æ¢ä¸º`runtime_tensor`ç±»å‹ï¼Œä¾›kmodelæ¨¡å‹æ¨ç†ä½¿ç”¨ã€‚vicapæ¨¡å—çš„é…ç½®å’Œä½¿ç”¨è¯·å‚è€ƒ [VICAP APIæ–‡æ¡£](./api_reference/vicap.md)ã€‚

ğŸ·ï¸ **å•é€šé“é‡‡å›¾**

æ¯ä¸ªMIPIæ‘„åƒå¤´æœ€å¤šå¯ä»¥å‡º3è·¯å›¾åƒé€šé“ï¼ˆå„è·¯é€šé“å¯ä»¥å…·æœ‰ä¸åŒåˆ†è¾¨ç‡æˆ–ä¸åŒæ ¼å¼ï¼‰ã€‚
è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨ä¸€è·¯é€šé“è¾“å‡ºä½œä¸ºç¤ºä¾‹ï¼Œæ•°æ®å¤„ç†æµç¨‹å›¾ä¸‹å›¾æ‰€ç¤ºï¼š

![1_chn_process](https://www.kendryte.com/api/post/attachment?id=613)

æ¨¡å‹æ¨ç†è¿‡ç¨‹ä¸­çš„è¾“å…¥æ•°æ®ä¹Ÿå¯ä»¥æ¥è‡ªMIPIæ‘„åƒå¤´çš„è§†é¢‘æµï¼Œä¸ºäº†ä¿è¯è¾“å‡ºæ•°æ®ä¸ºCHWæ’å¸ƒï¼Œæˆ‘ä»¬ä¸€èˆ¬æŒ‡å®šæ‘„åƒå¤´æµå‡ºæ•°æ®æ ¼å¼ä¸º`PIXEL_FORMAT_RGB_888_PLANAR`ã€‚é…ç½®VICAPè®¾å¤‡å‡ºå›¾çš„ä»£ç å¦‚ä¸‹ï¼Œä¸‹è¿°ä»£ç ä¸ºä¼ªä»£ç ï¼Œä¸å¯å®é™…è¿è¡Œï¼š

```cpp
// å®šä¹‰ISPå‡ºå›¾åˆ†è¾¨ç‡å’Œå•é€šé“çš„å‡ºå›¾åˆ†è¾¨ç‡
#define ISP_WIDTH 1920
#define ISP_HEIGHT 1080
#define AI_FRAME_WIDTH 640
#define AI_FRAME_HEIGHT 360
#define AI_FRAME_CHANNEL 3

k_s32 ret = 0;
k_u32 pool_id;
k_vb_pool_config pool_config;

//---------------------------- é…ç½®video buffer------------------------------------------------
memset(&config, 0, sizeof(k_vb_config));
config.max_pool_cnt = 64;
//VB for RGBP888 format, to AIï¼›åˆ›å»ºbuffer,RGBP888æ ¼å¼å¤§å°ï¼Œç”¨äºé€ç»™AIé€šé“è¿›è¡Œé¢„å¤„ç†
config.comm_pool[1].blk_cnt = 4;
config.comm_pool[1].mode = VB_REMAP_MODE_NOCACHE;
config.comm_pool[1].blk_size = VICAP_ALIGN_UP((AI_FRAME_WIDTH * AI_FRAME_HEIGHT * 3 ), VICAP_ALIGN_1K);
// è®¾ç½®vbé…ç½®
ret = kd_mpi_vb_set_config(&config);
if (ret) {
    printf("vb_set_config failed ret:%d\n", ret);
    return ret;
}
// è®¾ç½®vbé™„åŠ é…ç½®ï¼Œå¦‚DCFä¿¡æ¯/ISPç»Ÿè®¡ä¿¡æ¯/ISPå®æ—¶å‚æ•°ç­‰
k_vb_supplement_config supplement_config;
memset(&supplement_config, 0, sizeof(supplement_config));
supplement_config.supplement_config |= VB_SUPPLEMENT_JPEG_MASK;
ret = kd_mpi_vb_set_supplement_config(&supplement_config);
if (ret) {
    printf("vb_set_supplement_config failed ret:%d\n", ret);
    return ret;
}
// vbåˆå§‹åŒ–
ret = kd_mpi_vb_init();
if (ret) {
    printf("vb_init failed ret:%d\n", ret);
    return ret;
}
//------------------------------------------------------------------------------------------------

//------------------------------- é…ç½®Sensor & vicap-----------------------------------------------------
//sensorç±»å‹è‡ªåŠ¨æ¢æµ‹ï¼Œè·å–sensorç±»å‹
k_vicap_sensor_type sensor_type;

k_vicap_probe_config probe_cfg;
k_vicap_sensor_info sensor_info;
probe_cfg.csi_num = CONFIG_MPP_SENSOR_DEFAULT_CSI + 1;
probe_cfg.width = ISP_WIDTH;
probe_cfg.height = ISP_HEIGHT;
probe_cfg.fps = 30;
if(0x00 != kd_mpi_sensor_adapt_get(&probe_cfg, &sensor_info)) {
    printf("vicap, can't probe sensor on %d, output %dx%d@%d\n", probe_cfg.csi_num, probe_cfg.width, probe_cfg.height, probe_cfg.fps);
    return -1;
}
sensor_type =  sensor_info.sensor_type;
memset(&sensor_info, 0, sizeof(k_vicap_sensor_info));
ret = kd_mpi_vicap_get_sensor_info(sensor_type, &sensor_info);
if (ret) {
    printf("vicap, the sensor type not supported!\n");
    return ret;
}

//è®¾ç½®vicapè®¾å¤‡IDå’Œé€šé“ID
k_vicap_dev vicap_dev=VICAP_DEV_ID_0;
k_vicap_chn vicap_chn_to_ai=VICAP_CHN_ID_1;

//åˆå§‹åŒ–vicapçš„è®¾å¤‡ï¼Œé…ç½®è®¾å¤‡å±æ€§
k_vicap_dev_attr dev_attr;
memset(&dev_attr, 0, sizeof(k_vicap_dev_attr));
dev_attr.acq_win.h_start = 0;
dev_attr.acq_win.v_start = 0;
dev_attr.acq_win.width = ISP_WIDTH;
dev_attr.acq_win.height = ISP_HEIGHT;
dev_attr.mode = VICAP_WORK_ONLINE_MODE;
dev_attr.pipe_ctrl.data = 0xFFFFFFFF;
dev_attr.pipe_ctrl.bits.af_enable = 0;
dev_attr.pipe_ctrl.bits.ahdr_enable = 0;
dev_attr.pipe_ctrl.bits.dnr3_enable = 0;
dev_attr.cpature_frame = 0;
dev_attr.sensor_info = sensor_info;
ret = kd_mpi_vicap_set_dev_attr(vicap_dev, dev_attr);
if (ret) {
    printf("vicap, kd_mpi_vicap_set_dev_attr failed.\n");
    return ret;
}

//é…ç½®é€šé“1ï¼Œè¿™é‡Œåªé…ç½®äº†ä¸€ä¸ªé€šé“ï¼Œè®¾ç½®å‡ºå›¾æ ¼å¼ä¸ºPIXEL_FORMAT_RGB_888_PLANAR
k_vicap_chn_attr chn1_attr;
memset(&chn1_attr, 0, sizeof(k_vicap_chn_attr));
chn1_attr.out_win.h_start = 0;
chn1_attr.out_win.v_start = 0;
chn1_attr.out_win.width = AI_FRAME_WIDTH;
chn1_attr.out_win.height = AI_FRAME_HEIGHT;
chn1_attr.crop_win = dev_attr.acq_win;
chn1_attr.scale_win = chn1_attr.out_win;
chn1_attr.crop_enable = K_FALSE;
chn1_attr.scale_enable = K_FALSE;
chn1_attr.chn_enable = K_TRUE;
chn1_attr.pix_format = PIXEL_FORMAT_RGB_888_PLANAR;
chn1_attr.buffer_num = VICAP_MAX_FRAME_COUNT;
chn1_attr.buffer_size = config.comm_pool[1].blk_size;
printf("kd_mpi_vicap_set_chn_attr, buffer_size[%d]\n", chn1_attr.buffer_size);
ret = kd_mpi_vicap_set_chn_attr(vicap_dev, vicap_chn_to_ai, chn1_attr);
if (ret) {
    printf("kd_mpi_vicap_set_chn_attr failed.\n");
    return ret;
}
// è®¾ç½®ä¸åŒvicapè®¾å¤‡åŠ è½½ISPå‚æ•°çš„æ–¹å¼ï¼Œé»˜è®¤ä¸º0
ret = kd_mpi_vicap_set_database_parse_mode(vicap_dev, VICAP_DATABASE_PARSE_XML_JSON);
if (ret) {
    printf("kd_mpi_vicap_set_database_parse_mode failed.\n");
    return ret;
}
// vicapè®¾å¤‡åˆå§‹åŒ–
ret = kd_mpi_vicap_init(vicap_dev);
if (ret) {
    printf("kd_mpi_vicap_init failed.\n");
}
printf("kd_mpi_vicap_start_stream\n");
// å¯åŠ¨vicapè®¾å¤‡è¾“å‡ºæ•°æ®æµ
ret = kd_mpi_vicap_start_stream(vicap_dev);
if (ret) {
    printf("kd_mpi_vicap_init failed.\n");
}
//----------------------------------------------------------------------------------------------------------
// åˆå§‹åŒ–ä¸€å¸§æ•°æ®ï¼Œç„¶åä½¿ç”¨kd_mpi_vicap_dump_frameè·å–ä¸€å¸§æ•°æ®
k_video_frame_info dump_info;
memset(&dump_info, 0, sizeof(k_video_frame_info));
ret = kd_mpi_vicap_dump_frame(vicap_dev, VICAP_CHN_ID_1, VICAP_DUMP_YUV, &dump_info, 1000);
if (ret)
{
    printf("kd_mpi_vicap_dump_frame failed.\n");
}
// æ˜ å°„åˆ°è™šæ‹Ÿåœ°å€
auto vbvaddr = kd_mpi_sys_mmap(dump_info.v_frame.phys_addr[0], AI_FRAME_CHANNEL*AI_FRAME_HEIGHT*AI_FRAME_WIDTH);
uintptr_t virt_addr=reinterpret_cast<uintptr_t>(vbvaddr);
uintptr_t phy_addr=reinterpret_cast<uintptr_t>(dump_info.v_frame.phys_addr[0]);

// åœ¨è™šæ‹Ÿåœ°å€åŸºç¡€ä¸Šåˆ›å»ºtensor
input_tensor = host_runtime_tensor::create(typecode_t::dt_uint8, in_shape, { (gsl::byte *)virt_addr, compute_size(in_shape) },false, hrt::pool_shared, phy_addr).expect("cannot create input tensor");
hrt::sync(input_tensor, sync_op_t::sync_write_back, true).expect("sync write_back failed");

//é‡Šæ”¾å½“å‰å¸§
ret = kd_mpi_vicap_dump_release(vicap_dev, VICAP_CHN_ID_1, &dump_info);
if (ret)
{
    printf("kd_mpi_vicap_dump_release failed.\n");
}
```

ğŸ·ï¸ **åŒé€šé“é‡‡å›¾**

åœ¨è¾¹ç¼˜è®¾å¤‡ä¸Šæ‰§è¡Œ AI æ¨¡å‹æ¨ç†æ—¶ï¼Œç”±äºæ¨¡å‹è®¡ç®—é‡è¾ƒå¤§ï¼Œ**æ¨ç†è¿‡ç¨‹é€šå¸¸è¾ƒè€—æ—¶**ï¼Œè€—æ—¶èŒƒå›´ä»å‡ æ¯«ç§’åˆ°æ•°ç™¾æ¯«ç§’ä¸ç­‰ã€‚è‹¥é‡‡ç”¨å•é€šé“å¤„ç†æµç¨‹ï¼š

```text
å›¾åƒé‡‡é›† â†’ æ ¼å¼è½¬æ¢ â†’ æ•°æ®é¢„å¤„ç† â†’ æ¨¡å‹æ¨ç† â†’ ç»“æœåå¤„ç† â†’ åŸå›¾ç»˜åˆ¶ â†’ å›¾åƒæ˜¾ç¤º
```

è¿™ç§ä¸²è¡Œæ‰§è¡Œæ–¹å¼ä¼šå¯¼è‡´å›¾åƒæ˜¾ç¤ºå»¶è¿Ÿè¾ƒé«˜ï¼Œå°¤å…¶æ˜¯å½“æ¨¡å‹è¾ƒå¤§æˆ–ç³»ç»Ÿèµ„æºæœ‰é™æ—¶ï¼Œç”»é¢æ›´æ–°æ˜æ˜¾å˜æ…¢ï¼Œå½±å“ç”¨æˆ·ä½“éªŒã€‚

ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œ**æ¨èä½¿ç”¨åŒé€šé“å¤„ç†æ¶æ„**ï¼Œå³é‡‡ç”¨â€œ**ä¸€é€šé“ç”¨äºå®æ—¶æ˜¾ç¤ºï¼Œå¦ä¸€é€šé“ç”¨äºæ¨¡å‹æ¨ç†**â€çš„å¼‚æ­¥å¤„ç†ç­–ç•¥ã€‚è¯¥æ¶æ„é€šè¿‡å¹¶è¡Œå¤„ç†å›¾åƒé‡‡é›†ä¸æ¨¡å‹æ¨ç†ï¼Œæœ‰æ•ˆå‡å°‘äº†æ˜¾ç¤ºå»¶è¿Ÿï¼Œæå‡äº†ç”»é¢æµç•…æ€§ã€‚åŒé€šé“å¤„ç†æœºåˆ¶å¦‚ä¸‹ï¼š

- **æ˜¾ç¤ºé€šé“**ï¼šç›´æ¥é‡‡é›†å›¾åƒå¹¶æ¨é€è‡³å±å¹•ï¼Œå®ç°ä½å»¶è¿Ÿçš„å®æ—¶ç”»é¢æ˜¾ç¤ºï¼Œè¯¥è·¯æ•°æ®å¯ä»¥ä½¿ç”¨ç»‘å®šçš„æ–¹å¼å®ç°ã€‚
- **æ¨ç†é€šé“**ï¼šç‹¬ç«‹é‡‡é›†å›¾åƒå¹¶æ‰§è¡Œå®Œæ•´çš„ AI æ¨ç†æµç¨‹ï¼ˆåŒ…æ‹¬æ ¼å¼è½¬æ¢ã€é¢„å¤„ç†ã€æ¨¡å‹æ¨ç†ä¸åå¤„ç†ï¼‰ã€‚
- **OSD å›¾å±‚åˆæˆ**ï¼šå°†æ¨¡å‹æ¨ç†ç»“æœï¼ˆå¦‚æ£€æµ‹æ¡†ã€å…³é”®ç‚¹ç­‰ï¼‰ç»˜åˆ¶ä¸º OSD å›¾å±‚ï¼Œå¹¶é€šè¿‡ç¡¬ä»¶å åŠ ä¸åŸå§‹å›¾åƒåˆæˆåå†è¾“å‡ºæ˜¾ç¤ºã€‚

è™½ç„¶æ¨ç†ç»“æœåœ¨è§†è§‰ä¸Šä¼šå­˜åœ¨ä¸€å®šå»¶è¿Ÿï¼ˆå³ä¸Šä¸€å¸§çš„æ£€æµ‹æ¡†æ˜¾ç¤ºåœ¨å½“å‰å¸§å›¾åƒä¸Šï¼‰ï¼Œä½†æ•´ä½“ç”»é¢è¿ç»­æ€§æ›´å¥½ï¼Œç”¨æˆ·ä½“éªŒæ›´åŠ æµç•…ã€‚

![2_chn_process](https://www.kendryte.com/api/post/attachment?id=614)

åŒé€šé“å½©å›¾æ¨¡å¼çš„ä¼ªä»£ç å¦‚ä¸‹ï¼Œä¸‹è¿°ä»£ç æ— æ³•ç›´æ¥è¿è¡Œï¼Œä»…ç”¨äºè¯´æ˜ï¼š

```cpp
#define ISP_WIDTH 1920
#define ISP_HEIGHT 1080
#define DISPLAY_MODE 1   
#define DISPLAY_WIDTH 800
#define DISPLAY_HEIGHT 480
#define DISPLAY_ROTATE 1
#define AI_FRAME_WIDTH 640
#define AI_FRAME_HEIGHT 360
#define AI_FRAME_CHANNEL 3
#define USE_OSD 1
#define OSD_WIDTH 800
#define OSD_HEIGHT 480
#define OSD_CHANNEL 4

k_s32 ret = 0;
k_u32 pool_id;
k_vb_pool_config pool_config;

//---------------------------- é…ç½®video buffer------------------------------------------------
memset(&config, 0, sizeof(k_vb_config));
config.max_pool_cnt = 64;
//VB for YUV420SP format, to Displayï¼›åˆ›å»ºbuffer, YUV420SPæ ¼å¼å¤§å°ï¼Œç›´æ¥ç»‘å®šåˆ°Displayæ˜¾ç¤º
config.comm_pool[0].blk_cnt = 4;
config.comm_pool[0].mode = VB_REMAP_MODE_NOCACHE;
config.comm_pool[0].blk_size = VICAP_ALIGN_UP((DISPLAY_WIDTH * DISPLAY_HEIGHT * 3 / 2), VICAP_ALIGN_1K);
//VB for RGBP888 format, to AIï¼›åˆ›å»ºbuffer,RGBP888æ ¼å¼å¤§å°ï¼Œç”¨äºé€ç»™AIé€šé“è¿›è¡Œé¢„å¤„ç†
config.comm_pool[1].blk_cnt = 4;
config.comm_pool[1].mode = VB_REMAP_MODE_NOCACHE;
config.comm_pool[1].blk_size = VICAP_ALIGN_UP((AI_FRAME_WIDTH * AI_FRAME_HEIGHT * 3 ), VICAP_ALIGN_1K);
// è®¾ç½®vbé…ç½®
ret = kd_mpi_vb_set_config(&config);
if (ret) {
    printf("vb_set_config failed ret:%d\n", ret);
    return ret;
}
// è®¾ç½®vbé™„åŠ é…ç½®ï¼Œå¦‚DCFä¿¡æ¯/ISPç»Ÿè®¡ä¿¡æ¯/ISPå®æ—¶å‚æ•°ç­‰
k_vb_supplement_config supplement_config;
memset(&supplement_config, 0, sizeof(supplement_config));
supplement_config.supplement_config |= VB_SUPPLEMENT_JPEG_MASK;
ret = kd_mpi_vb_set_supplement_config(&supplement_config);
if (ret) {
    printf("vb_set_supplement_config failed ret:%d\n", ret);
    return ret;
}
// vbåˆå§‹åŒ–
ret = kd_mpi_vb_init();
if (ret) {
    printf("vb_init failed ret:%d\n", ret);
    return ret;
}
//------------------------------------------------------------------------------------------------
// ---------------------------------é…ç½®å±å¹•-------------------------------------------------------
// é…ç½®connector info
k_connector_info connector_info;
memset(&connector_info, 0, sizeof(k_connector_info));
//æ ¹æ®connectorçš„ç±»å‹è·å–æ•°æ®ç»“æ„
ret = kd_mpi_get_connector_info(connector_type, &connector_info);
if (ret) {
    printf("the connector type not supported!\n");
    return ret;
}
//æ‰“å¼€connectorè®¾å¤‡
k_s32 connector_fd = kd_mpi_connector_open(connector_info.connector_name);
if (connector_fd < 0) {
    printf("%s, connector open failed.\n", __func__);
    return K_ERR_VO_NOTREADY;
}
//æ‰“å¼€ç”µæº
kd_mpi_connector_power_set(connector_fd, K_TRUE);
//connectoråˆå§‹åŒ–
kd_mpi_connector_init(connector_fd, connector_info);
//--------------------------------------------------------------------------------------------------

//-----------------------------------é…ç½®vo-----------------------------------------------------------
k_s32 vo_dev_id=K_VO_DISPLAY_DEV_ID;
k_s32 vo_bind_chn_id=K_VO_DISPLAY_CHN_ID1;
//åˆå§‹åŒ–VOé…ç½®ï¼ŒåŒ…æ‹¬åˆ†è¾¨ç‡ã€æ˜¯å¦æ—‹è½¬ã€æ˜¾ç¤ºä½ç½®
//Layer1è®¾ç½®
k_vo_layer vo_chn_id = K_VO_LAYER1;
k_vo_video_layer_attr vo_attr;
memset(&vo_attr, 0, sizeof(k_vo_video_layer_attr));
vo_attr.display_rect = {0,0};
vo_attr.img_size = {(unsigned int)DISPLAY_HEIGHT,(unsigned int)DISPLAY_WIDTH};
vo_attr.pixel_format = PIXEL_FORMAT_YUV_SEMIPLANAR_420;
if (vo_attr.pixel_format != PIXEL_FORMAT_YUV_SEMIPLANAR_420)
{
    printf("input pix format failed \n");
    return -1;
}
vo_attr.stride = (DISPLAY_WIDTH / 8 - 1) + ((DISPLAY_HEIGHT - 1) << 16);
if(DISPLAY_ROTATE==0){
    vo_attr.func = K_ROTATION_0;
}
else if(DISPLAY_ROTATE==1){
    vo_attr.func = K_ROTATION_90;
}
else{
    vo_attr.func = K_ROTATION_0;
}
// é…ç½®æ£€æŸ¥ï¼Œrotateåªèƒ½åœ¨layer0å’Œlayer1ä½¿ç”¨
if ((vo_chn_id >= K_MAX_VO_LAYER_NUM) || ((vo_attr.func & K_VO_SCALER_ENABLE) && (vo_chn_id != K_VO_LAYER0)) || ((vo_attr.func != K_ROTATION_0) && (vo_chn_id == K_VO_LAYER2)))
{
    printf("input layer num failed \n");
    return -1 ;
}
//è®¾ç½®VO layer1çš„å±æ€§
kd_mpi_vo_set_video_layer_attr(vo_chn_id, &vo_attr);
//ä½¿èƒ½è¯¥layer
kd_mpi_vo_enable_video_layer(vo_chn_id);
//---------------------------------------------------------------------------------------------------

//------------------------------- é…ç½®Sensor & vicap-----------------------------------------------------
//sensorç±»å‹è‡ªåŠ¨æ¢æµ‹
//è®¾ç½®vicapè®¾å¤‡IDå’Œé€šé“IDï¼Œ0é€šé“å‡ºYUV420SPçš„å›¾åƒç›´æ¥ç»™åˆ°voæ˜¾ç¤ºï¼Œ1é€šé“å‡ºRGB888På›¾åƒåœ¨æ­¤æ•°æ®ä¸Šåˆ›å»ºtensorç»™AIæ¨¡å‹æ¨ç†
k_vicap_dev vicap_dev=VICAP_DEV_ID_0;
k_vicap_chn vicap_chn_to_vo=VICAP_CHN_ID_0;
k_vicap_chn vicap_chn_to_ai=VICAP_CHN_ID_1;

k_vicap_probe_config probe_cfg;
k_vicap_sensor_info sensor_info;
probe_cfg.csi_num = CONFIG_MPP_SENSOR_DEFAULT_CSI + 1;
probe_cfg.width = ISP_WIDTH;
probe_cfg.height = ISP_HEIGHT;
probe_cfg.fps = 30;
if(0x00 != kd_mpi_sensor_adapt_get(&probe_cfg, &sensor_info)) {
    printf("vicap, can't probe sensor on %d, output %dx%d@%d\n", probe_cfg.csi_num, probe_cfg.width, probe_cfg.height, probe_cfg.fps);
    return -1;
}
sensor_type =  sensor_info.sensor_type;
memset(&sensor_info, 0, sizeof(k_vicap_sensor_info));
ret = kd_mpi_vicap_get_sensor_info(sensor_type, &sensor_info);
if (ret) {
    printf("vicap, the sensor type not supported!\n");
    return ret;
}

//åˆå§‹åŒ–vicapçš„è®¾å¤‡ï¼Œé…ç½®è®¾å¤‡å±æ€§
k_vicap_dev_attr dev_attr;
memset(&dev_attr, 0, sizeof(k_vicap_dev_attr));
dev_attr.acq_win.h_start = 0;
dev_attr.acq_win.v_start = 0;
dev_attr.acq_win.width = ISP_WIDTH;
dev_attr.acq_win.height = ISP_HEIGHT;
dev_attr.mode = VICAP_WORK_ONLINE_MODE;
dev_attr.pipe_ctrl.data = 0xFFFFFFFF;
dev_attr.pipe_ctrl.bits.af_enable = 0;
dev_attr.pipe_ctrl.bits.ahdr_enable = 0;
dev_attr.pipe_ctrl.bits.dnr3_enable = 0;
dev_attr.cpature_frame = 0;
dev_attr.sensor_info = sensor_info;
ret = kd_mpi_vicap_set_dev_attr(vicap_dev, dev_attr);
if (ret) {
    printf("vicap, kd_mpi_vicap_set_dev_attr failed.\n");
    return ret;
}

// é…ç½®vicapçš„é€šé“0ï¼Œè®¾ç½®å‡ºå›¾æ ¼å¼ä¸ºPIXEL_FORMAT_YUV_SEMIPLANAR_420ï¼Œè¯¥é€šé“ä¼šç»‘å®šåˆ°voçš„layer1ï¼Œç”¨äºç›´æ¥æ˜¾ç¤ºå½“å‰å›¾åƒ
k_vicap_chn_attr chn0_attr;
memset(&chn0_attr, 0, sizeof(k_vicap_chn_attr));
chn0_attr.out_win.h_start = 0;
chn0_attr.out_win.v_start = 0;
chn0_attr.out_win.width = DISPLAY_WIDTH;
chn0_attr.out_win.height = DISPLAY_HEIGHT;
chn0_attr.crop_win = dev_attr.acq_win;
chn0_attr.scale_win = chn0_attr.out_win;
chn0_attr.crop_enable = K_FALSE;
chn0_attr.scale_enable = K_FALSE;
chn0_attr.chn_enable = K_TRUE;
chn0_attr.pix_format = PIXEL_FORMAT_YUV_SEMIPLANAR_420;
chn0_attr.buffer_num = VICAP_MAX_FRAME_COUNT;
chn0_attr.buffer_size = config.comm_pool[0].blk_size;
printf("vicap ...kd_mpi_vicap_set_chn_attr, buffer_size[%d]\n", chn0_attr.buffer_size);
ret = kd_mpi_vicap_set_chn_attr(vicap_dev, vicap_chn_to_vo, chn0_attr);
if (ret) {
    printf("vicap, kd_mpi_vicap_set_chn_attr failed.\n");
    return ret;
}

//åˆå§‹åŒ–ç»‘å®šä¿¡æ¯ï¼Œç»‘å®švicapçš„é€šé“0åˆ°voçš„é€šé“1
k_mpp_chn vicap_mpp_chn;
k_mpp_chn vo_mpp_chn;
vicap_mpp_chn.mod_id = K_ID_VI;
vicap_mpp_chn.dev_id = vicap_dev;
vicap_mpp_chn.chn_id = vicap_chn_to_vo;
vo_mpp_chn.mod_id = K_ID_VO;
vo_mpp_chn.dev_id = vo_dev_id;
vo_mpp_chn.chn_id = vo_bind_chn_id;
ret = kd_mpi_sys_bind(&vicap_mpp_chn, &vo_mpp_chn);
if (ret) {
    printf("kd_mpi_sys_bind failed:0x%x\n", ret);
}

//é…ç½®é€šé“1ï¼Œè®¾ç½®å‡ºå›¾æ ¼å¼ä¸ºPIXEL_FORMAT_RGB_888_PLANAR
k_vicap_chn_attr chn1_attr;
memset(&chn1_attr, 0, sizeof(k_vicap_chn_attr));
chn1_attr.out_win.h_start = 0;
chn1_attr.out_win.v_start = 0;
chn1_attr.out_win.width = AI_FRAME_WIDTH;
chn1_attr.out_win.height = AI_FRAME_HEIGHT;
chn1_attr.crop_win = dev_attr.acq_win;
chn1_attr.scale_win = chn1_attr.out_win;
chn1_attr.crop_enable = K_FALSE;
chn1_attr.scale_enable = K_FALSE;
chn1_attr.chn_enable = K_TRUE;
chn1_attr.pix_format = PIXEL_FORMAT_RGB_888_PLANAR;
chn1_attr.buffer_num = VICAP_MAX_FRAME_COUNT;
chn1_attr.buffer_size = config.comm_pool[1].blk_size;
printf("kd_mpi_vicap_set_chn_attr, buffer_size[%d]\n", chn1_attr.buffer_size);
ret = kd_mpi_vicap_set_chn_attr(vicap_dev, vicap_chn_to_ai, chn1_attr);
if (ret) {
    printf("kd_mpi_vicap_set_chn_attr failed.\n");
    return ret;
}
// è®¾ç½®ä¸åŒvicapè®¾å¤‡åŠ è½½ISPå‚æ•°çš„æ–¹å¼ï¼Œé»˜è®¤ä¸º0
ret = kd_mpi_vicap_set_database_parse_mode(vicap_dev, VICAP_DATABASE_PARSE_XML_JSON);
if (ret) {
    printf("kd_mpi_vicap_set_database_parse_mode failed.\n");
    return ret;
}
// vicapè®¾å¤‡åˆå§‹åŒ–
ret = kd_mpi_vicap_init(vicap_dev);
if (ret) {
    printf("kd_mpi_vicap_init failed.\n");
}
printf("kd_mpi_vicap_start_stream\n");
// å¯åŠ¨vicapè®¾å¤‡è¾“å‡ºæ•°æ®æµ
ret = kd_mpi_vicap_start_stream(vicap_dev);
if (ret) {
    printf("kd_mpi_vicap_init failed.\n");
}
//----------------------------------------------------------------------------------------------------------
// åˆå§‹åŒ–ä¸€å¸§æ•°æ®ï¼Œç„¶åä½¿ç”¨kd_mpi_vicap_dump_frameè·å–ä¸€å¸§æ•°æ®
k_video_frame_info dump_info;
memset(&dump_info, 0, sizeof(k_video_frame_info));
ret = kd_mpi_vicap_dump_frame(vicap_dev, VICAP_CHN_ID_1, VICAP_DUMP_YUV, &dump_info, 1000);
if (ret)
{
    printf("kd_mpi_vicap_dump_frame failed.\n");
}
// æ˜ å°„åˆ°è™šæ‹Ÿåœ°å€
auto vbvaddr = kd_mpi_sys_mmap(dump_info.v_frame.phys_addr[0], AI_FRAME_CHANNEL*AI_FRAME_HEIGHT*AI_FRAME_WIDTH);
uintptr_t virt_addr=reinterpret_cast<uintptr_t>(vbvaddr);
uintptr_t phy_addr=reinterpret_cast<uintptr_t>(dump_info.v_frame.phys_addr[0]);

// åœ¨è™šæ‹Ÿåœ°å€åŸºç¡€ä¸Šåˆ›å»ºtensor
input_tensor = host_runtime_tensor::create(typecode_t::dt_uint8, in_shape, { (gsl::byte *)virt_addr, compute_size(in_shape) },false, hrt::pool_shared, phy_addr).expect("cannot create input tensor");
hrt::sync(input_tensor, sync_op_t::sync_write_back, true).expect("sync write_back failed");

//é‡Šæ”¾å½“å‰å¸§
ret = kd_mpi_vicap_dump_release(vicap_dev, VICAP_CHN_ID_1, &dump_info);
if (ret)
{
    printf("kd_mpi_vicap_dump_release failed.\n");
}
```
  
#### UVCè§†é¢‘æµè¾“å…¥

k230 RT-Smartçš„æœ€æ–°ä»£ç æ”¯æŒUSBæ‘„åƒå¤´ã€‚UVCæ¨¡å—æä¾›äº†æ‘„åƒå¤´æ£€æµ‹ã€é…ç½®å’Œå›¾åƒé‡‡é›†åŠŸèƒ½ï¼Œæ”¯æŒå•æ‘„åƒå¤´æ“ä½œã€‚è·å–çš„è§†é¢‘æµå›¾åƒä¹Ÿå¯ä»¥ä½œä¸ºkmodelæ¨¡å‹çš„è¾“å…¥å®ç°æ¨ç†ã€‚UVCæ¨¡å—çš„ç›¸å…³æ–‡æ¡£é“¾æ¥è§ï¼š[RTOS UVC ä»‹ç»](./app_develop_guide/media/uvc.md)ã€‚

UVCæ¨ç†æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![uvc_process](https://www.kendryte.com/api/post/attachment?id=652)

è¿™é‡Œç»™å‡ºåˆ›å»º`runtime_tensor`çš„ä¼ªä»£ç å¦‚ä¸‹ï¼Œæ­¤ä»£ç ä»…ç”¨äºè¯´æ˜ï¼Œæ— æ³•ç›´æ¥è¿è¡Œï¼š

```cpp
// è§£ç å™¨è®¾å¤‡ ID å’Œé€šé“ IDï¼ˆé€šå¸¸é»˜è®¤ 0ï¼‰
k_s32 vdec_dev_id = 0;
k_s32 vdec_bind_chn_id = 0;
k_s32 vdec_pool_id;
k_video_frame_info vdec_frame_info; ///< è§£ç å™¨è¾“å‡ºçš„è§†é¢‘å¸§ä¿¡æ¯
k_vdec_supplement_info supplement_info; ///< è§£ç å™¨è¡¥å……ä¿¡æ¯

// nonai 2D ç›¸å…³
k_u32 nonai2d_dev_id = 0;               ///< nonai 2D è®¾å¤‡ ID
// YUV420SPè½¬RGB888é€šé“
k_u32 nonai2d_rgb888_chn_id = 0;        ///< nonai 2D RGB888 é€šé“ ID
k_nonai_2d_chn_attr attr_2d_rgb888;     ///< nonai 2D RGB888 é€šé“å±æ€§
k_video_frame_info rgb888_frame_info;   ///< nonai 2D RGB888 è§†é¢‘å¸§ä¿¡æ¯
// RGB888è½¬YUV420SPé€šé“
k_u32 nonai2d_yuv420sp_chn_id = 1;      ///< nonai 2D YUV420SP é€šé“ ID
k_nonai_2d_chn_attr attr_2d_yuv420sp;   ///< nonai 2D YUV420SP é€šé“å±æ€§
k_video_frame_info yuv420sp_frame_info; ///< nonai 2D YUV420SP è§†é¢‘å¸§ä¿¡æ¯

// è®¾ç½®ä¸º JPEG è§£ç æ¨¡å¼ï¼ˆ1 è¡¨ç¤º JPEG æ ¼å¼ï¼‰
unsigned char is_jpeg = 1;
// åˆå§‹åŒ– UVC æ ¼å¼ç»“æ„ä½“
uvc_format init_format = { UVC_WIDTH, UVC_HEIGHT, is_jpeg, 0 };

k_s32 ret = 0;
k_u32 pool_id;
k_vb_pool_config pool_config;

// ---------------------------- é…ç½®è§†é¢‘ç¼“å†²åŒºï¼ˆVideo Bufferï¼‰ -----------------------------------
memset(&config, 0, sizeof(k_vb_config));
config.max_pool_cnt = 64;

//-------------------------
// éšè—ç§æœ‰ç¼“å†²æ±  UVCä½¿ç”¨
//-------------------------

// å…¬å…±ç¼“å†²æ±  0  Nonai2Då¯ç”¨
config.comm_pool[0].blk_cnt = 4;
config.comm_pool[0].mode = VB_REMAP_MODE_NOCACHE;
config.comm_pool[0].blk_size = VICAP_ALIGN_UP((DISPLAY_WIDTH * DISPLAY_HEIGHT * 3), VICAP_ALIGN_1K);

// å…¬å…±ç¼“å†²æ±  1ï¼šç”¨äº VO
config.comm_pool[1].blk_cnt = 4;
config.comm_pool[1].mode = VB_REMAP_MODE_NOCACHE;
config.comm_pool[1].blk_size = VICAP_ALIGN_UP((DISPLAY_WIDTH * DISPLAY_HEIGHT * 3), VICAP_ALIGN_1K);
vo_pool_id = 1;

// å…¬å…±ç¼“å†²æ±  2ï¼šç”¨äº VDEC
config.comm_pool[2].blk_cnt = 4;
config.comm_pool[2].mode = VB_REMAP_MODE_NOCACHE;
config.comm_pool[2].blk_size = VICAP_ALIGN_UP((UVC_WIDTH * UVC_HEIGHT * 3), VICAP_ALIGN_1K);
vdec_pool_id = 2;

// è®¾ç½® VB é…ç½®
ret = kd_mpi_vb_set_config(&config);
if (ret) {
    printf("vb_set_config failed ret:%d\n", ret);
    return ret;
}

// è®¾ç½® VB é™„åŠ é…ç½®
k_vb_supplement_config supplement_config;
memset(&supplement_config, 0, sizeof(supplement_config));
supplement_config.supplement_config |= VB_SUPPLEMENT_JPEG_MASK;
ret = kd_mpi_vb_set_supplement_config(&supplement_config);
if (ret) {
    printf("vb_set_supplement_config failed ret:%d\n", ret);
    return ret;
}

// åˆå§‹åŒ– VB ç³»ç»Ÿ
ret = kd_mpi_vb_init();
if (ret) {
    printf("vb_init failed ret:%d\n", ret);
    return ret;
}
// -----------------------------------------------------------------------------------------------

// ---------------------------- é…ç½® JPEG è§£ç å™¨ï¼ˆVDECï¼‰ ----------------------------------------
// è§£ç å™¨å±æ€§é…ç½®ï¼ŒJPEG->YUV420
vdec_attr.pic_width = UVC_WIDTH;
vdec_attr.pic_height = UVC_HEIGHT;
vdec_attr.frame_buf_cnt = 6;
vdec_attr.stream_buf_size = ALIGN_UP(UVC_WIDTH * UVC_HEIGHT, 0x1000);  // è¾“å…¥ç¼“å†²å¤§å°
vdec_attr.frame_buf_size = vdec_attr.stream_buf_size * 2;              // è§£ç åå¸§ç¼“å†²å¤§å°
vdec_attr.type = K_PT_JPEG;                                            // è§£ç ç±»å‹ï¼šJPEG
vdec_attr.frame_buf_pool_id = vdec_pool_id;                            // ä½¿ç”¨çš„å†…å­˜æ±  ID

// åˆ›å»ºè§£ç é€šé“
ret = kd_mpi_vdec_create_chn(vdec_bind_chn_id, &vdec_attr);
if (ret) {
    printf("kd_mpi_vdec_create_chn fail, ret = %d\n", ret);
    return -1;
}

// å¯åŠ¨è§£ç é€šé“
ret = kd_mpi_vdec_start_chn(vdec_bind_chn_id);
if (ret) {
    printf("kd_mpi_vdec_start_chn fail, ret = %d\n", ret);
    return -1;
}

// è§£ç å¸§åˆå§‹åŒ–ã€é™„åŠ ä¿¡æ¯å‚æ•°é…ç½®
memset(&vdec_frame_info, 0, sizeof(k_video_frame_info));
memset(&supplement_info, 0, sizeof(k_vdec_supplement_info));
supplement_info.type=K_PT_JPEG;
supplement_info.is_valid_frame=K_TRUE;
supplement_info.end_of_stream=K_FALSE;
// -----------------------------------------------------------------------------------------------

// ----------------------------nonai_2d æ ¼å¼è½¬æ¢ -------------------------------------------------
// é…ç½®nonai2d_rgb888_chn_idé€šé“ï¼Œå®ç°YUV420->RGB888ï¼Œç»™AIæ¨¡å‹ä½¿ç”¨
attr_2d_rgb888.mode = K_NONAI_2D_CALC_MODE_CSC;
attr_2d_rgb888.dst_fmt = PIXEL_FORMAT_RGB_888;
ret = kd_mpi_nonai_2d_create_chn(nonai2d_rgb888_chn_id, &attr_2d_rgb888);
if (ret) {
    printf("kd_mpi_nonai_2d_create_chn fail, ret = %d\n", ret);
    return -1;
}
ret = kd_mpi_nonai_2d_start_chn(nonai2d_rgb888_chn_id);
if (ret) {
    printf("kd_mpi_nonai_2d_start_chn fail, ret = %d\n", ret);
    return -1;
}
memset(&rgb888_frame_info, 0, sizeof(k_video_frame_info));

// é…ç½®nonai2d_yuv420sp_chn_idé€šé“ï¼Œå®ç°RGB888->YUV420SPï¼Œè¯¥é€šé“nonai2dç»‘å®šåˆ°VOæ˜¾ç¤º
attr_2d_yuv420sp.mode = K_NONAI_2D_CALC_MODE_CSC;
attr_2d_yuv420sp.dst_fmt = PIXEL_FORMAT_YUV_SEMIPLANAR_420;
ret = kd_mpi_nonai_2d_create_chn(nonai2d_yuv420sp_chn_id, &attr_2d_yuv420sp);
if (ret) {
    printf("kd_mpi_nonai_2d_create_chn fail, ret = %d\n", ret);
    return -1;
}
ret = kd_mpi_nonai_2d_start_chn(nonai2d_yuv420sp_chn_id);
if (ret) {
    printf("kd_mpi_nonai_2d_start_chn fail, ret = %d\n", ret);
    return -1;
}
memset(&yuv420sp_frame_info, 0, sizeof(k_video_frame_info));

// -----------------------------------------------------------------------------------------------

// ---------------------------- åˆå§‹åŒ–å¹¶å¯åŠ¨ UVC é‡‡é›† -------------------------------------------
ret = uvc_init(&init_format);
if (ret) {
    printf("uvc_init fail\n");
    return -1;
}

ret = uvc_start_stream();
if (ret) {
    printf("uvc start stream fail\n");
    return -1;
}
// -----------------------------------------------------------------------------------------------

int ret = 0;

// è·å–ä¸€å¸§ UVC è§†é¢‘å¸§ï¼ˆå¸¦è¶…æ—¶ 5000msï¼‰
ret = uvc_get_frame(&cur_frame, 5000);
if (ret) {
    printf("uvc_get_frame fail\n");
}

// å°†å¸§æ•°æ®å‘é€ç»™ JPEG è§£ç å™¨
ret = kd_mpi_vdec_send_stream(vdec_bind_chn_id, &cur_frame.v_stream, 1000);
if (ret) {
    printf("kd_mpi_vdec_send_stream fail\n");
}
// è·å–è§£ç æ•°æ®å¸§
ret=kd_mpi_vdec_get_frame(vdec_bind_chn_id,&vdec_frame_info,&supplement_info,1000);
if (ret) {
    printf("kd_mpi_vdec_get_frame failed. %d\n", ret);
}
// å‘é€è§£ç æ•°æ®å¸§åˆ°nonai2d_rgb888_chn_idé€šé“
ret = kd_mpi_nonai_2d_send_frame(nonai2d_rgb888_chn_id, &vdec_frame_info, 1000);
if (ret) {
    printf("kd_mpi_nonai_2d_send_frame failed. %d\n", ret);
}
// ä»nonai2d_rgb888_chn_idé€šé“è·å–å¤„ç†åçš„RGB888æ•°æ®å¸§
ret = kd_mpi_nonai_2d_get_frame(nonai2d_rgb888_chn_id, &rgb888_frame_info, 1000);
if (ret) {
    printf("kd_mpi_nonai_2d_get_frame failed. %d\n", ret);
}
// æ˜ å°„RGB888æ•°æ®å¸§ç‰©ç†åœ°å€åˆ°è™šæ‹Ÿåœ°å€
auto vbvaddr = kd_mpi_sys_mmap(rgb888_frame_info.v_frame.phys_addr[0], AI_FRAME_CHANNEL*AI_FRAME_HEIGHT*AI_FRAME_WIDTH);
uintptr_t virt_addr=reinterpret_cast<uintptr_t>(vbvaddr);
uintptr_t phy_addr=reinterpret_cast<uintptr_t>(rgb888_frame_info.v_frame.phys_addr[0]);

// åˆ›å»ºä¸€ä¸ªç©ºçš„runtime_tensorå¯¹è±¡ï¼Œç”¨äºå­˜å‚¨è¾“å…¥æ•°æ®
dims_t in_shape { 1, AI_FRAME_CHANNEL, AI_FRAME_HEIGHT, AI_FRAME_WIDTH };
runtime_tensor input_tensor = host_runtime_tensor::create(typecode_t::dt_uint8, in_shape, hrt::pool_shared).expect("cannot create input tensor");
auto input_buf = input_tensor.impl()->to_host().unwrap()->buffer().as_host().unwrap().map(map_access_::map_write).unwrap().buffer();
void* vaddr=reinterpret_cast<void*>(virt_addr);
cv::Mat ori_img = cv::Mat(image_size.height, image_size.width, CV_8UC3, vaddr);
std::vector<uint8_t> chw_vec;
std::vector<cv::Mat> rgbChannels(3);
cv::split(ori_img, rgbChannels);
// å°†RGB888 æ•°æ®æ’å¸ƒè½¬æ¢æˆ RGB888Pæ•°æ®
for (auto i = 0; i < 3; i++)
{
    std::vector<uint8_t> data = std::vector<uint8_t>(rgbChannels[i].reshape(1, 1));
    chw_vec.insert(chw_vec.end(), data.begin(), data.end());
}
memcpy(reinterpret_cast<char *>(input_buf.data()), chw_vec.data(), chw_vec.size());
hrt::sync(input_tensor, sync_op_t::sync_write_back, true).expect("write back input failed");

// ä»nonai2d_yuv420sp_chn_idé€šé“è·å–å¤„ç†åçš„YUV420SPæ•°æ®å¸§
ret = kd_mpi_nonai_2d_release_frame(nonai2d_rgb888_chn_id, &rgb888_frame_info);
if (ret) {
    printf("kd_mpi_nonai_2d_release_frame failed. %d\n", ret);
}
// é‡Šæ”¾ VDEC å¸§èµ„æº
ret = kd_mpi_vdec_release_frame(vdec_bind_chn_id, &vdec_frame_info);
if (ret) {
    printf("kd_mpi_vdec_release_frame failed. %d\n", ret);
}
// é‡Šæ”¾ UVC å¸§èµ„æº
ret = uvc_put_frame(&cur_frame);
if (ret) {
    printf("uvc_put_frame fail\n");
}
```
  
### å›¾åƒtensoré¢„å¤„ç†

æˆ‘ä»¬ä¹‹å‰å·²ç»æˆåŠŸæŠŠå›¾åƒæ•°æ®å˜æˆäº†ä¸€ä¸ª tensorï¼Œä½†é—®é¢˜æ¥äº†â€”â€”è¿™ä¸ª tensor å¯èƒ½è·Ÿæ¨¡å‹â€œèƒƒå£ä¸åˆâ€ã€‚æ¯”å¦‚å¤§å°ä¸å¯¹ã€é¢œè‰²é€šé“ä¸å¯¹ã€‚è¿™æ—¶å€™ï¼Œå°±éœ€è¦æˆ‘ä»¬å‡ºé©¬ï¼ŒæŠŠ tensor åŠ å·¥ä¸€ä¸‹ï¼Œè®©å®ƒå˜æˆæ¨¡å‹å¯ä»¥æ¥å—çš„æ ¼å¼ã€‚è¿™æ•´ä¸ªå¤„ç†è¿‡ç¨‹å°±å«â€œé¢„å¤„ç†â€ï¼Œè€Œå®Œæˆè¿™ä¸ªå·¥ä½œçš„ï¼Œå°±æ˜¯æˆ‘ä»¬ä»Šå¤©çš„ä¸»è§’ â€”â€” ai2d æ¨¡å—ï¼

**ğŸ› ï¸ ä¸ºä»€ä¹ˆè¦åšé¢„å¤„ç†ï¼Ÿ**
æ¨¡å‹æ˜¯â€œæŒ‘é£Ÿâ€çš„ï¼Œå®ƒåªæ¥å—ç‰¹å®šå°ºå¯¸ã€æ ¼å¼çš„æ•°æ®ï¼Œæ¯”å¦‚ï¼šè¾“å…¥è¦æ˜¯ 320x320 å¤§å°ï¼›è¦æ˜¯ RGB é¡ºåºï¼Œè€Œä¸æ˜¯ BGRï¼›é€šé“åœ¨å‰ï¼ˆCHWï¼‰è¿˜æ˜¯é€šé“åœ¨åï¼ˆHWCï¼‰ä¹Ÿå¾—å¯¹ä¸Šã€‚å¦‚æœä¸å¯¹ï¼Œå°±ä¼šè¯†åˆ«é”™è¯¯ï¼Œç”šè‡³æ¨¡å‹ç›´æ¥ç½¢å·¥æŠ¥é”™ã€‚

**âš¡ ai2d æ¨¡å—ï¼šç¡¬ä»¶åŠ é€Ÿï¼Œé£å¿«å¤„ç†ï¼**
ai2d æ˜¯ K230 å¹³å°ä¸Šä¸“é—¨ç”¨äºå›¾åƒtensoré¢„å¤„ç†çš„æ¨¡å—ï¼Œè¿è¡Œåœ¨ç¡¬ä»¶ä¸Šï¼Œéå¸¸å¿«ï¼Œé€‚åˆåµŒå…¥å¼å®æ—¶ä»»åŠ¡ã€‚å®ƒå¯ä»¥å¸®ä½ å®Œæˆï¼šç¼©æ”¾ã€è£å‰ªã€å¡«å……ã€ä»¿å°„å˜æ¢ç­‰æ“ä½œï¼Œä½¿å¾—å›¾åƒæ•°æ®è¢«å¤„ç†æˆç¬¦åˆæ¨¡å‹è¾“å…¥è¦æ±‚çš„tensoræ•°æ®ã€‚

ä¸‹å›¾å±•ç¤ºäº†åœ¨ K230 å¹³å°ä¸Šé€šè¿‡ ai2d æ¨¡å—è¿›è¡Œé¢„å¤„ç†çš„è¾“å…¥è¾“å‡ºæµç¨‹å’Œæ ¼å¼ï¼š

![preprocess](https://www.kendryte.com/api/post/attachment?id=653)

#### é¢„å¤„ç†è¿‡ç¨‹ä»‹ç»

åœ¨éƒ¨ç½²æ¨¡å‹æ—¶ï¼Œè¾“å…¥å›¾åƒçš„ `runtime_tensor` å¹¶ä¸ä¸€å®šç¬¦åˆæ¨¡å‹çš„è¾“å…¥è§„æ ¼ã€‚ä¾‹å¦‚ï¼Œæ‘„åƒå¤´é‡‡é›†çš„å›¾åƒå°ºå¯¸å¯èƒ½ä¸º `1280Ã—720`ï¼Œè€Œæ¨¡å‹çš„è¾“å…¥è¦æ±‚æ˜¯ `320Ã—320`ï¼Œæ­¤æ—¶å°±éœ€è¦å¯¹å›¾åƒè¿›è¡Œ**é¢„å¤„ç†**ã€‚

é¢„å¤„ç†æ“ä½œåŒ…æ‹¬ä½†ä¸é™äºä»¥ä¸‹å¸¸è§æ–¹å¼ï¼š

- **ç¼©æ”¾ï¼ˆResizeï¼‰**ï¼šå°†åŸå§‹å›¾åƒè°ƒæ•´ä¸ºæ¨¡å‹è¾“å…¥æ‰€éœ€å°ºå¯¸ï¼›
- **è£å‰ªï¼ˆCropï¼‰**ï¼šä¿ç•™å›¾åƒçš„å…³é”®åŒºåŸŸï¼Œå»é™¤å†—ä½™éƒ¨åˆ†ï¼›
- **å½’ä¸€åŒ–ï¼ˆNormalizationï¼‰**ï¼šå°†åƒç´ å€¼æ˜ å°„åˆ°æŒ‡å®šåŒºé—´ï¼ˆå¦‚ `[0, 1]` æˆ– `[-1, 1]`ï¼‰ï¼›
- **å¡«å……ï¼ˆPaddingï¼‰**ï¼šä¸ºä¿æŒå›¾åƒçºµæ¨ªæ¯”è¿›è¡Œè¾¹ç¼˜å¡«å……ï¼Œé¿å…æ‹‰ä¼¸å˜å½¢ã€‚

å…·ä½“åº”é‡‡ç”¨å“ªäº›é¢„å¤„ç†æ–¹å¼ï¼Œéœ€æ ¹æ® **ONNX æ¨¡å‹çš„è®­ç»ƒé¢„å¤„ç†æµç¨‹**è¿›è¡Œå¯¹æ ‡è®¾ç½®ã€‚åŒæ—¶ï¼Œåœ¨å°† ONNX æ¨¡å‹è½¬æ¢ä¸º KModel çš„è¿‡ç¨‹ä¸­ï¼Œéƒ¨åˆ†é¢„å¤„ç†æ­¥éª¤ï¼ˆå¦‚æ ‡å‡†åŒ–ã€é¢œè‰²é€šé“è½¬æ¢ç­‰ï¼‰å¯é€šè¿‡ç¼–è¯‘å™¨å‚æ•°å°è£…è¿›æ¨¡å‹å†…éƒ¨ï¼Œè¿™äº›æ“ä½œåœ¨éƒ¨ç½²æ—¶**æ— éœ€å†æ¬¡å®ç°**ï¼Œç”± KModel è‡ªåŠ¨å®Œæˆã€‚

> âš ï¸ **æ³¨æ„**ï¼š
> å¯¹é¢„å¤„ç†æµç¨‹éœ€æœ‰æ¸…æ™°ç†è§£ï¼Œå°¤å…¶åœ¨è¿›è¡Œå›¾åƒ**ç­‰æ¯”ä¾‹å¡«å……ï¼ˆAspect Ratio Paddingï¼‰**æ—¶ï¼Œç”¨æˆ·å¯é€‰æ‹©ä¸åŒç­–ç•¥ï¼š
>
> - **åŒè¾¹å¡«å……**ï¼šåœ¨å›¾åƒçš„ä¸Šä¸‹å’Œå·¦å³ä¸¤ä¾§å‡è¿›è¡Œå¡«å……ï¼Œä½¿å›¾åƒå±…ä¸­ï¼›
> - **å•è¾¹å¡«å……**ï¼šä»…åœ¨å›¾åƒä¸€ä¾§ï¼ˆå¦‚ä¸Š/å·¦æˆ–ä¸‹/å³ï¼‰å¡«å……ï¼Œä¿æŒä¸€è¾¹å¯¹é½ã€‚
>
> ä¸åŒå¡«å……æ–¹å¼ä¼šå½±å“æ¨¡å‹æ¨ç†è¾“å‡ºåæ ‡çš„å¤åŸé€»è¾‘ï¼Œå› æ­¤åœ¨åå¤„ç†é˜¶æ®µéœ€è¦**åŒ¹é…ç›¸åº”çš„åæ ‡å˜æ¢è§„åˆ™**ï¼Œç¡®ä¿ç»“æœæ­£ç¡®æ˜ å°„å›åŸå§‹å›¾åƒã€‚

#### ai2dæ¨¡å—ä»‹ç»

åœ¨ RT-Smart æ–¹æ¡ˆä¸­ï¼Œå¸¸è§çš„å›¾åƒé¢„å¤„ç†æ“ä½œé€šå¸¸é€šè¿‡ `nncaseçš„ai2d_builder` æ¨¡å—ç”±ç¡¬ä»¶åŠ é€Ÿå®ç°ã€‚è¯¥æ¨¡å—æ”¯æŒäº”ç§ä¸»è¦çš„é¢„å¤„ç†æ–¹æ³•ï¼ŒåŒ…æ‹¬ï¼š

- **ç¼©æ”¾ï¼ˆResizeï¼‰**
- **è£å‰ªï¼ˆCropï¼‰**
- **å¡«å……ï¼ˆPadï¼‰**
- **ä»¿å°„å˜æ¢ï¼ˆAffineï¼‰**
- **æ¯”ç‰¹ä½å³ç§»ï¼ˆShiftï¼‰**

ä½¿ç”¨ `ai2d` æ¨¡å—å¯æœ‰æ•ˆé™ä½ CPU è¿ç®—è´Ÿæ‹…ï¼Œæé«˜é¢„å¤„ç†æ•ˆç‡ï¼Œé€‚ç”¨äºæ¨¡å‹æ¨ç†å‰çš„å›¾åƒé€‚é…æ“ä½œã€‚ç›¸å…³ API ä½¿ç”¨æ–¹æ³•è¯¦è§å®˜æ–¹æ–‡æ¡£ï¼š[ai2d API æ–‡æ¡£](./api_reference/nncase/ai2d_runtime.md)ã€‚åº”ç”¨ç¤ºä¾‹å»ºæ–‡æ¡£ï¼š[AI2D åº”ç”¨æŒ‡å—](./app_develop_guide/ai/ai2d.md)ã€‚

```{attention}
(1) **Affine ä¸ Resize äº’æ–¥**ï¼šäºŒè€…ä¸å¯åŒæ—¶å¯ç”¨ï¼Œä»…èƒ½é€‰æ‹©å…¶ä¸­ä¸€ç§è¿›è¡Œå‡ ä½•å˜æ¢ã€‚  
(2) **Shift ä»…æ”¯æŒ Raw16 è¾“å…¥æ ¼å¼**ï¼Œç”¨äºç‰¹å®šæ ¼å¼çš„é«˜ä½ç§»ä½æ“ä½œã€‚  
(3) **Pad Value æŒ‰é€šé“é…ç½®**ï¼šåº”æä¾›ä¸è¾“å…¥å›¾åƒé€šé“æ•°ä¸€è‡´çš„åˆ—è¡¨ï¼Œä¾‹å¦‚ RGB å›¾åƒéœ€é…ç½®ä¸‰ä¸ªé€šé“çš„å¡«å……å€¼ã€‚  
(4) **åŠŸèƒ½æ‰§è¡Œé¡ºåºä¸º Crop â†’ Shift â†’ Resize/Affine â†’ Pad**ï¼šé…ç½®å¤šä¸ªé¢„å¤„ç†æ­¥éª¤æ—¶å¿…é¡»éµå¾ªæ­¤é¡ºåºã€‚å¦‚æœé¢„å¤„ç†æµç¨‹ä¸ç¬¦åˆæ­¤é¡ºåºï¼Œå»ºè®®åˆå§‹åŒ–å¤šä¸ª `ai2d` å®ä¾‹ï¼Œé€æ­¥å®Œæˆæ‰€éœ€å¤„ç†ã€‚
```

é€šè¿‡åˆç†é…ç½® `ai2d` æ¨¡å—ï¼Œå¯å®ç°é«˜æ•ˆã€çµæ´»çš„å›¾åƒé¢„å¤„ç†ï¼Œä»¥æ»¡è¶³ä¸åŒæ¨¡å‹å¯¹è¾“å…¥æ•°æ®çš„è¦æ±‚ã€‚

è¿™é‡Œä»¥**æ‰“å°æ•°å­—è¯†åˆ«**ä»»åŠ¡ä½¿ç”¨çš„ç­‰æ¯”ä¾‹ç¼©æ”¾å¡«å……é¢„å¤„ç†è¿‡ç¨‹ä¸ºä¾‹ï¼Œä»‹ç»`ai2d`æ¨¡å—çš„ä½¿ç”¨æ–¹æ³•ã€‚**æ ¸å¿ƒä»£ç **(æ­¤ä»£ç ä»…ç”¨äºè¯´æ˜ï¼Œæ— æ³•ç›´æ¥è¿è¡Œ)å¦‚ä¸‹ï¼š

```cpp
int input_w=1280;
int input_h=720;
int output_w=320;
int output_h=320;
// -------è¿™ä¸¤ä¸ªtensorè‡ªè¡Œåˆ›å»º------
runtime_tensor input_tensor;
runtime_tensor output_tensor;
// -------------------------------

// è®¡ç®—å¡«å……å‚æ•°ï¼Œè¿™é‡Œé€‰æ‹©å•ä¾§å¡«å……ï¼Œä»…åœ¨å³ä¾§å’Œä¸‹ä¾§åšå¡«å……ï¼Œå…ˆæŒ‰ç…§çŸ­è¾¹è®¡ç®—ç¼©æ”¾æ¯”ä¾‹ï¼Œç„¶åè®¡ç®—ä¸¤ä¾§å¡«å……åƒç´ å®½åº¦
float ratiow = (float)output_w / input_w;
float ratioh = (float)output_h / input_h;
float ratio = ratiow < ratioh ? ratiow : ratioh;
int new_w = (int)(ratio * input_w);
int new_h = (int)(ratio * input_h);
int top = 0;
int bottom = output_h - new_h;
int left = 0;
int right = output_w - new_w;

// è®¾ç½®ai2dçš„å‚æ•°ï¼ŒåŒ…æ‹¬è¾“å…¥æ ¼å¼è¾“å‡ºæ ¼å¼ï¼Œè¾“å…¥æ•°æ®ç±»å‹è¾“å‡ºæ•°æ®ç±»å‹ï¼Œè£å‰ªå‚æ•°ï¼Œç§»ä½å‚æ•°ï¼Œå¡«å……å‚æ•°ï¼Œç¼©æ”¾å‚æ•°ï¼Œä»¿å°„å‚æ•°ï¼Œä½¿ç”¨å“ªç§æ–¹æ³•å°±å°†å…¶è®¾ç½®ä¸ºtrueï¼Œä¸”é…ç½®æ“ä½œå‚æ•°ï¼Œè¿™é‡Œä½¿ç”¨äº†resize+padæ–¹æ³•
ai2d_datatype_t ai2d_dtype{ai2d_format::NCHW_FMT, ai2d_format::NCHW_FMT, typecode_t::dt_uint8, typecode_t::dt_uint8};
ai2d_crop_param_t crop_param{false, 0, 0, 0, 0};
ai2d_shift_param_t shift_param{false, 0};
ai2d_pad_param_t pad_param{true, {{0, 0}, {0, 0}, {top, bottom}, {left, right}}, ai2d_pad_mode::constant, {padding[0], padding[1], padding[2]}};
ai2d_resize_param_t resize_param{true, ai2d_interp_method::tf_bilinear, ai2d_interp_mode::half_pixel};
ai2d_affine_param_t affine_param{false, ai2d_interp_method::cv2_bilinear, 0, 0, 127, 1, {0.5, 0.1, 0.0, 0.1, 0.5, 0.0}};
// è®¾ç½®è¾“å…¥è¾“å‡ºç»´åº¦
dims_t in_shape = {1,3,input_h,input_w};
dims_t out_shape = {1,3,output_h,output_w};
// åˆå§‹åŒ–ai2d_builderå®ä¾‹
std::unique_ptr<ai2d_builder> ai2d_builder_; // ai2dæ„å»ºå™¨
//è®¾ç½®å‚æ•°
ai2d_builder_.reset(new ai2d_builder(in_shape, out_shape, ai2d_dtype, crop_param, shift_param, pad_param, resize_param, affine_param));
ai2d_builder_->build_schedule();
// æ‰§è¡Œé¢„å¤„ç†
ai2d_builder_->invoke(input_tensor,output_tensor_).expect("error occurred in ai2d running");

//æœ€åå¯ä»¥ä»output_tensorè·å–å¤„ç†åçš„æ•°æ®
```

å…³äº`ai2d`çš„äº”ç§é¢„å¤„ç†æ–¹æ³•ï¼Œåœ¨æºç `src/rtsmart/examples/usage_ai2d`ä¸­ç»™å‡ºäº†ç¤ºä¾‹ï¼Œæ‰§è¡Œç›®å½•ä¸‹çš„`build_app.sh`æ—¢å¯ä»¥ç¼–è¯‘å¾—åˆ°å¯æ‰§è¡Œæ–‡ä»¶ï¼Œç¼–è¯‘äº§ç‰©åœ¨`k230_bin`ç›®å½•ä¸‹ï¼Œå¯ä»¥æ‹·è´åˆ°å¼€å‘æ¿ä¸Šæ‰§è¡Œå¹¶æŸ¥çœ‹ç»“æœã€‚
  
### KPUæ¨ç†

å‰é¢æˆ‘ä»¬å·²ç»æŠŠå›¾åƒé¢„å¤„ç†å¥½äº†ï¼Œè¾“å…¥ tensor ä¹Ÿå‡†å¤‡å°±ç»ªâ€”â€”ç°åœ¨ç»ˆäºè½®åˆ°**ä¸»è§’ç™»åœº**å•¦ï¼Œé‚£å°±æ˜¯æˆ‘ä»¬çš„â€œç¥ç»ç½‘ç»œåŠ é€Ÿå•å…ƒâ€â€”â€”**KPU**ï¼

KPU æ˜¯ K230 ä¸Šä¸“é—¨ç”¨æ¥è·‘ç¥ç»ç½‘ç»œæ¨¡å‹çš„ç¡¬ä»¶åŠ é€Ÿå™¨ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯ï¼š**æ¨¡å‹äº¤ç»™æˆ‘ï¼Œæ¨ç†æˆ‘æ¥æï¼**
ä¸è¿‡åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬å¾—å…ˆå‘Šè¯‰å®ƒï¼šå˜¿ï¼Œæˆ‘è¦ç”¨å“ªä¸ªæ¨¡å‹ï¼æ‰€ä»¥ä½ éœ€è¦æå‰æŠŠ `.kmodel` æ–‡ä»¶æ”¾è¿› K230 çš„æ¿å­é‡Œï¼Œç„¶ååœ¨ä»£ç é‡ŒæŠŠè¿™ä¸ªæ¨¡å‹åŠ è½½è¿› KPUã€‚

æ¥ç€ï¼Œå°±è¦è®¾ç½®è¾“å…¥å•¦â€”â€”æˆ‘ä»¬ä¹‹å‰ç”¨ ai2d æ¨¡å—å¤„ç†å¥½çš„ tensor å°±æ´¾ä¸Šç”¨åœºäº†ï¼Œä½œä¸ºæ¨¡å‹è¾“å…¥ä¼ ç»™ KPUã€‚ç„¶åï¼Œå°±å¯ä»¥è®© KPU å¼€å§‹é£é€Ÿåœ°è·‘æ¨¡å‹å•¦ï¼

æ¨¡å‹ä¸€è·‘å®Œï¼ŒKPU ä¼šæŠŠç»“æœè¿”å›ç»™æˆ‘ä»¬ï¼Œè¿™ä¸ªç»“æœæ˜¯ä¸€ä¸ª **è¾“å‡º tensor**ï¼Œé‡Œé¢å°±æ˜¯æ¨¡å‹æ¨ç†å‡ºæ¥çš„åŸå§‹æ•°æ®ã€‚ä½†æ˜¯è¿™ä¸ªæ ¼å¼äººçœ‹ä¸æ‡‚ä¹Ÿä¸å¥½ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜å¾—åšä¸€æ­¥â€œç¿»è¯‘â€ï¼Œé¦–å…ˆå°†è¾“å‡ºçš„`tensor`æ˜ å°„æˆæ•°æ®æŒ‡é’ˆï¼Œä»ä¸­å–å‡ºè¾“å‡ºæ•°æ®ï¼Œç„¶ååšåå¤„ç†æ“ä½œï¼Œæ¯”å¦‚åˆ¤æ–­è¯†åˆ«å‡ºçš„æ˜¯å“ªä¸ªæ•°å­—ã€å®ƒçš„ä½ç½®åœ¨å“ªå„¿ç­‰ç­‰ã€‚

ä¸‹å›¾æ˜¯ä½¿ç”¨ KPU å®ç°æ¨¡å‹æ¨ç†çš„è¿‡ç¨‹ï¼Œæ¨¡å‹æ¨ç†è¿‡ç¨‹åŒ…æ‹¬åŠ è½½æ¨¡å‹ã€è®¾ç½®æ¨¡å‹è¾“å…¥ã€æ‰§è¡Œæ¨¡å‹æ¨ç†ã€è·å–æ¨¡å‹è¾“å‡ºï¼š

![kpu_run](https://www.kendryte.com/api/post/attachment?id=654)

KPUæ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºæ·±åº¦å­¦ä¹ çš„åŠ é€Ÿå¼•æ“ï¼Œå®ç°å¯¹ç¥ç»ç½‘ç»œæ¨¡å‹çš„è®¡ç®—è¿‡ç¨‹è¿›è¡ŒåŠ é€Ÿã€‚è¯¥æ¨¡å—çš„APIæ–‡æ¡£è§é“¾æ¥ï¼š[nncase KPUè¿è¡Œæ—¶APIæ–‡æ¡£](./api_reference/nncase/kpu_runtime.md)ã€‚**å…³äºKPUçš„åº”ç”¨ç¤ºä¾‹ï¼Œè§æºä»£ç `src/rtsmart/examples/kpu_run_yolov8`**ã€‚

è¿™é‡Œç»™å‡ºä½¿ç”¨`kpu`æ¨¡å—è¿›è¡ŒKPUæ¨ç†çš„æ ¸å¿ƒä»£ç ï¼ˆæ­¤ä»£ç ä»…ç”¨äºè¯´æ˜ï¼Œæ— æ³•ç›´æ¥è¿è¡Œï¼‰å¦‚ä¸‹ï¼š

```cpp
//å‡è®¾æ­¤æ¨¡å‹æœ‰ä¸€ä¸ªè¾“å…¥ï¼Œä¸€ä¸ªè¾“å‡º
runtime_tensor input_tensor;
runtime_tensor output_tensor;
const char* kmodel_path="./test.kmodel";

// åŠ è½½æ¨¡å‹
interpreter interp;     
std::ifstream ifs(kmodel_path, std::ios::binary);
interp.load_model(ifs).expect("Invalid kmodel");
//è®¾ç½®è¾“å…¥tensor,è¿™é‡Œåªè®¾ç½®äº†ä¸€ä¸ªï¼Œå¦‚æœæœ‰å¤šä¸ªï¼Œå¯ä»¥æŒ‰ç…§ç´¢å¼•è®¾ç½®
interp.input_tensor(0, input_tensor).expect("cannot set input tensor");
//interp.input_tensor(1, input_tensor_1).expect("cannot set input tensor");

//è®¾ç½®è¾“å‡ºtensor,è¿™é‡Œåªè®¾ç½®äº†ä¸€ä¸ªï¼Œå¦‚æœæœ‰å¤šä¸ªï¼Œå¯ä»¥æŒ‰ç…§ç´¢å¼•è®¾ç½®
interp.output_tensor(0, output_tensor).expect("cannot set input tensor");
//interp.output_tensor(1, output_tensor_1).expect("cannot set input tensor");

// æ‰§è¡Œkpuæ¨ç†è¿‡ç¨‹
interp.run().expect("error occurred in running model");

// è·å–æ¨¡å‹è¾“å‡ºæ•°æ®çš„æŒ‡é’ˆ,å¯ä»¥ä»è¯¥æŒ‡é’ˆå‡ºå–æ•°æ®è¿›è¡Œåå¤„ç†
auto buf = output_tensor.impl()->to_host().unwrap()->buffer().as_host().unwrap().map(map_access_::map_read).unwrap().buffer();
float *p_out = reinterpret_cast<float *>(buf.data());
```

å¯¹äº**å››ç±»æ‰“å°æ•°å­—è¯†åˆ«ä»»åŠ¡**ï¼Œkpuæ¨¡å‹æ¨ç†çš„è¾“å‡ºåªæœ‰ä¸€ä¸ªï¼Œè¾“å‡ºshapeä¸º[1,8,2100]ã€‚è¾“å‡ºçš„æ•°æ®shapeå¦‚ä¸‹å›¾ï¼š

![output_shape](https://www.kendryte.com/api/post/attachment?id=634)

### åå¤„ç†

æ¨¡å‹æ¨ç†å·²ç»è·‘å®Œå•¦ï¼ŒKPU ç»™äº†æˆ‘ä»¬ä¸€å¤§ä¸²â€œæ•°å­—æ•°ç»„â€å½“ä½œç»“æœï¼Œä½†åˆ«é«˜å…´å¤ªæ—©â€”â€”è¿™äº›æ•°å­—ä¹ä¸€çœ‹æ ¹æœ¬ä¸çŸ¥é“æ˜¯ä»€ä¹ˆæ„æ€ã€‚æ‰€ä»¥ï¼Œæ¥ä¸‹æ¥çš„å·¥ä½œï¼Œå°±æ˜¯è¦æŠŠè¿™äº›æ•°æ®**ç¿»è¯‘æˆäººç±»èƒ½çœ‹æ‡‚çš„å†…å®¹**ï¼Œæ¯”å¦‚ï¼šç”»é¢é‡Œå‡ºç°äº†å“ªä¸ªæ•°å­—ï¼Ÿåœ¨ä»€ä¹ˆä½ç½®ï¼Ÿè¿™ä¸ªè¯†åˆ«ç»“æœé ä¸é è°±ï¼Ÿ

ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬è¿™ä¸ªâ€œå››ç±»æ‰“å°æ•°å­—è¯†åˆ«â€æ¨¡å‹çš„è¾“å‡ºå½¢çŠ¶æ˜¯`[1, 8, 2100]`ï¼Œæ„æ€æ˜¯æ€»å…±æœ‰ 2100 ä¸ªå€™é€‰æ¡†ï¼Œæ¯ä¸ªæ¡†ç”¨ 8 ä¸ªæ•°å­—æ¥æè¿°ã€‚å…·ä½“æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå‰ 4 ä¸ªæ˜¯æ¡†çš„ä½ç½®ï¼ˆä¸­å¿ƒç‚¹çš„ Xã€Y åæ ‡ï¼ŒåŠ ä¸Šå®½åº¦å’Œé«˜åº¦ï¼‰ï¼Œå 4 ä¸ªæ˜¯å››ç§æ•°å­—ï¼ˆ0ã€1ã€2ã€3ï¼‰çš„â€œå¾—åˆ†â€ï¼Œä¹Ÿå°±æ˜¯æ¨¡å‹å¯¹æ¯ç±»çš„åˆ¤æ–­ä¿¡å¿ƒã€‚

æˆ‘ä»¬è¦åšçš„ç¬¬ä¸€æ­¥ï¼Œå°±æ˜¯ä»è¿™ 4 ä¸ªå¾—åˆ†é‡Œï¼ŒæŒ‘å‡ºå¾—åˆ†æœ€é«˜çš„é‚£ä¸ªï¼Œæ‹¿åˆ°å®ƒçš„ç±»åˆ«ç¼–å·å’Œå¯¹åº”çš„åˆ†æ•°ï¼Œè¿™å°±ä»£è¡¨è¿™ä¸ªæ¡†æœ€å¯èƒ½æ˜¯ä»€ä¹ˆæ•°å­—ï¼Œä»¥åŠæ¨¡å‹æœ‰å¤šç¡®å®šæ˜¯è¿™ä¸ªæ•°å­—ã€‚

ç„¶åï¼Œå†å¤„ç†ä¸€ä¸‹ä½ç½®ã€‚æ¨¡å‹è¾“å‡ºçš„æ˜¯æ¡†çš„â€œä¸­å¿ƒç‚¹ + å®½é«˜â€ï¼Œä½†æˆ‘ä»¬é€šå¸¸æ›´ä¹ æƒ¯ç”¨â€œå·¦ä¸Šè§’åæ ‡ + å³ä¸‹è§’åæ ‡â€çš„æ–¹å¼ï¼Œè¿™æ ·æ‰èƒ½æ–¹ä¾¿åé¢åš NMS æ“ä½œã€‚

é‚£ NMSï¼ˆéæå¤§å€¼æŠ‘åˆ¶ï¼‰ æ˜¯å•¥å‘¢ï¼Ÿä½ å¯ä»¥ç†è§£ä¸ºâ€œå»é‡â€ã€‚æœ‰æ—¶å€™æ¨¡å‹å¤ªâ€œçƒ­æƒ…â€ï¼Œå¯¹åŒä¸€ä¸ªæ•°å­—æ¡†å‡ºå¥½å‡ ä¸ªï¼Œæˆ‘ä»¬ä¸éœ€è¦é‚£ä¹ˆå¤šâ€”â€”åªä¿ç•™å¾—åˆ†æœ€é«˜çš„é‚£ä¸€ä¸ªï¼Œå…¶å®ƒé‡å å¤ªå¤šçš„å…¨åˆ æ‰ï¼Œå¹²å¹²å‡€å‡€ï¼è¿™ä¸€æ­¥å°±å«åš NMSï¼Œå‡ ä¹æ‰€æœ‰ç›®æ ‡æ£€æµ‹çš„æ¨¡å‹åå¤„ç†éƒ½ä¼šæœ‰è¿™ä¸€æ­¥ï¼Œéå¸¸å…³é”®ï¼

æœ€åï¼Œè¿˜æœ‰ä¸ªç»†èŠ‚å°±æ˜¯ï¼šæ¨¡å‹æ˜¯å¯¹è¾“å…¥å°ºå¯¸åšæ¨ç†çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬è¾“å…¥çš„æ˜¯ 320Ã—320 çš„å›¾åƒï¼Œä½†åŸå›¾å¯èƒ½æ˜¯åˆ«çš„å¤§å°ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜è¦æŠŠè¿™äº›åæ ‡æŒ‰æ¯”ä¾‹â€œå¤åŸâ€åˆ°åŸå›¾ä¸Šï¼Œæ‰èƒ½æ­£ç¡®ç”»æ¡†ã€‚

è¿™æ ·ä¸€é€šæ“ä½œä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ä»æ¨¡å‹è¾“å‡ºçš„ä¸€å †â€œè°œä¹‹æ•°å­—â€ï¼Œå¾—åˆ°äº†æ¸…æ™°çš„è¯†åˆ«ç»“æœï¼š**ç”»é¢ä¸­å‡ºç°äº†å“ªä¸ªæ•°å­—ã€å®ƒåœ¨å“ªå„¿ã€è¯†åˆ«æœ‰å¤šé è°±ï¼Œæ¡†æ¡†ä¹Ÿç”»å¥½äº†ï¼**è¿™ä¸€æ­¥å°±æ˜¯ä¼ è¯´ä¸­çš„â€œåå¤„ç†â€é˜¶æ®µï¼Œæ•´ä¸ªæµç¨‹æ‰ç®—çœŸæ­£è·‘é€šäº†ï¼

ä¸‹å›¾è¯´æ˜äº†åå¤„ç†è¿‡ç¨‹çš„ä¸»è¦å·¥ä½œï¼š

![postprocess](https://www.kendryte.com/api/post/attachment?id=655)

æ¨¡å‹æ¨ç†ç»“æŸåï¼Œæ¨¡å‹çš„è¾“å‡º`tensor`è¢«æ˜ å°„æˆ`float`ç±»å‹çš„æŒ‡é’ˆã€‚ç”¨æˆ·å¯ä»¥æ ¹æ®åº”ç”¨åœºæ™¯çš„éœ€æ±‚å®ç°åå¤„ç†ã€‚æ¯”å¦‚ï¼Œå¯¹YOLOv8æ¨¡å‹çš„è¾“å‡ºå®ç°åå¤„ç†å¾—åˆ°æ£€æµ‹æ¡†çš„åæ ‡å’Œç±»åˆ«ä¿¡æ¯ã€‚é¦–å…ˆè¦äº†è§£è¾“å‡ºçš„å«ä¹‰ï¼Œå¯¹äº[1,8,2100]çš„è¾“å‡ºï¼Œ8è¡¨ç¤º4ä¸ªæ•°æ®æ˜¯åæ ‡ä¿¡æ¯å’Œ4ä¸ªç±»çš„åˆ†æ•°ï¼Œåå¤„ç†è¿‡ç¨‹éœ€è¦æ‰¾åˆ°åˆ†æ•°æœ€å¤§çš„ç±»åˆ«ç´¢å¼•å’Œç±»åˆ«åˆ†æ•°ï¼Œå¹¶å°†åæ ‡ä¿¡æ¯ä½¿ç”¨é¢„å¤„ç†æ—¶è®¡ç®—çš„æ¯”ä¾‹å¤åŸå›åŸå›¾å°ºå¯¸ï¼Œä»**ä¸­å¿ƒç‚¹+å®½é«˜æ ¼å¼**è½¬æ¢æˆ**å·¦ä¸Šå³ä¸‹åæ ‡æ ¼å¼**ï¼Œç„¶åä½¿ç”¨ç½®ä¿¡åº¦é˜ˆå€¼ç­›æ‰ä¸€éƒ¨åˆ†æ¡†ï¼Œå†ä½¿ç”¨NMSï¼ˆéæå¤§å€¼æŠ‘åˆ¶ï¼‰æ–¹æ³•ç­›æ‰å†—ä½™é‡å æ¡†ï¼Œæœ€åå¾—åˆ°çš„æ‰æ˜¯åŸºäºåŸå›¾çš„æ£€æµ‹æ¡†ä¿¡æ¯ã€‚é’ˆå¯¹**å››ç±»æ‰“å°æ•°å­—è¯†åˆ«**ï¼Œæˆ‘ä»¬ç»™å‡ºè¯¥ä»»åŠ¡åå¤„ç†çš„**æ ¸å¿ƒä»£ç **ï¼ˆæ­¤ä»£ç ä»…ç”¨äºè¯´æ˜ï¼Œæ— æ³•ç›´æ¥è¿è¡Œï¼‰å¦‚ä¸‹ï¼š

```cpp
//å®šä¹‰æ£€æµ‹æ¡†ç±»å‹
typedef struct Bbox{
    cv::Rect box;
    float confidence;
    int index;
}Bbox;

// åå¤„ç†IOUè®¡ç®—
float get_iou_value(cv::Rect rect1, cv::Rect rect2)
{
    int xx1, yy1, xx2, yy2;
 
    xx1 = std::max(rect1.x, rect2.x);
    yy1 = std::max(rect1.y, rect2.y);
    xx2 = std::min(rect1.x + rect1.width - 1, rect2.x + rect2.width - 1);
    yy2 = std::min(rect1.y + rect1.height - 1, rect2.y + rect2.height - 1);
 
    int insection_width, insection_height;
    insection_width = std::max(0, xx2 - xx1 + 1);
    insection_height = std::max(0, yy2 - yy1 + 1);
 
    float insection_area, union_area, iou;
    insection_area = float(insection_width) * insection_height;
    union_area = float(rect1.width*rect1.height + rect2.width*rect2.height - insection_area);
    iou = insection_area / union_area;

    return iou;
}

//NMSéæå¤§å€¼æŠ‘åˆ¶ï¼Œbboxesæ˜¯å¾…å¤„ç†æ¡†Bboxå®ä¾‹çš„åˆ—è¡¨ï¼Œindicesæ˜¯NMSåå‰©ä½™çš„bboxesæ¡†ç´¢å¼•
void nms(std::vector<Bbox> &bboxes,  float confThreshold, float nmsThreshold, std::vector<int> &indices)
{
    sort(bboxes.begin(), bboxes.end(), [](Bbox a, Bbox b) { return a.confidence > b.confidence; });
    int updated_size = bboxes.size();
    for (int i = 0; i < updated_size; i++)
    {
        if (bboxes[i].confidence < confThreshold)
            continue;
        indices.push_back(i);
        for (int j = i + 1; j < updated_size;)
        {
            float iou = get_iou_value(bboxes[i].box, bboxes[j].box);
            if (iou > nmsThreshold)
            {
                bboxes.erase(bboxes.begin() + j);
                updated_size = bboxes.size();
            }
            else
            {
                j++;    
            }
        }
    }
}

// æ¨¡å‹æ¨ç†ç»“æŸåï¼Œè¿›è¡Œåå¤„ç†
//ä¸Šä¸€æ­¥å¾—åˆ°çš„è¾“å‡ºæŒ‡é’ˆ
float *p_out;
// æ ‡ç­¾åç§°
std::vector<std::string> classes{"0","1","2","3"};
// ç½®ä¿¡åº¦é˜ˆå€¼
float conf_thresh=0.25;
// nmsé˜ˆå€¼
float nms_thresh=0.45;
//ç±»åˆ«æ•°
int class_num=classes.size();

// output0 [num_class+4,(w/8)*(h/8)+(w/16)*(h/16)+(w/32)*(h/32)]
float *output0 = p_out;
// æ¯ä¸ªæ¡†çš„ç‰¹å¾é•¿åº¦ï¼Œckass_numä¸ªåˆ†æ•°+4ä¸ªåæ ‡
int f_len=class_num+4;
// æ ¹æ®æ¨¡å‹çš„è¾“å…¥åˆ†è¾¨ç‡è®¡ç®—æ€»è¾“å‡ºæ¡†æ•°
int num_box=((input_shapes[0][2]/8)*(input_shapes[0][3]/8)+(input_shapes[0][2]/16)*(input_shapes[0][3]/16)+(input_shapes[0][2]/32)*(input_shapes[0][3]/32));
// ç”³è¯·æ¡†æ•°æ®å†…å­˜
float *output_det = new float[num_box * f_len];
// å°†è¾“å‡ºæ•°æ®æ’å¸ƒä»[num_class+4,(w/8)*(h/8)+(w/16)*(h/16)+(w/32)*(h/32)]è°ƒæ•´ä¸º[(w/8)*(h/8)+(w/16)*(h/16)+(w/32)*(h/32),num_class+4],æ–¹ä¾¿åç»­å¤„ç†
for(int r = 0; r < num_box; r++)
{
    for(int c = 0; c < f_len; c++)
    {
        output_det[r*f_len + c] = output0[c*num_box + r];
    }
}

// è§£ææ¯ä¸ªæ¡†çš„ä¿¡æ¯ï¼Œclass_num+4ä¸ºä¸€ä¸ªæ¡†ï¼Œå‰å››ä¸ªæ•°æ®ä¸ºåæ ‡å€¼ï¼Œåé¢çš„class_numä¸ªåˆ†æ•°ï¼Œé€‰æ‹©åˆ†æ•°æœ€å¤§çš„ä½œä¸ºè¯†åˆ«çš„ç±»åˆ«ï¼Œå› ä¸ºå¼€å§‹çš„æ—¶å€™åšäº†padding+resizeï¼Œæ‰€ä»¥æ¨¡å‹æ¨ç†çš„åæ ‡æ˜¯åŸºäºä¸å¤„ç†åçš„å›¾åƒçš„ç»“æœï¼Œè¦å…ˆæŠŠæ¡†çš„åæ ‡ä½¿ç”¨ratioæ˜ å°„å›åŸå›¾
std::vector<Bbox> bboxes;
for(int i=0;i<num_box;i++){
    float* vec=output_det+i*f_len;
    float box[4]={vec[0],vec[1],vec[2],vec[3]};
    float* class_scores=vec+4;
    float* max_class_score_ptr=std::max_element(class_scores,class_scores+class_num);
    float score=*max_class_score_ptr;
    int max_class_index = max_class_score_ptr - class_scores; // è®¡ç®—ç´¢å¼•
    if(score>conf_thresh){
        Bbox bbox;
        // æ¢å¤åˆ°åŸå›¾æ¯”ä¾‹
        float x_=box[0]/ratio*1.0;
        float y_=box[1]/ratio*1.0;
        float w_=box[2]/ratio*1.0;
        float h_=box[3]/ratio*1.0;
        int x=int(MAX(x_-0.5*w_,0));
        int y=int(MAX(y_-0.5*h_,0));
        int w=int(w_);
        int h=int(h_);
        if (w <= 0 || h <= 0) { continue; }
        bbox.box=cv::Rect(x,y,w,h);
        bbox.confidence=score;
        bbox.index=max_class_index;
        bboxes.push_back(bbox);
    }

}

//æ‰§è¡Œéæœ€å¤§æŠ‘åˆ¶ä»¥æ¶ˆé™¤å…·æœ‰è¾ƒä½ç½®ä¿¡åº¦çš„å†—ä½™é‡å æ¡†ï¼ˆNMSï¼‰
std::vector<int> nms_result;
nms(bboxes, conf_thresh, nms_thresh, nms_result);
```

ä¸Šè¿°ä»£ç ç»™å‡ºäº†YOLOv8 å››ç±»æ‰“å°æ•°å­—è¯†åˆ«æ¨¡å‹çš„åå¤„ç†æ­¥éª¤ã€‚
  
### ç»“æœç»˜åˆ¶

ç°åœ¨æˆ‘ä»¬å·²ç»å¾—åˆ°äº†è¯†åˆ«ç»“æœå•¦ï¼æ¯ä¸ªæ•°å­—çš„â€œèº«ä»½â€å’Œâ€œä½ç½®â€æˆ‘ä»¬éƒ½çŸ¥é“äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯è®©è¿™äº›ç»“æœ**å˜å¾—â€œçœ‹å¾—è§â€**â€”â€”ä¹Ÿå°±æ˜¯åœ¨å›¾åƒä¸Šç”»å‡ºæ£€æµ‹æ¡†ã€æ ‡ä¸Šæ•°å­—ï¼Œå‘Šè¯‰å¤§å®¶ï¼šâ€œçœ‹ï¼è¿™é‡Œæœ‰ä¸ª 1ï¼â€ã€â€œé‚£è¾¹æ˜¯ä¸ª 3ï¼â€

ä¸è¿‡ï¼Œäº‹æƒ…æ²¡é‚£ä¹ˆç®€å•â€”â€”ä½ çš„æ¨¡å‹æ˜¯å¯¹ 320Ã—320 çš„å›¾åƒåšçš„è¯†åˆ«ï¼Œä½†å±å¹•å¯èƒ½æ˜¯ 800Ã—480ã€1920Ã—1080ï¼Œç”šè‡³åˆ«çš„å°ºå¯¸ã€‚å¦‚æœç›´æ¥æŠŠæ¨¡å‹çš„æ¡†ç”»åœ¨å±å¹•ä¸Šï¼Œé‚£ä½ç½®å¯èƒ½å°±å…¨æ­ªäº†ï¼æ‰€ä»¥æˆ‘ä»¬è¦åšä¸€ä»¶éå¸¸é‡è¦çš„äº‹ï¼š**æŠŠå›¾åƒåæ ‡â€œæ˜ å°„â€æˆå±å¹•åæ ‡**ï¼Œä¹Ÿå°±æ˜¯è¯´æŠŠæ¡†çš„ä½ç½®æŒ‰æ¯”ä¾‹è½¬æ¢ä¸€ä¸‹ï¼Œè®©å®ƒåœ¨å±å¹•ä¸Šåˆšåˆšå¥½ã€‚

ç”»è¿™äº›è¯†åˆ«ä¿¡æ¯çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¸ä¼šç›´æ¥åŠ¨åŸå›¾ï¼Œè€Œæ˜¯åˆ›å»ºä¸€ä¸ªå«åš **OSDï¼ˆOn-Screen Displayï¼‰å’Œå±å¹•ä¸€æ ·å¤§**çš„â€œé€æ˜å›¾å±‚â€ï¼Œå°±åƒåœ¨ç…§ç‰‡ä¸Šè´´äº†ä¸€å¼ ç»ç’ƒè†œï¼Œæˆ‘ä»¬å°±åœ¨è¿™ä¸Šé¢ç”»æ¡†ã€æ ‡ç±»åˆ«ï¼Œä¸ä¼šå½±å“åº•ä¸‹çš„ç”»é¢ã€‚

æœ€åä¸€æ­¥ï¼Œå°±æ˜¯æŠŠè¿™ä¸ª OSD å›¾å±‚å’ŒåŸå§‹å›¾åƒå åŠ åœ¨ä¸€èµ·ï¼Œä¸€èµ·æ˜¾ç¤ºåˆ°å±å¹•ä¸Šï¼è¿™æ ·ä½ å°±èƒ½æ¸…æ¥šåœ°çœ‹åˆ°ï¼šæ¯ä¸ªæ•°å­—è¢«è¯†åˆ«å‡ºæ¥äº†ï¼Œæ¡†ä¹Ÿç”»å¾—å¦¥å¦¥çš„ï¼

ä¸‹å›¾ç»™å‡ºäº†ç»˜åˆ¶ç»“æœçš„æµç¨‹ï¼š

![draw_result](https://www.kendryte.com/api/post/attachment?id=656)

ä»¥**å››ç±»æ‰“å°æ•°å­—è¯†åˆ«**çš„æ£€æµ‹æ¡†ä¸ºä¾‹ï¼Œæˆ‘ä»¬è®¡ç®—å¾—åˆ°çš„æ£€æµ‹æ¡†åæ ‡æ˜¯åŸºäºè¾“å…¥åŸå›¾åˆ†è¾¨ç‡çš„ï¼Œå¦‚æœè¦åœ¨å±å¹•ä¸Šå®ç°æ˜¾ç¤ºï¼Œæˆ‘ä»¬éœ€è¦å°†åæ ‡ç­‰æ¯”ä¾‹è½¬æ¢æˆå±å¹•åæ ‡åˆ†è¾¨ç‡ä¸‹çš„åæ ‡ï¼Œç„¶åå°†æ•ˆæœç»˜åˆ¶åœ¨åˆå§‹åŒ–é€æ˜çš„`cv::Mat`ä¸Šï¼Œç„¶åè°ƒç”¨`vo`æ¨¡å—çš„`kd_mpi_vo_chn_insert_frame`æ–¹æ³•å®ç°å åŠ æ˜¾ç¤ºã€‚è¿™é‡Œç»™å‡ºæ ¸å¿ƒä»£ç ï¼ˆæ­¤ä»£ç ä»…ç”¨äºè¯´æ˜ï¼Œæ— æ³•ç›´æ¥è¿è¡Œï¼‰å¦‚ä¸‹ï¼š

```cpp
// vbç›¸å…³
k_vb_config config;
// å±å¹•ç›¸å…³
k_connector_type connector_type=LT9611_MIPI_4LAN_1920X1080_30FPS;
// voç›¸å…³
k_vo_layer vo_chn_id=K_VO_LAYER1;
k_s32 vo_dev_id=K_VO_DISPLAY_DEV_ID;
k_s32 vo_bind_chn_id=K_VO_DISPLAY_CHN_ID1;

//osdç›¸å…³
k_vo_osd osd_chn_id=K_VO_OSD3;
k_u32 osd_pool_id;
k_vb_blk_handle handle;
k_video_frame_info osd_frame_info;
void *insert_osd_vaddr;

k_s32 ret = 0;
k_u32 pool_id;
k_vb_pool_config pool_config;

//---------------------------- é…ç½®video buffer------------------------------------------------
memset(&config, 0, sizeof(k_vb_config));
config.max_pool_cnt = 64;
//VB for YUV420SP format, to Displayï¼›åˆ›å»ºbuffer, YUV420SPæ ¼å¼å¤§å°ï¼Œç›´æ¥ç»‘å®šåˆ°Displayæ˜¾ç¤º
config.comm_pool[0].blk_cnt = 4;
config.comm_pool[0].mode = VB_REMAP_MODE_NOCACHE;
config.comm_pool[0].blk_size = VICAP_ALIGN_UP((DISPLAY_WIDTH * DISPLAY_HEIGHT * 3 / 2), VICAP_ALIGN_1K);
//VB for RGBP888 format, to AIï¼›åˆ›å»ºbuffer,RGBP888æ ¼å¼å¤§å°ï¼Œç”¨äºé€ç»™AIé€šé“è¿›è¡Œé¢„å¤„ç†
config.comm_pool[1].blk_cnt = 4;
config.comm_pool[1].mode = VB_REMAP_MODE_NOCACHE;
config.comm_pool[1].blk_size = VICAP_ALIGN_UP((AI_FRAME_WIDTH * AI_FRAME_HEIGHT * 3 ), VICAP_ALIGN_1K);
//VB for ARGB8888 format, to OSDï¼›åˆ›å»ºbuffer,ARGB88808æ ¼å¼å¤§å°ï¼Œç”¨äºåˆ›å»ºä¸€ä¸ªç©ºå›¾ï¼Œç»˜åˆ¶AIæ¨ç†çš„ç»“æœ
if(USE_OSD == 1){
    config.comm_pool[2].blk_cnt = 3;
    config.comm_pool[2].mode = VB_REMAP_MODE_NOCACHE;
    config.comm_pool[2].blk_size = VICAP_ALIGN_UP((OSD_WIDTH * OSD_HEIGHT * OSD_CHANNEL), VICAP_ALIGN_1K);
    osd_pool_id=2;
    // VB for BGRA8888 format, to GDMAï¼›
    if(DISPLAY_MODE==1){
        config.comm_pool[3].blk_cnt = 4;
        config.comm_pool[3].mode = VB_REMAP_MODE_NOCACHE;
        config.comm_pool[3].blk_size = VICAP_ALIGN_UP((OSD_WIDTH * OSD_HEIGHT * OSD_CHANNEL), VICAP_ALIGN_1K);
        gdma_pool_id=3;
    }

}
// è®¾ç½®vbé…ç½®
ret = kd_mpi_vb_set_config(&config);
if (ret) {
    printf("vb_set_config failed ret:%d\n", ret);
    return ret;
}
// è®¾ç½®vbé™„åŠ é…ç½®ï¼Œå¦‚DCFä¿¡æ¯/ISPç»Ÿè®¡ä¿¡æ¯/ISPå®æ—¶å‚æ•°ç­‰
k_vb_supplement_config supplement_config;
memset(&supplement_config, 0, sizeof(supplement_config));
supplement_config.supplement_config |= VB_SUPPLEMENT_JPEG_MASK;
ret = kd_mpi_vb_set_supplement_config(&supplement_config);
if (ret) {
    printf("vb_set_supplement_config failed ret:%d\n", ret);
    return ret;
}
// vbåˆå§‹åŒ–
ret = kd_mpi_vb_init();
if (ret) {
    printf("vb_init failed ret:%d\n", ret);
    return ret;
}
//------------------------------------------------------------------------------------------------

// ---------------------------------é…ç½®å±å¹•-------------------------------------------------------
// é…ç½®connector info
k_connector_info connector_info;
memset(&connector_info, 0, sizeof(k_connector_info));
//æ ¹æ®connectorçš„ç±»å‹è·å–æ•°æ®ç»“æ„
ret = kd_mpi_get_connector_info(connector_type, &connector_info);
if (ret) {
    printf("the connector type not supported!\n");
    return ret;
}
//æ‰“å¼€connectorè®¾å¤‡
k_s32 connector_fd = kd_mpi_connector_open(connector_info.connector_name);
if (connector_fd < 0) {
    printf("%s, connector open failed.\n", __func__);
    return K_ERR_VO_NOTREADY;
}
//æ‰“å¼€ç”µæº
kd_mpi_connector_power_set(connector_fd, K_TRUE);
//connectoråˆå§‹åŒ–
kd_mpi_connector_init(connector_fd, connector_info);
//--------------------------------------------------------------------------------------------------

//-----------------------------------é…ç½®vo-----------------------------------------------------------
//åˆå§‹åŒ–VOé…ç½®ï¼ŒåŒ…æ‹¬åˆ†è¾¨ç‡ã€æ˜¯å¦æ—‹è½¬ã€æ˜¾ç¤ºä½ç½®
//Layer1è®¾ç½®
k_vo_video_layer_attr vo_attr;
memset(&vo_attr, 0, sizeof(k_vo_video_layer_attr));
vo_attr.display_rect = {0,0};
vo_attr.img_size = {(unsigned int)DISPLAY_HEIGHT,(unsigned int)DISPLAY_WIDTH};
vo_attr.pixel_format = PIXEL_FORMAT_YUV_SEMIPLANAR_420;
if (vo_attr.pixel_format != PIXEL_FORMAT_YUV_SEMIPLANAR_420)
{
    printf("input pix format failed \n");
    return -1;
}
vo_attr.stride = (DISPLAY_WIDTH / 8 - 1) + ((DISPLAY_HEIGHT - 1) << 16);
if(DISPLAY_ROTATE==0){
    vo_attr.func = K_ROTATION_0;
}
else if(DISPLAY_ROTATE==1){
    vo_attr.func = K_ROTATION_90;
}
else if(DISPLAY_ROTATE==2){
    vo_attr.func = K_ROTATION_180;
}
else if(DISPLAY_ROTATE==3){
    vo_attr.func = K_ROTATION_270;
}
else{
    vo_attr.func = K_ROTATION_0;
}
// é…ç½®æ£€æŸ¥ï¼Œrotateåªèƒ½åœ¨layer0å’Œlayer1ä½¿ç”¨
if ((vo_chn_id >= K_MAX_VO_LAYER_NUM) || ((vo_attr.func & K_VO_SCALER_ENABLE) && (vo_chn_id != K_VO_LAYER0)) || ((vo_attr.func != K_ROTATION_0) && (vo_chn_id == K_VO_LAYER2)))
{
    printf("input layer num failed \n");
    return -1 ;
}
//è®¾ç½®VO layer1çš„å±æ€§
kd_mpi_vo_set_video_layer_attr(vo_chn_id, &vo_attr);
//ä½¿èƒ½è¯¥layer
kd_mpi_vo_enable_video_layer(vo_chn_id);
//---------------------------------------------------------------------------------------------------

//-----------------------------------é…ç½®OSD---------------------------------------------------------
if(USE_OSD == 1){
    //åˆå§‹åŒ–OSDé…ç½®
    if(DISPLAY_MODE==1){
        osd_info osd;
        osd.act_size.width = OSD_HEIGHT;
        osd.act_size.height = OSD_WIDTH;
        osd.offset.x = 0;
        osd.offset.y = 0;
        osd.global_alptha = 0xff;
        osd.format = PIXEL_FORMAT_BGRA_8888;
        //é…ç½®OSDé€šé“å±æ€§
        k_vo_video_osd_attr osd_attr;
        memset(&osd_attr, 0, sizeof(k_vo_video_osd_attr));
        osd_attr.global_alptha = 0xff;
        osd_attr.pixel_format = PIXEL_FORMAT_BGRA_8888;
        osd_attr.display_rect = {0,0};
        osd_attr.img_size = {(unsigned int)OSD_HEIGHT,(unsigned int)OSD_WIDTH};
        if (osd_attr.pixel_format == PIXEL_FORMAT_ABGR_8888 || osd_attr.pixel_format == PIXEL_FORMAT_ARGB_8888 || osd_attr.pixel_format == PIXEL_FORMAT_BGRA_8888)
        {
            osd_attr.stride  = OSD_HEIGHT * 4 / 8;
        }
        else if (osd_attr.pixel_format == PIXEL_FORMAT_RGB_565 || osd_attr.pixel_format == PIXEL_FORMAT_BGR_565)
        {
            osd_attr.stride  = OSD_HEIGHT * 2 / 8;
        }
        else if (osd_attr.pixel_format == PIXEL_FORMAT_RGB_888 || osd_attr.pixel_format == PIXEL_FORMAT_BGR_888)
        {
            osd_attr.stride  = OSD_HEIGHT * 3 / 8;
        }
        else if(osd_attr.pixel_format == PIXEL_FORMAT_ARGB_4444 || osd_attr.pixel_format == PIXEL_FORMAT_ABGR_4444)
        {
            osd_attr.stride  = OSD_HEIGHT * 2 / 8;
        }
        else if(osd_attr.pixel_format == PIXEL_FORMAT_ARGB_1555 || osd_attr.pixel_format == PIXEL_FORMAT_ABGR_1555)
        {
            osd_attr.stride  = OSD_HEIGHT * 2 / 8;
        }
        else
        {
            printf("set osd pixel format failed  \n");
            return -1;
        }
        kd_mpi_vo_set_video_osd_attr(osd_chn_id, &osd_attr);
        kd_mpi_vo_osd_enable(osd_chn_id);
    }
    else{
        osd_info osd;
        osd.act_size.width = OSD_WIDTH;
        osd.act_size.height = OSD_HEIGHT;
        osd.offset.x = 0;
        osd.offset.y = 0;
        osd.global_alptha = 0xff;
        osd.format = PIXEL_FORMAT_BGRA_8888;
        //é…ç½®OSDé€šé“å±æ€§
        k_vo_video_osd_attr osd_attr;
        memset(&osd_attr, 0, sizeof(k_vo_video_osd_attr));
        osd_attr.global_alptha = 0xff;
        osd_attr.pixel_format = PIXEL_FORMAT_BGRA_8888;
        osd_attr.display_rect = {0,0};
        osd_attr.img_size = {(unsigned int)OSD_WIDTH,(unsigned int)OSD_HEIGHT};
        if (osd_attr.pixel_format == PIXEL_FORMAT_ABGR_8888 || osd_attr.pixel_format == PIXEL_FORMAT_ARGB_8888 || osd_attr.pixel_format == PIXEL_FORMAT_BGRA_8888)
        {
            osd_attr.stride  = OSD_WIDTH * 4 / 8;
        }
        else if (osd_attr.pixel_format == PIXEL_FORMAT_RGB_565 || osd_attr.pixel_format == PIXEL_FORMAT_BGR_565)
        {
            osd_attr.stride  = OSD_WIDTH * 2 / 8;
        }
        else if (osd_attr.pixel_format == PIXEL_FORMAT_RGB_888 || osd_attr.pixel_format == PIXEL_FORMAT_BGR_888)
        {
            osd_attr.stride  = OSD_WIDTH * 3 / 8;
        }
        else if(osd_attr.pixel_format == PIXEL_FORMAT_ARGB_4444 || osd_attr.pixel_format == PIXEL_FORMAT_ABGR_4444)
        {
            osd_attr.stride  = OSD_WIDTH * 2 / 8;
        }
        else if(osd_attr.pixel_format == PIXEL_FORMAT_ARGB_1555 || osd_attr.pixel_format == PIXEL_FORMAT_ABGR_1555)
        {
            osd_attr.stride  = OSD_WIDTH * 2 / 8;
        }
        else
        {
            printf("set osd pixel format failed  \n");
            return -1;
        }
        kd_mpi_vo_set_video_osd_attr(osd_chn_id, &osd_attr);
        kd_mpi_vo_osd_enable(osd_chn_id);
    }
    //ä»osdçš„ç¼“å†²æ± è·å–è¯¥å¸§çš„ç¼“å­˜å—ï¼Œå¹¶åˆå§‹åŒ–ä¸€ä¸ªOSDå¸§æ•°æ®ï¼Œå¹¶ç»‘å®šæŒ‡é’ˆpic_vaddrç”¨äºæ‹·è´OSDç»“æœæ•°æ®
    k_s32 size = VICAP_ALIGN_UP(OSD_HEIGHT * OSD_WIDTH * OSD_CHANNEL, VICAP_ALIGN_1K);
    //ç”¨æˆ·æ€è·å–ä¸€ä¸ªç¼“å­˜å—ï¼Œä¼ å…¥å‚æ•°ï¼Œç¼“å­˜æ± idå’Œç¼“å­˜å—å¤§å°ï¼Œosd_pool_idåœ¨å†…å­˜åˆ†é…æ—¶ç¡®å®š
    handle = kd_mpi_vb_get_block(osd_pool_id, size, NULL);
    if (handle == VB_INVALID_HANDLE)
    {
        printf("%s get vb block error\n", __func__);
        return -1;
    }
    //ç”¨æˆ·æ€è·å–è¯¥ç¼“å­˜å—çš„ç‰©ç†åœ°å€
    k_u64 phys_addr = kd_mpi_vb_handle_to_phyaddr(handle);
    if (phys_addr == 0)
    {
        printf("%s get phys addr error\n", __func__);
        return -1;
    }
    //æ˜ å°„ä¸ºè™šæ‹Ÿåœ°å€
    k_u32* virt_addr = (k_u32 *)kd_mpi_sys_mmap(phys_addr, size);
    //å¸¦cacheçš„è™šæ‹Ÿåœ°å€
    // virt_addr = (k_u32 *)kd_mpi_sys_mmap_cached(phys_addr, size);
    if (virt_addr == NULL)
    {
        printf("%s mmap error\n", __func__);
        return -1;
    }
    //åˆ›å»ºOSDæ•°æ®å¸§ï¼Œå¹¶åˆå§‹åŒ–å¸§ä¿¡æ¯ï¼Œå¹¶å°†è¯¥å¸§çš„è™šæ‹Ÿåœ°å€ç»‘å®šåˆ°insert_osd_vaddrä¸Š
    memset(&osd_frame_info, 0, sizeof(osd_frame_info));
    osd_frame_info.v_frame.width = OSD_HEIGHT;
    osd_frame_info.v_frame.height = OSD_WIDTH;
    osd_frame_info.v_frame.stride[0] = OSD_HEIGHT;
    osd_frame_info.v_frame.pixel_format = PIXEL_FORMAT_BGRA_8888;
    osd_frame_info.mod_id = K_ID_VO;
    osd_frame_info.pool_id = osd_pool_id;
    osd_frame_info.v_frame.phys_addr[0] = phys_addr;
    insert_osd_vaddr = virt_addr;
    printf("phys_addr is %lx g_pool_id is %d \n", phys_addr, osd_pool_id);   
}
//---------------------------------------------------------------------------------------------

// sensor vicapåˆå§‹åŒ–è¿™é‡Œçœç•¥ï¼Œé€šé“0ç»‘å®šåˆ°voçš„VIDEO_LAYER1

//åˆå§‹åŒ–ç»‘å®šä¿¡æ¯ï¼Œç»‘å®švicapçš„é€šé“0åˆ°
vicap_mpp_chn.mod_id = K_ID_VI;
vicap_mpp_chn.dev_id = vicap_dev;
vicap_mpp_chn.chn_id = vicap_chn_to_vo;
vo_mpp_chn.mod_id = K_ID_VO;
vo_mpp_chn.dev_id = vo_dev_id;
vo_mpp_chn.chn_id = vo_bind_chn_id;
ret = kd_mpi_sys_bind(&vicap_mpp_chn, &vo_mpp_chn);
if (ret) {
    printf("kd_mpi_sys_bind failed:0x%x\n", ret);
}

//å‡å¦‚è¿™é‡Œæœ‰ä¸€ä¸ªBGRAçš„é€æ˜å›¾åƒ
cv::Mat osd_data;

// å°†å›¾åƒæ•°æ®æ‹·è´åˆ°vbç¼“å­˜å—
memcpy(insert_osd_vaddr, osd_data, OSD_WIDTH * OSD_HEIGHT * OSD_CHANNEL);
//è°ƒç”¨voæ¨¡å—çš„kd_mpi_vo_chn_insert_frameæ¥å£å°†ç»˜åˆ¶ç»“æœæ’å…¥OSDå›¾å±‚
ret=kd_mpi_vo_chn_insert_frame(osd_chn_id + 3, &osd_frame_info);
if (ret)
{
    printf("kd_mpi_vo_chn_insert_frame failed.\n");
}

// ä¸Šè¿°å’Œå¦ä¸€ä¸ªé€šé“å åŠ å°±å¾—åˆ°äº†æœ€åçš„æ˜¾ç¤ºç»“æœ
```

å¦‚æœæ˜¾ç¤ºè®¾å¤‡ä½¿ç”¨`ST7701`çš„`480*800`çš„å±å¹•ï¼Œè¯¥å±å¹•æ˜¯ä¸€ä¸ªç«–å±ï¼Œå¦‚æœæˆ‘ä»¬æƒ³ä½œä¸ºæ¨ªå±ä½¿ç”¨ï¼Œéœ€è¦ä½¿ç”¨`GDMA`ç¡¬ä»¶å¯¹OSDå±‚çš„æ•°æ®è¿›è¡Œæ—‹è½¬90åº¦ã€‚GDMAé…ç½®çš„ä¼ªä»£ç å¦‚ä¸‹ï¼š

```cpp
//-------------------------------é…ç½®GDMAæ—‹è½¬--------------------------------------------------
// gdmaç›¸å…³
k_dma_dev_attr_t gdma_dev_attr;
k_dma_chn_attr_u dma_attr;
k_u32 gdma_pool_id;
k_vb_blk_handle gdma_handle;
k_video_frame_info gdma_frame_info;
void *insert_gdma_vaddr;

gdma_dev_attr.burst_len = 0;
gdma_dev_attr.ckg_bypass = (k_bool)0xff;
gdma_dev_attr.outstanding = 7;

memset(&dma_attr, 0, sizeof(k_dma_chn_attr_u));
dma_attr.gdma_attr.buffer_num = 3;
dma_attr.gdma_attr.rotation = DEGREE_90;
dma_attr.gdma_attr.x_mirror = K_FALSE;
dma_attr.gdma_attr.y_mirror = K_FALSE;
dma_attr.gdma_attr.width = OSD_WIDTH;
dma_attr.gdma_attr.height = OSD_HEIGHT;
dma_attr.gdma_attr.src_stride[0] = OSD_WIDTH * 4;
dma_attr.gdma_attr.dst_stride[0] = OSD_HEIGHT * 4;
dma_attr.gdma_attr.work_mode = DMA_UNBIND;
dma_attr.gdma_attr.pixel_format = DMA_PIXEL_FORMAT_ABGR_8888;

//ä»dmaçš„ç¼“å†²æ± è·å–è¯¥å¸§çš„ç¼“å­˜å—ï¼Œå¹¶åˆå§‹åŒ–ä¸€å¸§æ•°æ®ï¼Œå¹¶ç»‘å®šæŒ‡é’ˆpic_vaddrç”¨äºæ‹·è´ç»“æœæ•°æ®
k_s32 size = VICAP_ALIGN_UP(OSD_HEIGHT * OSD_WIDTH * OSD_CHANNEL, VICAP_ALIGN_1K);
//ç”¨æˆ·æ€è·å–ä¸€ä¸ªç¼“å­˜å—ï¼Œä¼ å…¥å‚æ•°ï¼Œç¼“å­˜æ± idå’Œç¼“å­˜å—å¤§å°ï¼Œosd_pool_idåœ¨å†…å­˜åˆ†é…æ—¶ç¡®å®š
gdma_handle = kd_mpi_vb_get_block(gdma_pool_id, size, NULL);
if (gdma_handle == VB_INVALID_HANDLE)
{
    printf("%s get vb block error\n", __func__);
    return -1;
}
//ç”¨æˆ·æ€è·å–è¯¥ç¼“å­˜å—çš„ç‰©ç†åœ°å€  
k_u64 phys_addr = kd_mpi_vb_handle_to_phyaddr(gdma_handle);
if (phys_addr == 0)
{
    printf("%s get phys addr error\n", __func__);
    return -1;
}
//æ˜ å°„ä¸ºè™šæ‹Ÿåœ°å€
k_u8* virt_addr = (k_u8 *)kd_mpi_sys_mmap(phys_addr, size);
//å¸¦cacheçš„è™šæ‹Ÿåœ°å€
// virt_addr = (k_u32 *)kd_mpi_sys_mmap_cached(phys_addr, size);
if (virt_addr == NULL)
{
    printf("%s mmap error\n", __func__);
    return -1;
}
//åˆ›å»ºGDMAæ•°æ®å¸§ï¼Œå¹¶åˆå§‹åŒ–å¸§ä¿¡æ¯ï¼Œå¹¶å°†è¯¥å¸§çš„è™šæ‹Ÿåœ°å€ç»‘å®šåˆ°insert_gdma_vaddrä¸Š
memset(&gdma_frame_info, 0, sizeof(gdma_frame_info));
gdma_frame_info.v_frame.width = OSD_WIDTH;
gdma_frame_info.v_frame.height = OSD_HEIGHT;
gdma_frame_info.v_frame.stride[0] = OSD_WIDTH;
gdma_frame_info.v_frame.pixel_format = PIXEL_FORMAT_BGRA_8888;
gdma_frame_info.mod_id = K_ID_DMA;
gdma_frame_info.pool_id = gdma_pool_id;
gdma_frame_info.v_frame.phys_addr[0] = phys_addr;
gdma_frame_info.v_frame.virt_addr[0] = (k_u64)(intptr_t)virt_addr;
insert_gdma_vaddr = (void*)virt_addr;
printf("dma phys_addr is %lx  dma g_pool_id is %d \n", phys_addr, gdma_pool_id);

ret=kd_mpi_dma_set_dev_attr(&gdma_dev_attr);
if(ret){
    printf("gdma dma dev set failed!\n");
    return ret;
}

ret = kd_mpi_dma_request_chn(GDMA_TYPE);
if(ret){
    printf("gdma dma chn request failed!\n");
    return ret;
}

ret = kd_mpi_dma_set_chn_attr(0, &dma_attr);
if (ret)
{
    printf("set dma chn attr failed\r\n");
    return ret;
}

ret = kd_mpi_dma_start_dev();
if (ret)
{
    printf("start dma dev failed.\r\n");
    return ret;
}
ret = kd_mpi_dma_start_chn(0);
if (ret)
{
    printf("start dma chn failed.\r\n");
    return ret;
}
//--------------------------------------------------------------------------------------------
```

é€šè¿‡ä¸Šè¿°æ­¥éª¤ï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šå°±å®Œæˆäº†ä½¿ç”¨RT-Smartçš„å¼€å‘ä¸€ä¸ªåº”ç”¨çš„å®Œæ•´æ­¥éª¤ã€‚ç”¨æˆ·ä»è½¬æ¨¡å‹å¼€å§‹ï¼Œéœ€è¦å¯¹æ¨¡å‹æ¨ç†çš„æ•´ä¸ªè¿‡ç¨‹æœ‰æ¯”è¾ƒå¥½çš„äº†è§£ã€‚
  
### æ˜¾ç¤ºè®¾å¤‡ä»‹ç»

å¯¹äºæ˜¾ç¤ºè¾“å‡ºï¼Œk230æä¾›äº†ä¸¤ç§æ˜¾ç¤ºè®¾å¤‡ï¼Œä½ å¯ä»¥é€‰æ‹©ä½¿ç”¨`HDMI/LCDå±å¹•`ä¸¤ç§æ–¹å¼ä¸­çš„ä¸€ç§ã€‚å¯¹åº”æ¨¡å—çš„APIæ–‡æ¡£è§é“¾æ¥ï¼š[è§†é¢‘è¾“å‡ºæ¨¡å—APIæ–‡æ¡£](./api_reference/display.md#kd_mpi_vo_chn_insert_frame)ã€‚ä¸‹é¢åˆ†åˆ«ä»‹ç»è¿™ä¸¤ç§æ–¹å¼ï¼š

ğŸ·ï¸ **HDMI**ï¼šè®¾å¤‡ç±»å‹ä¸º`LT9611`ï¼Œå¯ä»¥å‚ç…§APIæ–‡æ¡£æŸ¥çœ‹åˆå§‹åŒ–æ—¶æ”¯æŒçš„åˆ†è¾¨ç‡ã€å¸§ç‡ã€osdæ•°ç›®ã€‚åœ¨åŒé€šé“AIæ¨ç†ä¸‹ï¼Œä¸€èˆ¬è¿˜ä¼šåˆ›å»ºå¦ä¸€ä¸ªå›¾å±‚ï¼Œå°†ä¸€å¸§å’Œå±å¹•æ˜¾ç¤ºåˆ†è¾¨ç‡åŒæ ·å¤§çš„OSDé€æ˜å›¾åƒè´´åœ¨ä¸Šè¾¹æ˜¾ç¤ºæ¨ç†ç»“æœã€‚OSDä»…æ”¯æŒåœ¨`K_VO_OSD0`/`K_VO_OSD1`/`K_VO_OSD2`/`K_VO_OSD3`å››å±‚æ˜¾ç¤ºã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```cpp
k_connector_type connector_type=LT9611_MIPI_4LAN_1920X1080_30FPS;
// ---------------------------------é…ç½®å±å¹•-------------------------------------------------------
// é…ç½®connector info
k_connector_info connector_info;
memset(&connector_info, 0, sizeof(k_connector_info));
//æ ¹æ®connectorçš„ç±»å‹è·å–æ•°æ®ç»“æ„
ret = kd_mpi_get_connector_info(connector_type, &connector_info);
if (ret) {
    printf("the connector type not supported!\n");
    return ret;
}
//æ‰“å¼€connectorè®¾å¤‡
k_s32 connector_fd = kd_mpi_connector_open(connector_info.connector_name);
if (connector_fd < 0) {
    printf("%s, connector open failed.\n", __func__);
    return K_ERR_VO_NOTREADY;
}
//æ‰“å¼€ç”µæº
kd_mpi_connector_power_set(connector_fd, K_TRUE);
//connectoråˆå§‹åŒ–
kd_mpi_connector_init(connector_fd, connector_info);
//--------------------------------------------------------------------------------------------------
```

ğŸ·ï¸ **LCD**ï¼šè®¾å¤‡ç±»å‹ä¸º`ST7701`æˆ–`HX8399`ï¼Œå¯ä»¥å‚ç…§APIæ–‡æ¡£æŸ¥çœ‹åˆå§‹åŒ–æ—¶æ”¯æŒçš„åˆ†è¾¨ç‡ã€å¸§ç‡ã€osdæ•°ç›®ã€‚åœ¨åŒé€šé“AIæ¨ç†ä¸‹ï¼Œä¸€èˆ¬è¿˜ä¼šåˆ›å»ºå¦ä¸€ä¸ªå›¾å±‚ï¼Œå°†ä¸€å¸§å’Œå±å¹•æ˜¾ç¤ºåˆ†è¾¨ç‡åŒæ ·å¤§çš„OSDé€æ˜å›¾åƒè´´åœ¨ä¸Šè¾¹æ˜¾ç¤ºæ¨ç†ç»“æœã€‚OSDä»…æ”¯æŒåœ¨`K_VO_OSD0`/`K_VO_OSD1`/`K_VO_OSD2`/`K_VO_OSD3`å››å±‚æ˜¾ç¤ºã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```cpp
k_connector_type connector_type=ST7701_V1_MIPI_2LAN_480X800_30FPS;
// ---------------------------------é…ç½®å±å¹•-------------------------------------------------------
// é…ç½®connector info
k_connector_info connector_info;
memset(&connector_info, 0, sizeof(k_connector_info));
//æ ¹æ®connectorçš„ç±»å‹è·å–æ•°æ®ç»“æ„
ret = kd_mpi_get_connector_info(connector_type, &connector_info);
if (ret) {
    printf("the connector type not supported!\n");
    return ret;
}
//æ‰“å¼€connectorè®¾å¤‡
k_s32 connector_fd = kd_mpi_connector_open(connector_info.connector_name);
if (connector_fd < 0) {
    printf("%s, connector open failed.\n", __func__);
    return K_ERR_VO_NOTREADY;
}
//æ‰“å¼€ç”µæº
kd_mpi_connector_power_set(connector_fd, K_TRUE);
//connectoråˆå§‹åŒ–
kd_mpi_connector_init(connector_fd, connector_info);
//--------------------------------------------------------------------------------------------------
```

### ç±»æ‰“å°æ•°å­—è¯†åˆ«éƒ¨ç½²ä»£ç 

å¦‚æœä½¿ç”¨YOLOå®ç°å››ç±»æ‰“å°æ•°å­—æ£€æµ‹è¯†åˆ«ï¼ŒSDKä¸­å·²ç»ä¸ºä½ å‡†å¤‡å¥½äº†å®Œæ•´ä»£ç ï¼Œ**ä¸ä»…æ”¯æŒå•å¼ å›¾ç‰‡çš„æ¨ç†**ï¼Œè¿˜æ”¯æŒ**å®æ—¶è§†é¢‘æµçš„è¿ç»­è¯†åˆ«**ï¼æ— è®ºä½ æ˜¯æƒ³åœ¨é™æ€å›¾ç‰‡ä¸Šæµ‹è¯•æ¨¡å‹æ•ˆæœï¼Œè¿˜æ˜¯åœ¨æ¥å…¥æ‘„åƒå¤´åå®æ—¶æ£€æµ‹ï¼Œéƒ½å¯ä»¥å¿«é€Ÿä¸Šæ‰‹ã€‚ä½ åªéœ€è¦ç”¨å‰é¢æ­¥éª¤ä¸­å¯¼å‡ºçš„ `kmodel` æ¨¡å‹ï¼Œé…åˆæˆ‘ä»¬æä¾›çš„ç¤ºä¾‹è„šæœ¬ï¼Œå°±å¯ä»¥è½»æ¾åœ¨ K230 å¼€å‘æ¿ä¸Šéƒ¨ç½²è¿è¡Œå•¦ï¼

å¦‚æœä½ æƒ³éªŒè¯æ¨¡å‹åœ¨å›¾ç‰‡ä¸Šçš„è¯†åˆ«ç²¾åº¦å’Œå®šä½æ•ˆæœï¼Œå¯ä»¥ç›´æ¥è·‘æˆ‘ä»¬çš„ **å›¾ç‰‡è¯†åˆ«ä»£ç **ï¼›å¦‚æœä½ æƒ³å®æ—¶ä½“éªŒè¯†åˆ«è¿‡ç¨‹ä¸­çš„â€œè§†é¢‘æ•ˆæœâ€ï¼Œé‚£å°±è¯•è¯• **åŒé€šé“è§†é¢‘è¯†åˆ«ä»£ç **ï¼Œçœ‹çœ‹æ•°å­—å‡ºç°åœ¨å±å¹•ä¸Šçš„é‚£ä¸€åˆ»ï¼Œæ¡†æ¡†æ˜¯ä¸æ˜¯èƒ½ç²¾å‡†è¿½è¸ªåˆ°ä½ï¼

æ¥ä¸‹æ¥ä½ å°±å¯ä»¥å¤§èƒ†åŠ¨æ‰‹è¯•è¯•éƒ¨ç½²æµç¨‹ï¼Œæ„Ÿå— K230 ç«¯ä¾§ AI çš„è¿è¡Œæ•ˆæœï¼ŒAI å°±èƒ½è¯»æ‡‚ä½ æ‹ä¸‹çš„æ•°å­—ä¸–ç•Œï¼

ğŸ’¡ **å›ºä»¶ä»‹ç»**ï¼šè¯·å‚è€ƒä¸‹é¢æ–‡æ¡£ä¸­çš„æ­¥éª¤æ­å»ºç¼–è¯‘ç¯å¢ƒï¼Œå¹¶ç¼–è¯‘å›ºä»¶ï¼Œä»¥ä¿è¯**æœ€æ–°çš„ç‰¹æ€§**è¢«æ”¯æŒï¼æ–‡æ¡£æ•™ç¨‹è§ï¼š[å›ºä»¶ç¼–è¯‘](./userguide/how_to_build.md)ã€‚

#### yoloç¼–è¯‘

è¿›å…¥åˆ°`src/rtsmart/examples/YOLO`ç›®å½•ä¸‹ï¼Œæ‰§è¡Œ`build_app.sh`ï¼Œç¼–è¯‘ç”Ÿæˆçš„å›ºä»¶åœ¨`k230_bin`ç›®å½•ä¸‹ã€‚

#### æ¨¡å‹æ–‡ä»¶æ‹·è´

å¼€å‘æ¿çƒ§å½•å›ºä»¶ä¸Šç”µåï¼Œå¯ä»¥åœ¨ç£ç›˜å¤„å‘ç°è™šæ‹ŸUç›˜`CanMV`,ç£ç›˜è¢«åˆ†ä¸º`/sdcard`å’Œ`/data`ä¸¤ä¸ªåˆ†åŒºï¼Œå°†è½¬æ¢å¥½çš„`kmodel`å’Œç¼–è¯‘çš„å¯æ‰§è¡Œ`elfæ–‡ä»¶`ä»¥åŠæµ‹è¯•å›¾ç‰‡ã€æ ‡ç­¾æ–‡ä»¶ï¼ˆtxtæ ¼å¼ï¼Œæ¯è¡Œè¡¨ç¤ºä¸€ç±»ï¼‰æ‹·è´åˆ°å¼€å‘æ¿ä¸ŠæŸä¸€ä¸ªç›®å½•ä¸­ã€‚

#### å›¾ç‰‡è¯†åˆ«å‘½ä»¤

è¿™é‡Œç»™å‡ºå®Œæ•´çš„**4ç±»æ‰“å°æ•°å­—è¯†åˆ«**å›¾ç‰‡æ¨ç†å‘½ä»¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¸Šé¢æ­¥éª¤å¾—åˆ°çš„kmodelè¿›è¡Œæµ‹è¯•ï¼š

```shell
./yolo.elf -model_type yolov8 -task_type detect -task_mode image -image_path num.jpg -kmodel_path best.kmodel -labels_txt_filepath number_labels.txt -conf_thres 0.5 -nms_thres 0.45 -debug_mode 0
```

#### åŒé€šé“è§†é¢‘è¯†åˆ«å‘½ä»¤

è¿™é‡Œç»™å‡ºå®Œæ•´çš„**4ç±»æ‰“å°æ•°å­—è¯†åˆ«**è§†é¢‘æ¨ç†å‘½ä»¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¸Šé¢æ­¥éª¤å¾—åˆ°çš„kmodelè¿›è¡Œæµ‹è¯•ï¼š

```shell
./yolo.elf -ai_frame_width 640 -ai_frame_height 360 -display_mode 0 -model_type yolov8 -task_type detect -task_mode video -kmodel_path best.kmodel -labels_txt_filepath number_labels.txt -conf_thres 0.5 -nms_thres 0.45 -debug_mode 0
```

## YOLOéƒ¨ç½²

YOLO æ˜¯è§†è§‰ä»»åŠ¡ä¸­å¸¸ç”¨çš„æ¨¡å‹ï¼Œæ”¯æŒåˆ†ç±»ã€æ£€æµ‹ã€åˆ†å‰²ã€æ—‹è½¬ç›®æ ‡æ£€æµ‹ç­‰ä»»åŠ¡ã€‚æˆ‘ä»¬é€‰æ‹©YOLOç³»åˆ—æ¨¡å‹ä¸­ç»å…¸çš„YOLOv5ã€YOLOv8å’ŒYOLO11ä¸ºåŸºç¡€ï¼Œå°è£…äº†YOLOv5ã€YOLOv8å’ŒYOLO11çš„éƒ¨ç½²ä»£ç ï¼Œæ–¹ä¾¿ç”¨æˆ·å¿«é€Ÿéƒ¨ç½²YOLOæ¨¡å‹ã€‚å…·ä½“å†…å®¹è§é“¾æ¥ï¼š[YOLOåº”ç”¨æŒ‡å—](./app_develop_guide/ai/yolo.md)ã€‚

### YOLOv5çŒ«ç‹—åˆ†ç±»

åŸºäºYOLOv5æ¨¡å‹å®ç°çŒ«ç‹—åˆ†ç±»æ¨¡å‹åœ¨K230ä¸Šçš„éƒ¨ç½²ã€‚

#### YOLOv5æºç åŠè®­ç»ƒç¯å¢ƒæ­å»º

`YOLOv5` è®­ç»ƒç¯å¢ƒæ­å»ºè¯·å‚è€ƒ[ultralytics/yolov5: YOLOv5 ğŸš€ in PyTorch > ONNX > CoreML > TFLite (github.com)](https://github.com/ultralytics/yolov5)

```shell
git clone https://github.com/ultralytics/yolov5.git
cd yolov5
pip install -r requirements.txt
```

å¦‚æœæ‚¨å·²æ­å»ºå¥½ç¯å¢ƒï¼Œè¯·å¿½ç•¥æ­¤æ­¥éª¤ã€‚

#### è®­ç»ƒæ•°æ®å‡†å¤‡

è¯·ä¸‹è½½æä¾›çš„ç¤ºä¾‹æ•°æ®é›†ï¼Œç¤ºä¾‹æ•°æ®é›†ä»¥çŒ«ç‹—åˆ†ç±»ä¸ºåœºæ™¯ï¼Œä½¿ç”¨YOLOv5å®Œæˆè®­ç»ƒã€‚

```shell
cd yolov5
wget https://kendryte-download.canaan-creative.com/developer/k230/yolo_dataset/cat_dog.zip
unzip cat_dog.zip
```

âš ï¸ **windowsç³»ç»Ÿè¯·ç›´æ¥å¤åˆ¶é“¾æ¥åˆ°æµè§ˆå™¨ä¸‹è½½ï¼Œå¹¶è§£å‹åˆ°å¯¹åº”ç›®å½•**ã€‚

å¦‚æœæ‚¨å·²ä¸‹è½½å¥½æ•°æ®ï¼Œè¯·å¿½ç•¥æ­¤æ­¥éª¤ã€‚

#### ä½¿ç”¨YOLOv5è®­ç»ƒçŒ«ç‹—åˆ†ç±»æ¨¡å‹

åœ¨ `yolov5` ç›®å½•ä¸‹æ‰§è¡Œå‘½ä»¤ï¼Œä½¿ç”¨ `yolov5` è®­ç»ƒçŒ«ç‹—åˆ†ç±»æ¨¡å‹ï¼š

```shell
python classify/train.py --model yolov5n-cls.pt --data cat_dog --epochs 100 --batch-size 8 --imgsz 224 --device '0'
```

#### è½¬æ¢çŒ«ç‹—åˆ†ç±»kmodel

æ¨¡å‹è½¬æ¢éœ€è¦åœ¨è®­ç»ƒç¯å¢ƒå®‰è£…å¦‚ä¸‹åº“ï¼š

```Shell
# linuxå¹³å°ï¼šnncaseå’Œnncase-kpuå¯ä»¥åœ¨çº¿å®‰è£…ï¼Œnncase-2.x éœ€è¦å®‰è£… dotnet-7
sudo apt-get install -y dotnet-sdk-7.0
pip install --upgrade pip
pip install nncase==2.9.0
pip install nncase-kpu==2.9.0

# windowså¹³å°ï¼šè¯·è‡ªè¡Œå®‰è£…dotnet-7å¹¶æ·»åŠ ç¯å¢ƒå˜é‡,æ”¯æŒä½¿ç”¨pipåœ¨çº¿å®‰è£…nncaseï¼Œä½†æ˜¯nncase-kpuåº“éœ€è¦ç¦»çº¿å®‰è£…ï¼Œåœ¨https://github.com/kendryte/nncase/releasesä¸‹è½½nncase_kpu-2.*-py2.py3-none-win_amd64.whl
# è¿›å…¥å¯¹åº”çš„pythonç¯å¢ƒï¼Œåœ¨nncase_kpu-2.*-py2.py3-none-win_amd64.whlä¸‹è½½ç›®å½•ä¸‹ä½¿ç”¨pipå®‰è£…
pip install nncase_kpu-2.*-py2.py3-none-win_amd64.whl

# é™¤nncaseå’Œnncase-kpuå¤–ï¼Œè„šæœ¬è¿˜ç”¨åˆ°çš„å…¶ä»–åº“åŒ…æ‹¬ï¼š
pip install onnx
pip install onnxruntime
pip install onnxsim
```

ä¸‹è½½è„šæœ¬å·¥å…·ï¼Œå°†æ¨¡å‹è½¬æ¢è„šæœ¬å·¥å…· `test_yolov5.zip` è§£å‹åˆ° `yolov5` ç›®å½•ä¸‹ï¼›

```shell
wget https://kendryte-download.canaan-creative.com/developer/k230/yolo_files/test_yolov5.zip
unzip test_yolov5.zip
```

æŒ‰ç…§å¦‚ä¸‹å‘½ä»¤ï¼Œå¯¹ `runs/train-cls/exp/weights` ä¸‹çš„ `pt` æ¨¡å‹å…ˆå¯¼å‡ºä¸º `onnx` æ¨¡å‹ï¼Œå†è½¬æ¢æˆ `kmodel` æ¨¡å‹ï¼š

```shell
# å¯¼å‡ºonnxï¼Œptæ¨¡å‹è·¯å¾„è¯·è‡ªè¡Œé€‰æ‹©
python export.py --weight runs/train-cls/exp/weights/best.pt --imgsz 224 --batch 1 --include onnx
cd test_yolov5/classify
# å°†testç›®å½•ä¸‹çš„å›¾ç‰‡æ¢æˆä½ è‡ªå·±çš„è®­ç»ƒæ•°æ®çš„ä¸€éƒ¨åˆ†ï¼Œè½¬æ¢kmodel,onnxæ¨¡å‹è·¯å¾„è¯·è‡ªè¡Œé€‰æ‹©ï¼Œç”Ÿæˆçš„kmodelåœ¨onnxæ¨¡å‹åŒçº§ç›®å½•ä¸‹
python to_kmodel.py --target k230 --model ../../runs/train-cls/exp/weights/best.onnx --dataset ../test --input_width 224 --input_height 224 --ptq_option 0
cd ../../
```

ğŸ’¡ **æ¨¡å‹è½¬æ¢è„šæœ¬(to_kmodel.py)å‚æ•°è¯´æ˜**ï¼š

| å‚æ•°åç§°     | æè¿°     | è¯´æ˜                                                         | ç±»å‹  |
| ------------ | -------- | ------------------------------------------------------------| ----- |
| target       | ç›®æ ‡å¹³å° | å¯é€‰é¡¹ä¸ºk230/cpuï¼Œå¯¹åº”k230 kpuå’Œcpuï¼›                         | str   |
| model        | æ¨¡å‹è·¯å¾„ | å¾…è½¬æ¢çš„ONNXæ¨¡å‹è·¯å¾„ï¼›                                        | str   |
| dataset      | æ ¡å‡†å›¾ç‰‡é›†  | æ¨¡å‹è½¬æ¢æ—¶ä½¿ç”¨çš„å›¾ç‰‡æ•°æ®ï¼Œåœ¨é‡åŒ–é˜¶æ®µä½¿ç”¨ï¼Œå¯ä»¥ä»è®­ç»ƒæ•°æ®ä¸­å–ä¸€éƒ¨åˆ†                    | str   |
| input_width  | è¾“å…¥å®½åº¦ | æ¨¡å‹è¾“å…¥çš„å®½åº¦                                             | int   |
| input_height | è¾“å…¥é«˜åº¦ | æ¨¡å‹è¾“å…¥çš„é«˜åº¦                                             | int   |
| ptq_option   | é‡åŒ–æ–¹å¼ | dataå’Œweightsçš„é‡åŒ–æ–¹å¼ï¼Œ0ä¸º[uint8,uint8], 1ä¸º[uint8,int16], 2ä¸º[int16,uint8] | 0/1/2 |

#### åœ¨k230ä¸Šä½¿ç”¨RT-Smartéƒ¨ç½²æ¨¡å‹

##### æ­å»ºç¼–è¯‘ç¯å¢ƒ

ğŸ’¡ **å›ºä»¶ä»‹ç»**ï¼šè¯·å‚è€ƒä¸‹é¢æ–‡æ¡£ä¸­çš„æ­¥éª¤æ­å»ºç¼–è¯‘ç¯å¢ƒï¼Œå¹¶ç¼–è¯‘å›ºä»¶ï¼Œä»¥ä¿è¯**æœ€æ–°çš„ç‰¹æ€§**è¢«æ”¯æŒï¼æ–‡æ¡£æ•™ç¨‹è§ï¼š[å›ºä»¶ç¼–è¯‘](./userguide/how_to_build.md)ã€‚

##### yoloç¼–è¯‘

è¿›å…¥åˆ°`src/rtsmart/examples/YOLO`ç›®å½•ä¸‹ï¼Œæ‰§è¡Œ`build_app.sh`ï¼Œç¼–è¯‘ç”Ÿæˆçš„å›ºä»¶åœ¨`k230_bin`ç›®å½•ä¸‹ã€‚

##### æ¨¡å‹æ–‡ä»¶æ‹·è´

å¼€å‘æ¿çƒ§å½•å›ºä»¶ä¸Šç”µåï¼Œå¯ä»¥åœ¨ç£ç›˜å¤„å‘ç°è™šæ‹ŸUç›˜`CanMV`,ç£ç›˜è¢«åˆ†ä¸º`/sdcard`å’Œ`/data`ä¸¤ä¸ªåˆ†åŒºï¼Œå°†è½¬æ¢å¥½çš„`kmodel`å’Œç¼–è¯‘çš„å¯æ‰§è¡Œ`elfæ–‡ä»¶`ä»¥åŠæµ‹è¯•å›¾ç‰‡ã€æ ‡ç­¾æ–‡ä»¶ï¼ˆtxtæ ¼å¼ï¼Œæ¯è¡Œè¡¨ç¤ºä¸€ç±»ï¼‰æ‹·è´åˆ°å¼€å‘æ¿ä¸ŠæŸä¸€ä¸ªç›®å½•ä¸­ã€‚

##### YOLO æ¨¡å—

`YOLO` æ¨¡å—æ˜¯åŸºäº`YOLOç³»åˆ—æ¨¡å‹`å¼€å‘çš„éƒ¨ç½²ä»£ç ï¼Œå®ç°äº†æ­¤ç±»æ¨¡å‹çš„éƒ¨ç½²è¿‡ç¨‹ï¼Œå…¶æ”¯æŒçš„æƒ…å†µå¦‚ä¸‹ï¼š

- é›†æˆäº† `YOLOv5ã€YOLOv8ã€YOLO11` çš„ä¸‰ç§æ¨¡å‹ï¼›
- æ”¯æŒå››ç±»ä»»åŠ¡ï¼Œå…¶ä¸­`YOLOv5`æ”¯æŒåˆ†ç±»(classify)ã€æ£€æµ‹(detect)ã€åˆ†å‰²(segment)ä¸‰ç§ï¼Œ`YOLOv8å’ŒYOLO11`æ”¯æŒåˆ†ç±»(classify)ã€æ£€æµ‹(detect)ã€åˆ†å‰²(segment)ã€æ—‹è½¬ç›®æ ‡æ£€æµ‹(obb)å››ç§ä»»åŠ¡ï¼›
- æ”¯æŒä¸¤ç§æ¨ç†æ¨¡å¼ï¼ŒåŒ…æ‹¬å›¾ç‰‡(image)å’Œè§†é¢‘æµ(video)ï¼›
- æ”¯æŒä¸‰ç§æ˜¾ç¤ºæ¨¡å¼ï¼ŒåŒ…æ‹¬`LT9611 (hdmi,1920Ã—1080)`,`ST7701 (lcdå±å¹•,800Ã—480)`,`HX8377 (lcdå±å¹•,1920Ã—1080)`ï¼›

- **å‚æ•°è¯´æ˜**

| å‚æ•°åç§°               | é»˜è®¤å€¼          | è¯´æ˜                                                                 |
|------------------------|----------------|----------------------------------------------------------------------|
| `-ai_frame_width`      | 640            | è®¾ç½® AI å¸§çš„å®½åº¦ï¼Œé»˜è®¤å€¼ä¸º 640ï¼Œæ‚¨å¯ä»¥è‡ªå·±é€‰æ‹©ä½¿ç”¨çš„å€¼ã€‚                                      |
| `-ai_frame_height`     | 360            | è®¾ç½® AI å¸§çš„é«˜åº¦ï¼Œé»˜è®¤å€¼ä¸º 360ï¼Œæ‚¨å¯ä»¥è‡ªå·±é€‰æ‹©ä½¿ç”¨çš„å€¼ã€‚                                      |
| `-display_mode`        | 0              | è®¾ç½®æ˜¾ç¤ºæ¨¡å¼ï¼Œé»˜è®¤å€¼ä¸º 0ï¼š<br> - æ¨¡å¼ 0: LT9611 <br> - æ¨¡å¼ 1: ST7701 <br> - æ¨¡å¼ 2: HX8377 |
| `-model_type`          | yolov8         | è®¾ç½®æ¨¡å‹ç±»å‹ï¼Œé»˜è®¤å€¼ä¸º yolov8ï¼Œå¯é€‰å€¼ï¼šyolov5/yolov8/yolo11ã€‚          |
| `-task_type`           | detect         | è®¾ç½®ä»»åŠ¡ç±»å‹ï¼Œé»˜è®¤å€¼ä¸º detectï¼Œå¯é€‰å€¼ï¼šclassify/detect/segmentã€‚       |
| `-task_mode`           | video          | è®¾ç½®ä»»åŠ¡æ¨¡å¼ï¼Œé»˜è®¤å€¼ä¸º videoï¼Œå¯é€‰å€¼ï¼šimage/video |
| `-image_path`          | test.jpg       | è®¾ç½®å›¾åƒè·¯å¾„ï¼Œé»˜è®¤å€¼ä¸º test.jpgã€‚                                      |
| `-kmodel_path`         | yolov8n.kmodel | è®¾ç½® kmodel è·¯å¾„ï¼Œé»˜è®¤å€¼ä¸º yolov8n.kmodelã€‚                            |
| `-labels_txt_filepath` | coco_labels.txt| è®¾ç½®æ ‡ç­¾æ–‡æœ¬æ–‡ä»¶è·¯å¾„ï¼Œé»˜è®¤å€¼ä¸º coco_labels.txtï¼Œæ¯ä¸ªæ ‡ç­¾ç‹¬å ä¸€è¡Œã€‚                        |
| `-conf_thres`          | 0.35           | è®¾ç½®ç½®ä¿¡åº¦é˜ˆå€¼ï¼Œé»˜è®¤å€¼ä¸º 0.35ã€‚                                        |
| `-nms_thres`           | 0.65           | è®¾ç½®éæå¤§å€¼æŠ‘åˆ¶é˜ˆå€¼ï¼Œé»˜è®¤å€¼ä¸º 0.65ã€‚                                  |
| `-mask_thres`          | 0.5            | è®¾ç½®æ©ç é˜ˆå€¼ï¼Œé»˜è®¤å€¼ä¸º 0.5ã€‚                                           |
| `-debug_mode`          | 0              | è®¾ç½®è°ƒè¯•æ¨¡å¼ï¼Œé»˜è®¤å€¼ä¸º 0ï¼Œå¯é€‰å€¼ï¼š0/1ï¼Œ0ä¸ºä¸è°ƒè¯•ï¼Œ1ä¸ºè°ƒè¯•æ‰“å°ã€‚                                |

##### éƒ¨ç½²æ¨¡å‹å®ç°å›¾ç‰‡æ¨ç†

å›¾ç‰‡æ¨ç†ï¼Œè¯·å‚è€ƒä¸‹è¿°å‘½ä»¤ï¼Œ**æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹å‚æ•°**ï¼›

```shell
./yolo.elf -model_type yolov5 -task_type classify -task_mode image -image_path test.jpg -kmodel_path yolov5n_cat_dog_cls.kmodel -labels_txt_filepath cat_dog_labels.txt -conf_thres 0.5 -debug_mode 0
```

##### éƒ¨ç½²æ¨¡å‹å®ç°è§†é¢‘æ¨ç†

è§†é¢‘æ¨ç†ï¼Œè¯·å‚è€ƒä¸‹è¿°å‘½ä»¤ï¼Œ**æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹å‚æ•°**ï¼›

```shell
./yolo.elf -ai_frame_width 640 -ai_frame_height 360 -display_mode 0 -model_type yolov5 -task_type classify -task_mode video -kmodel_path yolov5n_cat_dog_cls.kmodel -labels_txt_filepath cat_dog_labels.txt -conf_thres 0.5 -debug_mode 0
```

##### éƒ¨ç½²æ•ˆæœ

é€‰æ‹©ä¸¤å¼ çŒ«ç‹—å›¾ç‰‡ä½¿ç”¨kmodelè¿›è¡Œåˆ†ç±»ã€‚æ•ˆæœå¦‚ä¸‹å›¾ï¼š

![cat_dog_cls_res](https://www.kendryte.com/api/post/attachment?id=646)

### YOLOv8è·Œå€’æ£€æµ‹

åŸºäºYOLOv8æ¨¡å‹å®ç°è·Œå€’æ£€æµ‹æ¨¡å‹åœ¨K230ä¸Šçš„éƒ¨ç½²ã€‚

#### YOLOv8æºç åŠè®­ç»ƒç¯å¢ƒæ­å»º

`YOLOv8` è®­ç»ƒç¯å¢ƒæ­å»ºè¯·å‚è€ƒ[ultralytics/ultralytics: Ultralytics YOLO ğŸš€ (github.com)](https://github.com/ultralytics/ultralytics)

```shell
# Pip install the ultralytics package including all requirements in a Python>=3.8 environment with PyTorch>=1.8.
pip install ultralytics
```

å¦‚æœæ‚¨å·²æ­å»ºå¥½ç¯å¢ƒï¼Œè¯·å¿½ç•¥æ­¤æ­¥éª¤ã€‚

#### è®­ç»ƒæ•°æ®å‡†å¤‡

ä¸‹è½½æä¾›çš„è·Œå€’æ£€æµ‹æ•°æ®é›†ï¼Œå¹¶è§£å‹ã€‚

```shell
cd yolov8
wget https://kendryte-download.canaan-creative.com/developer/k230/yolo_dataset/fall_det.zip
unzip fall_det.zip
```

âš ï¸ **windowsç³»ç»Ÿè¯·ç›´æ¥å¤åˆ¶é“¾æ¥åˆ°æµè§ˆå™¨ä¸‹è½½ï¼Œå¹¶è§£å‹åˆ°å¯¹åº”ç›®å½•**ã€‚

å¦‚æœæ‚¨å·²ä¸‹è½½å¥½æ•°æ®ï¼Œè¯·å¿½ç•¥æ­¤æ­¥éª¤ã€‚

#### ä½¿ç”¨YOLOv8è®­ç»ƒè·Œå€’æ£€æµ‹æ¨¡å‹

åœ¨ `yolov8` ç›®å½•ä¸‹æ‰§è¡Œå‘½ä»¤ï¼Œä½¿ç”¨ `yolov8` è®­ç»ƒè·Œå€’æ£€æµ‹æ¨¡å‹ï¼š

```shell
yolo detect train data=fall_det.yaml model=yolov8n.pt epochs=300 imgsz=320
```

#### è½¬æ¢è·Œå€’æ£€æµ‹kmodel

æ¨¡å‹è½¬æ¢éœ€è¦åœ¨è®­ç»ƒç¯å¢ƒå®‰è£…å¦‚ä¸‹åº“ï¼š

```Shell
# linuxå¹³å°ï¼šnncaseå’Œnncase-kpuå¯ä»¥åœ¨çº¿å®‰è£…ï¼Œnncase-2.x éœ€è¦å®‰è£… dotnet-7
sudo apt-get install -y dotnet-sdk-7.0
pip install --upgrade pip
pip install nncase==2.9.0
pip install nncase-kpu==2.9.0

# windowså¹³å°ï¼šè¯·è‡ªè¡Œå®‰è£…dotnet-7å¹¶æ·»åŠ ç¯å¢ƒå˜é‡,æ”¯æŒä½¿ç”¨pipåœ¨çº¿å®‰è£…nncaseï¼Œä½†æ˜¯nncase-kpuåº“éœ€è¦ç¦»çº¿å®‰è£…ï¼Œåœ¨https://github.com/kendryte/nncase/releasesä¸‹è½½nncase_kpu-2.*-py2.py3-none-win_amd64.whl
# è¿›å…¥å¯¹åº”çš„pythonç¯å¢ƒï¼Œåœ¨nncase_kpu-2.*-py2.py3-none-win_amd64.whlä¸‹è½½ç›®å½•ä¸‹ä½¿ç”¨pipå®‰è£…
pip install nncase_kpu-2.*-py2.py3-none-win_amd64.whl

# é™¤nncaseå’Œnncase-kpuå¤–ï¼Œè„šæœ¬è¿˜ç”¨åˆ°çš„å…¶ä»–åº“åŒ…æ‹¬ï¼š
pip install onnx
pip install onnxruntime
pip install onnxsim
```

ä¸‹è½½è„šæœ¬å·¥å…·ï¼Œå°†æ¨¡å‹è½¬æ¢è„šæœ¬å·¥å…· `test_yolov8.zip` è§£å‹åˆ° `yolov8` ç›®å½•ä¸‹ï¼›

```shell
wget https://kendryte-download.canaan-creative.com/developer/k230/yolo_files/test_yolov8.zip
unzip test_yolov8.zip
```

æŒ‰ç…§å¦‚ä¸‹å‘½ä»¤ï¼Œå¯¹ `runs/detect/train/weights` ä¸‹çš„ `pt` æ¨¡å‹å…ˆå¯¼å‡ºä¸º `onnx` æ¨¡å‹ï¼Œå†è½¬æ¢æˆ `kmodel` æ¨¡å‹ï¼š

```shell
# å¯¼å‡ºonnxï¼Œptæ¨¡å‹è·¯å¾„è¯·è‡ªè¡Œé€‰æ‹©
yolo export model=runs/detect/train/weights/best.pt format=onnx imgsz=320
cd test_yolov8/detect
# å°†testç›®å½•ä¸‹çš„å›¾ç‰‡æ¢æˆä½ è‡ªå·±çš„è®­ç»ƒæ•°æ®çš„ä¸€éƒ¨åˆ†ï¼Œè½¬æ¢kmodel,onnxæ¨¡å‹è·¯å¾„è¯·è‡ªè¡Œé€‰æ‹©ï¼Œç”Ÿæˆçš„kmodelåœ¨onnxæ¨¡å‹åŒçº§ç›®å½•ä¸‹
python to_kmodel.py --target k230 --model ../../runs/detect/train/weights/best.onnx --dataset ../test --input_width 320 --input_height 320 --ptq_option 1
cd ../../
```

ğŸ’¡ **æ¨¡å‹è½¬æ¢è„šæœ¬(to_kmodel.py)å‚æ•°è¯´æ˜**ï¼š

| å‚æ•°åç§°     | æè¿°     | è¯´æ˜                                                         | ç±»å‹  |
| ------------ | -------- | ------------------------------------------------------------| ----- |
| target       | ç›®æ ‡å¹³å° | å¯é€‰é¡¹ä¸ºk230/cpuï¼Œå¯¹åº”k230 kpuå’Œcpuï¼›                              | str   |
| model        | æ¨¡å‹è·¯å¾„ | å¾…è½¬æ¢çš„ONNXæ¨¡å‹è·¯å¾„ï¼›                                        | str   |
| dataset      | æ ¡å‡†å›¾ç‰‡é›†  | æ¨¡å‹è½¬æ¢æ—¶ä½¿ç”¨çš„å›¾ç‰‡æ•°æ®ï¼Œåœ¨é‡åŒ–é˜¶æ®µä½¿ç”¨ï¼Œå¯ä»¥ä»è®­ç»ƒé›†ä¸­å–ä¸€éƒ¨åˆ†å›¾ç‰‡æ›¿æ¢                   | str   |
| input_width  | è¾“å…¥å®½åº¦ | æ¨¡å‹è¾“å…¥çš„å®½åº¦                                             | int   |
| input_height | è¾“å…¥é«˜åº¦ | æ¨¡å‹è¾“å…¥çš„é«˜åº¦                                             | int   |
| ptq_option   | é‡åŒ–æ–¹å¼ | dataå’Œweightsçš„é‡åŒ–æ–¹å¼ï¼Œ0ä¸º[uint8,uint8], 1ä¸º[uint8,int16], 2ä¸º[int16,uint8] | 0/1/2 |

#### åœ¨k230ä¸Šä½¿ç”¨RT-Smartéƒ¨ç½²æ¨¡å‹

##### æ­å»ºç¼–è¯‘ç¯å¢ƒ

ğŸ’¡ **å›ºä»¶ä»‹ç»**ï¼šè¯·å‚è€ƒä¸‹é¢æ–‡æ¡£ä¸­çš„æ­¥éª¤æ­å»ºç¼–è¯‘ç¯å¢ƒï¼Œå¹¶ç¼–è¯‘å›ºä»¶ï¼Œä»¥ä¿è¯**æœ€æ–°çš„ç‰¹æ€§**è¢«æ”¯æŒï¼æ–‡æ¡£æ•™ç¨‹è§ï¼š[å›ºä»¶ç¼–è¯‘](./userguide/how_to_build.md)ã€‚

##### yoloç¼–è¯‘

è¿›å…¥åˆ°`src/rtsmart/examples/YOLO`ç›®å½•ä¸‹ï¼Œæ‰§è¡Œ`build_app.sh`ï¼Œç¼–è¯‘ç”Ÿæˆçš„å›ºä»¶åœ¨`k230_bin`ç›®å½•ä¸‹ã€‚

##### æ¨¡å‹æ–‡ä»¶æ‹·è´

å¼€å‘æ¿çƒ§å½•å›ºä»¶ä¸Šç”µåï¼Œå¯ä»¥åœ¨ç£ç›˜å¤„å‘ç°è™šæ‹ŸUç›˜`CanMV`,ç£ç›˜è¢«åˆ†ä¸º`/sdcard`å’Œ`/data`ä¸¤ä¸ªåˆ†åŒºï¼Œå°†è½¬æ¢å¥½çš„`kmodel`å’Œç¼–è¯‘çš„å¯æ‰§è¡Œ`elfæ–‡ä»¶`ä»¥åŠæµ‹è¯•å›¾ç‰‡ã€æ ‡ç­¾æ–‡ä»¶ï¼ˆtxtæ ¼å¼ï¼Œæ¯è¡Œè¡¨ç¤ºä¸€ç±»ï¼‰æ‹·è´åˆ°å¼€å‘æ¿ä¸ŠæŸä¸€ä¸ªç›®å½•ä¸­ã€‚

##### YOLO æ¨¡å—

`YOLO` æ¨¡å—æ˜¯åŸºäº`YOLOç³»åˆ—æ¨¡å‹`å¼€å‘çš„éƒ¨ç½²ä»£ç ï¼Œå®ç°äº†æ­¤ç±»æ¨¡å‹çš„éƒ¨ç½²è¿‡ç¨‹ï¼Œå…¶æ”¯æŒçš„æƒ…å†µå¦‚ä¸‹ï¼š

- é›†æˆäº† `YOLOv5ã€YOLOv8ã€YOLO11` çš„ä¸‰ç§æ¨¡å‹ï¼›
- æ”¯æŒå››ç±»ä»»åŠ¡ï¼Œå…¶ä¸­`YOLOv5`æ”¯æŒåˆ†ç±»(classify)ã€æ£€æµ‹(detect)ã€åˆ†å‰²(segment)ä¸‰ç§ï¼Œ`YOLOv8å’ŒYOLO11`æ”¯æŒåˆ†ç±»(classify)ã€æ£€æµ‹(detect)ã€åˆ†å‰²(segment)ã€æ—‹è½¬ç›®æ ‡æ£€æµ‹(obb)å››ç§ä»»åŠ¡ï¼›
- æ”¯æŒä¸¤ç§æ¨ç†æ¨¡å¼ï¼ŒåŒ…æ‹¬å›¾ç‰‡(image)å’Œè§†é¢‘æµ(video)ï¼›
- æ”¯æŒä¸‰ç§æ˜¾ç¤ºæ¨¡å¼ï¼ŒåŒ…æ‹¬`LT9611 (hdmi,1920Ã—1080)`,`ST7701 (lcdå±å¹•,800Ã—480)`,`HX8377 (lcdå±å¹•,1920Ã—1080)`ï¼›

- **å‚æ•°è¯´æ˜**

| å‚æ•°åç§°               | é»˜è®¤å€¼          | è¯´æ˜                                                                 |
|------------------------|----------------|----------------------------------------------------------------------|
| `-ai_frame_width`      | 640            | è®¾ç½® AI å¸§çš„å®½åº¦ï¼Œé»˜è®¤å€¼ä¸º 640ï¼Œæ‚¨å¯ä»¥è‡ªå·±é€‰æ‹©ä½¿ç”¨çš„å€¼ã€‚                                      |
| `-ai_frame_height`     | 360            | è®¾ç½® AI å¸§çš„é«˜åº¦ï¼Œé»˜è®¤å€¼ä¸º 360ï¼Œæ‚¨å¯ä»¥è‡ªå·±é€‰æ‹©ä½¿ç”¨çš„å€¼ã€‚                                      |
| `-display_mode`        | 0              | è®¾ç½®æ˜¾ç¤ºæ¨¡å¼ï¼Œé»˜è®¤å€¼ä¸º 0ï¼š<br> - æ¨¡å¼ 0: LT9611 <br> - æ¨¡å¼ 1: ST7701 <br> - æ¨¡å¼ 2: HX8377 |
| `-model_type`          | yolov8         | è®¾ç½®æ¨¡å‹ç±»å‹ï¼Œé»˜è®¤å€¼ä¸º yolov8ï¼Œå¯é€‰å€¼ï¼šyolov5/yolov8/yolo11ã€‚          |
| `-task_type`           | detect         | è®¾ç½®ä»»åŠ¡ç±»å‹ï¼Œé»˜è®¤å€¼ä¸º detectï¼Œå¯é€‰å€¼ï¼šclassify/detect/segmentã€‚       |
| `-task_mode`           | video          | è®¾ç½®ä»»åŠ¡æ¨¡å¼ï¼Œé»˜è®¤å€¼ä¸º videoï¼Œå¯é€‰å€¼ï¼šimage/video |
| `-image_path`          | test.jpg       | è®¾ç½®å›¾åƒè·¯å¾„ï¼Œé»˜è®¤å€¼ä¸º test.jpgã€‚                                      |
| `-kmodel_path`         | yolov8n.kmodel | è®¾ç½® kmodel è·¯å¾„ï¼Œé»˜è®¤å€¼ä¸º yolov8n.kmodelã€‚                            |
| `-labels_txt_filepath` | coco_labels.txt| è®¾ç½®æ ‡ç­¾æ–‡æœ¬æ–‡ä»¶è·¯å¾„ï¼Œé»˜è®¤å€¼ä¸º coco_labels.txtï¼Œæ¯ä¸ªæ ‡ç­¾ç‹¬å ä¸€è¡Œã€‚                        |
| `-conf_thres`          | 0.35           | è®¾ç½®ç½®ä¿¡åº¦é˜ˆå€¼ï¼Œé»˜è®¤å€¼ä¸º 0.35ã€‚                                        |
| `-nms_thres`           | 0.65           | è®¾ç½®éæå¤§å€¼æŠ‘åˆ¶é˜ˆå€¼ï¼Œé»˜è®¤å€¼ä¸º 0.65ã€‚                                  |
| `-mask_thres`          | 0.5            | è®¾ç½®æ©ç é˜ˆå€¼ï¼Œé»˜è®¤å€¼ä¸º 0.5ã€‚                                           |
| `-debug_mode`          | 0              | è®¾ç½®è°ƒè¯•æ¨¡å¼ï¼Œé»˜è®¤å€¼ä¸º 0ï¼Œå¯é€‰å€¼ï¼š0/1ï¼Œ0ä¸ºä¸è°ƒè¯•ï¼Œ1ä¸ºè°ƒè¯•æ‰“å°ã€‚                                |

##### éƒ¨ç½²æ¨¡å‹å®ç°å›¾ç‰‡æ¨ç†

å›¾ç‰‡æ¨ç†ï¼Œè¯·å‚è€ƒä¸‹è¿°å‘½ä»¤ï¼Œ**æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹å‚æ•°**ï¼›

```shell
./yolo.elf -model_type yolov8 -task_type detect -task_mode image -image_path test.jpg -kmodel_path yolov8n_fall_det.kmodel -labels_txt_filepath fall_labels.txt -conf_thres 0.5 -nms_thres 0.45 -debug_mode 0
```

##### éƒ¨ç½²æ¨¡å‹å®ç°è§†é¢‘æ¨ç†

è§†é¢‘æ¨ç†ï¼Œè¯·å‚è€ƒä¸‹è¿°å‘½ä»¤ï¼Œ**æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹å‚æ•°**ï¼›

```shell
./yolo.elf -ai_frame_width 640 -ai_frame_height 360 -display_mode 0 -model_type yolov8 -task_type detect -task_mode video -kmodel_path yolov8n_fall_det.kmodel -labels_txt_filepath fall_labels.txt -conf_thres 0.5 -nms_thres 0.45 -debug_mode 0
```

##### éƒ¨ç½²æ•ˆæœ

é€‰æ‹©ä¸€å¼ è·Œå€’å›¾ç‰‡ä½¿ç”¨kmodelè¿›è¡Œè·Œå€’æ£€æµ‹ã€‚åŸå›¾å’Œæ¨ç†ç»“æœçš„å¯¹æ¯”å¦‚ä¸‹å›¾ï¼š

![fall_det_res](https://www.kendryte.com/api/post/attachment?id=647)

### YOLO11æ°´æœåˆ†å‰²

#### YOLO11æºç åŠè®­ç»ƒç¯å¢ƒæ­å»º

`YOLO11` è®­ç»ƒç¯å¢ƒæ­å»ºè¯·å‚è€ƒ[ultralytics/ultralytics: Ultralytics YOLO ğŸš€ (github.com)](https://github.com/ultralytics/ultralytics)

```shell
# Pip install the ultralytics package including all requirements in a Python>=3.8 environment with PyTorch>=1.8.
pip install ultralytics
```

å¦‚æœæ‚¨å·²æ­å»ºå¥½ç¯å¢ƒï¼Œè¯·å¿½ç•¥æ­¤æ­¥éª¤ã€‚

#### è®­ç»ƒæ•°æ®å‡†å¤‡

ä¸‹è½½æä¾›çš„æ°´æœåˆ†å‰²æ•°æ®é›†ï¼Œå¹¶è§£å‹ã€‚

```shell
cd yolo11
wget https://kendryte-download.canaan-creative.com/developer/k230/yolo_dataset/fruit_seg.zip
unzip fruit_seg.zip
```

âš ï¸ **windowsç³»ç»Ÿè¯·ç›´æ¥å¤åˆ¶é“¾æ¥åˆ°æµè§ˆå™¨ä¸‹è½½ï¼Œå¹¶è§£å‹åˆ°å¯¹åº”ç›®å½•**ã€‚

å¦‚æœæ‚¨å·²ä¸‹è½½å¥½æ•°æ®ï¼Œè¯·å¿½ç•¥æ­¤æ­¥éª¤ã€‚

#### ä½¿ç”¨YOLO11è®­ç»ƒæ°´æœåˆ†å‰²æ¨¡å‹

åœ¨ `yolo11` ç›®å½•ä¸‹æ‰§è¡Œå‘½ä»¤ï¼Œä½¿ç”¨ `yolo11` è®­ç»ƒä¸‰ç±»æ°´æœåˆ†å‰²æ¨¡å‹ï¼š

```shell
yolo segment train data=fruits_seg.yaml model=yolo11n-seg.pt epochs=100 imgsz=320
```

#### è½¬æ¢æ°´æœåˆ†å‰²kmodel

æ¨¡å‹è½¬æ¢éœ€è¦åœ¨è®­ç»ƒç¯å¢ƒå®‰è£…å¦‚ä¸‹åº“ï¼š

```Shell
# linuxå¹³å°ï¼šnncaseå’Œnncase-kpuå¯ä»¥åœ¨çº¿å®‰è£…ï¼Œnncase-2.x éœ€è¦å®‰è£… dotnet-7
sudo apt-get install -y dotnet-sdk-7.0
pip install --upgrade pip
pip install nncase==2.9.0
pip install nncase-kpu==2.9.0

# windowså¹³å°ï¼šè¯·è‡ªè¡Œå®‰è£…dotnet-7å¹¶æ·»åŠ ç¯å¢ƒå˜é‡,æ”¯æŒä½¿ç”¨pipåœ¨çº¿å®‰è£…nncaseï¼Œä½†æ˜¯nncase-kpuåº“éœ€è¦ç¦»çº¿å®‰è£…ï¼Œåœ¨https://github.com/kendryte/nncase/releasesä¸‹è½½nncase_kpu-2.*-py2.py3-none-win_amd64.whl
# è¿›å…¥å¯¹åº”çš„pythonç¯å¢ƒï¼Œåœ¨nncase_kpu-2.*-py2.py3-none-win_amd64.whlä¸‹è½½ç›®å½•ä¸‹ä½¿ç”¨pipå®‰è£…
pip install nncase_kpu-2.*-py2.py3-none-win_amd64.whl

# é™¤nncaseå’Œnncase-kpuå¤–ï¼Œè„šæœ¬è¿˜ç”¨åˆ°çš„å…¶ä»–åº“åŒ…æ‹¬ï¼š
pip install onnx
pip install onnxruntime
pip install onnxsim
```

ä¸‹è½½è„šæœ¬å·¥å…·ï¼Œå°†æ¨¡å‹è½¬æ¢è„šæœ¬å·¥å…· `test_yolo11.zip` è§£å‹åˆ° `yolo11` ç›®å½•ä¸‹ï¼›

```shell
wget https://kendryte-download.canaan-creative.com/developer/k230/yolo_files/test_yolo11.zip
unzip test_yolo11.zip
```

æŒ‰ç…§å¦‚ä¸‹å‘½ä»¤ï¼Œå¯¹ `runs/segment/train/weights` ä¸‹çš„ `pt` æ¨¡å‹å…ˆå¯¼å‡ºä¸º `onnx` æ¨¡å‹ï¼Œå†è½¬æ¢æˆ `kmodel` æ¨¡å‹ï¼š

```shell
# å¯¼å‡ºonnxï¼Œptæ¨¡å‹è·¯å¾„è¯·è‡ªè¡Œé€‰æ‹©
yolo export model=runs/segment/train/weights/best.pt format=onnx imgsz=320
cd test_yolo11/segment
# testä¸­çš„å›¾ç‰‡å¯ä»¥ä»è®­ç»ƒé›†ä¸­é€‰å–ä¸€éƒ¨åˆ†æ›¿æ¢ï¼Œè½¬æ¢kmodel,onnxæ¨¡å‹è·¯å¾„è¯·è‡ªè¡Œé€‰æ‹©ï¼Œç”Ÿæˆçš„kmodelåœ¨onnxæ¨¡å‹åŒçº§ç›®å½•ä¸‹
python to_kmodel.py --target k230 --model ../../runs/segment/train/weights/best.onnx --dataset ../test --input_width 320 --input_height 320 --ptq_option 1
cd ../../
```

ğŸ’¡ **æ¨¡å‹è½¬æ¢è„šæœ¬(to_kmodel.py)å‚æ•°è¯´æ˜**ï¼š

| å‚æ•°åç§°     | æè¿°     | è¯´æ˜                                                         | ç±»å‹  |
| ------------ | -------- | ------------------------------------------------------------| ----- |
| target       | ç›®æ ‡å¹³å° | å¯é€‰é¡¹ä¸ºk230/cpuï¼Œå¯¹åº”k230 kpuå’Œcpuï¼›                              | str   |
| model        | æ¨¡å‹è·¯å¾„ | å¾…è½¬æ¢çš„ONNXæ¨¡å‹è·¯å¾„ï¼›                                        | str   |
| dataset      | æ ¡å‡†å›¾ç‰‡é›†  | æ¨¡å‹è½¬æ¢æ—¶ä½¿ç”¨çš„å›¾ç‰‡æ•°æ®ï¼Œåœ¨é‡åŒ–é˜¶æ®µä½¿ç”¨ï¼Œå¯ä»¥ä»è®­ç»ƒé›†ä¸­å–ä¸€éƒ¨åˆ†æ›¿æ¢                    | str   |
| input_width  | è¾“å…¥å®½åº¦ | æ¨¡å‹è¾“å…¥çš„å®½åº¦                                             | int   |
| input_height | è¾“å…¥é«˜åº¦ | æ¨¡å‹è¾“å…¥çš„é«˜åº¦                                             | int   |
| ptq_option   | é‡åŒ–æ–¹å¼ | dataå’Œweightsçš„é‡åŒ–æ–¹å¼ï¼Œ0ä¸º[uint8,uint8], 1ä¸º[uint8,int16], 2ä¸º[int16,uint8] | 0/1/2 |

#### åœ¨k230ä¸Šä½¿ç”¨RT-Smartéƒ¨ç½²æ¨¡å‹

##### æ­å»ºç¼–è¯‘ç¯å¢ƒ

ğŸ’¡ **å›ºä»¶ä»‹ç»**ï¼šè¯·å‚è€ƒä¸‹é¢æ–‡æ¡£ä¸­çš„æ­¥éª¤æ­å»ºç¼–è¯‘ç¯å¢ƒï¼Œå¹¶ç¼–è¯‘å›ºä»¶ï¼Œä»¥ä¿è¯**æœ€æ–°çš„ç‰¹æ€§**è¢«æ”¯æŒï¼æ–‡æ¡£æ•™ç¨‹è§ï¼š[å›ºä»¶ç¼–è¯‘](./userguide/how_to_build.md)ã€‚

##### yoloç¼–è¯‘

è¿›å…¥åˆ°`src/rtsmart/examples/YOLO`ç›®å½•ä¸‹ï¼Œæ‰§è¡Œ`build_app.sh`ï¼Œç¼–è¯‘ç”Ÿæˆçš„å›ºä»¶åœ¨`k230_bin`ç›®å½•ä¸‹ã€‚

##### æ¨¡å‹æ–‡ä»¶æ‹·è´

å¼€å‘æ¿çƒ§å½•å›ºä»¶ä¸Šç”µåï¼Œå¯ä»¥åœ¨ç£ç›˜å¤„å‘ç°è™šæ‹ŸUç›˜`CanMV`,ç£ç›˜è¢«åˆ†ä¸º`/sdcard`å’Œ`/data`ä¸¤ä¸ªåˆ†åŒºï¼Œå°†è½¬æ¢å¥½çš„`kmodel`å’Œç¼–è¯‘çš„å¯æ‰§è¡Œ`elfæ–‡ä»¶`ä»¥åŠæµ‹è¯•å›¾ç‰‡ã€æ ‡ç­¾æ–‡ä»¶ï¼ˆtxtæ ¼å¼ï¼Œæ¯è¡Œè¡¨ç¤ºä¸€ç±»ï¼‰æ‹·è´åˆ°å¼€å‘æ¿ä¸ŠæŸä¸€ä¸ªç›®å½•ä¸­ã€‚

##### YOLO æ¨¡å—

`YOLO` æ¨¡å—æ˜¯åŸºäº`YOLOç³»åˆ—æ¨¡å‹`å¼€å‘çš„éƒ¨ç½²ä»£ç ï¼Œå®ç°äº†æ­¤ç±»æ¨¡å‹çš„éƒ¨ç½²è¿‡ç¨‹ï¼Œå…¶æ”¯æŒçš„æƒ…å†µå¦‚ä¸‹ï¼š

- é›†æˆäº† `YOLOv5ã€YOLOv8ã€YOLO11` çš„ä¸‰ç§æ¨¡å‹ï¼›
- æ”¯æŒå››ç±»ä»»åŠ¡ï¼Œå…¶ä¸­`YOLOv5`æ”¯æŒåˆ†ç±»(classify)ã€æ£€æµ‹(detect)ã€åˆ†å‰²(segment)ä¸‰ç§ï¼Œ`YOLOv8å’ŒYOLO11`æ”¯æŒåˆ†ç±»(classify)ã€æ£€æµ‹(detect)ã€åˆ†å‰²(segment)ã€æ—‹è½¬ç›®æ ‡æ£€æµ‹(obb)å››ç§ä»»åŠ¡ï¼›
- æ”¯æŒä¸¤ç§æ¨ç†æ¨¡å¼ï¼ŒåŒ…æ‹¬å›¾ç‰‡(image)å’Œè§†é¢‘æµ(video)ï¼›
- æ”¯æŒä¸‰ç§æ˜¾ç¤ºæ¨¡å¼ï¼ŒåŒ…æ‹¬`LT9611 (hdmi,1920Ã—1080)`,`ST7701 (lcdå±å¹•,800Ã—480)`,`HX8377 (lcdå±å¹•,1920Ã—1080)`ï¼›

- **å‚æ•°è¯´æ˜**

| å‚æ•°åç§°               | é»˜è®¤å€¼          | è¯´æ˜                                                                 |
|------------------------|----------------|----------------------------------------------------------------------|
| `-ai_frame_width`      | 640            | è®¾ç½® AI å¸§çš„å®½åº¦ï¼Œé»˜è®¤å€¼ä¸º 640ï¼Œæ‚¨å¯ä»¥è‡ªå·±é€‰æ‹©ä½¿ç”¨çš„å€¼ã€‚                                      |
| `-ai_frame_height`     | 360            | è®¾ç½® AI å¸§çš„é«˜åº¦ï¼Œé»˜è®¤å€¼ä¸º 360ï¼Œæ‚¨å¯ä»¥è‡ªå·±é€‰æ‹©ä½¿ç”¨çš„å€¼ã€‚                                      |
| `-display_mode`        | 0              | è®¾ç½®æ˜¾ç¤ºæ¨¡å¼ï¼Œé»˜è®¤å€¼ä¸º 0ï¼š<br> - æ¨¡å¼ 0: LT9611 <br> - æ¨¡å¼ 1: ST7701 <br> - æ¨¡å¼ 2: HX8377 |
| `-model_type`          | yolov8         | è®¾ç½®æ¨¡å‹ç±»å‹ï¼Œé»˜è®¤å€¼ä¸º yolov8ï¼Œå¯é€‰å€¼ï¼šyolov5/yolov8/yolo11ã€‚          |
| `-task_type`           | detect         | è®¾ç½®ä»»åŠ¡ç±»å‹ï¼Œé»˜è®¤å€¼ä¸º detectï¼Œå¯é€‰å€¼ï¼šclassify/detect/segmentã€‚       |
| `-task_mode`           | video          | è®¾ç½®ä»»åŠ¡æ¨¡å¼ï¼Œé»˜è®¤å€¼ä¸º videoï¼Œå¯é€‰å€¼ï¼šimage/video |
| `-image_path`          | test.jpg       | è®¾ç½®å›¾åƒè·¯å¾„ï¼Œé»˜è®¤å€¼ä¸º test.jpgã€‚                                      |
| `-kmodel_path`         | yolov8n.kmodel | è®¾ç½® kmodel è·¯å¾„ï¼Œé»˜è®¤å€¼ä¸º yolov8n.kmodelã€‚                            |
| `-labels_txt_filepath` | coco_labels.txt| è®¾ç½®æ ‡ç­¾æ–‡æœ¬æ–‡ä»¶è·¯å¾„ï¼Œé»˜è®¤å€¼ä¸º coco_labels.txtï¼Œæ¯ä¸ªæ ‡ç­¾ç‹¬å ä¸€è¡Œã€‚                        |
| `-conf_thres`          | 0.35           | è®¾ç½®ç½®ä¿¡åº¦é˜ˆå€¼ï¼Œé»˜è®¤å€¼ä¸º 0.35ã€‚                                        |
| `-nms_thres`           | 0.65           | è®¾ç½®éæå¤§å€¼æŠ‘åˆ¶é˜ˆå€¼ï¼Œé»˜è®¤å€¼ä¸º 0.65ã€‚                                  |
| `-mask_thres`          | 0.5            | è®¾ç½®æ©ç é˜ˆå€¼ï¼Œé»˜è®¤å€¼ä¸º 0.5ã€‚                                           |
| `-debug_mode`          | 0              | è®¾ç½®è°ƒè¯•æ¨¡å¼ï¼Œé»˜è®¤å€¼ä¸º 0ï¼Œå¯é€‰å€¼ï¼š0/1ï¼Œ0ä¸ºä¸è°ƒè¯•ï¼Œ1ä¸ºè°ƒè¯•æ‰“å°ã€‚                                |

##### éƒ¨ç½²æ¨¡å‹å®ç°å›¾ç‰‡æ¨ç†

å›¾ç‰‡æ¨ç†ï¼Œè¯·å‚è€ƒä¸‹è¿°å‘½ä»¤ï¼Œ**æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹å‚æ•°**ï¼›

```shell
./yolo.elf -model_type yolo11 -task_type segment -task_mode image -image_path test.jpg -kmodel_path yolo11n_fruit_seg.kmodel -labels_txt_filepath fruit_labels.txt -conf_thres 0.5 -nms_thres 0.45 -mask_thres 0.5 -debug_mode 0
```

##### éƒ¨ç½²æ¨¡å‹å®ç°è§†é¢‘æ¨ç†

è§†é¢‘æ¨ç†ï¼Œè¯·å‚è€ƒä¸‹è¿°å‘½ä»¤ï¼Œ**æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹å‚æ•°**ï¼›

```shell
./yolo.elf -ai_frame_width 640 -ai_frame_height 360 -display_mode 0 -model_type yolo11 -task_type segment -task_mode video -kmodel_path yolo11n_fruit_seg.kmodel -labels_txt_filepath fruit_labels.txt -conf_thres 0.5 -nms_thres 0.45 -mask_thres 0.5 -debug_mode 0
```

##### éƒ¨ç½²æ•ˆæœ

é€‰æ‹©ä¸€å¼ æ°´æœå›¾ç‰‡ä½¿ç”¨kmodelè¿›è¡Œæ°´æœåˆ†å‰²ã€‚åŸå›¾å’Œæ¨ç†ç»“æœçš„å¯¹æ¯”å¦‚ä¸‹å›¾ï¼š

![fruit_seg_res](https://www.kendryte.com/api/post/attachment?id=648)

### YOLO11æ—‹è½¬ç›®æ ‡æ£€æµ‹

#### YOLO11æºç åŠè®­ç»ƒç¯å¢ƒæ­å»º

`YOLO11` è®­ç»ƒç¯å¢ƒæ­å»ºè¯·å‚è€ƒ[ultralytics/ultralytics: Ultralytics YOLO ğŸš€ (github.com)](https://github.com/ultralytics/ultralytics)

```shell
# Pip install the ultralytics package including all requirements in a Python>=3.8 environment with PyTorch>=1.8.
pip install ultralytics
```

å¦‚æœæ‚¨å·²æ­å»ºå¥½ç¯å¢ƒï¼Œè¯·å¿½ç•¥æ­¤æ­¥éª¤ã€‚

#### è®­ç»ƒæ•°æ®å‡†å¤‡

ä¸‹è½½æ¡Œé¢ç­¾å­—ç¬”æ—‹è½¬ç›®æ ‡æ£€æµ‹æ•°æ®é›†ï¼Œå¹¶è§£å‹ã€‚

```shell
cd yolo11
wget https://kendryte-download.canaan-creative.com/developer/k230/yolo_dataset/pen_obb.zip
unzip pen_obb.zip
```

âš ï¸ **windowsç³»ç»Ÿè¯·ç›´æ¥å¤åˆ¶é“¾æ¥åˆ°æµè§ˆå™¨ä¸‹è½½ï¼Œå¹¶è§£å‹åˆ°å¯¹åº”ç›®å½•**ã€‚

å¦‚æœæ‚¨å·²ä¸‹è½½å¥½æ•°æ®ï¼Œè¯·å¿½ç•¥æ­¤æ­¥éª¤ã€‚

#### ä½¿ç”¨YOLO11æ—‹è½¬ç›®æ ‡æ£€æµ‹æ¨¡å‹

åœ¨ `yolo11` ç›®å½•ä¸‹æ‰§è¡Œå‘½ä»¤ï¼Œä½¿ç”¨ `yolo11` è®­ç»ƒå•ç±»æ—‹è½¬ç›®æ ‡æ£€æµ‹æ¨¡å‹ï¼š

```shell
yolo obb train data=pen_obb.yaml model=yolo11n-obb.pt epochs=100 imgsz=320
```

#### è½¬æ¢æ—‹è½¬ç›®æ ‡æ£€æµ‹kmodel

æ¨¡å‹è½¬æ¢éœ€è¦åœ¨è®­ç»ƒç¯å¢ƒå®‰è£…å¦‚ä¸‹åº“ï¼š

```Shell
# linuxå¹³å°ï¼šnncaseå’Œnncase-kpuå¯ä»¥åœ¨çº¿å®‰è£…ï¼Œnncase-2.x éœ€è¦å®‰è£… dotnet-7
sudo apt-get install -y dotnet-sdk-7.0
pip install --upgrade pip
pip install nncase==2.9.0
pip install nncase-kpu==2.9.0

# windowså¹³å°ï¼šè¯·è‡ªè¡Œå®‰è£…dotnet-7å¹¶æ·»åŠ ç¯å¢ƒå˜é‡,æ”¯æŒä½¿ç”¨pipåœ¨çº¿å®‰è£…nncaseï¼Œä½†æ˜¯nncase-kpuåº“éœ€è¦ç¦»çº¿å®‰è£…ï¼Œåœ¨https://github.com/kendryte/nncase/releasesä¸‹è½½nncase_kpu-2.*-py2.py3-none-win_amd64.whl
# è¿›å…¥å¯¹åº”çš„pythonç¯å¢ƒï¼Œåœ¨nncase_kpu-2.*-py2.py3-none-win_amd64.whlä¸‹è½½ç›®å½•ä¸‹ä½¿ç”¨pipå®‰è£…
pip install nncase_kpu-2.*-py2.py3-none-win_amd64.whl

# é™¤nncaseå’Œnncase-kpuå¤–ï¼Œè„šæœ¬è¿˜ç”¨åˆ°çš„å…¶ä»–åº“åŒ…æ‹¬ï¼š
pip install onnx
pip install onnxruntime
pip install onnxsim
```

ä¸‹è½½è„šæœ¬å·¥å…·ï¼Œå°†æ¨¡å‹è½¬æ¢è„šæœ¬å·¥å…· `test_yolo11.zip` è§£å‹åˆ° `yolo11` ç›®å½•ä¸‹ï¼›

```shell
wget https://kendryte-download.canaan-creative.com/developer/k230/yolo_files/test_yolo11.zip
unzip test_yolo11.zip
```

æŒ‰ç…§å¦‚ä¸‹å‘½ä»¤ï¼Œå¯¹ `runs/obb/train/weights` ä¸‹çš„ `pt` æ¨¡å‹å…ˆå¯¼å‡ºä¸º `onnx` æ¨¡å‹ï¼Œå†è½¬æ¢æˆ `kmodel` æ¨¡å‹ï¼š

```shell
# å¯¼å‡ºonnxï¼Œptæ¨¡å‹è·¯å¾„è¯·è‡ªè¡Œé€‰æ‹©
yolo export model=runs/obb/train/weights/best.pt format=onnx imgsz=320
cd test_yolo11/obb
# testä¸‹å›¾ç‰‡å¯ä»¥ä»è®­ç»ƒé›†ä¸­é€‰æ‹©ä¸€éƒ¨åˆ†æ›¿æ¢ï¼Œè½¬æ¢kmodel,onnxæ¨¡å‹è·¯å¾„è¯·è‡ªè¡Œé€‰æ‹©ï¼Œç”Ÿæˆçš„kmodelåœ¨onnxæ¨¡å‹åŒçº§ç›®å½•ä¸‹
python to_kmodel.py --target k230 --model ../../runs/obb/train/weights/best.onnx --dataset ../test_obb --input_width 320 --input_height 320 --ptq_option 0
cd ../../
```

ğŸ’¡ **æ¨¡å‹è½¬æ¢è„šæœ¬(to_kmodel.py)å‚æ•°è¯´æ˜**ï¼š

| å‚æ•°åç§°     | æè¿°     | è¯´æ˜                                                         | ç±»å‹  |
| ------------ | -------- | ------------------------------------------------------------| ----- |
| target       | ç›®æ ‡å¹³å° | å¯é€‰é¡¹ä¸ºk230/cpuï¼Œå¯¹åº”k230 kpuå’Œcpuï¼›                              | str   |
| model        | æ¨¡å‹è·¯å¾„ | å¾…è½¬æ¢çš„ONNXæ¨¡å‹è·¯å¾„ï¼›                                        | str   |
| dataset      | æ ¡å‡†å›¾ç‰‡é›†  | æ¨¡å‹è½¬æ¢æ—¶ä½¿ç”¨çš„å›¾ç‰‡æ•°æ®ï¼Œåœ¨é‡åŒ–é˜¶æ®µä½¿ç”¨ï¼Œå¯ä»¥ä»è®­ç»ƒé›†ä¸­å–ä¸€éƒ¨åˆ†æ›¿æ¢                    | str   |
| input_width  | è¾“å…¥å®½åº¦ | æ¨¡å‹è¾“å…¥çš„å®½åº¦                                             | int   |
| input_height | è¾“å…¥é«˜åº¦ | æ¨¡å‹è¾“å…¥çš„é«˜åº¦                                             | int   |
| ptq_option   | é‡åŒ–æ–¹å¼ | dataå’Œweightsçš„é‡åŒ–æ–¹å¼ï¼Œ0ä¸º[uint8,uint8], 1ä¸º[uint8,int16], 2ä¸º[int16,uint8] | 0/1/2 |

#### åœ¨k230ä¸Šä½¿ç”¨RT-Smartéƒ¨ç½²æ¨¡å‹

##### æ­å»ºç¼–è¯‘ç¯å¢ƒ

ğŸ’¡ **å›ºä»¶ä»‹ç»**ï¼šè¯·å‚è€ƒä¸‹é¢æ–‡æ¡£ä¸­çš„æ­¥éª¤æ­å»ºç¼–è¯‘ç¯å¢ƒï¼Œå¹¶ç¼–è¯‘å›ºä»¶ï¼Œä»¥ä¿è¯**æœ€æ–°çš„ç‰¹æ€§**è¢«æ”¯æŒï¼æ–‡æ¡£æ•™ç¨‹è§ï¼š[å›ºä»¶ç¼–è¯‘](./userguide/how_to_build.md)ã€‚

##### yoloç¼–è¯‘

è¿›å…¥åˆ°`src/rtsmart/examples/YOLO`ç›®å½•ä¸‹ï¼Œæ‰§è¡Œ`build_app.sh`ï¼Œç¼–è¯‘ç”Ÿæˆçš„å›ºä»¶åœ¨`k230_bin`ç›®å½•ä¸‹ã€‚

##### æ¨¡å‹æ–‡ä»¶æ‹·è´

å¼€å‘æ¿çƒ§å½•å›ºä»¶ä¸Šç”µåï¼Œå¯ä»¥åœ¨ç£ç›˜å¤„å‘ç°è™šæ‹ŸUç›˜`CanMV`,ç£ç›˜è¢«åˆ†ä¸º`/sdcard`å’Œ`/data`ä¸¤ä¸ªåˆ†åŒºï¼Œå°†è½¬æ¢å¥½çš„`kmodel`å’Œç¼–è¯‘çš„å¯æ‰§è¡Œ`elfæ–‡ä»¶`ä»¥åŠæµ‹è¯•å›¾ç‰‡ã€æ ‡ç­¾æ–‡ä»¶ï¼ˆtxtæ ¼å¼ï¼Œæ¯è¡Œè¡¨ç¤ºä¸€ç±»ï¼‰æ‹·è´åˆ°å¼€å‘æ¿ä¸ŠæŸä¸€ä¸ªç›®å½•ä¸­ã€‚

##### YOLO æ¨¡å—

`YOLO` æ¨¡å—æ˜¯åŸºäº`YOLOç³»åˆ—æ¨¡å‹`å¼€å‘çš„éƒ¨ç½²ä»£ç ï¼Œå®ç°äº†æ­¤ç±»æ¨¡å‹çš„éƒ¨ç½²è¿‡ç¨‹ï¼Œå…¶æ”¯æŒçš„æƒ…å†µå¦‚ä¸‹ï¼š

- é›†æˆäº† `YOLOv5ã€YOLOv8ã€YOLO11` çš„ä¸‰ç§æ¨¡å‹ï¼›
- æ”¯æŒå››ç±»ä»»åŠ¡ï¼Œå…¶ä¸­`YOLOv5`æ”¯æŒåˆ†ç±»(classify)ã€æ£€æµ‹(detect)ã€åˆ†å‰²(segment)ä¸‰ç§ï¼Œ`YOLOv8å’ŒYOLO11`æ”¯æŒåˆ†ç±»(classify)ã€æ£€æµ‹(detect)ã€åˆ†å‰²(segment)ã€æ—‹è½¬ç›®æ ‡æ£€æµ‹(obb)å››ç§ä»»åŠ¡ï¼›
- æ”¯æŒä¸¤ç§æ¨ç†æ¨¡å¼ï¼ŒåŒ…æ‹¬å›¾ç‰‡(image)å’Œè§†é¢‘æµ(video)ï¼›
- æ”¯æŒä¸‰ç§æ˜¾ç¤ºæ¨¡å¼ï¼ŒåŒ…æ‹¬`LT9611 (hdmi,1920Ã—1080)`,`ST7701 (lcdå±å¹•,800Ã—480)`,`HX8377 (lcdå±å¹•,1920Ã—1080)`ï¼›

- **å‚æ•°è¯´æ˜**

| å‚æ•°åç§°               | é»˜è®¤å€¼          | è¯´æ˜                                                                 |
|------------------------|----------------|----------------------------------------------------------------------|
| `-ai_frame_width`      | 640            | è®¾ç½® AI å¸§çš„å®½åº¦ï¼Œé»˜è®¤å€¼ä¸º 640ï¼Œæ‚¨å¯ä»¥è‡ªå·±é€‰æ‹©ä½¿ç”¨çš„å€¼ã€‚                                      |
| `-ai_frame_height`     | 360            | è®¾ç½® AI å¸§çš„é«˜åº¦ï¼Œé»˜è®¤å€¼ä¸º 360ï¼Œæ‚¨å¯ä»¥è‡ªå·±é€‰æ‹©ä½¿ç”¨çš„å€¼ã€‚                                      |
| `-display_mode`        | 0              | è®¾ç½®æ˜¾ç¤ºæ¨¡å¼ï¼Œé»˜è®¤å€¼ä¸º 0ï¼š<br> - æ¨¡å¼ 0: LT9611 <br> - æ¨¡å¼ 1: ST7701 <br> - æ¨¡å¼ 2: HX8377 |
| `-model_type`          | yolov8         | è®¾ç½®æ¨¡å‹ç±»å‹ï¼Œé»˜è®¤å€¼ä¸º yolov8ï¼Œå¯é€‰å€¼ï¼šyolov5/yolov8/yolo11ã€‚          |
| `-task_type`           | detect         | è®¾ç½®ä»»åŠ¡ç±»å‹ï¼Œé»˜è®¤å€¼ä¸º detectï¼Œå¯é€‰å€¼ï¼šclassify/detect/segment/obbã€‚       |
| `-task_mode`           | video          | è®¾ç½®ä»»åŠ¡æ¨¡å¼ï¼Œé»˜è®¤å€¼ä¸º videoï¼Œå¯é€‰å€¼ï¼šimage/video |
| `-image_path`          | test.jpg       | è®¾ç½®å›¾åƒè·¯å¾„ï¼Œé»˜è®¤å€¼ä¸º test.jpgã€‚                                      |
| `-kmodel_path`         | yolov8n.kmodel | è®¾ç½® kmodel è·¯å¾„ï¼Œé»˜è®¤å€¼ä¸º yolov8n.kmodelã€‚                            |
| `-labels_txt_filepath` | coco_labels.txt| è®¾ç½®æ ‡ç­¾æ–‡æœ¬æ–‡ä»¶è·¯å¾„ï¼Œé»˜è®¤å€¼ä¸º coco_labels.txtï¼Œæ¯ä¸ªæ ‡ç­¾ç‹¬å ä¸€è¡Œã€‚                        |
| `-conf_thres`          | 0.35           | è®¾ç½®ç½®ä¿¡åº¦é˜ˆå€¼ï¼Œé»˜è®¤å€¼ä¸º 0.35ã€‚                                        |
| `-nms_thres`           | 0.65           | è®¾ç½®éæå¤§å€¼æŠ‘åˆ¶é˜ˆå€¼ï¼Œé»˜è®¤å€¼ä¸º 0.65ã€‚                                  |
| `-mask_thres`          | 0.5            | è®¾ç½®æ©ç é˜ˆå€¼ï¼Œé»˜è®¤å€¼ä¸º 0.5ã€‚                                           |
| `-debug_mode`          | 0              | è®¾ç½®è°ƒè¯•æ¨¡å¼ï¼Œé»˜è®¤å€¼ä¸º 0ï¼Œå¯é€‰å€¼ï¼š0/1ï¼Œ0ä¸ºä¸è°ƒè¯•ï¼Œ1ä¸ºè°ƒè¯•æ‰“å°ã€‚                                |

##### éƒ¨ç½²æ¨¡å‹å®ç°å›¾ç‰‡æ¨ç†

å›¾ç‰‡æ¨ç†ï¼Œè¯·å‚è€ƒä¸‹è¿°å‘½ä»¤ï¼Œ**æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹å‚æ•°**ï¼›

```shell
./yolo.elf -model_type yolo11 -task_type obb -task_mode image -image_path test.jpg -kmodel_path yolo11n_pen_obb.kmodel -labels_txt_filepath pen_labels.txt -conf_thres 0.5 -nms_thres 0.45 -debug_mode 0
```

##### éƒ¨ç½²æ¨¡å‹å®ç°è§†é¢‘æ¨ç†

è§†é¢‘æ¨ç†ï¼Œè¯·å‚è€ƒä¸‹è¿°å‘½ä»¤ï¼Œ**æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹å‚æ•°**ï¼›

```shell
./yolo.elf -ai_frame_width 640 -ai_frame_height 360 -display_mode 0 -model_type yolo11 -task_type obb -task_mode video -kmodel_path yolo11n_pen_obb.kmodel -labels_txt_filepath pen_labels.txt -conf_thres 0.5 -nms_thres 0.45 -debug_mode 0
```

##### éƒ¨ç½²æ•ˆæœ

é€‰æ‹©ä¸€å¼ æ¡Œé¢ç­¾å­—ç¬”å›¾ç‰‡ä½¿ç”¨kmodelè¿›è¡Œæ—‹è½¬ç›®æ ‡æ£€æµ‹ã€‚åŸå›¾å’Œæ¨ç†ç»“æœçš„å¯¹æ¯”å¦‚ä¸‹å›¾ï¼š

![pen_obb_res](https://www.kendryte.com/api/post/attachment?id=649)

## è¾…åŠ©å·¥å…·

### åœ¨çº¿è®­ç»ƒå¹³å°

#### äº‘è®­ç»ƒå¹³å°ç®€ä»‹

Canaanå¼€å‘è€…ç¤¾åŒºæ¨¡å‹è®­ç»ƒåŠŸèƒ½æ˜¯ä¸ºç®€åŒ–å¼€å‘æµç¨‹ï¼Œæé«˜å¼€å‘æ•ˆç‡å¼€æ”¾çš„è®­ç»ƒå¹³å°ã€‚è¯¥å¹³å°ä½¿ç”¨æˆ·å…³æ³¨è§†è§‰åœºæ™¯çš„è½åœ°å®ç°ï¼Œæ›´åŠ å¿«æ·çš„å®Œæˆä»æ•°æ®æ ‡æ³¨åˆ°è·å¾—éƒ¨ç½²åŒ…ä¸­çš„KModelæ¨¡å‹çš„è¿‡ç¨‹ï¼Œå¹¶åœ¨æ­è½½å˜‰æ¥ ç§‘æŠ€KendryteÂ®ç³»åˆ—AIoTèŠ¯ç‰‡ä¸­K230ã€K230DèŠ¯ç‰‡å¼€å‘æ¿ä¸Šè¿›è¡Œéƒ¨ç½²ã€‚ç”¨æˆ·ä»…éœ€ä¸Šä¼ æ•°æ®é›†ï¼Œç®€å•çš„é…ç½®å‚æ•°å°±å¯ä»¥å¼€å§‹è®­ç»ƒäº†ã€‚

![plat](https://www.kendryte.com/api/post/attachment?id=600)

ğŸ“Œå¹³å°åœ°å€ï¼š**[å˜‰æ¥ äº‘è®­ç»ƒå¹³å°](https://www.kendryte.com/zh/training/start)**

ğŸ“Œå¹³å°ä½¿ç”¨æ–‡æ¡£å‚è€ƒï¼š**[å˜‰æ¥ äº‘è®­ç»ƒå¹³å°æ–‡æ¡£æ•™ç¨‹](https://www.kendryte.com/web/CloudPlatDoc.html)**ï¼Œè¯·æ³¨æ„æ•°æ®é›†çš„æ ¼å¼ï¼

#### æ”¯æŒä»»åŠ¡ä»‹ç»

äº‘è®­ç»ƒå¹³å°ä¸­å¯¹äºK230ç³»åˆ—èŠ¯ç‰‡æ”¯æŒçš„è§†è§‰ä»»åŠ¡æœ‰7ç§ï¼Œä»»åŠ¡ä»‹ç»å¦‚ä¸‹è¡¨ï¼š

ğŸ’¡ **ä»»åŠ¡ä»‹ç»**ï¼š

| ä»»åŠ¡åç§°  | ä»»åŠ¡è¯´æ˜                                                                                                           |
| ----- | --------------------------------------------------------------------------------------------------------------------- |
| å›¾åƒåˆ†ç±»  | å¯¹å›¾ç‰‡è¿›è¡Œåˆ†ç±»ï¼Œå¾—åˆ°å›¾ç‰‡çš„ç±»åˆ«ç»“æœå’Œåˆ†æ•°ã€‚                                                                            |
| å›¾åƒæ£€æµ‹  | åœ¨å›¾ç‰‡ä¸­æ£€æµ‹å‡ºç›®æ ‡ç‰©ä½“ï¼Œå¹¶ç»™å‡ºç‰©ä½“çš„ä½ç½®ä¿¡æ¯ã€ç±»åˆ«ä¿¡æ¯å’Œåˆ†æ•°ã€‚                                                          |
| è¯­ä¹‰åˆ†å‰²  | å¯¹å›¾ç‰‡ä¸­çš„ç›®æ ‡åŒºåŸŸè¿›è¡Œåˆ†å‰²ï¼Œå°†å›¾ç‰‡ä¸­çš„ä¸åŒæ ‡ç­¾åŒºåŸŸåˆ‡å‰²å‡ºæ¥ï¼Œå±äºåƒç´ çº§ä»»åŠ¡ã€‚                                              |
| OCRæ£€æµ‹ | åœ¨å›¾ç‰‡ä¸­æ£€æµ‹å‡ºæ–‡æœ¬åŒºåŸŸï¼Œå¹¶ç»™å‡ºæ–‡æœ¬åŒºåŸŸçš„ä½ç½®ä¿¡æ¯ã€‚                                                                        |
| OCRè¯†åˆ« | åœ¨å›¾ç‰‡ä¸­è¯†åˆ«å‡ºæ–‡æœ¬å†…å®¹ã€‚                                                                                                |
| åº¦é‡å­¦ä¹   | è®­ç»ƒå¯ä»¥å°†å›¾ç‰‡ç‰¹å¾åŒ–çš„æ¨¡å‹ï¼Œä½¿ç”¨è¯¥æ¨¡å‹åˆ›å»ºç‰¹å¾åº“ï¼Œé€šè¿‡ç‰¹å¾å¯¹æ¯”ï¼Œåœ¨ä¸é‡æ–°è®­ç»ƒæ¨¡å‹çš„å‰æä¸‹å¯¹æ–°çš„ç±»åˆ«è¿›è¡Œåˆ†ç±»ï¼Œä¹Ÿå¯ç§°ä¸ºè‡ªå­¦ä¹ ã€‚   |
| å¤šæ ‡ç­¾åˆ†ç±» | å¯¹å›¾ç‰‡è¿›è¡Œå¤šç±»åˆ«åˆ†ç±»ï¼Œä¸€äº›å›¾ç‰‡å¯èƒ½ä¸åªæ˜¯å±äºæŸä¸ªå•ä¸€çš„ç±»åˆ«ï¼Œå¤©ç©ºå’Œå¤§æµ·å¯ä»¥åŒæ—¶å­˜åœ¨ï¼Œå¾—åˆ°å›¾ç‰‡çš„å¤šæ ‡ç­¾åˆ†ç±»ç»“æœã€‚               |

#### éƒ¨ç½²æ­¥éª¤

##### éƒ¨ç½²åŒ…è¯´æ˜

è®­ç»ƒç»“æŸåå¯ä»¥ä¸‹è½½å¯¹åº”è®­ç»ƒä»»åŠ¡çš„éƒ¨ç½²åŒ…ï¼Œä¸‹è½½çš„éƒ¨ç½²zipåŒ…è§£å‹åï¼Œç›®å½•å¦‚ä¸‹ï¼š

```shell
ğŸ“¦ task_name
â”œâ”€â”€ ğŸ“ **_result
â”‚   â”œâ”€â”€ test_0.jpg
â”‚   â”œâ”€â”€ test_1.jpg
â”‚   â””â”€â”€...
â”œâ”€â”€ mp_deployment_source
â”œâ”€â”€ **_image_1_2_2.py
â”œâ”€â”€ **_image_1_3.py
â”œâ”€â”€ **_video_1_2_2.py
â”œâ”€â”€ **_video_1_3.py
â””â”€â”€ README.pdf
```

å†…å®¹å¦‚å›¾æ‰€ç¤ºï¼š

![éƒ¨ç½²åŒ…](https://www.kendryte.com/api/post/attachment?id=657)

å…¶ä¸­`mp_deployment_source`å³æ˜¯åœ¨K230é•œåƒä¸Šéƒ¨ç½²çš„ä»£ç åŒ…ï¼Œå†…éƒ¨åŒ…å«éƒ¨ç½²çš„é…ç½®æ–‡ä»¶å’Œéƒ¨ç½²çš„KModelæ¨¡å‹ã€‚æ³¨æ„ï¼šå¹³å°ç”Ÿæˆçš„é…ç½®æ–‡ä»¶`deploy_config.json`å’Œ`***.kmodel`æ˜¯åœ¨k230ä¸Šéƒ¨ç½²çš„å…³é”®,å®ƒä»¬åœ¨å„ç§SDKä¸­å‡å¯ç”¨ã€‚

##### æ–‡ä»¶æ‹·è´

âœ… **å›ºä»¶é€‰æ‹©**ï¼šè¯·å‚è€ƒä¸‹é¢æ–‡æ¡£ä¸­çš„æ­¥éª¤æ­å»ºç¼–è¯‘ç¯å¢ƒï¼Œå¹¶ç¼–è¯‘å›ºä»¶ï¼Œä»¥ä¿è¯**æœ€æ–°çš„ç‰¹æ€§**è¢«æ”¯æŒï¼æ–‡æ¡£æ•™ç¨‹è§ï¼š[å›ºä»¶ç¼–è¯‘](./userguide/how_to_build.md)ã€‚

âœ… **å›ºä»¶çƒ§å½•**ï¼š æŒ‰ç…§å¼€å‘æ¿ç±»å‹çƒ§å½•å›ºä»¶ï¼Œå›ºä»¶çƒ§å½•å‚è€ƒï¼š[å›ºä»¶çƒ§å½•](./userguide/how_to_flash.md)ã€‚

âœ… **éƒ¨ç½²ä»£ç **ï¼šéƒ¨ç½²ä»£ç ä½äºç¼–è¯‘ç¯å¢ƒä¸‹`rtos_sdk/src/rtsmart/examples/cloudplat_deploy_code`,éœ€è¦è¿›å…¥è¯¥ç›®å½•æ‰§è¡Œ`./build.sh`å®Œæˆç¼–è¯‘ï¼Œç¼–è¯‘äº§ç‰©ä½äº`k230_bin`ç›®å½•ä¸‹ï¼Œä½¿ç”¨æ–¹æ³•å‚è€ƒè¯¥ç›®å½•ä¸‹çš„`README.md`ã€‚

##### è„šæœ¬è¿è¡Œ

**å‚æ•°é…ç½®**ï¼š

æ‚¨å¯ä»¥åœ¨`common_files`ä¸­çš„`setting.h`é…ç½®å‚æ•°ï¼Œå…³äºå‚æ•°é…ç½®çš„è§£æå¦‚ä¸‹ï¼Œä¸»è¦ç”¨äºé…ç½®å±å¹•æ˜¾ç¤ºï¼š

|å®å®šä¹‰å‚æ•°|è¯´æ˜|
|:-:|:-:|
|`ISP_WIDTH`|ISPè¾“å‡ºå®½åº¦|
|`ISP_HEIGHT`|ISPè¾“å‡ºé«˜åº¦|
|`DISPLAY_MODE`|æ˜¾ç¤ºæ¨¡å¼ï¼Œ0ä¸º1920Ã—1080 LT9611ï¼Œ1ä¸º800Ã—480 ST7701|
|`DISPLAY_WIDTH`|æ˜¾ç¤ºå±å¹•å®½åº¦|
|`DISPLAY_HEIGHT`|æ˜¾ç¤ºå±å¹•é«˜åº¦|
|`AI_FRAME_WIDTH`|AIæ¨ç†å¸§å®½åº¦|
|`AI_FRAME_HEIGHT`|AIæ¨ç†å¸§é«˜åº¦|
|`AI_FRAME_CHANNEL`|AIæ¨ç†å¸§é€šé“æ•°|
|`USE_OSD`|æ˜¯å¦ä½¿ç”¨OSDï¼Œ0ä¸ºä¸ä½¿ç”¨ï¼Œ1ä¸ºä½¿ç”¨|
|`OSD_WIDTH`|OSDå›¾å±‚å®½åº¦,ç”¨äºæ˜¾ç¤ºAIæ¨ç†ç»“æœ|
|`OSD_HEIGHT`|OSDå›¾å±‚é«˜åº¦,ç”¨äºæ˜¾ç¤ºAIæ¨ç†ç»“æœ|
|`OSD_CHANNEL`|OSDå›¾å±‚é€šé“æ•°|

**æºç ç¼–è¯‘**ï¼š

è¿›å…¥`src/rtsmart/examples/cloudplat_deploy_code`ç›®å½•

```shell
# è¿›å…¥ç›®å½•
cd cloudplat_deploy_code

# ç¼–è¯‘æ–‡ä»¶,ä¼šåœ¨k230_binç›®å½•ä¸‹å¾—åˆ°æ‰€æœ‰çš„ä»»åŠ¡ç¼–è¯‘elfæ–‡ä»¶
./build.sh

# å¦‚æœåªæƒ³ç¼–è¯‘æŸä¸€ä¸ªä»»åŠ¡çš„éƒ¨ç½²æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨./build.sh <ä»»åŠ¡å>
./build.sh classification
./build.sh detection
...
```

ç¼–è¯‘äº§ç‰©åœ¨ `k230_bin` ç›®å½•ä¸‹ã€‚

**ä¸Šæ¿éƒ¨ç½²**ï¼š

å°†å¾—åˆ°çš„`elfæ–‡ä»¶`ã€å­—ä½“æ–‡ä»¶å’Œå‹˜æ™ºè®­ç»ƒå¹³å°å¾—åˆ°çš„`kmodel`ã€`deploy_config.json`ä»¥åŠæµ‹è¯•å›¾ç‰‡æ‹·è´åˆ°å¼€å‘æ¿ä¸Šçš„æŸä¸€ç›®å½•ä¸­ï¼Œè¿è¡Œå‘½ä»¤ï¼š

```shell
# åˆ†ç±»-è§†é¢‘æ¨ç†ï¼Œè¾“å…¥`q`å›è½¦é€€å‡ºè§†é¢‘æ¨ç†
./classification.elf deploy_config.json None 0

# åˆ†ç±»-å›¾ç‰‡æ¨ç†
./classification.elf deploy_config.json test.jpg 0

# æ£€æµ‹-è§†é¢‘æ¨ç†ï¼Œè¾“å…¥`q`å›è½¦é€€å‡ºè§†é¢‘æ¨ç†
./detection.elf deploy_config.json None 0

# æ£€æµ‹-å›¾ç‰‡æ¨ç†
./detection.elf deploy_config.json test.jpg 0

# è¯­ä¹‰åˆ†å‰²-è§†é¢‘æ¨ç†ï¼Œè¾“å…¥`q`å›è½¦é€€å‡ºè§†é¢‘æ¨ç†
./segmentation.elf deploy_config.json None 0

# è¯­ä¹‰åˆ†å‰²-å›¾ç‰‡æ¨ç†
./segmentation.elf deploy_config.json test.jpg 0

# OCRæ£€æµ‹-è§†é¢‘æ¨ç†ï¼Œè¾“å…¥`q`å›è½¦é€€å‡ºè§†é¢‘æ¨ç†
./ocr_detection.elf deploy_config.json None 0

# OCRæ£€æµ‹-å›¾ç‰‡æ¨ç†
./ocr_detection.elf deploy_config.json test.jpg 0

# OCRè¯†åˆ«-å›¾ç‰‡æ¨ç†ï¼Œè¯¥ä»»åŠ¡åªæ”¯æŒå›¾ç‰‡æ¨ç†
./ocr_recognition.elf deploy_config.json test.jpg 0

# OCR-è§†é¢‘æ¨ç†ï¼Œè¾“å…¥`q`å›è½¦é€€å‡ºè§†é¢‘æ¨ç†
./ocr.elf ocrdet_deploy_config.json ocrrec_deploy_config.json None 0

# OCR-å›¾ç‰‡æ¨ç†
./ocr.elf ocrdet_deploy_config.json ocrrec_deploy_config.json test.jpg 0

# åº¦é‡å­¦ä¹ -è§†é¢‘æ¨ç†ï¼Œè¾“å…¥`q`å›è½¦é€€å‡ºè§†é¢‘æ¨ç†
./metric_learning.elf deploy_config.json None 0

# åº¦é‡å­¦ä¹ -å›¾ç‰‡æ¨ç†
./metric_learning.elf deploy_config.json test.jpg 0

# å¤šæ ‡ç­¾åˆ†ç±»-è§†é¢‘æ¨ç†ï¼Œè¾“å…¥`q`å›è½¦é€€å‡ºè§†é¢‘æ¨ç†
./multilabel_classification.elf deploy_config.json None 0

# å¤šæ ‡ç­¾åˆ†ç±»-å›¾ç‰‡æ¨ç†
./multilabel_classification.elf deploy_config.json test.jpg 0
```

##### éƒ¨ç½²è¯´æ˜

- ğŸ“¢ åœ¨éƒ¨ç½²æ¨¡å‹æ—¶å¦‚æœæ•ˆæœä¸ç†æƒ³ï¼Œé¦–å…ˆè°ƒæ•´å¯¹åº”ä»»åŠ¡çš„é˜ˆå€¼å’Œæ¨ç†å›¾åƒçš„åˆ†è¾¨ç‡ï¼Œæµ‹è¯•ç»“æœæ˜¯å¦å¯ä»¥æœ‰å¥½è½¬ï¼

- ğŸ“¢ å­¦ä¼šå®šä½é—®é¢˜ï¼Œæ¯”å¦‚æŸ¥çœ‹éƒ¨ç½²åŒ…ä¸­çš„`**_results`ç›®å½•ä¸‹çš„æµ‹è¯•å›¾ç‰‡ï¼Œå¦‚æœè¯¥å›¾ç‰‡æ­£å¸¸ï¼Œåˆ™å¯èƒ½æ˜¯éƒ¨ç½²ä»£ç ã€æ¨¡å‹è½¬æ¢æˆ–è€…é˜ˆå€¼çš„é—®é¢˜ï¼

- ğŸ“¢ è°ƒæ•´æ¨¡å‹è®­ç»ƒçš„å‚æ•°ï¼Œæ¯”å¦‚`epoch`ã€`learning_rate`ç­‰ï¼Œé˜²æ­¢å‡ºç°è®­ç»ƒä¸å……åˆ†çš„æƒ…å†µï¼

### AICube

#### AICubeç®€ä»‹

AICubeæ˜¯å˜‰æ¥ ä¸ºå¼€å‘è€…æä¾›çš„ç¦»çº¿è®­ç»ƒå·¥å…·ï¼Œè¯¥å¹³å°ä¿è¯äº†æ•°æ®å®‰å…¨æ€§ï¼Œå®ç°å¯è§†åŒ–çš„æœ¬åœ°è®­ç»ƒã€‚è¯¥å¹³å°æ”¯æŒå›¾åƒåˆ†ç±»ã€ç›®æ ‡æ£€æµ‹ã€è¯­ä¹‰åˆ†å‰²ã€OCRæ£€æµ‹ã€OCRè¯†åˆ«ã€åº¦é‡å­¦ä¹ ã€å¤šæ ‡ç­¾åˆ†ç±»ã€å¼‚å¸¸æ£€æµ‹å…±8ä¸ªä»»åŠ¡ã€‚å…¶ç›¸å¯¹äºåœ¨çº¿è®­ç»ƒå¹³å°ï¼Œå¯ä»¥ä¿è¯ç”¨æˆ·ä½¿ç”¨æœ¬åœ°çš„GPUå®ç°æ¨¡å‹è®­ç»ƒï¼Œå¹¶å°†æ¨¡å‹è½¬æ¢æˆkmodeléƒ¨ç½²åœ¨K230ä¸Šã€‚

#### ç¯å¢ƒå‡†å¤‡å’Œè½¯ä»¶å®‰è£…

åœ¨å®‰è£…AICubeå‰ï¼Œè¯·å…³æ³¨ä¸€ä¸‹å‰ææ¡ä»¶æ˜¯å¦å…·å¤‡ï¼š

- å¸¦æœ‰NVIDIA GPUçš„è®¾å¤‡ï¼Œæ¨èæ˜¾å­˜8Gä»¥ä¸Šï¼›

- è®¡ç®—æœºå·²å®‰è£…CUDA 11.7ä»¥åŠä»¥ä¸Šç‰ˆæœ¬ï¼Œå·²å®‰è£…CUDNNï¼›

- è®¡ç®—æœºå·²å®‰è£…dotnet 7.0ï¼Œå¹¶å°†å®‰è£…è·¯å¾„æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ï¼›

- æ¨èè®¡ç®—æœºå†…å­˜åœ¨8GBä»¥ä¸Šï¼Œç¡¬ç›˜å‰©ä½™ç©ºé—´è‡³å°‘20GBä»¥ä¸Šï¼›

å¦‚æœæ‚¨çš„è®¡ç®—æœºæ»¡è¶³ä¸Šè¿°æ¡ä»¶ï¼Œå¯ä»¥ä¸‹è½½AICubeå¹¶è§£å‹ä½¿ç”¨ã€‚AICubeæä¾›äº†ubuntuç‰ˆæœ¬å’Œwindowsç‰ˆæœ¬çš„å®‰è£…åŒ…ï¼Œå› ä¸ºå®‰è£…åŒ…å†…åŒ…å«äº†é…å¥—çš„**torchè®­ç»ƒç¯å¢ƒã€å¤šä¸ªé¢„è®­ç»ƒæ¨¡å‹å’Œç¤ºä¾‹æ•°æ®é›†**ï¼Œå› æ­¤å®‰è£…åŒ…è¾ƒå¤§ï¼Œ**è¯·åœ¨åˆé€‚çš„ç½‘ç»œç¯å¢ƒä¸‹è½½**ï¼Œä¸‹è½½åœ°å€è§: [AICubeä¸‹è½½](https://www.kendryte.com/zh/resource?selected=4-2)ã€‚ä½¿ç”¨æ­¥éª¤è¯·å‚è€ƒå¯¹åº”ç‰ˆæœ¬çš„ç”¨æˆ·æŒ‡å—ã€‚

ğŸ“¢ **ä¸‹è½½æ—¶è¯·é€‰æ‹©æœ€æ–°ç‰ˆæœ¬ä¸‹è½½**ã€‚

#### æ”¯æŒä»»åŠ¡ä»‹ç»

AICubeä¸­å¯¹äºK230ç³»åˆ—èŠ¯ç‰‡æ”¯æŒçš„è§†è§‰ä»»åŠ¡æœ‰8ç§ï¼Œä»»åŠ¡ä»‹ç»å¦‚ä¸‹è¡¨ï¼š

ğŸ’¡ **ä»»åŠ¡ä»‹ç»**ï¼š

| ä»»åŠ¡åç§°  | ä»»åŠ¡è¯´æ˜                                                                                                           |
| ----- | --------------------------------------------------------------------------------------------------------------------- |
| å›¾åƒåˆ†ç±»  | å¯¹å›¾ç‰‡è¿›è¡Œåˆ†ç±»ï¼Œå¾—åˆ°å›¾ç‰‡çš„ç±»åˆ«ç»“æœå’Œåˆ†æ•°ã€‚                                                                            |
| å›¾åƒæ£€æµ‹  | åœ¨å›¾ç‰‡ä¸­æ£€æµ‹å‡ºç›®æ ‡ç‰©ä½“ï¼Œå¹¶ç»™å‡ºç‰©ä½“çš„ä½ç½®ä¿¡æ¯ã€ç±»åˆ«ä¿¡æ¯å’Œåˆ†æ•°ã€‚                                                          |
| è¯­ä¹‰åˆ†å‰²  | å¯¹å›¾ç‰‡ä¸­çš„ç›®æ ‡åŒºåŸŸè¿›è¡Œåˆ†å‰²ï¼Œå°†å›¾ç‰‡ä¸­çš„ä¸åŒæ ‡ç­¾åŒºåŸŸåˆ‡å‰²å‡ºæ¥ï¼Œå±äºåƒç´ çº§ä»»åŠ¡ã€‚                                              |
| OCRæ£€æµ‹ | åœ¨å›¾ç‰‡ä¸­æ£€æµ‹å‡ºæ–‡æœ¬åŒºåŸŸï¼Œå¹¶ç»™å‡ºæ–‡æœ¬åŒºåŸŸçš„ä½ç½®ä¿¡æ¯ã€‚                                                                        |
| OCRè¯†åˆ« | åœ¨å›¾ç‰‡ä¸­è¯†åˆ«å‡ºæ–‡æœ¬å†…å®¹ã€‚                                                                                                |
| åº¦é‡å­¦ä¹   | è®­ç»ƒå¯ä»¥å°†å›¾ç‰‡ç‰¹å¾åŒ–çš„æ¨¡å‹ï¼Œä½¿ç”¨è¯¥æ¨¡å‹åˆ›å»ºç‰¹å¾åº“ï¼Œé€šè¿‡ç‰¹å¾å¯¹æ¯”ï¼Œåœ¨ä¸é‡æ–°è®­ç»ƒæ¨¡å‹çš„å‰æä¸‹å¯¹æ–°çš„ç±»åˆ«è¿›è¡Œåˆ†ç±»ï¼Œä¹Ÿå¯ç§°ä¸ºè‡ªå­¦ä¹ ã€‚   |
| å¤šæ ‡ç­¾åˆ†ç±» | å¯¹å›¾ç‰‡è¿›è¡Œå¤šç±»åˆ«åˆ†ç±»ï¼Œä¸€äº›å›¾ç‰‡å¯èƒ½ä¸åªæ˜¯å±äºæŸä¸ªå•ä¸€çš„ç±»åˆ«ï¼Œå¤©ç©ºå’Œå¤§æµ·å¯ä»¥åŒæ—¶å­˜åœ¨ï¼Œå¾—åˆ°å›¾ç‰‡çš„å¤šæ ‡ç­¾åˆ†ç±»ç»“æœã€‚               |
|å¼‚å¸¸æ£€æµ‹| ç”¨äºæ£€æµ‹æŸç±»äº§å“ä¸­çš„å¼‚å¸¸ç±»åˆ«ï¼Œå¸¸ç”¨äºå·¥ä¸šè´¨æ£€ç­‰é¢†åŸŸã€‚|

#### ä½¿ç”¨è¯´æ˜

##### åŠŸèƒ½é¡µä»‹ç»

AI CubeåŒ…å«5ä¸ªåŠŸèƒ½é¡µï¼Œâ€œé¡¹ç›®â€é¡µé¢ä¸»è¦å®ç°é¡¹ç›®ç®¡ç†åŠŸèƒ½ï¼Œå±•ç¤ºå½“å‰é¡¹ç›®å’Œæœ€è¿‘é¡¹ç›®ï¼›â€œå›¾åƒâ€é¡µé¢å±•ç¤ºå½“å‰é¡¹ç›®çš„æ•°æ®é›†ä¿¡æ¯ï¼Œä¾¿äºç”¨æˆ·æŸ¥çœ‹æ•°æ®é›†çš„å›¾ç‰‡ï¼›â€œæ‹†åˆ†â€é¡µé¢å±•ç¤ºæ‹†åˆ†ä¿¡æ¯ï¼Œç»Ÿè®¡æ‹†åˆ†ç±»åˆ«å’Œä¸åŒæ‹†åˆ†é›†çš„å›¾ç‰‡ï¼›â€œè®­ç»ƒâ€é¡µé¢å®ç°è®­ç»ƒå‚æ•°é…ç½®ï¼Œè®­ç»ƒä¿¡æ¯å’Œè®­ç»ƒæ›²çº¿çš„æ˜¾ç¤ºï¼›â€œè¯„ä¼°â€é¡µé¢å®ç°æ¨¡å‹è¯„ä¼°å’Œè¯„ä¼°ä¿¡æ¯çš„å±•ç¤ºï¼Œå¹¶ä¸”å¯ä»¥é…ç½®éƒ¨ç½²å¿…è¦å‚æ•°ç”Ÿæˆéƒ¨ç½²åŒ…ã€‚

ğŸ—‚ï¸ **é¡¹ç›®é¡µé¢**å›¾ç¤ºï¼š

![é¡¹ç›®é¡µé¢](https://www.kendryte.com/api/post/attachment?id=616)

ğŸ—‚ï¸ **å›¾åƒé¡µé¢**å›¾ç¤ºï¼š

![å›¾åƒé¡µé¢](https://www.kendryte.com/api/post/attachment?id=617)

ğŸ—‚ï¸ **æ‹†åˆ†é¡µé¢**å›¾ç¤ºï¼š

![æ‹†åˆ†é¡µé¢](https://www.kendryte.com/api/post/attachment?id=618)

ğŸ—‚ï¸ **è®­ç»ƒé¡µé¢**å›¾ç¤ºï¼š

![è®­ç»ƒé¡µé¢](https://www.kendryte.com/api/post/attachment?id=619)

ğŸ—‚ï¸ **è¯„ä¼°é¡µé¢**å›¾ç¤ºï¼š

![è¯„ä¼°é¡µé¢](https://www.kendryte.com/api/post/attachment?id=620)

##### åˆ›å»ºæ•°æ®é›†

æŒ‰ç…§ä¸åŒä»»åŠ¡çš„æ•°æ®é›†æ ¼å¼ç»„ç»‡æ•°æ®é›†ã€‚å¯¹åº”æ•°æ®é›†æ ¼å¼åœ¨`é¡¹ç›®é¡µé¢`ç‚¹å‡»æ–°å»ºé¡¹ç›®æŸ¥çœ‹ï¼ŒåŒæ—¶æˆ‘ä»¬æä¾›äº†ä¸åŒä»»åŠ¡çš„ç¤ºä¾‹æ•°æ®é›†ï¼Œåœ¨`example_dataset`ç›®å½•ä¸‹ï¼›å¹¶ä½¿ç”¨è¿™äº›ç¤ºä¾‹æ•°æ®é›†åˆ›å»ºäº†ç¤ºä¾‹é¡¹ç›®ï¼Œä½äº`example_projects`ç›®å½•ä¸‹ã€‚

å…³äºä¸åŒä»»åŠ¡çš„ç¤ºä¾‹æ•°æ®é›†å’Œç¤ºä¾‹ä»»åŠ¡ï¼Œå¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š

| æ•°æ®é›†åç§°     | ç¤ºä¾‹ä»»åŠ¡   | è¯´æ˜                   |
| -------------- | ---------- | ---------------------- |
| vegetable_cls  | å›¾åƒåˆ†ç±»   | è”¬èœåˆ†ç±»åœºæ™¯           |
| insect         | ç›®æ ‡æ£€æµ‹   | æ˜†è™«æ£€æµ‹åœºæ™¯           |
| Ocular_lesions | è¯­ä¹‰åˆ†å‰²   | çœ¼çƒç—…å˜åŒºåŸŸåˆ†å‰²åœºæ™¯   |
| dataset_td100  | OCRæ£€æµ‹    | OCRæ–‡å­—æ£€æµ‹åœºæ™¯        |
| ProductionDate | OCRè¯†åˆ«    | ç”Ÿäº§æ—¥æœŸè¯†åˆ«åœºæ™¯       |
| drink          | åº¦é‡å­¦ä¹    | é¥®æ–™ç“¶åˆ†ç±»åœºæ™¯         |
| multilabel2000 | å¤šæ ‡ç­¾åˆ†ç±» | è‡ªç„¶é£å…‰å¤šæ ‡ç­¾åˆ†ç±»åœºæ™¯ |
| bottle         | å¼‚å¸¸æ£€æµ‹   | ç“¶å£å¼‚å¸¸æ£€æµ‹åœºæ™¯       |

æ‚¨å¯ä»¥ä½¿ç”¨æˆ‘ä»¬æä¾›çš„ç¤ºä¾‹æ•°æ®é›†ï¼Œä¹Ÿå¯ä»¥è‡ªå·±æŒ‰ç…§`æ–°å»ºé¡¹ç›®ç•Œé¢`å¯¹åº”ä»»åŠ¡æ ¼å¼ç»„ç»‡æ‚¨çš„æ•°æ®é›†ã€‚AICubeé‡åˆ°çš„å¤§å¤šæ•°é—®é¢˜éƒ½æ˜¯æ•°æ®çš„é—®é¢˜ï¼Œæˆ‘ä»¬åªå¯¹æ•°æ®é›†çš„ç›®å½•ç»“æ„å®ç°äº†æ£€æŸ¥ï¼Œå¹¶æ²¡æœ‰å¯¹æ•°æ®å†…éƒ¨çš„æ ‡æ³¨ä¿¡æ¯åšæ£€æŸ¥ï¼Œè¯·è°¨æ…çš„å¤„ç†æ•°æ®ã€‚

##### åˆ›å»ºé¡¹ç›®

è¿›å…¥`é¡¹ç›®é¡µé¢`--->ç‚¹å‡»`æ–°å»ºé¡¹ç›®`æŒ‰é’®--->é€‰æ‹©ä»»åŠ¡ç±»å‹--->å¯¼å…¥æ•°æ®é›†--->é€‰æ‹©é¡¹ç›®çš„å­˜å‚¨è·¯å¾„--->æ·»åŠ é¡¹ç›®çš„åç§°--->åˆ›å»ºé¡¹ç›®ã€‚

æ–°å»ºé¡¹ç›®ç•Œé¢å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![æ–°å»ºé¡¹ç›®](https://www.kendryte.com/api/post/attachment?id=621)

é¡¹ç›®æ–°å»ºå®Œæˆåï¼Œä¼šè‡ªåŠ¨è·³è½¬åˆ°`å›¾åƒé¡µé¢`ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹æ‚¨çš„æ•°æ®é›†è¯¦æƒ…ã€‚è¿›å…¥`æ‹†åˆ†é¡µé¢`ï¼Œæ‚¨å¯ä»¥æŒ‰ç…§è‡ªå®šä¹‰æ¯”ä¾‹å¯¹æ•°æ®é›†è¿›è¡Œæ‹†åˆ†ï¼Œå¹¶æŸ¥çœ‹æ‹†åˆ†é›†çš„ç»Ÿè®¡ä¿¡æ¯ã€‚

##### å¯åŠ¨è®­ç»ƒ

è¿›å…¥`è®­ç»ƒé¡µé¢`ï¼Œåœ¨å·¦ä¾§é…ç½®**æ¨¡å‹ã€æ•°æ®å¢å¼ºå’Œè®­ç»ƒå‚æ•°**ã€‚

å¸¸è§å‚æ•°è§£æï¼š

| å¹³å°å‚æ•°åç§°     | å¸¸ç”¨å‚æ•°å®šä¹‰            | å‚æ•°å«ä¹‰è§£æ                                                 |
| ---------------- | ----------------------- | ------------------------------------------------------------ |
| æ¨¡å‹             | model                   | ä¸åŒç»“æ„çš„ç½‘ç»œæ¨¡å‹ï¼Œç”¨äºå®ç°ä¸åŒçš„ä»»åŠ¡ï¼›                     |
| Backbone         | model backbone          | æ¨¡å‹ä¸­çš„ç‰¹å¾æå–éƒ¨åˆ†ç½‘ç»œç»“æ„ï¼Œæ¯”å¦‚æ£€æµ‹å’Œåˆ†å‰²ä»»åŠ¡çš„æ¨¡å‹ï¼›     |
| æ˜¯å¦é¢„è®­ç»ƒ       | pretrain                | æ˜¯å¦åŠ è½½AICubeæä¾›çš„é¢„è®­ç»ƒæ¨¡å‹;                             |
| é¢„è®­ç»ƒæ¨¡å‹è¯­è¨€   | pretrain language       | **OCRè¯†åˆ«**çš„ç‰¹å®šä»»åŠ¡å‚æ•°ï¼Œé€‰æ‹©è®­ç»ƒé¢„è®­ç»ƒæ¨¡å‹çš„æ ·æœ¬è¯­è¨€ï¼›å…¶ä»–ä»»åŠ¡å¿½ç•¥ï¼›        |
| æ¨¡å‹å¤§å°         | model size              | nã€sã€mã€lã€xï¼ŒåŒä¸€æ¨¡å‹çš„å˜ä½“ï¼ŒåŒºåˆ«æ˜¯æ¨¡å‹å°ºå¯¸ï¼Œç”¨äºå¹³è¡¡å‡†ç¡®ç‡å’Œé€Ÿç‡ï¼› |
| æ¨¡å‹å®½åº¦         | model width             | å®½åº¦è¶Šå¤§ï¼Œå‚æ•°é‡è¶Šå¤§;                                        |
| å›¾åƒå°ºå¯¸         | model input size        | æ¨¡å‹è¾“å…¥åˆ†è¾¨ç‡ï¼Œå•å€¼è¡¨ç¤ºè¾“å…¥ä¸º[x,x]ï¼ŒåŒå€¼è¡¨ç¤ºè¾“å…¥ä¸º[x,y];    |
| ASPPç©ºæ´ç‡       | ASPP dilation rate      | **è¯­ä¹‰åˆ†å‰²**çš„ç‰¹å®šä»»åŠ¡å‚æ•°ï¼Œä¸åŒç©ºæ´å·ç§¯å’Œæ± åŒ–æ“ä½œçš„å°ºåº¦ï¼Œä¸åŒçš„ç©ºæ´ç‡è¿›è¡Œç©ºæ´å·ç§¯å¯ä»¥æ‰©å¤§æ„Ÿå—é‡ï¼Œè·å¾—æ›´å¹¿é˜”çš„çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼› |
| ç¼–ç é•¿åº¦         | embedding length        | **åº¦é‡å­¦ä¹ **çš„ç‰¹å®šä»»åŠ¡å‚æ•°ï¼Œæ ·æœ¬è¢«å‘é‡åŒ–çš„å‘é‡é•¿åº¦ï¼›             |
| è‡ªåŠ¨æ•°æ®å¢å¼º     | TrivialAugment          | æ— å‚æ•°å•å›¾éšæœºè‡ªåŠ¨æ•°æ®å¢å¼º;                                  |
| å…¶ä»–æ•°æ®å¢å¼ºæ–¹æ³• | â€”                       | äº®åº¦ã€å¯¹æ¯”åº¦ã€é¥±å’Œåº¦ã€è‰²åº¦ã€é”åº¦å¢å¼ºï¼Œç¿»è½¬ï¼Œæ—‹è½¬ï¼Œéšæœºç¼©æ”¾ï¼Œéšæœºè£å‰ªï¼Œé€è§†å˜æ¢ï¼Œé«˜æ–¯æ¨¡ç³Šï¼Œç›´æ–¹å›¾å‡è¡¡åŒ–ï¼Œç°åº¦ä¸–ç•Œç®—æ³•ï¼ŒCutOutï¼ŒRandom Erasingï¼ŒMask; |
| å­¦ä¹ ç‡           | learning rate           | ä¼˜åŒ–ç®—æ³•çš„å‚æ•°ï¼Œæ¯æ¬¡è¿­ä»£çš„è°ƒæ•´æ­¥é•¿ï¼›                         |
| è¿­ä»£è½®æ•°         | epoch                   | ä¸€ä¸ªepochæ˜¯ç¥ç»ç½‘ç»œä½¿ç”¨å…¨éƒ¨è®­ç»ƒæ ·æœ¬è®­ç»ƒä¸€æ¬¡çš„è¿‡ç¨‹ï¼›          |
| è®­ç»ƒæ‰¹å¤§å°       | batchsize               | æ¯æ¬¡å‰å‘å’Œåå‘ä¼ æ’­ä½¿ç”¨çš„æ ·æœ¬æ•°é‡ï¼›                           |
| ä¼˜åŒ–å™¨           | optimizer               | ä¼˜åŒ–ç½‘ç»œçš„æ—¶å€™ä½¿ç”¨çš„ä¼˜åŒ–å‡½æ•°ï¼Œæ¯”å¦‚SGDã€Adamç­‰ï¼›              |
| AutoAnchor       | autoanchor              | ç›®æ ‡æ£€æµ‹ä»»åŠ¡ä¸­çš„é”šæ¡†è‡ªé€‚åº”ï¼›                                 |
| NMSé€‰é¡¹          | nms option              | ç›®æ ‡æ£€æµ‹ä»»åŠ¡ä¸­åŒºåˆ«ç±»å†…å’Œç±»é—´çš„éæå¤§å€¼æŠ‘åˆ¶é€‰é¡¹ï¼›             |
| ç½®ä¿¡åº¦é˜ˆå€¼       | confidience threshold   | ç”¨äºé¢„æµ‹æ¡†ç±»åˆ«çš„è¿‡æ»¤ï¼Œä½äºæ­¤é˜ˆå€¼çš„é¢„æµ‹æ¡†éƒ½å°†è¢«åˆ é™¤ï¼›         |
| äº¤å¹¶æ¯”é˜ˆå€¼       | IOU threshold           | å¯¹å¤šä¸ªé‡å æ¡†è¿›è¡Œæå¤§å€¼ç­›é€‰ï¼Œè®¡ç®—æ‰€æœ‰æ£€æµ‹æ¡†çš„å¾—åˆ†ï¼Œä¾æ¬¡ä¸å¾—åˆ†æœ€é«˜çš„æ£€æµ‹æ¡†å¯¹æ¯”ï¼Œå¤§äºæ­¤é˜ˆå€¼çš„æ£€æµ‹æ¡†è¢«åˆ é™¤ï¼›OCRæ£€æµ‹ä¸­çš„Boxé˜ˆå€¼ç±»ä¼¼ï¼› |
| è‡ªåŠ¨æ··åˆç²¾åº¦     | AMP                     | é’ˆå¯¹ä¸åŒå±‚é‡‡ç”¨ä¸åŒçš„æ•°æ®ç²¾åº¦ï¼Œä»¥èŠ‚çœæ˜¾å­˜å¹¶æé«˜è®¡ç®—é€Ÿåº¦ï¼›     |
| æŒ‡æ•°ç§»åŠ¨å¹³å‡     | EMA                     | å¹³æ»‘æ–¹æ³•ï¼Œé˜²æ­¢å¼‚å¸¸å€¼çš„å½±å“ï¼Œæƒé‡éšæ—¶é—´æŒ‡æ•°é€’å‡ï¼›             |
| æ—©åœ             | Early Stopping          | å¢åŠ æ¨¡å‹æ³›åŒ–æ€§å’Œé˜²æ­¢è¿‡æ‹Ÿåˆçš„æ–¹æ³•ï¼›                           |
| é¢„çƒ­ç­–ç•¥         | WarmUp                  | æ“ä½œè®­ç»ƒåˆå§‹é˜¶æ®µçš„learning rateï¼Œä½¿æ¨¡å‹æ›´å¿«çš„æ”¶æ•›ï¼›          |
| å¤šå°ºåº¦è®­ç»ƒ       | MST                     | å®ç°å¯¹ä¸åŒå°ºåº¦çš„è¾“å…¥å›¾åƒè¿›è¡Œè®­ç»ƒï¼Œæé«˜æ£€æµ‹æ¨¡å‹å¯¹ä¸åŒå¤§å°ç‰©ä½“çš„æ£€æµ‹æ³›åŒ–æ€§ï¼› |
| æŸå¤±å‡½æ•°         | loss function           | ç”¨äºè¯„ä¼°æ¨¡å‹é¢„æµ‹å€¼å’ŒçœŸå®å€¼çš„å·®è·ç¨‹åº¦ï¼ŒæŸå¤±è¶Šå°ï¼Œæ¨¡å‹æ€§èƒ½è¶Šå¥½ï¼› |
| å­¦ä¹ ç‡è°ƒåº¦       | learning rate scheduler | å­¦ä¹ ç‡è°ƒæ•´ç­–ç•¥ï¼Œè®­ç»ƒè¿‡ç¨‹ä¸­åŠ¨æ€çš„è°ƒæ•´å­¦ä¹ ç‡ä»¥é€‚åº”æ¢¯åº¦ä¸‹é™è¿‡ç¨‹ï¼ŒåŒ…æ‹¬StepLRã€CosineAnnealingLRã€LinearLRã€MultiStepLRç­‰ï¼› |
| æŸå¤±åˆ·æ–°æ­¥é•¿     | loss refresh step       | ç•Œé¢Lossæ›²çº¿ç»˜åˆ¶é¢‘ç‡ï¼Œä»¥batchä¸ºå•ä½ï¼›                        |
| GPUç´¢å¼•          | gpu index               | æ˜¾å¡ç´¢å¼•ï¼›                                                 |

æŒ‰ç…§ä¸åŒçš„ä»»åŠ¡é…ç½®å¥½å¯¹åº”å‚æ•°åï¼Œå¯ä»¥ç‚¹å‡»`å¢å¼ºæ ·æœ¬æŒ‰é’®`æŸ¥çœ‹ç»è¿‡æ•°æ®å¢å¼ºçš„éƒ¨åˆ†ç¤ºä¾‹æ ·æœ¬ï¼›ç‚¹å‡»`å­¦ä¹ ç‡æ›²çº¿`å¯ä»¥æŸ¥çœ‹ä¸åŒçš„å­¦ä¹ ç‡ç­–ç•¥å¯¼è‡´çš„å­¦ä¹ ç‡å˜åŒ–ï¼›ç‚¹å‡»`å¼€å§‹è®­ç»ƒæŒ‰é’®`ï¼Œè®­ç»ƒçš„ä¿¡æ¯ä¼šåœ¨å³ä¸Šæ–¹é¢æ¿æ˜¾ç¤ºï¼ŒæŸå¤±æ›²çº¿å’ŒæŒ‡æ ‡æ›²çº¿ä¼šåœ¨ä¸­é—´ä½ç½®ç»˜åˆ¶ï¼›ç¤ºä¾‹æ ·æœ¬çš„é¢„æµ‹ç»“æœä¼šåœ¨å³ä¸‹é¢æ¿è¿­ä»£æ˜¾ç¤ºæ¯ä¸ªepochçš„å˜åŒ–ã€‚è®­ç»ƒæ—¶ç•Œé¢å¦‚ä¸‹å›¾ï¼š

![è®­ç»ƒè¿‡ç¨‹](https://www.kendryte.com/api/post/attachment?id=619)

##### æ¨¡å‹æµ‹è¯•

è¿›å…¥`è¯„ä¼°é¡µé¢`ï¼Œé€‰æ‹©è®­ç»ƒå¥½çš„æ¨¡å‹ï¼Œç„¶åé€‰æ‹©æµ‹è¯•æ–¹å¼ã€‚æµ‹è¯•æ–¹å¼å¦‚ä¸‹ï¼š

| æµ‹è¯•æ–¹å¼     | è¯´æ˜                                                         |
| ------------ | ------------------------------------------------------------ |
| æµ‹è¯•é›†æµ‹è¯•   | å¯¹æ‹†åˆ†å¾—åˆ°çš„æµ‹è¯•é›†è¿›è¡Œæµ‹è¯•è¯„ä¼°ï¼Œè¾“å‡ºæµ‹è¯•æŒ‡æ ‡æ•°æ®ï¼›           |
| é¢å¤–æ•°æ®æµ‹è¯• | ä½¿ç”¨å’Œè®­ç»ƒæ•°æ®é›†ç›¸åŒæ ¼å¼çš„å¸¦æ ‡æ³¨æ•°æ®è¿›è¡Œæµ‹è¯•ï¼Œè¾“å‡ºæµ‹è¯•æŒ‡æ ‡æ•°æ®ï¼› |
| å›¾åƒç›®å½•æµ‹è¯• | åªé€‰æ‹©ä½¿ç”¨è®­ç»ƒçš„æ¨¡å‹å’Œå‚æ•°å¯¹å›¾ç‰‡ç›®å½•ä¸‹çš„æ‰€æœ‰æ— æ ‡æ³¨æ ·æœ¬è¿›è¡Œæ¨ç†ï¼Œæ— æµ‹è¯•æŒ‡æ ‡ï¼› |

ç‚¹å‡»â€œå¼€å§‹æµ‹è¯•â€æŒ‰é’®ï¼Œè¿›è¡Œæµ‹è¯•ï¼Œæµ‹è¯•ç»“æŸåï¼Œæ ¹æ®è¯„ä¼°æŒ‡æ ‡æŸ¥çœ‹æ‚¨çš„æ¨¡å‹æ€§èƒ½ï¼›åŒå‡»æµ‹è¯•æ•°æ®åˆ—è¡¨çš„æ¡ç›®å¯ä»¥æŸ¥çœ‹æ¨ç†ç»“æœå¤§å›¾ã€‚

##### æ¨¡å‹éƒ¨ç½²

å¦‚æœæ¨¡å‹çš„æ€§èƒ½ç¬¦åˆæ‚¨çš„éœ€æ±‚ï¼Œæ‚¨å¯ä»¥åœ¨èŠ¯ç‰‡é€‚é…é¢æ¿é…ç½®éƒ¨ç½²å‚æ•°ï¼Œä¸»è¦æ˜¯æ¨¡å‹çš„è¾“å…¥åˆ†è¾¨ç‡å’Œä¸€äº›åŸºç¡€å‚æ•°ï¼Œç‚¹å‡»`éƒ¨ç½²æŒ‰é’®`ç”Ÿæˆéƒ¨ç½²åŒ…ã€‚

![éƒ¨ç½²åŒ…ç”Ÿæˆ](https://www.kendryte.com/api/post/attachment?id=622)

éƒ¨ç½²äº§ç‰©ç”Ÿæˆåæ‚¨å¯ä»¥åœ¨å½“å‰é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹æ‰¾åˆ°å¦‚ä¸‹æ–‡ä»¶ï¼Œæˆ‘ä»¬ä¸»è¦ä½¿ç”¨`kmodel`å’Œé…ç½®æ–‡ä»¶`deploy_config.json`ï¼š

```shell
ğŸ“¦ task_name
â”œâ”€â”€ ğŸ“ cpp_deployment_source
â”œâ”€â”€ ğŸ“ mp_deployment_source
â””â”€â”€ README.md
```

![é¡¹ç›®æ–‡ä»¶](https://www.kendryte.com/api/post/attachment?id=623)

å…¶ä¸­`mp_deployment_source`ç›®å½•æ˜¯åœ¨K230æ–¹æ¡ˆä¸Šéƒ¨ç½²çš„èµ„æºï¼ŒåŒ…å«Kmodelæ–‡ä»¶å’Œéƒ¨ç½²é…ç½®æ–‡ä»¶ï¼**æˆ‘ä»¬å…¶å®éœ€è¦çš„åªæ˜¯å…¶ä¸­çš„é…ç½®æ–‡ä»¶`deploy_config.json`å’Œæ¨¡å‹æ–‡ä»¶`***.kmodel`**ï¼Œå°†è¯¥ç›®å½•æ‹·è´åˆ°å¼€å‘æ¿ä¸Šã€‚

#### éƒ¨ç½²æ­¥éª¤

##### éƒ¨ç½²åŒ…è¯´æ˜

è®­ç»ƒç»“æŸåå¯ä»¥å¾—åˆ°å¯¹åº”è®­ç»ƒä»»åŠ¡çš„éƒ¨ç½²äº§ç‰©ã€‚

##### æ–‡ä»¶æ‹·è´

âœ… **å›ºä»¶é€‰æ‹©**ï¼šè¯·å‚è€ƒä¸‹é¢æ–‡æ¡£ä¸­çš„æ­¥éª¤æ­å»ºç¼–è¯‘ç¯å¢ƒï¼Œå¹¶ç¼–è¯‘å›ºä»¶ï¼Œä»¥ä¿è¯**æœ€æ–°çš„ç‰¹æ€§**è¢«æ”¯æŒï¼æ–‡æ¡£æ•™ç¨‹è§ï¼š[å›ºä»¶ç¼–è¯‘](./userguide/how_to_build.md)ã€‚

âœ… **å›ºä»¶çƒ§å½•**ï¼š æŒ‰ç…§å¼€å‘æ¿ç±»å‹çƒ§å½•å›ºä»¶ï¼Œå›ºä»¶çƒ§å½•å‚è€ƒï¼š[å›ºä»¶çƒ§å½•](https://www.kendryte.com/k230_rtos/zh/main/userguide/how_to_flash.html)ã€‚

âœ… **éƒ¨ç½²ä»£ç **ï¼šéƒ¨ç½²ä»£ç ä½äºç¼–è¯‘ç¯å¢ƒä¸‹`rtos_sdk/src/rtsmart/examples/cloudplat_deploy_code`,éœ€è¦è¿›å…¥è¯¥ç›®å½•æ‰§è¡Œ`./build.sh`å®Œæˆç¼–è¯‘ï¼Œç¼–è¯‘äº§ç‰©ä½äº`k230_bin`ç›®å½•ä¸‹ï¼Œä½¿ç”¨æ–¹æ³•å‚è€ƒè¯¥ç›®å½•ä¸‹çš„`README.md`ã€‚

##### è„šæœ¬è¿è¡Œ

**å‚æ•°é…ç½®**ï¼š

æ‚¨å¯ä»¥åœ¨`common_files`ä¸­çš„`setting.h`é…ç½®å‚æ•°ï¼Œå…³äºå‚æ•°é…ç½®çš„è§£æå¦‚ä¸‹ï¼Œä¸»è¦ç”¨äºé…ç½®å±å¹•æ˜¾ç¤ºï¼š

|å®å®šä¹‰å‚æ•°|è¯´æ˜|
|:-:|:-:|
|`ISP_WIDTH`|ISPè¾“å‡ºå®½åº¦|
|`ISP_HEIGHT`|ISPè¾“å‡ºé«˜åº¦|
|`DISPLAY_MODE`|æ˜¾ç¤ºæ¨¡å¼ï¼Œ0ä¸º1920Ã—1080 LT9611ï¼Œ1ä¸º800Ã—480 ST7701|
|`DISPLAY_WIDTH`|æ˜¾ç¤ºå±å¹•å®½åº¦|
|`DISPLAY_HEIGHT`|æ˜¾ç¤ºå±å¹•é«˜åº¦|
|`AI_FRAME_WIDTH`|AIæ¨ç†å¸§å®½åº¦|
|`AI_FRAME_HEIGHT`|AIæ¨ç†å¸§é«˜åº¦|
|`AI_FRAME_CHANNEL`|AIæ¨ç†å¸§é€šé“æ•°|
|`USE_OSD`|æ˜¯å¦ä½¿ç”¨OSDï¼Œ0ä¸ºä¸ä½¿ç”¨ï¼Œ1ä¸ºä½¿ç”¨|
|`OSD_WIDTH`|OSDå›¾å±‚å®½åº¦,ç”¨äºæ˜¾ç¤ºAIæ¨ç†ç»“æœ|
|`OSD_HEIGHT`|OSDå›¾å±‚é«˜åº¦,ç”¨äºæ˜¾ç¤ºAIæ¨ç†ç»“æœ|
|`OSD_CHANNEL`|OSDå›¾å±‚é€šé“æ•°|

**æºç ç¼–è¯‘**ï¼š

è¿›å…¥`src/rtsmart/examples/cloudplat_deploy_code`ç›®å½•

```shell
# è¿›å…¥ç›®å½•
cd cloudplat_deploy_code

# ç¼–è¯‘æ–‡ä»¶,ä¼šåœ¨k230_binç›®å½•ä¸‹å¾—åˆ°æ‰€æœ‰çš„ä»»åŠ¡ç¼–è¯‘elfæ–‡ä»¶
./build.sh

# å¦‚æœåªæƒ³ç¼–è¯‘æŸä¸€ä¸ªä»»åŠ¡çš„éƒ¨ç½²æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨./build.sh <ä»»åŠ¡å>
./build.sh classification
./build.sh detection
...
```

ç¼–è¯‘äº§ç‰©åœ¨ `k230_bin` ç›®å½•ä¸‹ã€‚

**ä¸Šæ¿éƒ¨ç½²**ï¼š

å°†å¾—åˆ°çš„`elfæ–‡ä»¶`ã€å­—ä½“æ–‡ä»¶å’ŒAICubeè®­ç»ƒé¡¹ç›®ä¸­å¾—åˆ°çš„`kmodel`ã€`deploy_config.json`ä»¥åŠæµ‹è¯•å›¾ç‰‡æ‹·è´åˆ°å¼€å‘æ¿ä¸Šçš„æŸä¸€ç›®å½•ä¸­ï¼Œè¿è¡Œå‘½ä»¤ï¼š

```shell
# åˆ†ç±»-è§†é¢‘æ¨ç†ï¼Œè¾“å…¥`q`å›è½¦é€€å‡ºè§†é¢‘æ¨ç†
./classification.elf deploy_config.json None 0

# åˆ†ç±»-å›¾ç‰‡æ¨ç†
./classification.elf deploy_config.json test.jpg 0

# æ£€æµ‹-è§†é¢‘æ¨ç†ï¼Œè¾“å…¥`q`å›è½¦é€€å‡ºè§†é¢‘æ¨ç†
./detection.elf deploy_config.json None 0

# æ£€æµ‹-å›¾ç‰‡æ¨ç†
./detection.elf deploy_config.json test.jpg 0

# è¯­ä¹‰åˆ†å‰²-è§†é¢‘æ¨ç†ï¼Œè¾“å…¥`q`å›è½¦é€€å‡ºè§†é¢‘æ¨ç†
./segmentation.elf deploy_config.json None 0

# è¯­ä¹‰åˆ†å‰²-å›¾ç‰‡æ¨ç†
./segmentation.elf deploy_config.json test.jpg 0

# OCRæ£€æµ‹-è§†é¢‘æ¨ç†ï¼Œè¾“å…¥`q`å›è½¦é€€å‡ºè§†é¢‘æ¨ç†
./ocr_detection.elf deploy_config.json None 0

# OCRæ£€æµ‹-å›¾ç‰‡æ¨ç†
./ocr_detection.elf deploy_config.json test.jpg 0

# OCRè¯†åˆ«-å›¾ç‰‡æ¨ç†ï¼Œè¯¥ä»»åŠ¡åªæ”¯æŒå›¾ç‰‡æ¨ç†
./ocr_recognition.elf deploy_config.json test.jpg 0

# OCR-è§†é¢‘æ¨ç†ï¼Œè¾“å…¥`q`å›è½¦é€€å‡ºè§†é¢‘æ¨ç†
./ocr.elf ocrdet_deploy_config.json ocrrec_deploy_config.json None 0

# OCR-å›¾ç‰‡æ¨ç†
./ocr.elf ocrdet_deploy_config.json ocrrec_deploy_config.json test.jpg 0

# åº¦é‡å­¦ä¹ -è§†é¢‘æ¨ç†ï¼Œè¾“å…¥`q`å›è½¦é€€å‡ºè§†é¢‘æ¨ç†
./metric_learning.elf deploy_config.json None 0

# åº¦é‡å­¦ä¹ -å›¾ç‰‡æ¨ç†
./metric_learning.elf deploy_config.json test.jpg 0

# å¤šæ ‡ç­¾åˆ†ç±»-è§†é¢‘æ¨ç†ï¼Œè¾“å…¥`q`å›è½¦é€€å‡ºè§†é¢‘æ¨ç†
./multilabel_classification.elf deploy_config.json None 0

# å¤šæ ‡ç­¾åˆ†ç±»-å›¾ç‰‡æ¨ç†
./multilabel_classification.elf deploy_config.json test.jpg 0
```

##### éƒ¨ç½²è¯´æ˜

- ğŸ“¢ åœ¨éƒ¨ç½²æ¨¡å‹æ—¶å¦‚æœæ•ˆæœä¸ç†æƒ³ï¼Œé¦–å…ˆè°ƒæ•´å¯¹åº”ä»»åŠ¡çš„é˜ˆå€¼å’Œæ¨ç†å›¾åƒçš„åˆ†è¾¨ç‡ï¼Œæµ‹è¯•ç»“æœæ˜¯å¦å¯ä»¥æœ‰å¥½è½¬ï¼

- ğŸ“¢ å­¦ä¼šå®šä½é—®é¢˜ï¼Œæ¯”å¦‚æŸ¥çœ‹AICubeæ¨¡å‹è¯„ä¼°çš„ç»“æœï¼Œå¦‚æœè¯¥å›¾ç‰‡æ­£å¸¸ï¼Œåˆ™å¯èƒ½æ˜¯éƒ¨ç½²ä»£ç ã€æ¨¡å‹è½¬æ¢æˆ–è€…é˜ˆå€¼çš„é—®é¢˜ï¼Œæ‚¨å¯ä»¥é€‰æ‹©è°ƒæ•´é‡åŒ–æ–¹å¼æˆ–è€…è°ƒæ•´éƒ¨ç½²å‚æ•°è¿›è¡Œä¼˜åŒ–ï¼

- ğŸ“¢ AICubeå­˜åœ¨å¤§é‡çš„è®­ç»ƒå‚æ•°ï¼Œå¯¹æ·±åº¦å­¦ä¹ äº†è§£çš„ç”¨æˆ·å¯ä»¥æ ¹æ®å¯èƒ½çš„ä¼˜åŒ–æ–¹å‘è°ƒæ•´è®­ç»ƒå‚æ•°ï¼Œè°ƒæ•´æ¨¡å‹è®­ç»ƒçš„å‚æ•°å®ç°é‡æ–°è®­ç»ƒè½¬æ¢ï¼

## FAQ
  
### å¼€å‘è¿‡ç¨‹ä¸­å¦‚ä½•æŸ¥æ‰¾é—®é¢˜æ‰€åœ¨ï¼Ÿ

ğŸ“ é¦–å…ˆæ ¹æ®ä¸åŒçš„é˜¶æ®µå’Œé”™è¯¯é‡‡å–ä¸åŒçš„æ–¹æ³•ï¼š

- å¦‚æœæ¨¡å‹è½¬æ¢é˜¶æ®µå‡ºç°é”™è¯¯ï¼Œå¯èƒ½æ˜¯è½¬æ¢ä»£ç å­˜åœ¨é—®é¢˜ï¼Œéœ€è¦é˜…è¯»nncaseçš„ä½¿ç”¨æ–¹æ³•ï¼Œè°ƒæ•´è½¬æ¢ä»£ç ï¼›
- å¦‚æœæ¨¡å‹è½¬æ¢æˆåŠŸï¼Œä½†æ˜¯æ•ˆæœä¸åŠé¢„æœŸï¼Œå¯ä»¥è€ƒè™‘è°ƒæ•´é˜ˆå€¼ã€æ›´æ”¹æ¨¡å‹è½¬æ¢çš„é‡åŒ–æ–¹å¼ã€è®­ç»ƒæ—¶è°ƒæ•´è®­ç»ƒå‚æ•°ï¼›
- å¦‚æœæ¨¡å‹è½¬æ¢æˆåŠŸï¼Œä½†æ˜¯å¸§ç‡è¾ƒä½ï¼Œå¯ä»¥è€ƒè™‘æ›´æ¢æ›´è½»é‡çš„æ¨¡å‹æˆ–è€…é™ä½æ¨¡å‹è¾“å…¥åˆ†è¾¨ç‡ï¼›
- å¦‚æœéƒ¨ç½²æŠ¥é”™ï¼Œè¯·æŸ¥çœ‹éƒ¨ç½²ä»£ç æŠ¥é”™è¡Œæ•°ï¼Œæ ¹æ®APIæ–‡æ¡£æŸ¥æ‰¾æŠ¥é”™åŸå› ï¼Œè°ƒæ•´ä»£ç ï¼›

### nncaseæ”¯æŒå“ªäº›ç®—å­ï¼Ÿ

ğŸ“ nncaseæ”¯æŒçš„onnxç®—å­å’Œtfliteç®—å­è§é“¾æ¥ï¼š[onnxç®—å­æ”¯æŒ](https://github.com/kendryte/nncase/blob/master/docs/onnx_ops.md) å’Œ [tfliteç®—å­æ”¯æŒ](https://github.com/kendryte/nncase/blob/master/docs/tflite_ops.md)

### åœ¨è½¬æ¢æ¨¡å‹æ—¶æŠ¥é”™â€œImportError: DLL load failed while importing _nncaseâ€

ğŸ“ è¯·å‚è€ƒå¦‚ä¸‹é“¾æ¥çš„è§£å†³æ–¹æ³•ï¼š[ImportError: DLL load failed while importing _nncase](https://github.com/kendryte/nncase/issues/451)

### è½¬æ¢æ¨¡å‹æ—¶æŠ¥é”™â€œRuntimeError: Failed to initialize hostfxrâ€

ğŸ“ è¯·å®‰è£…dotnet-sdk-7.0ï¼Œ è¯·ä¸è¦å†Anacondaè™šæ‹Ÿç¯å¢ƒä¸­å®‰è£…dotnet-sdkã€‚

Linux:

```shell
sudo apt-get update
sudo apt-get install dotnet-sdk-7.0
If you still have problems after installation, maybe you install dotnet in a virtual enviroment, set the environment variables. dotnet error
export DOTNET_ROOT=/usr/share/dotnet
```

Windows: è¯·å‚è€ƒå¾®è½¯å®˜æ–¹ç½‘ç«™ã€‚

### åœ¨çº¿è®­ç»ƒå¹³å°å’ŒAICubeçš„åŒºåˆ«ï¼Ÿ

ğŸ“ åœ¨çº¿è®­ç»ƒå¹³å°çš„ä½¿ç”¨äº‘ç«¯ç®—åŠ›ï¼Œèµ„æºç´§å¼ æ—¶éœ€è¦æ’é˜Ÿï¼ŒåŒæ—¶å‚æ•°é…ç½®æ¯”è¾ƒç®€å•ï¼Œä¸€é”®è®­ç»ƒï¼Œçµæ´»æ€§è¾ƒä½ï¼›AICubeä½¿ç”¨æœ¬åœ°ç§äººç®—åŠ›ï¼Œç¯å¢ƒå’Œå‚æ•°é…ç½®æ¯”è¾ƒå¤æ‚ï¼Œçµæ´»æ€§é«˜ã€‚ä»–ä»¬çš„ç›®çš„éƒ½æ˜¯è·å¾—kmodelå’Œé…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨å›ºä»¶ä¸­çš„`src/rtsmart/examples/cloudplat_deploy_code`çš„ä»£ç ç¼–è¯‘å³å¯å®ç°éƒ¨ç½²ã€‚

### YOLOåº“ä¸­æ”¯æŒå“ªäº›ä»»åŠ¡ï¼Ÿ

ğŸ“ YOLOv5æ”¯æŒåˆ†ç±»ã€æ£€æµ‹ã€åˆ†å‰²ä¸‰ç±»ä»»åŠ¡ï¼ŒYOLOv8å’ŒYOLO11æ”¯æŒåˆ†ç±»ã€æ£€æµ‹ã€åˆ†å‰²å’Œæ—‹è½¬ç›®æ ‡æ£€æµ‹å››ç±»ä»»åŠ¡ã€‚

### å¦‚ä½•è·å–æ”¯æŒï¼Ÿ

ğŸ“ åœ¨å¼€å‘è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œæ‚¨å¯ä»¥å‰å¾€å˜‰æ¥ å¼€å‘è€…ç¤¾åŒºé—®ç­”è®ºå›å‘å¸–æé—®ã€‚è®ºå›åœ°å€ï¼š[Canaané—®ç­”è®ºå›](https://www.kendryte.com/answer/)ã€‚

## é™„å½•

### API

K230 RT-Smart APIæ–‡æ¡£è§é“¾æ¥ï¼š[APIæ–‡æ¡£](https://www.kendryte.com/k230_rtos/zh/main/api_reference/index.html)

### KTS

`K230_training_scriptsï¼ˆKTSï¼‰`æ˜¯å®ç°çš„ç«¯åˆ°ç«¯çš„è®­ç»ƒå¤„ç†è¿‡ç¨‹ï¼Œä½†æ˜¯è¯¥é¡¹ç›®çš„ä»£ç æ˜¯åŸºäºåŒç³»ç»ŸC++å¼€å‘çš„ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è¯¥å·¥å…·è·å–kmodelã€‚é¡¹ç›®åœ°å€ï¼š[K230_training_scripts](https://github.com/kendryte/K230_training_scripts)ã€‚
